[
  {
    "id" : "3b501372-7612-40fa-863e-486edcd6944e",
    "prId" : 39002,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39002#pullrequestreview-402367380",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "123cca48-30fa-4868-805e-1b6ff9b85664",
        "parentId" : null,
        "authorId" : "6f904d11-bed6-4022-8971-4dbfb55561c0",
        "body" : "You need to `from tensorflow.python import tf2` for this.",
        "createdAt" : "2020-04-29T05:07:55Z",
        "updatedAt" : "2020-04-29T06:27:16Z",
        "lastEditedBy" : "6f904d11-bed6-4022-8971-4dbfb55561c0",
        "tags" : [
        ]
      },
      {
        "id" : "b402916b-3afa-4495-b8fe-521daa0cba8a",
        "parentId" : "123cca48-30fa-4868-805e-1b6ff9b85664",
        "authorId" : "3126854e-2947-4f0e-9f3f-0c90477c7ea9",
        "body" : "Yep, working on another CP for this. Thanks!",
        "createdAt" : "2020-04-29T05:09:53Z",
        "updatedAt" : "2020-04-29T06:27:16Z",
        "lastEditedBy" : "3126854e-2947-4f0e-9f3f-0c90477c7ea9",
        "tags" : [
        ]
      }
    ],
    "commit" : "d8d265779c8cc29e3d49cfcdb58fd4d4238c17a6",
    "line" : 810,
    "diffHunk" : "@@ -1,1 +1379,1383 @@    with ops.device(worker):\n      worker_devices = input_workers.compute_devices_for_worker(i)\n      if tf2.enabled() and not enable_legacy_iterators:\n        iterator = _SingleWorkerOwnedDatasetIterator(worker_datasets[i], worker,\n                                                     worker_devices)"
  },
  {
    "id" : "98866b4e-1f8e-4702-a7e1-f08cca3580d5",
    "prId" : 38968,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/38968#pullrequestreview-505990928",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "21d93b0c-f20c-4f39-a815-0feff4737ece",
        "parentId" : null,
        "authorId" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "body" : "This file still needs to address these main comments:\r\n\r\nhttps://github.com/tensorflow/tensorflow/pull/38968#discussion_r486760778 (you've removed the placement on GPU but need to combine the code more with the other PER_WORKER path)\r\nhttps://github.com/tensorflow/tensorflow/pull/38968/files#r486753816\r\nhttps://github.com/tensorflow/tensorflow/pull/38968#discussion_r486759716\r\n\r\nOnce those are reviewed, i ll review it again.\r\n\r\n",
        "createdAt" : "2020-09-18T03:40:47Z",
        "updatedAt" : "2020-10-16T22:58:06Z",
        "lastEditedBy" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "tags" : [
        ]
      },
      {
        "id" : "0327b5e9-3217-4fc4-8c8d-13a18cfa70fe",
        "parentId" : "21d93b0c-f20c-4f39-a815-0feff4737ece",
        "authorId" : "7eb69383-d92b-478c-941d-f9486652ab60",
        "body" : "I tried to address the requests. Please have a look and let me know what you think.",
        "createdAt" : "2020-09-28T02:09:53Z",
        "updatedAt" : "2020-10-16T22:58:06Z",
        "lastEditedBy" : "7eb69383-d92b-478c-941d-f9486652ab60",
        "tags" : [
        ]
      },
      {
        "id" : "242f243d-2b53-4faa-91f2-a9cffda17c4e",
        "parentId" : "21d93b0c-f20c-4f39-a815-0feff4737ece",
        "authorId" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "body" : "I don't think these are correctly addressed, i have left comments next to the relevant code.",
        "createdAt" : "2020-10-10T00:25:23Z",
        "updatedAt" : "2020-10-16T22:58:06Z",
        "lastEditedBy" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "tags" : [
        ]
      }
    ],
    "commit" : "82d96700dabb2e613e7da2248609254a1e11adc3",
    "line" : 2,
    "diffHunk" : "@@ -1,1 +34,38 @@from tensorflow.python.distribute import distribution_strategy_context\nfrom tensorflow.python.distribute import input_ops\nfrom tensorflow.python.distribute import reduce_util\nfrom tensorflow.python.distribute import values\nfrom tensorflow.python.distribute.distribute_lib import InputReplicationMode"
  },
  {
    "id" : "723df7d5-3914-49a4-bb9a-4524f586f155",
    "prId" : 38968,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/38968#pullrequestreview-507014790",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "833200cd-3777-4c9c-9c59-a0d3d250e0b9",
        "parentId" : null,
        "authorId" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "body" : "As I had mentioned in one of the previous rounds of review(https://github.com/tensorflow/tensorflow/pull/38968/files#r486753816), it's fine if we don't want to use the `OwnedMultiDeviceIterator` for DALI users. But we do need to do something to make this behavior and expectation clear. \r\n\r\nWe already have an option `options.experimental_prefetch_to_device` to make this clear. We can use that here to make the decision of when to use `OwnedMultiDeviceIterator` or not:\r\n\r\nWhen options.replication_mode== PER_REPLICA:\r\n1) If options.experimental_prefetch_to_device=True => Use OwnedMultiDeviceIterator\r\n2) If options.experimental_prefetch_to_device=False => Use simple `iter(..)` \r\n\r\nSo DALI users can pass `options(replication_mode=PER_REPLICA, experimental_prefetch_to_device=False)`\r\n\r\n\r\n\r\n\r\n\r\n",
        "createdAt" : "2020-10-09T21:58:37Z",
        "updatedAt" : "2020-10-16T22:58:06Z",
        "lastEditedBy" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "tags" : [
        ]
      },
      {
        "id" : "c34ffb82-a607-4e0a-85d2-05115f6098f6",
        "parentId" : "833200cd-3777-4c9c-9c59-a0d3d250e0b9",
        "authorId" : "7eb69383-d92b-478c-941d-f9486652ab60",
        "body" : "Addressed by adding the new option \"experimental_copy_dataset_on_device\"",
        "createdAt" : "2020-10-13T01:45:22Z",
        "updatedAt" : "2020-10-16T22:58:06Z",
        "lastEditedBy" : "7eb69383-d92b-478c-941d-f9486652ab60",
        "tags" : [
        ]
      }
    ],
    "commit" : "82d96700dabb2e613e7da2248609254a1e11adc3",
    "line" : 237,
    "diffHunk" : "@@ -1,1 +1648,1652 @@      host_device = device_util.get_host_for_device(self._worker)\n      with ops.device(self._worker):\n        self._iterator = multi_device_iterator_ops.OwnedMultiDeviceIterator(\n            self._dataset, self._devices, source_device=host_device)\n    else:"
  },
  {
    "id" : "2d886f1b-4e0c-42a4-9a4c-9e3ff47030e7",
    "prId" : 38968,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/38968#pullrequestreview-509974330",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb84f4c2-a8cc-4f1a-951a-ff6c5a636154",
        "parentId" : null,
        "authorId" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "body" : "nit: Can we add a comment here for the reader explaining why we need this? since the iterator code is removed from here it may be hard to understand right away.",
        "createdAt" : "2020-10-16T02:43:27Z",
        "updatedAt" : "2020-10-16T22:58:07Z",
        "lastEditedBy" : "41542927-e19d-470d-b24b-77a91acd82ee",
        "tags" : [
        ]
      }
    ],
    "commit" : "82d96700dabb2e613e7da2248609254a1e11adc3",
    "line" : 161,
    "diffHunk" : "@@ -1,1 +1469,1473 @@    if (self._options\n        and self._options.experimental_replication_mode == InputReplicationMode.PER_REPLICA\n            and not self._options.experimental_prefetch_to_device):\n      return [data_list]\n    else:"
  }
]