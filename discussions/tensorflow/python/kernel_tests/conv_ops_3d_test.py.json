[
  {
    "id" : "627ae097-dd19-4cae-96cc-345645b2c4f3",
    "prId" : 30968,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/30968#pullrequestreview-266791269",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "parentId" : null,
        "authorId" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "body" : "Shouldn't this shape be invalid? If it's all 0s then it's okay. But 0s in just some dimensions is just not possible (dim sizes should be 1s instead of 0s).",
        "createdAt" : "2019-07-24T17:41:36Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "tags" : [
        ]
      },
      {
        "id" : "49d8fdbd-f2b2-41b3-83c3-a07c2abedf42",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "body" : "During our internal testing, one model encountered this shape, Eigen did not error out and execution proceeded. [Intel MKL] version had cascade errors related to these corner cases. \r\nDo you want me to investigate why a model would create such a shape before this PR gets merged?  ",
        "createdAt" : "2019-07-24T17:57:10Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "tags" : [
        ]
      },
      {
        "id" : "72187f95-97bd-4144-bd2f-6be233f12a92",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "body" : "That would be great. Thank you very much! \r\nI'm looping in @ezhulenev for comments on Eigen and grappler.",
        "createdAt" : "2019-07-24T18:08:36Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "tags" : [
        ]
      },
      {
        "id" : "cb6e382b-05e0-4f79-b457-7e8c82ff79af",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "body" : "Ok, I will do the investigation and report back.  ",
        "createdAt" : "2019-07-24T18:20:01Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "tags" : [
        ]
      },
      {
        "id" : "2bdea1de-95ee-4460-9620-72f8b3230326",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "cc3a9462-2410-463b-a9e3-7b2b39d1f5bd",
        "body" : "I've seen in multiple kernels check for zero in dimensions, though I'm also not sure that this is legal, and how that can happen.",
        "createdAt" : "2019-07-24T18:34:20Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "cc3a9462-2410-463b-a9e3-7b2b39d1f5bd",
        "tags" : [
        ]
      },
      {
        "id" : "e121bc61-5a56-45d3-9367-9289c61db195",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "cc3a9462-2410-463b-a9e3-7b2b39d1f5bd",
        "body" : "@alextp  usually has answers for all questions.",
        "createdAt" : "2019-07-24T18:36:05Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "cc3a9462-2410-463b-a9e3-7b2b39d1f5bd",
        "tags" : [
        ]
      },
      {
        "id" : "4311f827-c886-41a4-83ac-38bfb23db81b",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "body" : "Ok, could be user application bug/corner case that slipped the checks. I will dig more into the origin of this shape during runtime.",
        "createdAt" : "2019-07-24T19:30:35Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "tags" : [
        ]
      },
      {
        "id" : "5a552258-b00c-4beb-abd3-7c80fcceb66f",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "0184dacc-e36e-4f02-9c48-fb3acedd41da",
        "body" : "0 in some dimensions is perfectly fine and should happen naturally during the course of many tf programs. For example, if to do partitioned embedding lookup, you take a tensor of indices and partition it so all indices in a range go to a certain partition. Since the content of the indices is dynamic, it's perfectly possible that a partition ends up with no indices, so shape [0]. Then if you use these indices to gather rows from a variable of shape [N, M], you get something with shape [0, M]. You can then apply a linear layer on these, and get something of the shape [0, K], etc.\r\n\r\nIf we cannot reason about these empty tensors with different shapes we're strongly limited on the type of shape dynamism we can support.",
        "createdAt" : "2019-07-25T16:53:21Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "0184dacc-e36e-4f02-9c48-fb3acedd41da",
        "tags" : [
        ]
      },
      {
        "id" : "13388b52-783b-4b56-a7a4-897e1a1f4cab",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "body" : "Thanks @alextp  for the nice explanation!  @penpornk It seems the tensor shape with 0 in its dimension is a valid tensor, and I accidentally noticed some comments in c_api.cc where it created EmptyTensor, and did not care about shape.dims -- as long as the number of elements is 0. \r\n\r\nhttps://github.com/tensorflow/tensorflow/blob/0f08941cfbdf24474f7660cde5e880633a7e78be/tensorflow/c/c_api.cc#L390-L407\r\n\r\nSo during runtime, the above 0 sized tensor indeed can happen. ",
        "createdAt" : "2019-07-25T17:04:46Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "tags" : [
        ]
      },
      {
        "id" : "ce3801ad-b22f-42c0-acdc-76e80bcc770b",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "body" : "Got it. So it's just a reserved shape without any elements. Thank you everyone for the explanation!\r\n",
        "createdAt" : "2019-07-25T17:31:01Z",
        "updatedAt" : "2019-07-25T17:56:40Z",
        "lastEditedBy" : "72acf7f0-6473-4b57-a71f-2a44410818c5",
        "tags" : [
        ]
      },
      {
        "id" : "75eaadc0-822a-433c-b5d1-d4e8ce74afc3",
        "parentId" : "b767af67-2e7c-4f97-ba5b-f0e93d9ce8cf",
        "authorId" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "body" : "Thank you @penpornk for reviewing and raising this question! \r\nBTW, I committed the strides change via github GUI. Please review :) ",
        "createdAt" : "2019-07-25T17:59:36Z",
        "updatedAt" : "2019-07-25T17:59:36Z",
        "lastEditedBy" : "a6e3f10f-d7ac-4c17-a58a-edcaece160f6",
        "tags" : [
        ]
      }
    ],
    "commit" : "ea3185dab5f5fb36ab722ca61b95776408b8e2a9",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +322,326 @@    Args: none\n    \"\"\"\n    input_shape = [0, 112, 112, 112, 32]\n    filter_shape = [3, 3, 3, 32, 64]\n"
  }
]