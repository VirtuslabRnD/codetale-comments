[
  {
    "id" : "ab6dfc40-580b-4240-9441-83495236ce58",
    "prId" : 40368,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/40368#pullrequestreview-433337712",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6329c7b3-de7a-4fa1-8822-7b1e7b6631d5",
        "parentId" : null,
        "authorId" : "25d9ca1a-eec3-4905-a140-d1d6a3a2fde2",
        "body" : "Maybe call this `map_explicit_values` or `map_nondefault_values`, to make it more clear that this only applies to explicit values?  (For users who are less knowledgable about the inner workings of SparseTensor, it may not be clear that a SparseTensor's \"values\" just refers to the explicit values.)\r\n\r\n@alextp Thoughts on naming for this?",
        "createdAt" : "2020-06-18T14:30:22Z",
        "updatedAt" : "2020-07-02T18:25:10Z",
        "lastEditedBy" : "25d9ca1a-eec3-4905-a140-d1d6a3a2fde2",
        "tags" : [
        ]
      }
    ],
    "commit" : "e5540f1c89e0432ccfb25d994f5021beab4e3333",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +2737,2741 @@@tf_export(\"sparse.map_values\", v1=[])\n@dispatch.add_dispatch_support\ndef map_values(op, *args, **kwargs):\n  \"\"\"Applies `op` to the `.values` tensor of one or more `SparseTensor`s.\n"
  },
  {
    "id" : "5c4ed882-7244-41ab-8492-15a6ff48fea3",
    "prId" : 40368,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/40368#pullrequestreview-433337712",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f9ea54e8-e5ed-4cb3-aed2-9458378d3318",
        "parentId" : null,
        "authorId" : "25d9ca1a-eec3-4905-a140-d1d6a3a2fde2",
        "body" : "`indices` and `dense_shape`",
        "createdAt" : "2020-06-18T14:33:04Z",
        "updatedAt" : "2020-07-02T18:25:10Z",
        "lastEditedBy" : "25d9ca1a-eec3-4905-a140-d1d6a3a2fde2",
        "tags" : [
        ]
      }
    ],
    "commit" : "e5540f1c89e0432ccfb25d994f5021beab4e3333",
    "line" : 59,
    "diffHunk" : "@@ -1,1 +2782,2786 @@    and `dense_shape` of all input `SparseTensor`s.\n  Raises:\n    ValueError: If args contains no `SparseTensor`, or if the `indices`\n      or `dense_shape`s of the input `SparseTensor`s are not equal.\n  \"\"\""
  },
  {
    "id" : "f738a19b-d409-42f5-a6ca-038f4e71e940",
    "prId" : 3031,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c549456b-d1e7-403a-8bb8-9dfc671e351f",
        "parentId" : null,
        "authorId" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "body" : "This looks pretty good. Now, I think it would be even better if moved this to be part of the regular transpose op. You could put this code inside an \"if isinstance(input, ops.SparseTensor):\" check in https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_ops.py#L995\n\nIt would be great if you could update the corresponding gradient and its tests at the same time:\n\nhttps://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/ops/array_grad.py#L322\n\nit should be pretty easy.\n",
        "createdAt" : "2016-08-10T21:46:39Z",
        "updatedAt" : "2016-08-26T06:11:15Z",
        "lastEditedBy" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "tags" : [
        ]
      },
      {
        "id" : "debf3210-3e30-4362-8b6f-3023418fea81",
        "parentId" : "c549456b-d1e7-403a-8bb8-9dfc671e351f",
        "authorId" : "d09a4fdb-5c41-4fa8-b3a3-771a8d191bf1",
        "body" : "thanks for the help and sorry for the delay. I have tried to put it in array_ops itself but this code uses the transpose function itself on the dense tensor and also the `sparse_reorder` function needs to reorder the final values in the transposed sparse tensor. But AFAICS, none of the sparse functions are used in the array_ops, probably because that would create a cyclic dependency. It would be really helpful if you could guide me here. \nAlso could you let me know about updating the grad for the sparse tensor. Thanks.\n",
        "createdAt" : "2016-08-16T18:21:18Z",
        "updatedAt" : "2016-08-26T06:11:15Z",
        "lastEditedBy" : "d09a4fdb-5c41-4fa8-b3a3-771a8d191bf1",
        "tags" : [
        ]
      },
      {
        "id" : "ba28a384-bdef-4989-beb3-e2540650f0b7",
        "parentId" : "c549456b-d1e7-403a-8bb8-9dfc671e351f",
        "authorId" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "body" : "@maniteja123 You are right, let's keep it as a separate function for now. I think if you extend the tests to cover rank > 2 tensors, we should be good. Maybe it would be easier to generate random sparse tensors and use tf.sparse_tensor_to_dense(t) to convert it to dense, transpose the dense and compare with the \"densified\" version of the output from your function. See e.g. https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/sparse_ops_test.py#L721\n",
        "createdAt" : "2016-08-25T17:33:18Z",
        "updatedAt" : "2016-08-26T06:11:15Z",
        "lastEditedBy" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "tags" : [
        ]
      },
      {
        "id" : "17ac1134-2559-42a3-9945-db21bc4e082a",
        "parentId" : "c549456b-d1e7-403a-8bb8-9dfc671e351f",
        "authorId" : "d09a4fdb-5c41-4fa8-b3a3-771a8d191bf1",
        "body" : "@rmlarsen Thanks a lot for the clarification. I tried to add a test for tensors of rank from 1 to 5 and generate a permutation. I still have not added a gradient as I wasn't able to proceed and have never written one before. Please do let me know if that has to be implemented and any advice is greatly helpful. Thanks.\n",
        "createdAt" : "2016-08-26T06:25:55Z",
        "updatedAt" : "2016-08-26T06:25:55Z",
        "lastEditedBy" : "d09a4fdb-5c41-4fa8-b3a3-771a8d191bf1",
        "tags" : [
        ]
      }
    ],
    "commit" : "226d459c3fa53807263bf66cf848b7225184e6e2",
    "line" : 47,
    "diffHunk" : "@@ -1,1 +1619,1623 @@    TypeError: If `sp_input` is not a `SparseTensor`.\n  \"\"\"\n  with ops.op_scope([sp_input], name, \"SparseTranspose\") as name:\n    if perm is None:\n      rank = array_ops.rank(sp_input)"
  },
  {
    "id" : "a1cc3d0e-bf2d-4053-b4f5-c5be18cff968",
    "prId" : 3031,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "11696795-2a4f-4884-890c-802679b928f2",
        "parentId" : null,
        "authorId" : "ee2af531-7125-47f4-8d81-dfb9211dc054",
        "body" : "This line is longer than 80 cols.\n",
        "createdAt" : "2016-08-26T18:23:36Z",
        "updatedAt" : "2016-08-26T18:23:36Z",
        "lastEditedBy" : "ee2af531-7125-47f4-8d81-dfb9211dc054",
        "tags" : [
        ]
      }
    ],
    "commit" : "226d459c3fa53807263bf66cf848b7225184e6e2",
    "line" : 52,
    "diffHunk" : "@@ -1,1 +1624,1628 @@      perm = (rank - 1) - math_ops.range(0, rank, 1)\n    indices = sp_input.indices\n    transposed_indices = array_ops.transpose(array_ops.gather(array_ops.transpose(indices), perm))\n    dense_shape = sp_input.shape\n    transposed_dense_shape = array_ops.gather(dense_shape, perm)"
  }
]