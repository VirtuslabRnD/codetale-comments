[
  {
    "id" : "01f14ddf-d0fa-40d3-8d7e-a8184c741329",
    "prId" : 47826,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/47826#pullrequestreview-613570131",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "parentId" : null,
        "authorId" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "body" : "This could be further simplified, but would require changes to\r\nhttps://github.com/tensorflow/tensorflow/blob/21f11ebd835bcf35c8946925f1e570dc15a1b6e7/tensorflow/python/ops/default_gradient.py#L52-L57\r\nto accept keyword arguments like `name`. Let me know if you think that's worth doing.",
        "createdAt" : "2021-03-15T19:43:52Z",
        "updatedAt" : "2021-03-16T17:45:27Z",
        "lastEditedBy" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "tags" : [
        ]
      },
      {
        "id" : "2dcbb275-97a5-4f5f-a29a-480362937dff",
        "parentId" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "authorId" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "body" : "Does the array_ops.py ones_like work? https://github.com/tensorflow/tensorflow/blob/85c8b2a817f95a3e979ecd1ed95bff1dc1335cff/tensorflow/python/ops/array_ops.py#L3002",
        "createdAt" : "2021-03-16T17:27:30Z",
        "updatedAt" : "2021-03-16T17:45:27Z",
        "lastEditedBy" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "tags" : [
        ]
      },
      {
        "id" : "5c4accc4-2f47-48d7-900a-3d7886e1c0aa",
        "parentId" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "authorId" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "body" : "I don't think that's possible since judging from [this check](https://github.com/tensorflow/tensorflow/blob/f099387426243a6e37e63ad7082bac2fe403efb1/tensorflow/python/ops/gradients_util.py#L198), `y` can be a `tf.resource` which is not supported by `array_ops.ones_like`.",
        "createdAt" : "2021-03-16T17:41:48Z",
        "updatedAt" : "2021-03-16T17:45:27Z",
        "lastEditedBy" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "tags" : [
        ]
      },
      {
        "id" : "d06a9bcb-2de7-43d7-af02-044445dd62d5",
        "parentId" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "authorId" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "body" : "None of these (fill, array_ops.zeros, array_ops.zeros_like) support resource-dtype tensors. It looks like it's calling the same \"ones\" kernel right now, but having it call the standard API would be useful if we ever decide to have a \"OnesLike\" kernel like we do for zeros.",
        "createdAt" : "2021-03-16T17:48:07Z",
        "updatedAt" : "2021-03-16T17:48:08Z",
        "lastEditedBy" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "tags" : [
        ]
      },
      {
        "id" : "4849d2e6-3aa6-4390-a375-781749d28163",
        "parentId" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "authorId" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "body" : "Not sure if I fully understand your comment. The current code works correctly for resource-dtype tensors since `tf.shape` can handle resource-dtype tensors, so `array_ops.zeros` never receives a resource-dtype tensors itself.",
        "createdAt" : "2021-03-16T17:56:58Z",
        "updatedAt" : "2021-03-16T17:56:58Z",
        "lastEditedBy" : "c0e6af67-982a-4e5a-980e-4580b05253a0",
        "tags" : [
        ]
      },
      {
        "id" : "d80a2e04-9985-4df2-a42c-4b0d796e7c67",
        "parentId" : "3c416b9d-8ace-4948-88cc-62c0568c38eb",
        "authorId" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "body" : "Shape works fine, but neither constant_op.constant(1, dtype=dtypes.resource) nor array_ops.ones(shape=..., dtype=dtypes.resource) work. array_ops.ones_like just moves some of the boilerplate to a helper, the functionality is equivalent.",
        "createdAt" : "2021-03-16T18:04:54Z",
        "updatedAt" : "2021-03-16T18:04:55Z",
        "lastEditedBy" : "e08938af-f8a8-460f-881b-a60c1ee311f5",
        "tags" : [
        ]
      }
    ],
    "commit" : "87bdd515ecd1991cb11d5dac654f47033f520768",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +173,177 @@        new_grad_ys.append(\n            array_ops.ones(\n                array_ops.shape(y), dtype=y.dtype, name=\"grad_ys_%d\" % i))\n        continue\n      if y.dtype.is_floating or y.dtype.is_integer:"
  }
]