[
  {
    "id" : "76741155-8cd6-431b-96b8-013e5fd0abd2",
    "prId" : 37837,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/37837#pullrequestreview-382490401",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2b7ca7eb-4b9b-4953-a707-4a20933a3bf4",
        "parentId" : null,
        "authorId" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "body" : "Doesn't this lose everything that was in `self._descriptor_cache` before pickling?",
        "createdAt" : "2020-03-26T18:59:49Z",
        "updatedAt" : "2020-04-01T18:04:40Z",
        "lastEditedBy" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "tags" : [
        ]
      },
      {
        "id" : "8dcfc6c1-3e45-4853-a3a6-ff21126194e1",
        "parentId" : "2b7ca7eb-4b9b-4953-a707-4a20933a3bf4",
        "authorId" : "2ce871bd-92cf-491c-aace-f9ebbd579d15",
        "body" : "This is the _unpickle_ function, so it's creating a new function from scratch. So yes, the cache is empty, but that's fine, it's a new object.",
        "createdAt" : "2020-03-26T19:56:02Z",
        "updatedAt" : "2020-04-01T18:04:40Z",
        "lastEditedBy" : "2ce871bd-92cf-491c-aace-f9ebbd579d15",
        "tags" : [
        ]
      },
      {
        "id" : "523a76f5-9feb-41b6-9f23-031736113bcb",
        "parentId" : "2b7ca7eb-4b9b-4953-a707-4a20933a3bf4",
        "authorId" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "body" : "Yes, I know it's the _unpickle_ code path. My question was about whether we need to store more state when pickling and restore it at unpickling.\r\n\r\nBut I think it's ok on more read of the API. Leaving @alextp to give the final approval",
        "createdAt" : "2020-03-26T23:33:24Z",
        "updatedAt" : "2020-04-01T18:04:40Z",
        "lastEditedBy" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "9274fe4678f120de6081d5f9f4395c2181ca33dc",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +434,438 @@    self.__dict__ = state\n    self._lock = threading.Lock()\n    self._descriptor_cache = weakref.WeakKeyDictionary()\n\n  def _defun_with_scope(self, scope):"
  },
  {
    "id" : "ad942899-248f-41cc-a0b5-9fc97567fb4b",
    "prId" : 37837,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/37837#pullrequestreview-382366581",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a8c84cf9-1ac8-4f90-990d-41fa1f2f658c",
        "parentId" : null,
        "authorId" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "body" : "We should also make sure the lock is released to prevent deadlocks.",
        "createdAt" : "2020-03-26T19:00:11Z",
        "updatedAt" : "2020-04-01T18:04:40Z",
        "lastEditedBy" : "9f15379f-126a-430d-93cb-7cc21488adf2",
        "tags" : [
        ]
      },
      {
        "id" : "152fa992-2c41-4a28-a371-63a571a7fbec",
        "parentId" : "a8c84cf9-1ac8-4f90-990d-41fa1f2f658c",
        "authorId" : "2ce871bd-92cf-491c-aace-f9ebbd579d15",
        "body" : "This is a copy of the object. It doesn't affect the original object in any way. And when it's unpickled it creates new, unlocked lock. So it should be fine.",
        "createdAt" : "2020-03-26T19:56:01Z",
        "updatedAt" : "2020-04-01T18:04:40Z",
        "lastEditedBy" : "2ce871bd-92cf-491c-aace-f9ebbd579d15",
        "tags" : [
        ]
      }
    ],
    "commit" : "9274fe4678f120de6081d5f9f4395c2181ca33dc",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +426,430 @@    \"\"\"Custom pickling, to omit unpickleable objects.\"\"\"\n    result = self.__dict__.copy()\n    del result[\"_lock\"]\n    del result[\"_descriptor_cache\"]\n    return result"
  }
]