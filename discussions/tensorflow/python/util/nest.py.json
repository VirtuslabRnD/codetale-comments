[
  {
    "id" : "a77c79f5-554e-48b6-bd60-0e4f1b59d401",
    "prId" : 36186,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/36186#pullrequestreview-356047943",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a85b783a-dbb5-43e7-9ab2-a9e46214a661",
        "parentId" : null,
        "authorId" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "body" : "You're missing the else branch here (and also for default dicts the constructor needs to be called with the factory argument, as in the old code).",
        "createdAt" : "2020-02-08T14:56:56Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "tags" : [
        ]
      },
      {
        "id" : "80330fdc-9ef9-4791-8b14-515632adc3a6",
        "parentId" : "a85b783a-dbb5-43e7-9ab2-a9e46214a661",
        "authorId" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "body" : "You mean to use `_collections.defaultdict(instance.default_factory)` for the `defaultdict` constructor arguement as done in `_is_mapping` branch?",
        "createdAt" : "2020-02-08T15:57:58Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "tags" : [
        ]
      },
      {
        "id" : "0bf64973-6291-4842-bdb1-91be846bf623",
        "parentId" : "a85b783a-dbb5-43e7-9ab2-a9e46214a661",
        "authorId" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "body" : "Yes.",
        "createdAt" : "2020-02-09T16:54:19Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "tags" : [
        ]
      },
      {
        "id" : "4d753c04-e644-4fd5-a3e4-a0a940f6ea0f",
        "parentId" : "a85b783a-dbb5-43e7-9ab2-a9e46214a661",
        "authorId" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "body" : "Ok",
        "createdAt" : "2020-02-10T15:51:12Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "tags" : [
        ]
      }
    ],
    "commit" : "54457e58a7ac020f1446f661b72306d7d94baf1b",
    "line" : 52,
    "diffHunk" : "@@ -1,1 +147,151 @@    result = dict(zip(_sorted(instance), args))\n    instance_type = type(instance)\n    if instance_type == _collections.defaultdict:\n      d = _collections.defaultdict(instance.default_factory)\n    else:"
  },
  {
    "id" : "b7323dca-acd8-47cd-92df-e1f0643edd9f",
    "prId" : 36186,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/36186#pullrequestreview-356636480",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "eedd98a9-78d4-4c9b-8246-dd3130ce02c6",
        "parentId" : null,
        "authorId" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "body" : "I'm a bit worried that we might break someone who relied on this behavior before. Let's keep the old branch for _is_mapping (removing the pieces specific to defaultdict), but add a warning to it:\r\n\r\n```\r\ntf_logging.log_first_n(\r\n    tf_logging.WARN, \"Mapping types may not work well with tf.nest. Prefer using MutableMapping for {}\".format(instance_type), 1)\r\n```",
        "createdAt" : "2020-02-11T01:57:13Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "tags" : [
        ]
      },
      {
        "id" : "e1cf0c27-327a-4e33-9abc-5bcfb4187c12",
        "parentId" : "eedd98a9-78d4-4c9b-8246-dd3130ce02c6",
        "authorId" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "body" : "So shall I create a normal `dict` for for the `is_mapping` branch while adding the warning at the beginning of the branch which would be better?",
        "createdAt" : "2020-02-11T06:56:34Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "438a1d7c-32d4-4b58-919d-9f2710601580",
        "tags" : [
        ]
      },
      {
        "id" : "ef76ac22-d306-4db9-b825-c0afe16ed3fd",
        "parentId" : "eedd98a9-78d4-4c9b-8246-dd3130ce02c6",
        "authorId" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "body" : "Yes. Preserve the original code, minus the special cases for defaultdict, and adding the warning.",
        "createdAt" : "2020-02-11T13:01:37Z",
        "updatedAt" : "2020-02-12T10:23:27Z",
        "lastEditedBy" : "6d710ed1-8ddd-4cc0-acf7-45a1b4f8ceba",
        "tags" : [
        ]
      }
    ],
    "commit" : "54457e58a7ac020f1446f661b72306d7d94baf1b",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +139,143 @@    `args` with the type of `instance`.\n  \"\"\"\n  if _is_mutable_mapping(instance):\n    # Pack dictionaries in a deterministic order by sorting the keys.\n    # Notice this means that we ignore the original order of `OrderedDict`"
  }
]