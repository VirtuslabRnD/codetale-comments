[
  {
    "id" : "fa22d0c5-0169-41ed-ab22-a2f501fea729",
    "prId" : 50153,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/50153#pullrequestreview-681841850",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c41e65ef-6663-46a2-9b4e-a9d514ced27f",
        "parentId" : null,
        "authorId" : "46fa9a61-9f6f-4ecb-a276-f19713d630df",
        "body" : "Why is this method available only for fusions?",
        "createdAt" : "2021-06-08T23:21:57Z",
        "updatedAt" : "2021-06-09T19:55:52Z",
        "lastEditedBy" : "46fa9a61-9f6f-4ecb-a276-f19713d630df",
        "tags" : [
        ]
      },
      {
        "id" : "1589abce-4332-4326-90ee-754d55e29cf1",
        "parentId" : "c41e65ef-6663-46a2-9b4e-a9d514ced27f",
        "authorId" : "f5c553cb-d123-4eb4-9f6d-9a715871f6eb",
        "body" : "I based my implementation on the `AddParameter()` and `RemoveParameter()` methods. They had those restriction, so I kept it for safety.",
        "createdAt" : "2021-06-11T14:06:51Z",
        "updatedAt" : "2021-06-11T14:28:13Z",
        "lastEditedBy" : "f5c553cb-d123-4eb4-9f6d-9a715871f6eb",
        "tags" : [
        ]
      }
    ],
    "commit" : "250bced1fae220caa31efc9e64537aeed042bbf2",
    "line" : 10,
    "diffHunk" : "@@ -1,1 +205,209 @@  CHECK_LT(param_no, param_instructions_.size());\n  CHECK(instruction->opcode() == HloOpcode::kParameter);\n  CHECK(IsFusionComputation());\n  CHECK_EQ(fusion_instruction_->operand_count(), param_instructions_.size());\n"
  },
  {
    "id" : "dea4c6cf-371e-4be0-9aa5-582c0c54a24e",
    "prId" : 50153,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/50153#pullrequestreview-681841850",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d50582c1-fa8e-4236-8a9b-10a06b19f509",
        "parentId" : null,
        "authorId" : "46fa9a61-9f6f-4ecb-a276-f19713d630df",
        "body" : "I feel quite uneasy about this API, how does it work when shapes don't match? Could you give an example?",
        "createdAt" : "2021-06-09T19:55:44Z",
        "updatedAt" : "2021-06-09T19:55:52Z",
        "lastEditedBy" : "46fa9a61-9f6f-4ecb-a276-f19713d630df",
        "tags" : [
        ]
      },
      {
        "id" : "45685f02-4218-40d2-8caa-0132eaf8c1d1",
        "parentId" : "d50582c1-fa8e-4236-8a9b-10a06b19f509",
        "authorId" : "f5c553cb-d123-4eb4-9f6d-9a715871f6eb",
        "body" : "In the file `hlo_instruction.h`, there is already many `Replace*WithDifferentShape()` like `ReplaceAllUsesWithDifferentShape()`. I'm just following the same pattern. I do this in the hlo_computation.h files as the nodes are in an HloComputation and I want its internal structure to show the changes. Doing the update manually would be brittle and would need more code of line.\r\n\r\nHere I use it to lift a bitcast. Example before:\r\n```\r\n%1=tanh(f32[32,32,32] input)\r\n%2=f32[1024,32] bitcast(%1)\r\n```\r\nafter:\r\n```\r\n%3=f32[1024,32] bitcast(f32[32,32,32] input)\r\n%4=tanh(%1)\r\n```\r\nI need to replace the %1 by %3 and they have different shape.\r\nThis is a powerful function that must be used with care. Like all the `HloInstruction::Replace*WithDifferentShape()` functions. This is why I limit the ops supported inside the fusion.",
        "createdAt" : "2021-06-11T14:16:29Z",
        "updatedAt" : "2021-06-11T14:28:13Z",
        "lastEditedBy" : "f5c553cb-d123-4eb4-9f6d-9a715871f6eb",
        "tags" : [
        ]
      }
    ],
    "commit" : "250bced1fae220caa31efc9e64537aeed042bbf2",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +941,945 @@}\n\nStatus HloComputation::ReplaceInstructionWithDifferentShape(\n    HloInstruction* old_instruction, HloInstruction* new_instruction) {\n  VLOG(10) << \"transformed \" << old_instruction->ToString() << \" to \""
  },
  {
    "id" : "3e8f2077-2dcc-470e-9015-c93236aa1416",
    "prId" : 50153,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/50153#pullrequestreview-695789223",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f2aa9a26-c333-4b80-9699-c82b09239ce3",
        "parentId" : null,
        "authorId" : "68fac570-a499-4a66-bf20-f8f2cbebf597",
        "body" : "In line 974, it should call ReplaceAllUsesWithDifferentShape instead of ReplaceAllUsesWith\r\nWe already know that we can enter this method with different shapes of old_instruction and new_instruction.",
        "createdAt" : "2021-06-30T08:03:51Z",
        "updatedAt" : "2021-06-30T08:06:17Z",
        "lastEditedBy" : "68fac570-a499-4a66-bf20-f8f2cbebf597",
        "tags" : [
        ]
      }
    ],
    "commit" : "250bced1fae220caa31efc9e64537aeed042bbf2",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +942,946 @@\nStatus HloComputation::ReplaceInstructionWithDifferentShape(\n    HloInstruction* old_instruction, HloInstruction* new_instruction) {\n  VLOG(10) << \"transformed \" << old_instruction->ToString() << \" to \"\n           << new_instruction->ToString();"
  }
]