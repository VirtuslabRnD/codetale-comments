[
  {
    "id" : "ca53bdaa-c167-4889-9a75-15e1a9c8595d",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-629224712",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "58ccd1e6-966f-41fc-a376-74f9d20a16f2",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "per some other comments: what happens if `input_type` is not f32? (here and elsewhere). I feel you may be missing a helper that gets a type appropriate float attr given an input type.",
        "createdAt" : "2021-04-01T04:28:43Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      },
      {
        "id" : "e0467301-fef6-480c-842e-a135c3c3faca",
        "parentId" : "58ccd1e6-966f-41fc-a376-74f9d20a16f2",
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "alternatively, in a lot of these cases, you should at least early exit if the input type is not f32.",
        "createdAt" : "2021-04-01T04:29:21Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      },
      {
        "id" : "6aa47fd7-a989-4538-9680-bfd3b67a3762",
        "parentId" : "58ccd1e6-966f-41fc-a376-74f9d20a16f2",
        "authorId" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "body" : "I agree we should do more check where we implicitly assume types are f32.\r\n\r\nBut isn't this function already did the check you're asking?\r\nif (input_is_qtype) {\r\n  ... // legalize for quantized type\r\n} else {\r\n   ... // legalize for f32\r\n   // maybe I should check and return failure() if not input_type is f32 here\r\n}\r\n",
        "createdAt" : "2021-04-06T17:16:36Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 82,
    "diffHunk" : "@@ -1,1 +2255,2259 @@          rewriter.getI64IntegerAttr(quantized_0),\n          rewriter.getI64IntegerAttr(quantized_max),\n          rewriter.getF32FloatAttr(0), rewriter.getF32FloatAttr(0));\n\n      return clamp_op.getResult();"
  },
  {
    "id" : "1150dacb-1932-4fac-96b0-bed06582e398",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-629232595",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb66c2e0-b4c6-41ee-8af9-5c0046829bbf",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "nit: move these checks to the top, keeping the height/width extraction with the calculations that use them.",
        "createdAt" : "2021-04-01T04:33:49Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      },
      {
        "id" : "a4d2df22-01b0-4455-8147-e6af60eea216",
        "parentId" : "cb66c2e0-b4c6-41ee-8af9-5c0046829bbf",
        "authorId" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "body" : "Thanks. Will update in next round.",
        "createdAt" : "2021-04-06T17:25:38Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 245,
    "diffHunk" : "@@ -1,1 +2615,2619 @@  }\n\n  bool input_is_qtype =\n      input_type.getElementType().isa<mlir::quant::UniformQuantizedType>();\n  bool output_is_qtype ="
  },
  {
    "id" : "433823a9-cc9f-4ef1-8b2d-646d9cfa8733",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-629345128",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "37418ee5-d7fe-4bc5-9a0e-721bb1b6536e",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "Where are you checking this condition and early exiting? (forgive me if I missed it)",
        "createdAt" : "2021-04-01T04:43:50Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      },
      {
        "id" : "b987daa7-c495-4b71-ad37-cc1a5b80d745",
        "parentId" : "37418ee5-d7fe-4bc5-9a0e-721bb1b6536e",
        "authorId" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "body" : "No I didn't. I will add the check in next round.",
        "createdAt" : "2021-04-06T17:32:48Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "tags" : [
        ]
      },
      {
        "id" : "f26b00ba-0476-46c9-b2d3-58a23f7c3512",
        "parentId" : "37418ee5-d7fe-4bc5-9a0e-721bb1b6536e",
        "authorId" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "body" : "Oh actually we did. In legalize_tf.cc and legalize_tfl.cc, we do return failure() if matchPattern() fails.",
        "createdAt" : "2021-04-06T19:41:24Z",
        "updatedAt" : "2021-04-12T22:09:56Z",
        "lastEditedBy" : "f31d0583-2480-4fc3-9503-1351afc6cb97",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 983,
    "diffHunk" : "@@ -1,1 +3450,3454 @@  // index), or [..., k, ...] = off_value (if k != index)\n  //\n  // The lowering below assumes depth is always known at compile time.\n  // TBD for depth resolved in run time.\n  //"
  },
  {
    "id" : "bfca9955-4652-46fc-958c-12af51995c52",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636093139",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "85524adf-21f3-439c-b9ea-5fa3f98afbd0",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "output_height and output_width require explicit static_casts for the initializer list.",
        "createdAt" : "2021-04-14T21:26:30Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 304,
    "diffHunk" : "@@ -1,1 +2674,2678 @@\n  ArrayAttr output_size =\n      rewriter.getI64ArrayAttr({output_height, output_width});\n  StringAttr resize_mode = rewriter.getStringAttr(mode);\n"
  },
  {
    "id" : "054246e4-478a-4de6-8630-f326e3408e58",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636104775",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d9e2b122-6736-4713-a640-c9e6526dda30",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "Unused",
        "createdAt" : "2021-04-14T21:26:54Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      },
      {
        "id" : "8fab1a01-56f6-4d57-ba88-15b9e0fe7526",
        "parentId" : "d9e2b122-6736-4713-a640-c9e6526dda30",
        "authorId" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "body" : "done",
        "createdAt" : "2021-04-14T21:42:42Z",
        "updatedAt" : "2021-04-14T21:42:42Z",
        "lastEditedBy" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 345,
    "diffHunk" : "@@ -1,1 +2715,2719 @@      auto input_element_qtype =\n          input_type.getElementType().cast<mlir::quant::UniformQuantizedType>();\n      auto output_element_qtype =\n          output_type.getElementType()\n              .cast<mlir::quant::UniformQuantizedType>();"
  },
  {
    "id" : "b1caf027-a3fe-4123-920f-2a06804ba31c",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636104694",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "15865e19-c368-4a3f-ab0f-b84184303406",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "Explicit cast to float required",
        "createdAt" : "2021-04-14T21:27:32Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      },
      {
        "id" : "ea7e95d0-f190-4fa5-9f71-a94903518bd5",
        "parentId" : "15865e19-c368-4a3f-ab0f-b84184303406",
        "authorId" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "body" : "done",
        "createdAt" : "2021-04-14T21:42:34Z",
        "updatedAt" : "2021-04-14T21:42:34Z",
        "lastEditedBy" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 418,
    "diffHunk" : "@@ -1,1 +2788,2792 @@        rewriter.getI64ArrayAttr({0, 0}), rewriter.getI64ArrayAttr({0, 0}),\n        rewriter.getI32IntegerAttr(0),\n        rewriter.getF32ArrayAttr({fp_stride_y, fp_stride_x}),\n        rewriter.getF32ArrayAttr({fp_offset_y, fp_offset_x}), resize_mode);\n    return resize_op.getResult();"
  },
  {
    "id" : "48c73177-cdab-41c8-be8a-8d51ccf98654",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636104612",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8e177c1d-1f2f-4287-8059-1c7634cacf2b",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "Same casts as above.",
        "createdAt" : "2021-04-14T21:27:47Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      },
      {
        "id" : "12a30624-1e6b-47af-89d6-c2ea6a71c954",
        "parentId" : "8e177c1d-1f2f-4287-8059-1c7634cacf2b",
        "authorId" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "body" : "done",
        "createdAt" : "2021-04-14T21:42:27Z",
        "updatedAt" : "2021-04-14T21:42:27Z",
        "lastEditedBy" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 419,
    "diffHunk" : "@@ -1,1 +2789,2793 @@        rewriter.getI32IntegerAttr(0),\n        rewriter.getF32ArrayAttr({fp_stride_y, fp_stride_x}),\n        rewriter.getF32ArrayAttr({fp_offset_y, fp_offset_x}), resize_mode);\n    return resize_op.getResult();\n  }"
  },
  {
    "id" : "766474cc-2636-4bd9-973d-c69d047ee3b0",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636104524",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2ba39936-62a6-43d9-b390-2762e041c218",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "All of these doubles are unused",
        "createdAt" : "2021-04-14T21:28:28Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      },
      {
        "id" : "1b3a73f3-f103-468d-a02d-eb3837996fc3",
        "parentId" : "2ba39936-62a6-43d9-b390-2762e041c218",
        "authorId" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "body" : "done",
        "createdAt" : "2021-04-14T21:42:19Z",
        "updatedAt" : "2021-04-14T21:42:19Z",
        "lastEditedBy" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 277,
    "diffHunk" : "@@ -1,1 +2647,2651 @@  double in_center_w = static_cast<double>(input_width - 1) / 2.0;\n  double out_center_h = static_cast<double>(output_height - 1) / 2.0;\n  double out_center_w = static_cast<double>(output_width - 1) / 2.0;\n\n  double fp_stride_y ="
  },
  {
    "id" : "7cdfb1b2-b8a3-4f6d-9bcf-ee0e7482ff51",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636093139",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3853f8b5-4cc2-47c6-b516-1f9006ade0f7",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "Unused",
        "createdAt" : "2021-04-14T21:29:12Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 449,
    "diffHunk" : "@@ -1,1 +2847,2851 @@    return llvm::None;\n\n  auto output_shape = output_type.getShape();\n\n  Value zp_val ="
  },
  {
    "id" : "a0e2df60-3c7f-4fc8-aa9c-82686a44851c",
    "prId" : 48193,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/48193#pullrequestreview-636093139",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a02fdf88-4b05-4ab7-9f29-fd1636e5fe0e",
        "parentId" : null,
        "authorId" : "2b360356-8486-433a-8b78-303484004dfe",
        "body" : "Unused.",
        "createdAt" : "2021-04-14T21:29:22Z",
        "updatedAt" : "2021-04-14T21:29:25Z",
        "lastEditedBy" : "2b360356-8486-433a-8b78-303484004dfe",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c29763e8b9790e117049595f61c71d61b20117c",
    "line" : 481,
    "diffHunk" : "@@ -1,1 +2887,2891 @@  }\n\n  auto output_shape = output_type.getShape();\n\n  // This code originates from tensorflow/core/kernels/fake_quant_ops_functor.h."
  },
  {
    "id" : "0fa4536b-345a-443f-af8e-0235840a0895",
    "prId" : 45496,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/45496#pullrequestreview-547774496",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "66c73b35-751e-4dab-992d-56ef61564ff2",
        "parentId" : null,
        "authorId" : "79b78984-b8e9-4fc7-aa98-92198b35ecca",
        "body" : "Please as followup, replace all the \"emitOpError\" with rewriter.notifyMatchFailure()`.\r\n\r\nIn particular in legalization the framework expects some pattern to fail to apply and this is not an error: other pattens may be able to handle it.\r\n",
        "createdAt" : "2020-12-09T01:49:00Z",
        "updatedAt" : "2020-12-10T22:13:34Z",
        "lastEditedBy" : "79b78984-b8e9-4fc7-aa98-92198b35ecca",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbc5ec2bd459858f89598155f8b5026cd7e6167d",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +66,70 @@  // Check for ranked tensor type.\n  if (!result_type) {\n    op->emitOpError(\"PackOp: result type not ranked tensor\");\n    return llvm::None;\n  }"
  },
  {
    "id" : "084a2d9e-971d-413b-9d80-41887aa1aabb",
    "prId" : 44851,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/44851#pullrequestreview-533667719",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "24aeeb0c-a8bc-4086-9f43-b07520a3e4ad",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "Nit for the future: For a lot of these styles of utility functions, I find it better to return an llvm::Optional<Value> instead of an Operation*. It lets you generically handle some of the cases a bit better where you are doing different things with the ops.",
        "createdAt" : "2020-11-17T21:56:09Z",
        "updatedAt" : "2020-11-20T16:22:47Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      },
      {
        "id" : "a1704869-ed2b-4069-a212-2e178f24a235",
        "parentId" : "24aeeb0c-a8bc-4086-9f43-b07520a3e4ad",
        "authorId" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "body" : "Marked TODO",
        "createdAt" : "2020-11-18T17:07:15Z",
        "updatedAt" : "2020-11-20T16:22:47Z",
        "lastEditedBy" : "8de71123-74d5-4bf9-8fdf-4c7804212b1f",
        "tags" : [
        ]
      }
    ],
    "commit" : "f2631ad5eb993325fcb239357f7be18f8e56a8b5",
    "line" : 437,
    "diffHunk" : "@@ -1,1 +435,439 @@// Lowers the Mul operator to TOSA.  For quantized types, this requires\n// inserting rescale operators before and after the operation.\nOperation* convertMultiplyOp(PatternRewriter& rewriter, Operation* op,\n                             Value output_val, Value input_lhs_val,\n                             Value input_rhs_val) {"
  },
  {
    "id" : "4e6c561b-a672-4170-ab77-c1ee3019794b",
    "prId" : 44851,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/44851#pullrequestreview-530421967",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2dbfa8f3-f1ed-465b-847b-c90ef9a24a97",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "fyi - this is the code-smell that leads me to the above comment (getting the defining op of a value)",
        "createdAt" : "2020-11-17T21:56:49Z",
        "updatedAt" : "2020-11-20T16:22:47Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      }
    ],
    "commit" : "f2631ad5eb993325fcb239357f7be18f8e56a8b5",
    "line" : 495,
    "diffHunk" : "@@ -1,1 +493,497 @@  }\n\n  return output.getDefiningOp();\n}\n"
  },
  {
    "id" : "bbcb279b-ed23-478d-ac5f-9ab01173abc9",
    "prId" : 44851,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/44851#pullrequestreview-530421967",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f04ead18-9406-46dd-be52-2db9f6d59022",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "Nice!",
        "createdAt" : "2020-11-17T22:04:16Z",
        "updatedAt" : "2020-11-20T16:22:47Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      }
    ],
    "commit" : "f2631ad5eb993325fcb239357f7be18f8e56a8b5",
    "line" : 1396,
    "diffHunk" : "@@ -1,1 +1394,1398 @@  // max(logits)), -1)\n  //\n  // We'll use first version for direct fp lowering, and second version for\n  // quantized lowering since second one we can restrict input to exp() be\n  // negative, and thus LUT can always be within [0.0, 1.0]."
  },
  {
    "id" : "4f093c5f-8000-494e-b95d-4c24b66edf06",
    "prId" : 44851,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/44851#pullrequestreview-530421967",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3032b31f-c477-4174-ade8-ff61d5f1f042",
        "parentId" : null,
        "authorId" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "body" : "op->emitError(\"quantized tanh lowering not implemneted\")",
        "createdAt" : "2020-11-17T22:14:05Z",
        "updatedAt" : "2020-11-20T16:22:47Z",
        "lastEditedBy" : "b534dd2f-ff29-4848-b22b-6d156debdac0",
        "tags" : [
        ]
      }
    ],
    "commit" : "f2631ad5eb993325fcb239357f7be18f8e56a8b5",
    "line" : 2173,
    "diffHunk" : "@@ -1,1 +2171,2175 @@\n    if (fused_activation_fn.getValue() == \"TANH\") {\n      // TODO: implement with TABLE\n      op->emitWarning(\"Quantized TANH lowering TBD!\");\n      return nullptr;"
  }
]