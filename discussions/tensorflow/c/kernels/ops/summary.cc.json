[
  {
    "id" : "7f3c7b30-dc4f-4c71-b36c-7adb8ff2e3aa",
    "prId" : 41209,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/41209#pullrequestreview-448656367",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a28453cf-2202-47a9-992e-ebe85ad82478",
        "parentId" : null,
        "authorId" : "348d02e7-fb87-40d6-9079-97142b662dc4",
        "body" : "Just returning shape constructed with `TF_NewShapeHandle` seems different from current behavior.\r\n`TF_NewShapeHandle` just [calls](https://cs.opensource.google/tensorflow/tensorflow/+/master:tensorflow/c/ops.cc;l=104?q=tf_newshapehandle) empty `ShapeHandle` [constructor](https://cs.opensource.google/tensorflow/tensorflow/+/master:tensorflow/core/framework/shape_inference.h;drc=a6207b8f2e5c62524392e1d2b22f87cfc3ec1f10;l=96). This means `ptr_` inside `ShapeHandle` is `nullptr` and `IsSet` would return false.\r\n\r\nAt the same time original registration creates a [scalar shape](https://cs.opensource.google/tensorflow/tensorflow/+/master:tensorflow/core/framework/common_shape_fns.h;l=83;drc=a6207b8f2e5c62524392e1d2b22f87cfc3ec1f10). Clicking through, it does actually create a `Shape` object. So, it seems like `ptr_` would not be `nullptr` in `ShapeHandle`.\r\n\r\nI am thinking we might have to add ` TF_ShapeInferenceContextScalar` similar to the vector shape function [here](https://cs.opensource.google/tensorflow/tensorflow/+/master:tensorflow/c/ops.h;l=285). What do you think?",
        "createdAt" : "2020-07-15T07:50:04Z",
        "updatedAt" : "2020-07-31T22:13:14Z",
        "lastEditedBy" : "348d02e7-fb87-40d6-9079-97142b662dc4",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a02cef1bfaaa96f6796e601e6e12ef009f61835",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +24,28 @@  TF_SetStatus(status, TF_OK, \"\"); \n  TF_ShapeHandle* result = TF_ShapeInferenceContextScalar(ctx);\n  TF_ShapeInferenceContextSetOutput(ctx, 0, result, status);\n  TF_DeleteShapeHandle(result);\n}"
  },
  {
    "id" : "358c9547-ae67-4933-bb22-f1d7c7f82e8a",
    "prId" : 41209,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/41209#pullrequestreview-457800785",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e8677c2c-0447-412c-b8c6-6ca904a9313c",
        "parentId" : null,
        "authorId" : "348d02e7-fb87-40d6-9079-97142b662dc4",
        "body" : "Need `#include \"tensorflow/core/platform/macros.h\"` here for TF_ATTRIBUTE_UNUSED macro.",
        "createdAt" : "2020-07-29T18:55:13Z",
        "updatedAt" : "2020-07-31T22:13:14Z",
        "lastEditedBy" : "348d02e7-fb87-40d6-9079-97142b662dc4",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a02cef1bfaaa96f6796e601e6e12ef009f61835",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +17,21 @@#include \"tensorflow/c/tf_status.h\"\n#include \"tensorflow/core/framework/selective_registration.h\"\n#include \"tensorflow/core/platform/logging.h\"\n#include \"tensorflow/core/platform/macros.h\"\n"
  }
]