[
  {
    "id" : "92edeb4c-c975-48ee-9d92-c66275a87957",
    "prId" : 47317,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/47317#pullrequestreview-603684391",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8c806afa-de72-4afa-a246-0aae7acf1eba",
        "parentId" : null,
        "authorId" : "47ddd433-c835-4958-95b7-07277656ff33",
        "body" : "did you test these delegates?",
        "createdAt" : "2021-03-03T04:55:00Z",
        "updatedAt" : "2021-03-04T04:07:48Z",
        "lastEditedBy" : "47ddd433-c835-4958-95b7-07277656ff33",
        "tags" : [
        ]
      },
      {
        "id" : "06b521f0-27ba-4284-a6b1-63e869fe66b8",
        "parentId" : "8c806afa-de72-4afa-a246-0aae7acf1eba",
        "authorId" : "95e70777-32bc-4e8f-991f-41e9175612e1",
        "body" : "@terryheo\r\nYes, I add another commit(https://github.com/tensorflow/tensorflow/pull/47317/commits/79e6e84b602b7a42ddb8aaa589f16367a419b5c3) to show the delegation log.\r\n\r\nI add the addition def \"TFLITE_PROFILING_ENABLED\" to show the profiling result in label_image.\r\n```\r\ndiff --git a/tensorflow/lite/CMakeLists.txt b/tensorflow/lite/CMakeLists.txt\r\nindex 74f1dc8..9dbfb0f 100644\r\n--- a/tensorflow/lite/CMakeLists.txt\r\n+++ b/tensorflow/lite/CMakeLists.txt\r\n@@ -143,7 +143,7 @@ if(CMAKE_CXX_COMPILER_ID MATCHES \"Clang$\")\r\n   list(APPEND TF_TARGET_PRIVATE_OPTIONS \"-Wno-deprecated-declarations\")\r\n endif()\r\n # Additional compiler flags used when compiling TF Lite.\r\n-set(TFLITE_TARGET_PUBLIC_OPTIONS \"\")\r\n+set(TFLITE_TARGET_PUBLIC_OPTIONS \"-DTFLITE_PROFILING_ENABLED\")\r\n set(TFLITE_TARGET_PRIVATE_OPTIONS \"\")\r\n # Additional library dependencies based upon enabled features.\r\n set(TFLITE_TARGET_DEPENDENCIES \"\")\t\r\n```\r\n\r\nThe log:\r\n```\r\n/tensorflow/tensorflow/lite/build$ ./examples/label_image/label_image -m ~/mobilenet_v1_1.0_224.f32.tflite -l ~/labels.txt -i /tensorflow/tensorflow/lite/examples/label_image/testdata/grace_hopper.bmp -p 1 -x 1\r\n\r\nINFO: Loaded model /home/jerrys/mobilenet_v1_1.0_224.f32.tflite\r\nINFO: resolved reporter\r\nINFO: Created TensorFlow Lite XNNPACK delegate for CPU.\r\nINFO: Use XNNPACK acceleration.\r\nINFO: Applied XNNPACK delegate.\r\nERROR: ModifyGraphWithDelegate is disallowed when graph is immutable.\r\nERROR: Ignoring failed application of the default TensorFlow Lite delegate indexed at 0.\r\nINFO: invoked\r\nINFO: average time: 6.421 ms\r\nINFO:      6.411, Subgraph   0, Node   0, OpCode   3, CONV_2D\r\nINFO:      6.388, Subgraph   0, Node  31, OpCode  51, DELEGATE\r\nINFO:      0.002, Subgraph   0, Node  29, OpCode  43, SQUEEZE\r\nINFO:      0.008, Subgraph   0, Node  32, OpCode  51, DELEGATE\r\nINFO: 0.860174: 653 653:military uniform\r\nINFO: 0.0481019: 907 907:Windsor tie\r\nINFO: 0.00786707: 466 466:bulletproof vest\r\nINFO: 0.00644937: 514 514:cornet, horn, trumpet, trump\r\nINFO: 0.00608026: 543 543:drumstick\r\n```\r\n\r\nYou could see the message:\r\n```\r\nINFO: Use XNNPACK acceleration.\r\nINFO: Applied XNNPACK delegate.\r\nERROR: ModifyGraphWithDelegate is disallowed when graph is immutable.\r\nERROR: Ignoring failed application of the default TensorFlow Lite delegate indexed at 0.\r\n```\r\n\r\nThe xnnpack backend was created successfully.\r\n\r\nThe \"ModifyGraphWithDelegate is disallowed when graph is immutable\" is another issue:https://github.com/tensorflow/tensorflow/issues/42757",
        "createdAt" : "2021-03-04T03:58:06Z",
        "updatedAt" : "2021-03-04T04:07:48Z",
        "lastEditedBy" : "95e70777-32bc-4e8f-991f-41e9175612e1",
        "tags" : [
        ]
      },
      {
        "id" : "1bede990-e346-446b-9253-9976cee8c60c",
        "parentId" : "8c806afa-de72-4afa-a246-0aae7acf1eba",
        "authorId" : "95e70777-32bc-4e8f-991f-41e9175612e1",
        "body" : "The \"DELEGATE\" op in profiling result shows that the graph goes through delegation backend.",
        "createdAt" : "2021-03-04T04:00:19Z",
        "updatedAt" : "2021-03-04T04:07:48Z",
        "lastEditedBy" : "95e70777-32bc-4e8f-991f-41e9175612e1",
        "tags" : [
        ]
      }
    ],
    "commit" : "fc5dda4ab17775a2d7190a8b5e219b41b81c431f",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +33,37 @@)\n\nif(TFLITE_ENABLE_XNNPACK)\n  list(APPEND TFLITE_LABEL_IMAGE_SRCS\n    ${TFLITE_SOURCE_DIR}/tools/delegates/xnnpack_delegate_provider.cc"
  }
]