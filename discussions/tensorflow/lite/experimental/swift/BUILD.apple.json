[
  {
    "id" : "3c0a6cb6-e122-4b86-9167-d3080b9e1d91",
    "prId" : 39765,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39765#pullrequestreview-418540483",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4196ee16-cf75-4a73-a219-9ed57a9c4a9c",
        "parentId" : null,
        "authorId" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "body" : "Would it be possible to do the selects here? I don't believe negating a select is possible, so if `use_coreml_delegate` is not true, then exclude `Sources/CoreMLDelegate.swift` as the \"default\" condition?\r\n\r\nSame for Metal?",
        "createdAt" : "2020-05-21T20:22:43Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "tags" : [
        ]
      },
      {
        "id" : "07220d52-6abc-40c4-a45d-8822e0d9bee9",
        "parentId" : "4196ee16-cf75-4a73-a219-9ed57a9c4a9c",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "I tried something like that (if I understand what you mean) but the value of `exclude` has to be a list of strings, it can't be a select, which was a TIL",
        "createdAt" : "2020-05-22T01:02:16Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      },
      {
        "id" : "6b6815d0-8439-4ce4-937c-aad46ebaaf0a",
        "parentId" : "4196ee16-cf75-4a73-a219-9ed57a9c4a9c",
        "authorId" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "body" : "I see, was thinking something like:\r\n```\r\n    srcs = glob(\r\n        [\r\n            \"Sources/*.swift\",\r\n        ],\r\n        exclude = select({\r\n          \"//tensorflow/lite/tools/delegates:use_coreml_delegate\": [],\r\n          \"//conditions:default\": [\r\n              \"Sources/CoreMLDelegate.swift\",\r\n          ],\r\n        }) + select({\r\n          \"//tensorflow/lite/tools/delegates:use_metal_delegate\": [],\r\n          \"//conditions:default\": [\r\n              \"Sources/MetalDelegate.swift\",\r\n          ],\r\n        }),\r\n    )\r\n```\r\n\r\nOR\r\n\r\n```\r\n    srcs = glob(\r\n        [\r\n            \"Sources/*.swift\",\r\n        ],\r\n        exclude = [] + select({\r\n          \"//tensorflow/lite/tools/delegates:use_coreml_delegate\": [],\r\n          \"//conditions:default\": [\r\n              \"Sources/CoreMLDelegate.swift\",\r\n          ],\r\n        }) + select({\r\n          \"//tensorflow/lite/tools/delegates:use_metal_delegate\": [],\r\n          \"//conditions:default\": [\r\n              \"Sources/MetalDelegate.swift\",\r\n          ],\r\n        }),\r\n    )\r\n```\r\n\r\nBut if that's less readable and still doesn't work, then I think what you have is reasonable. Was just looking for a way to avoid having to update files / selects in multiple places when adding new delegates in future.",
        "createdAt" : "2020-05-26T17:52:03Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "tags" : [
        ]
      },
      {
        "id" : "edfd344b-1cc3-43fa-951c-63d1cfdb2b78",
        "parentId" : "4196ee16-cf75-4a73-a219-9ed57a9c4a9c",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "Yea we can't put the `select` in the `exclude` so this is what we're stuck with ðŸ˜¢ ",
        "createdAt" : "2020-05-26T17:55:12Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      }
    ],
    "commit" : "701c201eab8ceb659e50fad735eb2583181270d3",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +30,34 @@            \"Sources/*.swift\",\n        ],\n        exclude = [\n            \"Sources/CoreMLDelegate.swift\",\n            \"Sources/MetalDelegate.swift\","
  },
  {
    "id" : "89f7d975-1bd9-4a28-afe1-549891f8d02f",
    "prId" : 39765,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39765#pullrequestreview-418676003",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "da4ecb43-f893-4fd8-a559-dbfd9b23dc2d",
        "parentId" : null,
        "authorId" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "body" : "Similar to comment for `TensorFlowLiteC_framework`, we will want Metal to follow same pattern as CoreML. I think @teijeong is planning to update Metal to match CoreML?\r\n\r\nProbably out of scope for your current change, so seems fine to leave as you have it and we can add Metal to this list of deps when ready.",
        "createdAt" : "2020-05-21T20:24:57Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "tags" : [
        ]
      },
      {
        "id" : "c8954d06-38d3-48ae-b6ea-c50f5437404f",
        "parentId" : "da4ecb43-f893-4fd8-a559-dbfd9b23dc2d",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "The metal cocoapods changes were merged yesterday, I've rebased to work with the new pattern",
        "createdAt" : "2020-05-26T21:01:11Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      }
    ],
    "commit" : "701c201eab8ceb659e50fad735eb2583181270d3",
    "line" : 66,
    "diffHunk" : "@@ -1,1 +61,65 @@    deps = [\n        \"//tensorflow/lite/experimental/ios:tensorflow_lite_c\",\n    ] + select({\n        \":use_coreml_delegate\": [\n            \"//tensorflow/lite/experimental/delegates/coreml:coreml_delegate\","
  },
  {
    "id" : "d8dd91ad-2dd3-4dba-98fe-f2412391f299",
    "prId" : 39765,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39765#pullrequestreview-419578319",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e8b9412-bab7-4c94-a71b-02825563b71b",
        "parentId" : null,
        "authorId" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "body" : "We may want to add a comment stating that by default this target builds the core TensorFlow Lite Swift library and that developers will need to specify the appropriate defines to enable delegation support.",
        "createdAt" : "2020-05-27T16:18:29Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "tags" : [
        ]
      },
      {
        "id" : "47ee2316-72b0-4b4f-9cb1-425584053080",
        "parentId" : "2e8b9412-bab7-4c94-a71b-02825563b71b",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "Moved the other comment up here since it makes more sense to be with this I think",
        "createdAt" : "2020-05-27T20:20:45Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      }
    ],
    "commit" : "701c201eab8ceb659e50fad735eb2583181270d3",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +24,28 @@# To build with the Metal delegate pass --define=use_metal_delegate=1\n# To build with the CoreML delegate pass --define=use_coreml_delegate=1\nswift_library(\n    name = \"TensorFlowLite\",\n    srcs = glob("
  },
  {
    "id" : "894a9f5b-49f5-4c70-8af0-b521773c189b",
    "prId" : 39765,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39765#pullrequestreview-420307438",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5072fef6-fd07-4368-b22e-c869f3192ed5",
        "parentId" : null,
        "authorId" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "body" : "can we mark this target as `testonly`?",
        "createdAt" : "2020-05-28T16:51:40Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "7637c868-e04c-4068-9e5a-2060ba95da5d",
        "tags" : [
        ]
      }
    ],
    "commit" : "701c201eab8ceb659e50fad735eb2583181270d3",
    "line" : 80,
    "diffHunk" : "@@ -1,1 +75,79 @@\nswift_library(\n    name = \"TensorFlowLiteAllDelegates\",\n    testonly = 1,\n    srcs = glob([\"Sources/*.swift\"]),"
  },
  {
    "id" : "cfb3c577-4332-4670-bf3d-4c72e6a0751d",
    "prId" : 39765,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39765#pullrequestreview-423243007",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7b610420-2e62-48b3-a3ca-16787237bcb4",
        "parentId" : null,
        "authorId" : "28c4e279-d1eb-40df-95bd-8d718399624b",
        "body" : "```suggestion\r\n    name = \"TensorFlowLiteAllDelegates\",\r\n    testonly = 1,\r\n```",
        "createdAt" : "2020-06-03T06:09:23Z",
        "updatedAt" : "2020-06-03T16:17:45Z",
        "lastEditedBy" : "28c4e279-d1eb-40df-95bd-8d718399624b",
        "tags" : [
        ]
      }
    ],
    "commit" : "701c201eab8ceb659e50fad735eb2583181270d3",
    "line" : 80,
    "diffHunk" : "@@ -1,1 +75,79 @@\nswift_library(\n    name = \"TensorFlowLiteAllDelegates\",\n    testonly = 1,\n    srcs = glob([\"Sources/*.swift\"]),"
  },
  {
    "id" : "79983acf-275f-48c6-9ea0-0bb5f495fcf6",
    "prId" : 39043,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/39043#pullrequestreview-407627951",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c7711702-831e-4805-a817-056d38ec12c5",
        "parentId" : null,
        "authorId" : "759833ab-bc69-4396-a938-c5c124e21b59",
        "body" : "ios_unit_test fails with this change, because \"CoreML\" is no longer specified as a weak dependency. you can add\r\nlinkopts=[\"-weak_framework\", \"CoreML\"] to make this work.",
        "createdAt" : "2020-05-06T04:25:01Z",
        "updatedAt" : "2020-05-07T16:14:16Z",
        "lastEditedBy" : "759833ab-bc69-4396-a938-c5c124e21b59",
        "tags" : [
        ]
      },
      {
        "id" : "a4795887-75ad-4fa0-8504-39dd713e4cfc",
        "parentId" : "c7711702-831e-4805-a817-056d38ec12c5",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "Done, FYI I added them to the swift_library and not the cc_library because of https://github.com/bazelbuild/rules_swift/issues/432",
        "createdAt" : "2020-05-06T17:31:28Z",
        "updatedAt" : "2020-05-07T16:14:16Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      },
      {
        "id" : "a9851740-348d-4712-a852-a7254c387709",
        "parentId" : "c7711702-831e-4805-a817-056d38ec12c5",
        "authorId" : "759833ab-bc69-4396-a938-c5c124e21b59",
        "body" : "Thanks! Do you know if this should be applied to TensorFlowLiteC_framework target, too?",
        "createdAt" : "2020-05-07T01:39:22Z",
        "updatedAt" : "2020-05-07T16:14:16Z",
        "lastEditedBy" : "759833ab-bc69-4396-a938-c5c124e21b59",
        "tags" : [
        ]
      },
      {
        "id" : "e072d6d8-43c2-4f38-ad29-84957d8ed778",
        "parentId" : "c7711702-831e-4805-a817-056d38ec12c5",
        "authorId" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "body" : "In the current scheme it doesn't make a difference because no linking target (at least in this public repo) depends on it. But I added it for completeness since it doesn't hurt!",
        "createdAt" : "2020-05-07T16:14:11Z",
        "updatedAt" : "2020-05-07T16:14:16Z",
        "lastEditedBy" : "f469b98c-f65f-465f-a2a6-ffedb179f3ab",
        "tags" : [
        ]
      }
    ],
    "commit" : "178b6171492285252e176960ca33de645bf8d0ee",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +22,26 @@    visibility = ios_visibility_whitelist(),\n    deps = [\n        \"//tensorflow/lite/experimental/ios:tensorflow_lite_c\",\n    ],\n)"
  }
]