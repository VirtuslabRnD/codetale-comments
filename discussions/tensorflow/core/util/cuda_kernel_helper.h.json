[
  {
    "id" : "183c0264-475b-4d84-a6b7-cafe9ee2e029",
    "prId" : 12502,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/12502#pullrequestreview-63509403",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "108c4ad1-b577-474c-943c-be537c2d29fc",
        "parentId" : null,
        "authorId" : "845afb08-ba85-462c-92e8-305877b05a5d",
        "body" : "Please add comments explaining what's going on here, and in particular what \"sync\" means.",
        "createdAt" : "2017-08-23T21:14:05Z",
        "updatedAt" : "2017-09-06T23:30:12Z",
        "lastEditedBy" : "845afb08-ba85-462c-92e8-305877b05a5d",
        "tags" : [
        ]
      },
      {
        "id" : "1191fa36-1204-428d-a75c-00c7afe49f7b",
        "parentId" : "108c4ad1-b577-474c-943c-be537c2d29fc",
        "authorId" : "8ff4e099-8cf6-4348-9db7-45b9bc9150c1",
        "body" : "Done",
        "createdAt" : "2017-08-30T00:05:10Z",
        "updatedAt" : "2017-09-06T23:30:12Z",
        "lastEditedBy" : "8ff4e099-8cf6-4348-9db7-45b9bc9150c1",
        "tags" : [
        ]
      },
      {
        "id" : "cd2bc55d-a4ee-4aff-bbbd-fc373f97476e",
        "parentId" : "108c4ad1-b577-474c-943c-be537c2d29fc",
        "authorId" : "a674097a-507b-4c99-83fd-0615bc6a626e",
        "body" : "IMO this is incorrect. _sync variants provide guarantee of thread synchronization if called from diverged context, which you can not do  with non-sync variants or on pre-Volta hardware as there's no way to guarantee that the call happens in converged context in non-trivial code.\r\n\r\nHypothetical example:\r\n```\r\nif (threadIdx.x < 16) {\r\n  // stuff\r\n  __shfl_sync(0xFFFFFFFF,...);\r\n  // more stuff that depends on shfl result\r\n} else {\r\n  // stuff\r\n  __shfl_sync(0xFFFFFFFF,...);\r\n  // more stuff that depends on shfl result\r\n}\r\n```\r\nOn volta, I believe __shfl_sync() in both branches would sync up and shuffle the data among all 32 threads in the warp. \r\nOn pre-volta h/w each of the branches would get data only from half of the threads as each branch will be executed in diverged context.\r\n\r\nIMO, compatibility should be provided in the opposite direction -- define old API using their new *_sync counterparts if we're compiling using CUDA-9.\r\n\r\n",
        "createdAt" : "2017-09-18T22:45:13Z",
        "updatedAt" : "2017-09-18T23:53:51Z",
        "lastEditedBy" : "a674097a-507b-4c99-83fd-0615bc6a626e",
        "tags" : [
        ]
      }
    ],
    "commit" : "ef71383cf2d8d8241d813ac11695a26c34ae3ceb",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +48,52 @@#define __shfl_up_sync(mask, val, delta, width)     __shfl_up(val, delta, width)\n#define __shfl_xor_sync(mask, val, laneMask, width) __shfl_xor(val, laneMask, width)\n#endif\n\n// Usage of GetCudaLaunchConfig, GetCuda2DLaunchConfig, and"
  },
  {
    "id" : "4abd22a7-c037-41b2-9052-68b98db11549",
    "prId" : 10032,
    "prUrl" : "https://github.com/tensorflow/tensorflow/pull/10032#pullrequestreview-41085177",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "29987c79-4614-4d21-a066-e772e5f22f93",
        "parentId" : null,
        "authorId" : "0d926870-310b-41c9-b0ea-46cdc7661c9c",
        "body" : "Which is better here? Log and exit using `CHECK_GE`, or explicitly return an invalid output as in above?",
        "createdAt" : "2017-05-27T22:20:46Z",
        "updatedAt" : "2017-06-06T06:12:28Z",
        "lastEditedBy" : "0d926870-310b-41c9-b0ea-46cdc7661c9c",
        "tags" : [
        ]
      },
      {
        "id" : "4b4836bf-09d8-44e6-8281-a25e36aa8ff6",
        "parentId" : "29987c79-4614-4d21-a066-e772e5f22f93",
        "authorId" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "body" : "The original code ends up creating a config with virtual_thread_count=0, I think. I'm guessing that the original author thought that returning such a config is fine in this case, since presumably the caller will subsequently call CUDA_1D_KERNEL_LOOP(i, n)   with n==0 which becomes a noop. @zheng-xq can you advice?\r\n\r\n",
        "createdAt" : "2017-05-30T21:50:46Z",
        "updatedAt" : "2017-06-06T06:12:28Z",
        "lastEditedBy" : "0ba8fb18-637a-4ab3-a7c8-cd971823fe45",
        "tags" : [
        ]
      }
    ],
    "commit" : "7405ef3598bf8a255f1b027448f887d6ff8bafe3",
    "line" : 106,
    "diffHunk" : "@@ -1,1 +135,139 @@  if (work_element_count <= 0) {\n    return config;\n  }\n\n  const int virtual_thread_count = work_element_count;"
  }
]