[
  {
    "id" : "109cda02-7f75-4e72-9abb-dc347fdc61dc",
    "prId" : 9167,
    "prUrl" : "https://github.com/apache/airflow/pull/9167#pullrequestreview-425827519",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "37932479-b65f-4d3b-a108-0f5ee679324a",
        "parentId" : null,
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "What do you think about creating one generic script and many symbolic links? This one script can select an image based on \"basename \"${BASH_SOURCE[0]}\".  If it detects suffix \"-update\" it will update the image.  The script can be located in one file e.g. scripts/ci/in_container/run_cli_tools.sh.",
        "createdAt" : "2020-06-07T13:58:49Z",
        "updatedAt" : "2020-06-08T05:22:09Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "c62a6fad-2506-4800-9610-287cb5efbe6f",
        "parentId" : "37932479-b65f-4d3b-a108-0f5ee679324a",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "Busbox works in a similar way. \r\n\r\n> \r\n> BusyBox is a multi-call binary. A multi-call binary is an executable program that performs the same job as more than one utility program. That means there is just a single BusyBox binary, but that single binary acts like a large number of utilities. This allows BusyBox to be smaller since all the built-in utility programs (we call them applets) can share code for many common operations.\r\n> \r\n> You can also invoke BusyBox by issuing a command as an argument on the command line. For example, entering\r\n> \r\n>         /bin/busybox ls\r\n> will also cause BusyBox to behave as 'ls'.\r\n> \r\n> Of course, adding '/bin/busybox' into every command would be painful. So most people will invoke BusyBox using links to the BusyBox binary.\r\n> \r\n> For example, entering\r\n> \r\n>         ln -s /bin/busybox ls\r\n>         ./ls\r\n> will cause BusyBox to behave as 'ls' (if the 'ls' command has been compiled into BusyBox). Generally speaking, you should never need to make all these links yourself, as the BusyBox build system will do this for you when you run the 'make install' command.\r\n> \r\n> If you invoke BusyBox with no arguments, it will provide you with a list of the applets that have been compiled into your BusyBox binary.\r\n\r\nhttps://busybox.net/downloads/BusyBox.html",
        "createdAt" : "2020-06-07T14:04:30Z",
        "updatedAt" : "2020-06-08T05:22:09Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "93791739-a517-4a87-bcb8-81a189ffd55a",
        "parentId" : "37932479-b65f-4d3b-a108-0f5ee679324a",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "It will not work for 'aws' for example - because the command is a bit different there. I think I prefer to generate separate scripts - also because in the future we might add other tools like that and they might have different commands to run. having separate script. I prefer to have different logic to generate those scripts.\r\n\r\nFor busybox it makes perfect sense because it is quite substantial binary and copying it over takes precious space. In our case it's not an issue and I prefer each tool is separate",
        "createdAt" : "2020-06-07T14:56:19Z",
        "updatedAt" : "2020-06-08T05:22:09Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "90e55c693847b9a70fd8b6bb650674f39380bf91",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +29,33 @@\n    cat >\"${TARGET_TOOL_PATH}\" <<EOF\n#!/usr/bin/env bash\ndocker run --rm -it \\\n    -v \"\\${HOST_AIRFLOW_SOURCES}/tmp:/tmp\" \\"
  },
  {
    "id" : "29419712-ff33-47a8-a3e1-5a50f532427f",
    "prId" : 9167,
    "prUrl" : "https://github.com/apache/airflow/pull/9167#pullrequestreview-426115320",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "parentId" : null,
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "I have a problem with this. I want to add terraform but it needs more volumes to be added i.e. auth script folder for every provider you want to use with terraform.",
        "createdAt" : "2020-06-08T10:03:12Z",
        "updatedAt" : "2020-06-08T10:03:23Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "e7eede1e-4935-4cc8-8a12-45df0cc57e07",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "So this `prepare_tool_script \"hashicorp/terraform:latest\" \".aws\" \".azure\" \".config/gcloud\" terraform` would not work.\r\n\r\nSo `VOLUMES` varies and also `COMMAND`.",
        "createdAt" : "2020-06-08T10:08:47Z",
        "updatedAt" : "2020-06-08T10:08:47Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "4ba209e4-55bb-49c2-b2ca-7cb0cfe11980",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "The docker run command which I use for terraform is: `docker run --rm -it -v \\${HOST_HOME}/.aws:/root/.aws -v \\${HOST_HOME}/.azure:/root/.azure -v \\${HOST_HOME}/.config:/root/.config -v \\${HOST_AIRFLOW_SOURCES}:/opt/airflow -w /opt/airflow --env-file <(env | grep TF) ${TERRAFORM_IMAGE} \\\"\\$@\\\"`\r\n\r\nSo I would also like to be able to set the working directory and maybe `--env-file` or if there is a different way of accessing the `TF` env vars, I am open to change it :/",
        "createdAt" : "2020-06-08T10:16:00Z",
        "updatedAt" : "2020-06-08T10:17:39Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "dcd50945-4aec-4a66-9bbe-551bae1da723",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "@potiuk WDYT of having `function prepare_terraform_script` so we can keep the rest as it is.",
        "createdAt" : "2020-06-08T10:21:05Z",
        "updatedAt" : "2020-06-08T10:21:25Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "e99f0b1c-a24d-40ad-b246-4f557c0fd42c",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I think it woudl be easy enough (as a follow-up change :)) to turn VOLUME into list of volumes. And adding \"env\" or -w is also quite OK. I'a m happy to make it as a follow-up pr afterwards.",
        "createdAt" : "2020-06-08T10:22:30Z",
        "updatedAt" : "2020-06-08T10:22:31Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "862b3b68-5a6b-4ad9-90a6-9817912ac26d",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Sure 'prepare_terraform_script\" sounds even better :)",
        "createdAt" : "2020-06-08T10:26:35Z",
        "updatedAt" : "2020-06-08T10:26:35Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "c48cee48-5ab4-45f8-9ff2-71a48b9a3a90",
        "parentId" : "e8e11aaa-4b44-4924-b72a-3f8ef59fe24d",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "Okay, I am gonna add it when I am adding terraform. :)",
        "createdAt" : "2020-06-08T10:50:43Z",
        "updatedAt" : "2020-06-08T10:50:43Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      }
    ],
    "commit" : "90e55c693847b9a70fd8b6bb650674f39380bf91",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +21,25 @@function prepare_tool_script() {\n    IMAGE=\"${1}\"\n    VOLUME=\"${2}\"\n    TOOL=\"${3}\"\n    COMMAND=\"${4:-}\""
  }
]