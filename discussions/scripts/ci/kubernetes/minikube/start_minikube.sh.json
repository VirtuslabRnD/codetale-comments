[
  {
    "id" : "cf0c8b4c-4b8a-47bb-aa8b-8e0aa2a8fbd4",
    "prId" : 2853,
    "prUrl" : "https://github.com/apache/airflow/pull/2853#pullrequestreview-88295963",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9fa15830-4488-411e-86de-04a0b1192659",
        "parentId" : null,
        "authorId" : "537cec6b-32b7-4f8b-9f76-6932246f79b5",
        "body" : "You probably want to store this in travisâ€™ cache. See the Hadoop scripts as an example",
        "createdAt" : "2017-12-30T06:01:18Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "537cec6b-32b7-4f8b-9f76-6932246f79b5",
        "tags" : [
        ]
      },
      {
        "id" : "ae5a5a32-2266-4f29-8b0b-7c505a6cf68d",
        "parentId" : "9fa15830-4488-411e-86de-04a0b1192659",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "@grantnicholas could you please set this part up?",
        "createdAt" : "2018-01-02T17:40:15Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "b049644d-0a6f-4349-abb5-feb56c5ca544",
        "parentId" : "9fa15830-4488-411e-86de-04a0b1192659",
        "authorId" : "530497f6-e5e6-42f2-a59c-9d7bbcbecaaf",
        "body" : "@dimberman sure will do. ",
        "createdAt" : "2018-01-11T20:27:48Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "530497f6-e5e6-42f2-a59c-9d7bbcbecaaf",
        "tags" : [
        ]
      }
    ],
    "commit" : "7fb5906e68fdf351e97acbf04f334b2a86081e81",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +24,28 @@#\n\ncurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.24.1/minikube-linux-amd64 && chmod +x minikube\ncurl -Lo kubectl  https://storage.googleapis.com/kubernetes-release/release/${KUBERNETES_VERSION}/bin/linux/amd64/kubectl && chmod +x kubectl\n"
  },
  {
    "id" : "35052a37-e968-4e65-a209-69e724f85d78",
    "prId" : 2853,
    "prUrl" : "https://github.com/apache/airflow/pull/2853#pullrequestreview-88332930",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "parentId" : null,
        "authorId" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "body" : "The assumption here is that kubectl isn't configured to talk to another cluster and that the other cluster isn't the default.  I don't think there is a better way to prove you're talking to minikube as intended, i guess you could look at the current context?\r\n\r\nThere's not a great way to parse that the config context stuff since you can't (or previously couldn't) change output types to something easily parsable.\r\n  \r\n\r\nSome other options here would be to ensure minikube is running using something like `minikube status` and that kubectl is configured to talk to the minikube cluster with `minikube update-context` ?",
        "createdAt" : "2018-01-05T01:03:30Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "tags" : [
        ]
      },
      {
        "id" : "5fe347a6-847e-4835-8c45-2b4d7b228af9",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "7415a51e-f48a-4bc4-96d6-fd0b678c112b",
        "body" : "To prevent collisions, `minikube profile` could be used to set a kubectl context name that's unique enough to be unlikely accidentally used. Then `kubectl config set-context` (or alias kubectl) could be used to ensure that minikube is used.",
        "createdAt" : "2018-01-05T22:31:34Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "7415a51e-f48a-4bc4-96d6-fd0b678c112b",
        "tags" : [
        ]
      },
      {
        "id" : "429e2175-4f1f-446b-99e6-fa98f7beeee5",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "@grantnicholas I think @cmkimerer and @ethernetdan have a good point here, do you want to set this up? (I can do it this weekend if you're busy)",
        "createdAt" : "2018-01-05T22:38:56Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "a63fe630-ea7e-4534-af55-8117a9b7a04a",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "4a014c25-3f4d-421a-b30f-6c902215128e",
        "body" : "Drive-by thought - Isn't this meant to run under travis only? In that case, there is complete control over the environment and we can be sure there isn't a different k8s cluster configured also. \r\n\r\nFor the cleanup, we usually run the tests in a separate randomly generated namespace every time and clean up the namespace which ensures everything - i.e. secrets, services, pods, etc get cleaned up.",
        "createdAt" : "2018-01-05T22:43:35Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "4a014c25-3f4d-421a-b30f-6c902215128e",
        "tags" : [
        ]
      },
      {
        "id" : "7795ed43-b82c-40ed-a028-e522bf28a0e1",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "fair point. The other consideration is making it as easy as possible for users to unit test if they want to add features, but even then there's no reason they HAVE to use minikube (at least none of our unit tests are minikube specific).",
        "createdAt" : "2018-01-05T22:46:18Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "45019b49-8486-47f3-99fb-b927824ec189",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "body" : "Given the comment here: https://github.com/apache/incubator-airflow/pull/2853/files#diff-a6fe26ef61545b07f21f31c42a69d4e3R22, it looks like the desired way to do development work on this also calls this script.\r\n\r\nHowever, if you had just started minikube though as that linked documentation also suggests, you also have likely just re-configured your kubectl's context.\r\n\r\nIt does seem like the `setup_kubernetes.sh` script isn't all that helpful in setting up the development environment as it is now though.  Maybe it was intended to be more in-depth, or was at one point and lost (unneeded) functionality as this patch evolved?",
        "createdAt" : "2018-01-05T22:52:29Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "tags" : [
        ]
      },
      {
        "id" : "22249dd7-fb9b-43db-874b-95b013f04cf5",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "4a014c25-3f4d-421a-b30f-6c902215128e",
        "body" : "Yeah, if the goal is also to support user-run testing, we could separate out the actual testing from the environment setup into a script which takes `master` as a parameter. Not sure if that's worth the effort right now.\r\n  ",
        "createdAt" : "2018-01-05T22:53:37Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "4a014c25-3f4d-421a-b30f-6c902215128e",
        "tags" : [
        ]
      },
      {
        "id" : "8d093e08-fd4f-4908-b0ec-350a5a45e1cc",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "Eh, I'm fine to put that on the roadmap, but I really want to get people trying this out as an MVP/alpha",
        "createdAt" : "2018-01-05T23:03:01Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "a1d61a42-b237-44f8-8540-75ebf9ebd832",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "530497f6-e5e6-42f2-a59c-9d7bbcbecaaf",
        "body" : "@cmkimerer While the script is technically only supposed to be used for travis, it's nice to have a way to setup a \"standard\" development environment. I know when we were all collaborating it was hard to prevent \"works on my machine\" issues with different kubernetes setups so having one standard setup enforced a certain amount of reliability. \r\n\r\nYou are right that much of the functionality of the script was removed as it only applies to the kubernetes executor and not the operator. So the script *is* useful but you can't really see that right now until the executor PR is opened. \r\n\r\nI think we probably want to make this a bit more robust, but probably not a blocker for a first release (imo). ",
        "createdAt" : "2018-01-11T20:19:48Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "530497f6-e5e6-42f2-a59c-9d7bbcbecaaf",
        "tags" : [
        ]
      },
      {
        "id" : "d5ea8e4d-0fb2-4064-a16e-e0cb9ba153a1",
        "parentId" : "c5ae0367-5dfb-4bec-a159-8d41303a4afc",
        "authorId" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "body" : "@grantnicholas Yea, I'm definitely not trying to hold up this from landing (as I'm waiting on this and the executor PR ðŸ˜„ to land), just figured I'd call out the fact this is potentially dangerous and is something we should smooth out [in a future release]",
        "createdAt" : "2018-01-11T22:49:51Z",
        "updatedAt" : "2018-01-11T23:31:46Z",
        "lastEditedBy" : "ee583c98-35db-4e09-af46-207acfe468bf",
        "tags" : [
        ]
      }
    ],
    "commit" : "7fb5906e68fdf351e97acbf04f334b2a86081e81",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +17,21 @@\n# Guard against a kubernetes cluster already being up\nkubectl get pods &> /dev/null\nif [ $? -eq 0 ]; then\n  echo \"kubectl get pods returned 0 exit code, exiting early\""
  }
]