[
  {
    "id" : "26ea4c52-e540-45a8-8e60-45bd06d04c1a",
    "prId" : 9027,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/9027#pullrequestreview-417175861",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "95072d5d-b1d9-4ba3-b650-3cf4ae8f9b46",
        "parentId" : null,
        "authorId" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "body" : "What if we call `.normalize` on `relPath` instead?",
        "createdAt" : "2020-05-22T19:29:47Z",
        "updatedAt" : "2020-05-22T19:29:47Z",
        "lastEditedBy" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "tags" : [
        ]
      },
      {
        "id" : "a67bf9da-84e6-4030-ab03-3f6adde95909",
        "parentId" : "95072d5d-b1d9-4ba3-b650-3cf4ae8f9b46",
        "authorId" : "128563de-a925-4397-af34-450c7978a8d2",
        "body" : "this didn't work because you'd get something like\r\nfor the source file `/var/tmp/foo/T/bar/Src1.scala` and `sourceRoot` `Users/jamie/workspace/dotty/`  you would get relPath\r\n`../../../../var/tmp/foo/T/bar/Src1.scala` which isn't good when you append it to\r\n`Users/jamie/workspace/dotty/out/META-INF/semanticdb`",
        "createdAt" : "2020-05-22T19:38:54Z",
        "updatedAt" : "2020-05-22T19:38:54Z",
        "lastEditedBy" : "128563de-a925-4397-af34-450c7978a8d2",
        "tags" : [
        ]
      },
      {
        "id" : "adf2bce9-0651-4b71-aa95-06e14bef4c4d",
        "parentId" : "95072d5d-b1d9-4ba3-b650-3cf4ae8f9b46",
        "authorId" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "body" : "OK I see, but it sounds like we should be running these tests with `-sourceroot /var/tmp/foo/` or something then, otherwise the files won't be placed in the correct subdirectory inside META-INF/semanticdb ?",
        "createdAt" : "2020-05-22T19:44:55Z",
        "updatedAt" : "2020-05-22T19:44:55Z",
        "lastEditedBy" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "tags" : [
        ]
      },
      {
        "id" : "085bfbd5-6bf7-4138-97ad-726174e6cd82",
        "parentId" : "95072d5d-b1d9-4ba3-b650-3cf4ae8f9b46",
        "authorId" : "128563de-a925-4397-af34-450c7978a8d2",
        "body" : "in the situation above, sourceRoot becomes `/` so its safe for all cases, the storage path for the semanticdb file then becomes `Users/jamie/workspace/dotty/out/META-INF/semanticdb/var/tmp/foo/T/bar/Src1.scala.semanticdb`",
        "createdAt" : "2020-05-22T20:48:01Z",
        "updatedAt" : "2020-05-22T20:48:01Z",
        "lastEditedBy" : "128563de-a925-4397-af34-450c7978a8d2",
        "tags" : [
        ]
      },
      {
        "id" : "6978dd24-5c44-4d7e-b6ac-967bb0402911",
        "parentId" : "95072d5d-b1d9-4ba3-b650-3cf4ae8f9b46",
        "authorId" : "128563de-a925-4397-af34-450c7978a8d2",
        "body" : "explicit `-sourceroot` in this situation could be used to reduce the number of nested directories but isn't critical",
        "createdAt" : "2020-05-22T20:49:01Z",
        "updatedAt" : "2020-05-22T20:49:31Z",
        "lastEditedBy" : "128563de-a925-4397-af34-450c7978a8d2",
        "tags" : [
        ]
      }
    ],
    "commit" : "565abde9a1c654f99670f718ae6e692d82ca4414",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +600,604 @@    val sourcePath = absolutePath(source.file.jpath)\n    val sourceRoot =\n      // Here if `sourceRoot` and `sourcePath` do not share a common prefix then `relPath` will not be normalised,\n      // containing ../.. etc, which is problematic when appending to `/META-INF/semanticdb/` and will not be accepted\n      // by Files.createDirectories on JDK 11."
  }
]