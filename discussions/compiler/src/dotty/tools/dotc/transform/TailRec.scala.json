[
  {
    "id" : "d382af75-6257-41ce-9e8c-d85f5503044b",
    "prId" : 5115,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/5115#pullrequestreview-167493016",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f2f837c4-83c2-46f0-8dfd-bbcde27d0d23",
        "parentId" : null,
        "authorId" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "body" : "I think you could simplify the implementation here. If I understand correctly `rewrittenParamSyms` is just `paramSyms` that you reorder (for reasons I don't understand). Would it be possible to get rid of `rewrittenParamSyms`? Something like:\r\n\r\n```scala\r\nprivate[this] var myVarsForRewrittenParamSyms: List[Symbol] = _\r\ndef varsForRewrittenParamSyms(implicit ctx: Context) = {\r\n  if (myVarsForRewrittenParamSyms == null) {\r\n    myVarsForRewrittenParamSyms = paramSyms.map(param =>\r\n      ctx.newSymbol(method, TailLocalName.fresh(param.name.toTermName), Flags.Synthetic | Flags.Mutable, param.info))\r\n  }\r\n  myVarsForRewrittenParamSyms\r\n}\r\n```",
        "createdAt" : "2018-10-23T12:03:45Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "tags" : [
        ]
      },
      {
        "id" : "74307ba2-ba24-4851-8524-d851fb952cb6",
        "parentId" : "f2f837c4-83c2-46f0-8dfd-bbcde27d0d23",
        "authorId" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "body" : "No, `rewrittenParamSyms` is a *subset* of `paramSyms`. It only contains parameters whose value is changed in at least one tail-recursive call. This is quite important to avoid declaring and assigning useless variables.",
        "createdAt" : "2018-10-23T15:37:00Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "tags" : [
        ]
      }
    ],
    "commit" : "3084b1a9e5cf6e3014ae222d87891c6ea8f91527",
    "line" : 303,
    "diffHunk" : "@@ -1,1 +208,212 @@    var rewrittenParamSyms: List[Symbol] = Nil\n    /** The replacement `var`s for the params in `rewrittenParamSyms`. */\n    var varsForRewrittenParamSyms: List[Symbol] = Nil\n\n    private def getVarForRewrittenThis()(implicit c: Context): Symbol = {"
  },
  {
    "id" : "d349291e-ed6a-4cfe-8dba-d3ba63d17c98",
    "prId" : 5115,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/5115#pullrequestreview-167311204",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "386a36d5-456d-4334-aa85-32ef7e5a578c",
        "parentId" : null,
        "authorId" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "body" : "These four variables would benefit from comments explaining what they are",
        "createdAt" : "2018-10-23T12:04:24Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "tags" : [
        ]
      }
    ],
    "commit" : "3084b1a9e5cf6e3014ae222d87891c6ea8f91527",
    "line" : 303,
    "diffHunk" : "@@ -1,1 +208,212 @@    var rewrittenParamSyms: List[Symbol] = Nil\n    /** The replacement `var`s for the params in `rewrittenParamSyms`. */\n    var varsForRewrittenParamSyms: List[Symbol] = Nil\n\n    private def getVarForRewrittenThis()(implicit c: Context): Symbol = {"
  },
  {
    "id" : "eb5f7eeb-c536-43a3-bd8f-888e3c854743",
    "prId" : 5115,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/5115#pullrequestreview-167311204",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c902654a-267a-4cc3-a476-9cead0a43044",
        "parentId" : null,
        "authorId" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "body" : "This seems a bit convoluted to compute each var lazily. You could compute them all at once.\r\n\r\nSee comment under:\r\n```scala\r\nvar varsForRewrittenParamSyms: List[Symbol] = Nil\r\n```",
        "createdAt" : "2018-10-23T12:11:35Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "tags" : [
        ]
      }
    ],
    "commit" : "3084b1a9e5cf6e3014ae222d87891c6ea8f91527",
    "line" : 318,
    "diffHunk" : "@@ -1,1 +223,227 @@    }\n\n    private def getVarForRewrittenParam(param: Symbol)(implicit c: Context): Symbol = {\n      rewrittenParamSyms.indexOf(param) match {\n        case -1 =>"
  },
  {
    "id" : "2d1c584a-5184-463c-9b8d-556a807852b4",
    "prId" : 5115,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/5115#pullrequestreview-168852247",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b233bc75-c446-4606-90ba-e9c9c775206b",
        "parentId" : null,
        "authorId" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "body" : "Maybe a bit simpler:\r\n```scala\r\nval tmp = SyntheticValDef(TailTempName.fresh(lhs.name.toTermName), rhs)\r\n(tmp, Assign(ref(lhs), ref(tmp.symbol)).withPos(tree.pos))\r\n```",
        "createdAt" : "2018-10-23T13:23:49Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "tags" : [
        ]
      },
      {
        "id" : "1bcadfde-e020-4ac0-895a-ae61997bf3e2",
        "parentId" : "b233bc75-c446-4606-90ba-e9c9c775206b",
        "authorId" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "body" : "Doesn't work, because it does not use the correct `owner` for the new symbol.",
        "createdAt" : "2018-10-26T14:32:30Z",
        "updatedAt" : "2018-11-05T17:43:21Z",
        "lastEditedBy" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "tags" : [
        ]
      }
    ],
    "commit" : "3084b1a9e5cf6e3014ae222d87891c6ea8f91527",
    "line" : 369,
    "diffHunk" : "@@ -1,1 +312,316 @@                val (tempValDefs, assigns) = (for ((lhs, rhs) <- assignThisAndParamPairs) yield {\n                  val temp = c.newSymbol(method, TailTempName.fresh(lhs.name.toTermName), Flags.Synthetic, lhs.info)\n                  (ValDef(temp, rhs), Assign(ref(lhs), ref(temp)).withPos(tree.pos))\n                }).unzip\n                tempValDefs ::: assigns"
  },
  {
    "id" : "1846d927-1b44-4d86-82ef-f25b53f6598f",
    "prId" : 5112,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/5112#pullrequestreview-158588312",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3e698cc7-fc26-419e-8a07-be0174ae173a",
        "parentId" : null,
        "authorId" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "body" : "Why was this not needed before?",
        "createdAt" : "2018-09-25T13:01:11Z",
        "updatedAt" : "2018-09-25T16:01:52Z",
        "lastEditedBy" : "223e67d6-1873-432a-9af9-f40b82a7eedd",
        "tags" : [
        ]
      },
      {
        "id" : "6bf0fbd7-a2c2-48ef-b1ce-67e5f4d1ed73",
        "parentId" : "3e698cc7-fc26-419e-8a07-be0174ae173a",
        "authorId" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "body" : "It was needed before, but it was handled by [`fullyParameterizedDef`](https://github.com/lampepfl/dotty/blob/e88a6a579d0c49abbd5cbbc44836611272c9b6a4/compiler/src/dotty/tools/dotc/transform/FullParameterization.scala#L212) (along with many other complications for type parameters, which are not needed anymore).",
        "createdAt" : "2018-09-25T15:03:13Z",
        "updatedAt" : "2018-09-25T16:02:14Z",
        "lastEditedBy" : "5a9cd756-9120-4d5e-ac88-e9c636084f0e",
        "tags" : [
        ]
      }
    ],
    "commit" : "f102203d7b3d21db8a4c6444b01d16d17fde4448",
    "line" : 165,
    "diffHunk" : "@@ -1,1 +133,137 @@                    .subst(origVParams, vrefs.tail.map(_.tpe)),\n                  treeMap = {\n                    case tree: This if tree.symbol == classSym => thisRef\n                    case tree => tree\n                  },"
  }
]