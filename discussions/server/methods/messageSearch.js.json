[
  {
    "id" : "83269af2-9baa-4f2e-a41e-ca27a7c666bb",
    "prId" : 10110,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/10110#pullrequestreview-114069613",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "parentId" : null,
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "any reason to change the result schema? I'm afraid this could break some clients. if there is no strong reason for this change, I would ask to stick with the old schema.",
        "createdAt" : "2018-04-19T23:33:12Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      },
      {
        "id" : "c3df2740-441f-436d-89f3-ed2aa368a6ae",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "525785c6-8dc4-408c-b464-62837df622a0",
        "body" : "The result schema has been changed because we wanted to allow some metadata to the search results (e.g. number of matching documents, scoring, etc) In order to keep one schema (necessary e.g. for result validation) for all providers, we changed it also here. Nevertheless, I changed this in the code in api, which uses his function, too . If you want to change there we can have the solutions: add a parameter *format* to the function, that is default *basic* but can be set to *extended*\r\nWhat do you think?",
        "createdAt" : "2018-04-20T06:16:27Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "525785c6-8dc4-408c-b464-62837df622a0",
        "tags" : [
        ]
      },
      {
        "id" : "813def79-7603-40e8-9b95-8ff423b5e904",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "08341c92-9d32-4db9-b11e-644bd64f0c85",
        "body" : "@tkurz what about adding another property to the result which is exclusively dedicated to the metadata? \r\n```javascript\r\nresult: {\r\n  messages: [...],\r\n  meta: {\r\n    messages: {\r\n      totalCount: 17177882,\r\n      pagesize: 50,\r\n      currentPage: 37\r\n    },\r\n    user: {\r\n      language: 'prBR'\r\n    }\r\n}\r\n```\r\nI don't think it's a good style to change the schema of a response, but having optional parts for which a projection might be specified by the consumer is fine.",
        "createdAt" : "2018-04-20T06:27:54Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "08341c92-9d32-4db9-b11e-644bd64f0c85",
        "tags" : [
        ]
      },
      {
        "id" : "0a2a2283-1384-43ed-9114-c04bc19c2d16",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "525785c6-8dc4-408c-b464-62837df622a0",
        "body" : "Yes, would be a valid solution, but enforces some major changes in the current Chatpal implementation. What about this: Keep the \"old\" schema in the messageSearch Service and map it in the search provider. so we do not change the current api. IMHO the new schema is more adequate (and common) on search index systems  like solr/elastic. Would be easy and would not contain api changes (and this be downwards compatible to 3rd party)",
        "createdAt" : "2018-04-20T09:15:18Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "525785c6-8dc4-408c-b464-62837df622a0",
        "tags" : [
        ]
      },
      {
        "id" : "71d768d5-e8f1-414b-ba79-501d6c0fdd96",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "08341c92-9d32-4db9-b11e-644bd64f0c85",
        "body" : "As you said, the new Schema us common for search providers. Since itâ€™s the implementation of the â€žsearchâ€œ service, I believe itâ€™s valid to go for .docs - as you also changed the old global search implementation and the api to match, I donâ€™t see a constraint to use this new schema. It was a beta in the current version explicitly anyway. But I think you should discuss this with @diegosampaio (probably on open.rocket.chat) during the course of today. ðŸ‡§ðŸ‡· ist close to waking up now anyway ;-)",
        "createdAt" : "2018-04-20T10:07:25Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "08341c92-9d32-4db9-b11e-644bd64f0c85",
        "tags" : [
        ]
      },
      {
        "id" : "f9d7b353-cde4-4dcd-9b5e-f04b390a2d30",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "I'm here ðŸ‘‹  feel free to reach me out at https://open.rocket.chat/direct/diego.sampaio \r\n\r\non the schema change, I just need to make sure it will at least not break our mobile apps and add a break changes alert on release notes..",
        "createdAt" : "2018-04-20T11:43:53Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      },
      {
        "id" : "58f43002-29e3-4fa0-942d-4a79a401d7f2",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "525785c6-8dc4-408c-b464-62837df622a0",
        "body" : "Hi @sampaiodiego ;) Regarding mobile apps: I can only find 2 usages of the messageSearch function:\r\n1. DefaultSearchProvider (which can deal of course with the schema)\r\n2. API: RocketChat.API 'chat.search' method (https://github.com/RocketChat/Rocket.Chat/blob/2d123a8be7ac8d4732214b13c8044fb70d382aac/packages/rocketchat-api/server/v1/chat.js#L123)\r\n\r\nThe PR already adapted this function to the new model:\r\n\r\nhttps://github.com/redlink-gmbh/Rocket.Chat/blob/dfecb5e9ac1db98a8d74635153e9460321873528/packages/rocketchat-api/server/v1/chat.js#L140",
        "createdAt" : "2018-04-20T14:46:36Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "525785c6-8dc4-408c-b464-62837df622a0",
        "tags" : [
        ]
      },
      {
        "id" : "986af021-6c41-48c8-b464-0be39ec19ffa",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "97008387-ed37-4abe-bd0a-d59f54ba177a",
        "body" : "@rafaelks do the mobile apps utilize the real time method or the endpoint for searching? Or do they not search messages yet?",
        "createdAt" : "2018-04-20T15:39:44Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "97008387-ed37-4abe-bd0a-d59f54ba177a",
        "tags" : [
        ]
      },
      {
        "id" : "bc2bd472-7893-4d07-af16-ec1e8321a962",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "@graywolf336 We're implementing using this API: https://rocket.chat/docs/developer-guides/rest-api/chat/search/.",
        "createdAt" : "2018-04-20T16:14:33Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "51e70af4-b527-4790-8431-0c9405607e7d",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "525785c6-8dc4-408c-b464-62837df622a0",
        "body" : "Thanks, I will take a look!",
        "createdAt" : "2018-04-20T17:14:01Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "525785c6-8dc4-408c-b464-62837df622a0",
        "tags" : [
        ]
      },
      {
        "id" : "9bbb4b9e-2557-4fc6-aec8-8e5ee82d391d",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "525785c6-8dc4-408c-b464-62837df622a0",
        "body" : "@graywolf336 the rest endpoint uses still current search service (mongo based). And it returns the same result format as before. So schema change should not influence the app right? In a next version we can change the method (and maybe the api) so it supports both, basic and extended schema version. Then it would also be possible to use the current provider for API as well. But for now it should be fine right?",
        "createdAt" : "2018-04-20T17:41:17Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "525785c6-8dc4-408c-b464-62837df622a0",
        "tags" : [
        ]
      },
      {
        "id" : "d2a1f1f4-91d4-4521-b4b4-869e3df49844",
        "parentId" : "9a6224e2-fdfc-4379-bd3b-5f5614425124",
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "yup.. seems we're good with mobile apps.. I'll still add a `[BREAK]` flag for third parties who still rely on DDP method.\r\n\r\nlooking forward to the next version with metadata on REST endpoints ðŸ˜ƒ ",
        "createdAt" : "2018-04-20T17:50:08Z",
        "updatedAt" : "2018-04-20T21:27:26Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      }
    ],
    "commit" : "1f1185d8cec9674c5fc4607ce4896a4583d7cd44",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +227,231 @@\t\t\t}\n\n\t\t\tresult.message.docs = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n"
  },
  {
    "id" : "6b29029c-957a-482e-84a6-473440ce864e",
    "prId" : 8947,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/8947#pullrequestreview-80808281",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "63e50642-f844-4004-a757-be7bf942633e",
        "parentId" : null,
        "authorId" : "97008387-ed37-4abe-bd0a-d59f54ba177a",
        "body" : "Can someone answer this question?",
        "createdAt" : "2017-12-02T06:06:44Z",
        "updatedAt" : "2017-12-06T19:07:22Z",
        "lastEditedBy" : "97008387-ed37-4abe-bd0a-d59f54ba177a",
        "tags" : [
        ]
      },
      {
        "id" : "7c82273a-8c94-45db-8ee9-8c7510b4f58f",
        "parentId" : "63e50642-f844-4004-a757-be7bf942633e",
        "authorId" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "body" : "Seems like we shouldn't be... This looks kinda like maybe duplicated from spotlight?  As that's the only thing I can think of that returns all 3",
        "createdAt" : "2017-12-02T06:31:01Z",
        "updatedAt" : "2017-12-06T19:07:22Z",
        "lastEditedBy" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "tags" : [
        ]
      },
      {
        "id" : "a0a5610b-5de2-4737-9e7e-4de618207968",
        "parentId" : "63e50642-f844-4004-a757-be7bf942633e",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "@graywolf336 It probably was a copy of what slack does at that time:\r\n![image](https://user-images.githubusercontent.com/234261/33519696-36b689ee-d793-11e7-8283-25ef017713b0.png)\r\n\r\nI don't know if that is what we want now, need to discuss.",
        "createdAt" : "2017-12-02T21:02:16Z",
        "updatedAt" : "2017-12-06T19:07:22Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "ce40dd2c-0052-432e-8335-ac560f9e7809",
        "parentId" : "63e50642-f844-4004-a757-be7bf942633e",
        "authorId" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "body" : "Isn't this essentially what the spotlight methods do?",
        "createdAt" : "2017-12-03T02:40:09Z",
        "updatedAt" : "2017-12-06T19:07:22Z",
        "lastEditedBy" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "tags" : [
        ]
      },
      {
        "id" : "4e378080-c0a4-4e6d-a7f4-0151f4bdb21f",
        "parentId" : "63e50642-f844-4004-a757-be7bf942633e",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "@geekgonecrazy Yes, but it was prior to the spotlight implementation",
        "createdAt" : "2017-12-04T11:21:36Z",
        "updatedAt" : "2017-12-06T19:07:22Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      }
    ],
    "commit" : "5bd2cb3c6d408392891c07f26a24f5ea98421b25",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +7,11 @@\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessages: [],"
  }
]