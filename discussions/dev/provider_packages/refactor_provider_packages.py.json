[
  {
    "id" : "492f3dd8-0ff1-413c-81e8-eef03b3669f9",
    "prId" : 12082,
    "prUrl" : "https://github.com/apache/airflow/pull/12082#pullrequestreview-524144030",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "85781e7f-6dd1-47d9-8440-539328f5e0ef",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "I know we don't like relative imports in Airflow for some reason, but :)\r\n\r\n```suggestion\r\nfrom .prepare_provider_packages import (\r\n```",
        "createdAt" : "2020-11-05T10:18:40Z",
        "updatedAt" : "2020-11-09T10:55:03Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "aa7c9543-84b5-4652-b9b7-a4db2a9794fc",
        "parentId" : "85781e7f-6dd1-47d9-8440-539328f5e0ef",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I still do not like relative imports. They introduce more problems that they solve. I prefer to make assumption that the root of our repository is root of pythin sources and start from there. This is a really safe assumption",
        "createdAt" : "2020-11-05T10:55:36Z",
        "updatedAt" : "2020-11-09T10:55:03Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "40a587d871f61f999029e16c652762ae8d536438",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +27,31 @@from fissix.pytree import Leaf\n\nfrom dev.provider_packages.prepare_provider_packages import (\n    get_source_airflow_folder,\n    get_source_providers_folder,"
  },
  {
    "id" : "4c06f5e2-a0a1-4a52-be04-e8671ea7e71c",
    "prId" : 12384,
    "prUrl" : "https://github.com/apache/airflow/pull/12384#pullrequestreview-532550353",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Waaaaait -- just noticed that 1.10.x still has an `airflow/kubernetes/pod.py` etc. What is this going to do?",
        "createdAt" : "2020-11-17T09:30:10Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "724bed91-9a5f-4d99-b220-a0a213e5b711",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Yeah. They should be removed after rename. However Interesting thing is that the package installed correctly (prepare backport providers job in CI does it).",
        "createdAt" : "2020-11-17T09:32:09Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "79b87461-6326-4403-9fdf-30a05f318383",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Yeah, pip doesn't really care if two distributions install the same file -- it'll just happily overwrite the existing file.\r\n\r\nWhich is fine right until you come to uninstall things.\r\n\r\nThis brings up an interesting point. What is the behaviour when upgrading from 1.10.x with backport provider to 2.0.0 with normal provider. Yes pip will complain about version conflicts, but that still isn't an error (especially given many people will be on an older pip still)",
        "createdAt" : "2020-11-17T09:44:59Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "a439eb2f-8c4a-409b-9d90-24bbcc977940",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "From this respect good @ashb ! the backport provider package only contains airflow.providers files. We do not add airflow/kubernetes.\r\n\r\nJust double-checked and installed both airflow 1.10.12 and backport cncf,kubernetes from pcakges and seem to be all ok.\r\n\r\nThis is what you get in 'backwards_compat_converters.py in the backport package:\r\n\r\n```\r\nfrom typing import List\r\n\r\nfrom kubernetes.client import models as k8s\r\n\r\nfrom airflow.exceptions import AirflowException\r\nfrom airflow.kubernetes.pod import Port, Resources\r\nfrom airflow.kubernetes.pod_runtime_info_env import PodRuntimeInfoEnv\r\nfrom airflow.kubernetes.volume import Volume\r\nfrom airflow.kubernetes.volume_mount import VolumeMount\r\n\r\n\r\ndef _convert_kube_model_object(obj, old_class, new_class):\r\n    convert_op = getattr(obj, \"to_k8s_client_obj\", None)\r\n    if callable(convert_op):\r\n        return obj.to_k8s_client_obj()\r\n\r\n\r\n```",
        "createdAt" : "2020-11-17T09:46:02Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "9240634b-d916-4999-998b-f9d125e923ab",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "~What is this `rename()` achieving then? What dist does/should it appear in?~",
        "createdAt" : "2020-11-17T09:48:45Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "ab82a6f4-8735-43a5-bd35-ac11fbdfffab",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "One small thing that we could do - maybe also remove the backcompat classes. They seem to not be removed during the refactoring and they are not needed in the backport at all:\r\n\r\n![image](https://user-images.githubusercontent.com/595491/99374141-91370280-28c2-11eb-8bc8-53b85bbeb601.png)\r\n",
        "createdAt" : "2020-11-17T09:50:09Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "e51cbaca-8488-4087-8da5-5f781a2c1f96",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "@ashb @dimberman Fixup here (I could not push it to astronomer's repo) : https://github.com/apache/airflow/pull/12392/commits/8d0be15ae4e4c1cd51d61ccd71fe0a8bef7f0ffe",
        "createdAt" : "2020-11-17T10:10:11Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "2521167f-77ae-466c-ad73-88ff6888bc48",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "> This brings up an interesting point. What is the behaviour when upgrading from 1.10.x with backport provider to 2.0.0 with normal provider. Yes pip will complain about version conflicts, but that still isn't an error (especially given many people will be on an older pip still)\r\n\r\nThis will work fine. Backport packages need airflow ~1.10. PIP will not allow to upgrade airflow without removing backports.",
        "createdAt" : "2020-11-17T10:12:56Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "f1768316-9e73-46ca-b87a-26046230af3b",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "(I think that's cos Dan didn't tick the \"allow commits from maintainers?\" Or maybe that only works for PRs from personal repos -- I had the same trying to push to a PolideaInternal PR you opened)",
        "createdAt" : "2020-11-17T10:13:20Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "765071b5-e774-4096-8886-e8fab134b63a",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "For example backport cncf.kubernetes:\r\n\r\n```\r\n       install_requires=[\r\n            'apache-airflow>=1.10.12, <2.0.0',\r\n            'cryptography>=2.0.0',\r\n            'kubernetes>=3.0.0, <12.0.0',\r\n        ],\r\n```",
        "createdAt" : "2020-11-17T10:14:53Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "ed9f2fdd-ba7b-4427-8867-c55507ff53d3",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "We should simply add a step in UPDATING to 2.0 to make sure they remove backports simply (so that they are not tempted to force installation even with version conflict.",
        "createdAt" : "2020-11-17T10:18:43Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "c2fc141a-049b-4ea7-b8b0-9fca921ef627",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "> @ashb @dimberman Fixup here (I could not push it to astronomer's repo) : 8d0be15\r\n\r\nPushed this as https://github.com/apache/airflow/pull/12384/commits/d5d9e8b51b0ae534c8ac3f69a341c415ec8d3fb0",
        "createdAt" : "2020-11-17T10:52:14Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "720c919a-8971-40b5-88dc-4783dff0abf2",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "@potiuk Turns out we need those files:\r\n\r\n```\r\n  File \"/usr/local/lib/python3.6/site-packages/airflow/providers/cncf/kubernetes/operators/kubernetes_pod.py\", line 39, in <module>\r\n    from airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info_env import PodRuntimeInfoEnv\r\nModuleNotFoundError: No module named 'airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info_env'\r\n```",
        "createdAt" : "2020-11-17T11:22:35Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "8327d134-9c05-4911-9502-1f4b8cf787e7",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Force-pushed back to the previous commit.",
        "createdAt" : "2020-11-17T11:25:47Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "a1f74d7a-2e25-4a80-b8dc-68b2553c8202",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "But we should not I believe. This import should be changed in the backport provider as well.",
        "createdAt" : "2020-11-17T12:24:08Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "3460748c-c05a-438f-911f-d3fdb7018bbf",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "So the proper fix will be to remove the classes from backcompat and add rename for that one as well.",
        "createdAt" : "2020-11-17T12:25:45Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "2e594be4-be2f-43ca-b410-815cda90168f",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "the kubernetes_pod.py was excluded from the previous rename, but pod_runtime_info can be changed in all classes.",
        "createdAt" : "2020-11-17T12:29:52Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "ab263048-e252-4c02-9b09-63e43f626a5b",
        "parentId" : "1cfcad9c-2130-45f2-b592-636d840f622c",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "@dimberman ^^ have you seen this discussion ? ",
        "createdAt" : "2020-11-17T16:25:39Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "6d0e09691769ec20967b49dd7b931b69a1d10d08",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +152,156 @@        self.qry.select_module(\"airflow.providers.cncf.kubernetes.backcompat\").filter(\n            callback=is_not_k8spodop\n        ).rename(\"airflow.kubernetes\")\n\n        self.qry.select_module(\"airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info_env\").rename("
  },
  {
    "id" : "21826d2b-c3a1-4815-b61d-f8e6092fe464",
    "prId" : 12384,
    "prUrl" : "https://github.com/apache/airflow/pull/12384#pullrequestreview-532657287",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "parentId" : null,
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "```suggestion\r\n        self.qry.select_module(\"airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info\")\\\r\n              .rename(\"airflow.kubernetes.pod_runtime_info\")\r\n```\r\n\r\nThat + restoring class removal should fix it.\r\n",
        "createdAt" : "2020-11-17T12:28:19Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "e85b3254-6799-4589-87c8-5c3b7eb71767",
        "parentId" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Does select_module just operate on that one module, not sub modules under it?",
        "createdAt" : "2020-11-17T12:30:12Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "65da59bd-6aa7-49f1-80e5-2675ca47e7f1",
        "parentId" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "There are none under it :). It's the full package name not the module. But likely it should be select_package indeed :)",
        "createdAt" : "2020-11-17T14:28:45Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "555cc2e3-c52d-4716-8094-15c9514e94ce",
        "parentId" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "@potiuk @ashb wait can someone please break this down for me? I'm still confused as to what is broken.",
        "createdAt" : "2020-11-17T16:21:46Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "7ae79f50-f975-41de-b040-8560caba1f06",
        "parentId" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "@dimberman: Not broken, but can be improved :) \r\n\r\nThis commit: https://github.com/apache/airflow/commit/8d0be15ae4e4c1cd51d61ccd71fe0a8bef7f0ffe removes the backcompat/pod.py and other files from backports as they are not needed there. Except that \r\n\r\n`from airflow.kubernetes.pod_runtime_info_env import PodRuntimeInfoEnv` in `kubernetes_pod.py` still points to backcompat because this file is excluded from the rename above.\r\n\r\nThe \"perfect\" fix is to:\r\n1) Also replace the import in `./kubernetes_pod.py`. Can be likely done with this without affecting the other imports in ./kubernetes.pod:\r\n\r\n```\r\n        self.qry.select_package(\"airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info\")\\\r\n              .rename(\"airflow.kubernetes.pod_runtime_info\")\r\n```\r\n\r\n2) remove the backcompat files as in https://github.com/apache/airflow/commit/8d0be15ae4e4c1cd51d61ccd71fe0a8bef7f0ffe\r\n\r\n\r\n",
        "createdAt" : "2020-11-17T16:32:34Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "c09120ea-7abf-46fe-97ff-d2c9509ad618",
        "parentId" : "118eb6fb-c9cd-4e12-b08a-31841d42c0cd",
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "ohhh ok. I think I get it. \r\n\r\nSo basically the idea here is that we want to delete the backcompat files in 1.10 since we're not using them, though we were running into a bowler issue because we weren't changing one import in `kubernetes_pod.py` (this was because we needed to keep the original import for the converters.  So adding that extra query fixes the `pod_runtime_info_env` import and allows us to delete those files.",
        "createdAt" : "2020-11-17T18:14:04Z",
        "updatedAt" : "2020-11-17T19:47:47Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      }
    ],
    "commit" : "6d0e09691769ec20967b49dd7b931b69a1d10d08",
    "line" : 10,
    "diffHunk" : "@@ -1,1 +153,157 @@            callback=is_not_k8spodop\n        ).rename(\"airflow.kubernetes\")\n\n        self.qry.select_module(\"airflow.providers.cncf.kubernetes.backcompat.pod_runtime_info_env\").rename(\n            \"airflow.kubernetes.pod_runtime_info_env\""
  }
]