[
  {
    "id" : "b0b8e259-0062-4cdd-8a0f-e06409964da8",
    "prId" : 42029,
    "prUrl" : "https://github.com/flutter/flutter/pull/42029#pullrequestreview-298465638",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "parentId" : null,
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Copy of the template.",
        "createdAt" : "2019-10-05T00:34:31Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "88ae4f8c-7a0b-4211-9c5e-876296fd5730",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "body" : "Do these mean this will break for consumers?",
        "createdAt" : "2019-10-05T02:17:08Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "tags" : [
        ]
      },
      {
        "id" : "e6342b79-0a24-4b49-875a-5d403aea0d1f",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "No, the original format of the Generated.xcconfig is the same, and this method isn't accessible outside this file (unless someone was doing some really weird hackery).  The method return type is different now, but I changed the two places we call it.",
        "createdAt" : "2019-10-05T02:21:03Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "f89f731c-9399-4224-b480-f928fcc94ed7",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "body" : "Sorry, I mean the fact that you had to update all of these - will it not be automatic for people running Flutter on existing projects?",
        "createdAt" : "2019-10-05T02:34:26Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "tags" : [
        ]
      },
      {
        "id" : "64a03af6-277c-40a6-8761-00b83177a981",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "The only place this method is called is [within](https://github.com/flutter/flutter/pull/42029/files#diff-b4f1b78922d84823776457d645d50192R50) this [Podfile](https://github.com/flutter/flutter/pull/42029/files#diff-b4f1b78922d84823776457d645d50192R70).  So if they regenerate the Podfile they will get the updated method and the updated usage.",
        "createdAt" : "2019-10-07T17:30:36Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "6119b209-6251-426d-b1be-f551328b55c4",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Oh I understand your question.  Nothing will break for existing customers.  They just won't use the copied version, and instead will keep using the symlink and may keep experiencing the old stale framework issue.  If they regenerated their Podfile, they will get the new behavior.",
        "createdAt" : "2019-10-07T17:55:17Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "f608ff88-9d1b-47fb-aa16-86e15e049bd0",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "body" : "Could we have the tool check if they're going to be using the symlink and warn them that it could cause problems and either fix it or provide instructions?",
        "createdAt" : "2019-10-07T18:04:08Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "tags" : [
        ]
      },
      {
        "id" : "a3d8d1c4-68a7-4d1b-9de0-9034a7522d96",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "I don't think we can fix it automatically since that would involve overwriting their Podfile, and people seem to edit that and expect it to not be removed or overwritten.\r\nMaybe something like https://github.com/flutter/flutter/blob/cdb3578b140b3708dc47a958c538b1501f2b6106/packages/flutter_tools/lib/src/resident_runner.dart#L970 ?\r\n\r\nAfter `pod install` the tool could check for the presence of `.symlinks/flutter` and print a warning their Podfile is out of date and they should regenerate?\r\n```\r\n'Your Podfile is out of date.\\nConsider removing ios/Podfile and running \"flutter create .\" to regenerate it.';\r\n```\r\nThat might be annoying since it doesn't give people who already edited their Podfile a way to just fix up the problem.\r\n@zanderso What do you think?",
        "createdAt" : "2019-10-07T21:11:36Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "5010748b-850f-4baf-996b-232381642f38",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "P.S. The stale framework issue this is fixing happens when developers fail to follow the deployment instructions and do not run `flutter build ios` in release before archiving. So if the Podfile isn't updated, but they follow instructions, they will be fine.",
        "createdAt" : "2019-10-07T21:13:33Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "2a3cf67d-bada-4c4f-8c81-fcbdd526643a",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "body" : "Maybe we could read the podfile an dlook for the the offending line?  ",
        "createdAt" : "2019-10-07T21:27:23Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "db47316c-0a85-441a-8891-3b84e8bfe474",
        "tags" : [
        ]
      },
      {
        "id" : "596a227b-83ae-43d7-802f-768b5ab2b789",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "A more detailed message, or a link to some docs on the website, could help folks do the necessary update manually if they have local edits they want to keep. Like, \"Your Podfile is out of date. Regenerate it with .... If you have local edits that you'd like to keep, see ... for instructions.\"",
        "createdAt" : "2019-10-07T21:37:45Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      },
      {
        "id" : "0b4fe179-7a3f-4b23-887b-aba9284e6f44",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "It's easy to see if their Podfile is out of date without parsing (either `.symlinks/flutter` exists or it doesn't since that directory gets removed and recreated each `pod install` run).\r\nThe minimum Podfile change (without the mapping refactor) is pretty large, so it's not just a one-line swap:\r\n```ruby\r\ngenerated_xcode_build_settings = parse_KV_file('./Flutter/Generated.xcconfig')\r\nif generated_xcode_build_settings.empty?\r\n  puts \"Generated.xcconfig must exist. If you're running pod install manually, make sure flutter pub get is executed first.\"\r\nend\r\ngenerated_xcode_build_settings.map { |p|\r\n  if p[:name] == 'FLUTTER_FRAMEWORK_DIR'\r\n    symlink = File.join('.symlinks', 'flutter')\r\n    File.symlink(File.dirname(p[:path]), symlink)\r\n    pod 'Flutter', :path => File.join(symlink, File.basename(p[:path]))\r\n  end\r\n}\r\n```\r\nbecomes:\r\n```ruby\r\ncopied_flutter_dir = File.join(__dir__, 'Flutter')\r\ncopied_framework_path = File.join(copied_flutter_dir, 'Flutter.framework')\r\ncopied_podspec_path = File.join(copied_flutter_dir, 'Flutter.podspec')\r\nunless File.exist?(copied_framework_path) && File.exist?(copied_podspec_path)\r\n  generated_xcode_build_settings = parse_KV_file('./Flutter/Generated.xcconfig')\r\n  if generated_xcode_build_settings.empty?\r\n    puts \"Generated.xcconfig must exist. If you're running pod install manually, make sure flutter pub get is executed first.\"\r\n  end\r\n  generated_xcode_build_settings = parse_KV_file(generated_xcode_build_settings_path)\r\n  generated_xcode_build_settings.map { |p|\r\n    if p[:name] == 'FLUTTER_FRAMEWORK_DIR'\r\n      cached_framework_dir = p[:path]\r\n      unless File.exist?(copied_framework_path)\r\n        FileUtils.cp_r(File.join(cached_framework_dir, 'Flutter.framework'), copied_flutter_dir)\r\n      end\r\n      unless File.exist?(copied_podspec_path)\r\n        FileUtils.cp(File.join(cached_framework_dir, 'Flutter.podspec'), copied_flutter_dir)\r\n      end\r\n    end\r\n  }\r\nend\r\n\r\npod 'Flutter', :path => 'Flutter'\r\n```",
        "createdAt" : "2019-10-07T21:40:27Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "58381c31-e715-44f4-a634-64d28f2dfdc6",
        "parentId" : "4e269973-2fc7-462b-932b-2c8892b7b733",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Here's what it looks like when I have an old version, build, get the migration instructions, remove the Podfile, then build again:\r\n![podfile_migration](https://user-images.githubusercontent.com/682784/66356379-9683f880-e91f-11e9-8ab6-5285b74da8c9.png)\r\nNote I need to actually add instructions to that issue.",
        "createdAt" : "2019-10-07T23:29:20Z",
        "updatedAt" : "2019-10-15T19:45:29Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3d501326f1314b0ba91238a2b422c7d559672eb",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +16,20 @@    return [];\n  end\n  generated_key_values = {}\n  skip_line_start_symbols = [\"#\", \"/\"]\n  File.foreach(file_abs_path) do |line|"
  }
]