[
  {
    "id" : "65c325e3-3017-46b8-a393-5de7f6cb8428",
    "prId" : 20971,
    "prUrl" : "https://github.com/flutter/flutter/pull/20971#pullrequestreview-151560282",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "parentId" : null,
        "authorId" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "body" : "I think the agent code should do the clean-up (perhaps _in addition_ to the clean-up here). Otherwise, this is pretty much guaranteed to leak into other tests. The proper place to add it is somewhere in the CI loop, perhaps next to the place where we turn off the screen: https://github.com/flutter/cocoon/blob/master/agent/lib/src/commands/ci.dart#L120",
        "createdAt" : "2018-08-24T19:40:05Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "tags" : [
        ]
      },
      {
        "id" : "acc11692-38cb-45f6-885e-61e616d42a8c",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "That would require refactoring and updating the cocoon agent code to dart 2 as well...\r\n\r\nYou're right though, we'll need to expose some sort of AndroidAccessibilityTest config to handle this.\r\n\r\n(_But_  leaving talkback on shouldn't negatively effect testing, since all of the driver gestures bypass the talkback gestures, just saying)",
        "createdAt" : "2018-08-24T20:13:03Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "63904e9d-8093-4da2-8c56-f07977b95d4f",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "cc @goderbauer , @gspencergoog do you guys agree with yegor that we need to do this in coccon agent? tearDownAll is always called so I believe the chance of it failing to execute are minimal - or rather the agent process invoking it has the same risks.",
        "createdAt" : "2018-08-28T22:43:28Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "f843d332-712a-4e45-b05d-0a815b83c789",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "body" : "Leaving it up to @goderbauer and @gspencergoog (and perhaps @cbracken) to make a final call, . If I was among the ones maintaining the devicelab right now I'd continue insisting that the agents do the clean-up :smile: I built the devicelab with the philosophy that flutter/flutter repository cannot be trusted, and where possible (and practical) did all the clean-up in the agent code, which doesn't change often. For example, the agents are currently reponsible for managing screen on/off state, cleaning up dangling processes, and smoke-testing the USB connections. I think this falls under the same category.",
        "createdAt" : "2018-08-28T22:55:51Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "tags" : [
        ]
      },
      {
        "id" : "caad08ef-1ec1-4766-9b08-b8a864deaef1",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "I would agree with Yegor that the clean-up should also happen in the agent. Is turning it off a no-op if it is already off? In that case we could turn it off before we run a test to ensure that this doesn't leak across tests even if the agent or test was killed mid-execution?\r\n\r\n@jonahwilliams Why is this dependent on moving the agents to Dart 2?",
        "createdAt" : "2018-08-29T16:08:01Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "dadad6bd-f807-4c5b-b033-5cc11df67fe8",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Actually we might not need to move to dart 2 I think I was confused a bit with something else. Turning it off is a no-op, so we can run that as a part of clean up. In that case, the test would still be required to set up TalkBack and could tear it down too, but there would be way less risk of leaks. @yjbanov does that sound good to you?",
        "createdAt" : "2018-08-29T16:29:45Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "c666a816-d466-4166-9698-1c9de9a1e324",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "body" : ":+1: ",
        "createdAt" : "2018-08-29T17:01:07Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "ac2c92fd-803c-4666-96b1-db1044c762c5",
        "tags" : [
        ]
      },
      {
        "id" : "ea39c07d-5df1-4dfe-918c-f4889e2354b2",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "I've updated linux1/2 ... just a bunch of macs to go",
        "createdAt" : "2018-08-31T17:06:45Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "f93776d3-9854-4a22-8a93-ea6452fe2164",
        "parentId" : "19833cd6-f88d-430a-bb72-68754fedbc9b",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "macs updated",
        "createdAt" : "2018-08-31T22:01:14Z",
        "updatedAt" : "2018-09-06T16:26:32Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "54e43f8fb353ba1cf171281e92633acdd80520e1",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +37,41 @@    tearDownAll(() async {\n      // ... And turn it off again\n      final io.Process run = await io.Process.start('adb', const <String>[\n        'shell',\n        'settings',"
  }
]