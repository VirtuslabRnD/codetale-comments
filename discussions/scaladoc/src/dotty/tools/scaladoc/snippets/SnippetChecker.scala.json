[
  {
    "id" : "84394139-e6c1-47ba-9529-bbf525b76cf5",
    "prId" : 11582,
    "prUrl" : "https://github.com/lampepfl/dotty/pull/11582#pullrequestreview-666665352",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "71068e87-42a1-46aa-adc7-797b71464ed9",
        "parentId" : null,
        "authorId" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "body" : "What is the purpose of SnippetCompilerSetting? If it's just storing settings it seems that the existing `SettingsState` would suffice and you could write something like :\r\n```scala\r\n  private val snippetCompilerSettings = cctx.settings.classpath.updateIn(cctx.settingsState, fullClasspath)\r\n```",
        "createdAt" : "2021-05-23T17:23:35Z",
        "updatedAt" : "2021-05-23T17:23:39Z",
        "lastEditedBy" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "tags" : [
        ]
      },
      {
        "id" : "fcae645e-d389-4e3f-890a-d3fffba6c1c5",
        "parentId" : "71068e87-42a1-46aa-adc7-797b71464ed9",
        "authorId" : "8cb031fc-f40c-4d99-9506-5ae74a7f3d46",
        "body" : "If we change classpath of compiler context used to load TASTY to produce documentation from, won't it affect loading process?",
        "createdAt" : "2021-05-24T07:50:16Z",
        "updatedAt" : "2021-05-24T07:50:16Z",
        "lastEditedBy" : "8cb031fc-f40c-4d99-9506-5ae74a7f3d46",
        "tags" : [
        ]
      },
      {
        "id" : "e9191766-9aaf-4873-ba77-aaa21942228f",
        "parentId" : "71068e87-42a1-46aa-adc7-797b71464ed9",
        "authorId" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "body" : "Since updateIn returns a new SettingsState, I was expecting it to not mutate the existing settingsState of the compiler context, but in fact it's slightly more tricky than that, it will be mutated if no one tried to read a setting previously: https://github.com/lampepfl/dotty/blob/e2e77b56d012b00faf16a86ad1c8437404bb0812/compiler/src/dotty/tools/dotc/config/Settings.scala#L36-L40 (this is a really bad idea and that code that should be replaced)",
        "createdAt" : "2021-05-24T11:57:03Z",
        "updatedAt" : "2021-05-24T11:57:04Z",
        "lastEditedBy" : "9ffc9890-522c-4d3a-8fe5-fb5cbad2b309",
        "tags" : [
        ]
      }
    ],
    "commit" : "946752fd76b721393bc2a1fedcde1817da64bf5f",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +27,31 @@  private val snippetCompilerSettings: Seq[SnippetCompilerSetting[_]] = cctx.settings.userSetSettings(cctx.settingsState).filter(_ != cctx.settings.classpath).map( s =>\n    SnippetCompilerSetting(s, s.valueIn(cctx.settingsState))\n  ) :+ SnippetCompilerSetting(cctx.settings.classpath, fullClasspath)\n\n  private val compiler: SnippetCompiler = SnippetCompiler(snippetCompilerSettings = snippetCompilerSettings)"
  }
]