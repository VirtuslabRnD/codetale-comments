[
  {
    "id" : "32d67aab-a854-494a-8289-c8470ed44430",
    "prId" : 99659,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/99659#pullrequestreview-603251269",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c1835651-ab33-4866-9f35-6dfb4387d03e",
        "parentId" : null,
        "authorId" : "54734308-b9bb-4f25-91a3-239b9e074b3f",
        "body" : "Add a TODO to remove the delay or rearrange the calls to this method so it's likely enough time has passed to get an accurate output of the service configuration.",
        "createdAt" : "2021-03-03T00:12:16Z",
        "updatedAt" : "2021-03-03T00:12:24Z",
        "lastEditedBy" : "54734308-b9bb-4f25-91a3-239b9e074b3f",
        "tags" : [
        ]
      },
      {
        "id" : "8d596e9a-6a19-4a20-8d4e-f19644c6594f",
        "parentId" : "c1835651-ab33-4866-9f35-6dfb4387d03e",
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "I don't understand. The delay is zero by default, but each callsite can set it independently \"so it's likely enough time has passed to get an accurate output.\"\r\n\r\nThe callsites in this PR add a total of 3 seconds of delay. Are you saying that's too much?",
        "createdAt" : "2021-03-03T00:19:33Z",
        "updatedAt" : "2021-03-03T00:19:33Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      },
      {
        "id" : "4237e864-9d57-4f8e-b567-b6641739c482",
        "parentId" : "c1835651-ab33-4866-9f35-6dfb4387d03e",
        "authorId" : "54734308-b9bb-4f25-91a3-239b9e074b3f",
        "body" : "It's probably fine but a bit unfortunate.",
        "createdAt" : "2021-03-03T17:17:34Z",
        "updatedAt" : "2021-03-03T17:17:34Z",
        "lastEditedBy" : "54734308-b9bb-4f25-91a3-239b9e074b3f",
        "tags" : [
        ]
      },
      {
        "id" : "4017ba64-f371-49ca-8c6a-bf9ae09ac70e",
        "parentId" : "c1835651-ab33-4866-9f35-6dfb4387d03e",
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Yeah, I think it's ok for now. If/when we do an audit of node startup performance someday we can reconsider, but this will definitely not be the most significant delay.",
        "createdAt" : "2021-03-03T19:07:59Z",
        "updatedAt" : "2021-03-03T19:07:59Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      }
    ],
    "commit" : "3d2e9600d957b0914ebd51f77d446213a7906d5c",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +59,63 @@    [parameter(Mandatory=$false)] [int]$Delay = 0\n  )\n  if ($Delay -gt 0) {\n    Start-Sleep $Delay\n  }"
  },
  {
    "id" : "c77393cb-2d79-4487-9e7f-7d3af9674242",
    "prId" : 96661,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96661#pullrequestreview-542436477",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8abbd220-3152-43f9-9490-c3ce69d95013",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Please update the comment above to describe this new (awesome) behavior.",
        "createdAt" : "2020-12-02T01:46:29Z",
        "updatedAt" : "2020-12-02T07:00:12Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      }
    ],
    "commit" : "155bda010a0835ba749467cf21c168face3f449e",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +144,148 @@  )\n\n  # If the file is already downloaded and matches the expected hash, skip the download.\n  if ((Test-Path -Path $OutFile) -And -Not [string]::IsNullOrEmpty($Hash)) {\n    try {"
  },
  {
    "id" : "7f1be992-c7c6-446d-8c8a-1c344adae55a",
    "prId" : 96661,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96661#pullrequestreview-542436477",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9534adbe-8faf-4b16-b010-84adbaf818cb",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Please add a log message to indicate that the download is being skipped because the SHA matches.",
        "createdAt" : "2020-12-02T01:47:27Z",
        "updatedAt" : "2020-12-02T07:00:12Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      }
    ],
    "commit" : "155bda010a0835ba749467cf21c168face3f449e",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +149,153 @@      Validate-SHA -Hash $Hash -Path $OutFile -Algorithm $Algorithm\n      Log-Output \"Skip download of ${OutFile}, it already exists with expected hash.\"\n      return\n    }\n    catch {"
  },
  {
    "id" : "f91d50ac-f2c3-4ff6-bf49-b17c6034a093",
    "prId" : 96661,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96661#pullrequestreview-543344818",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0b3c3d1b-783d-4a5e-8db9-d968dde12f73",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Use lowercase for -and and -gt? This is what the style guide suggests, and would be consistent with the rest of this code I think.",
        "createdAt" : "2020-12-03T00:19:43Z",
        "updatedAt" : "2020-12-03T00:22:37Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      }
    ],
    "commit" : "155bda010a0835ba749467cf21c168face3f449e",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +161,165 @@  while ($true) {\n    foreach ($url in $URLs) {\n      if (($Attempts -ne 0) -And ($currentAttempt -Gt 5)) {\n        throw \"Attempted to download ${url} ${currentAttempt} times. Giving up.\"\n      }"
  },
  {
    "id" : "b4c1e0b4-0c99-40bb-96f9-bdc6ecbba27c",
    "prId" : 96661,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96661#pullrequestreview-543344818",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "54136cd0-5e34-44f1-a31f-6bb693262ef3",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Thanks, this is much better!",
        "createdAt" : "2020-12-03T00:21:58Z",
        "updatedAt" : "2020-12-03T00:22:37Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      }
    ],
    "commit" : "155bda010a0835ba749467cf21c168face3f449e",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +166,170 @@      $currentAttempt++\n      try {\n        Get-RemoteFile -OutFile $OutFile -Url $url -Headers $Headers\n      }\n      catch {"
  },
  {
    "id" : "6dd6a127-e579-49d3-be8e-e8a060c563e6",
    "prId" : 75014,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75014#pullrequestreview-211492908",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3e3e8a7b-06ad-42b8-9471-e09335188e8a",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Can you add a small comment explaining what this function does?\r\n\r\nSame for other functions you've added.",
        "createdAt" : "2019-03-06T18:26:43Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      },
      {
        "id" : "0e0820f6-e41d-4711-8277-ee9b5ab95c43",
        "parentId" : "3e3e8a7b-06ad-42b8-9471-e09335188e8a",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "Will do.",
        "createdAt" : "2019-03-06T21:48:26Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "0a21d644f5e4cb565c0563d4ab146d0f656cd9b0",
    "line" : 44,
    "diffHunk" : "@@ -1,1 +204,208 @@# Close-Handle closes the specified open file handle.\n# On failure, throws an exception.\nfunction Close-Handle {\n  param (\n    [parameter(Mandatory=$true)] [System.IntPtr]$Handle"
  },
  {
    "id" : "6d280245-9266-4318-aaee-f2dc47b3795a",
    "prId" : 75014,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75014#pullrequestreview-211491301",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a28217d-3e84-40de-b863-1e3d6a7715f2",
        "parentId" : null,
        "authorId" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "body" : "Any idea what can happen if the kubelet writes to the file between the SetFilePointer and the SetEndOfFile?\r\n\r\nWould SetEndOfFile fail? If so, should we retry with whatever the current FilePointer value is? Or maybe just not throw the exception if SetEndOfFile fails?",
        "createdAt" : "2019-03-06T18:38:44Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "84643be2-004e-4f49-9ab2-b32a1995bad6",
        "tags" : [
        ]
      },
      {
        "id" : "d6bb9eaa-7a3e-4f75-9c32-26700c0a6936",
        "parentId" : "0a28217d-3e84-40de-b863-1e3d6a7715f2",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "It should be fine, the file pointer associated with the script's handle is independent from the Kubelet's.",
        "createdAt" : "2019-03-06T21:44:57Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "0a21d644f5e4cb565c0563d4ab146d0f656cd9b0",
    "line" : 108,
    "diffHunk" : "@@ -1,1 +268,272 @@  }\n\n  $ret = $Kernel32::SetEndOfFile($handle)\n  $err = [System.Runtime.InteropServices.Marshal]::GetLastWin32Error()\n  if ($ret -eq 0) {"
  },
  {
    "id" : "d370b5e5-5d64-431b-9d47-6d0456dc3d09",
    "prId" : 75014,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75014#pullrequestreview-211542900",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3bf9eda-3d77-4a27-9e2c-684f1d3b6556",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "Should we put this in `/etc/kubernetes`?\r\n",
        "createdAt" : "2019-03-06T22:53:29Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "0a4f5c6d-1aab-4c0c-9f60-a1c3a906f9c8",
        "parentId" : "f3bf9eda-3d77-4a27-9e2c-684f1d3b6556",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "I'd like to stay consistent with whatever convention we have; currently that seems to be putting most of the scripts (except hns.psm1) in `C:\\`. I'd support moving most scripts under `etc/kubernetes` in a future PR.",
        "createdAt" : "2019-03-07T00:11:11Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "0a21d644f5e4cb565c0563d4ab146d0f656cd9b0",
    "line" : 305,
    "diffHunk" : "@@ -1,1 +465,469 @@  # Write a powershell script to a file that imports this module ($PSCommandPath)\n  # and calls Rotate-Files with the configured arguments.\n  $scriptPath = \"C:\\rotate-kube-logs.ps1\"\n  New-Item -Force -ItemType file -Path $scriptPath | Out-Null\n  Set-Content -Path $scriptPath @\""
  },
  {
    "id" : "c19305d0-dbd3-424a-a36b-70c5d5585531",
    "prId" : 75014,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75014#pullrequestreview-211953360",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8662836e-0608-4b63-a0a9-1b6f7245cf65",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "How are the exceptions handled in the script? Will the script terminate and does it log anywhere? ",
        "createdAt" : "2019-03-06T23:31:07Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "5d45672d-9e4a-4b58-a35e-cc8525a7afd4",
        "parentId" : "8662836e-0608-4b63-a0a9-1b6f7245cf65",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "An exception (terminating error) should terminate the rotation script. The behavior in the startup scripts has been to terminate and log the exception to the serial console (assuming it was stderr). There are also non-terminating errors that only crash the script if `$ErrorActionPreference = 'Stop'` (it's `Continue` by default, and in the rotation script, though we set it to `Stop` in `configure.ps1`). Non-terminating errors are things like `ObjectNotFound`. It's probably a good idea to change the rotation script to `Stop` as well.\r\n\r\nI'm not sure where logs go, if any, from scheduled tasks. If the task crashes due to the exception, there *may* be a message in the Windows event logs.\r\n\r\nOne thing I haven't done but could: Catch exceptions from Rotate-File in Rotate-Files and log them, so issues rotating one file won't block others. If I do this, however, it may reduce our ability to detect errors, since the rotation script won't crash and there may be no stderr/stdout logs anywhere.",
        "createdAt" : "2019-03-07T00:26:56Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      },
      {
        "id" : "b64b98fb-3c2e-467e-84c0-b3dce6a934e6",
        "parentId" : "8662836e-0608-4b63-a0a9-1b6f7245cf65",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "Decided to set Stop in the rotation script and catch those exceptions. I'd rather the script be more robust since error detection for scheduled tasks looks difficult.",
        "createdAt" : "2019-03-07T00:47:11Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      },
      {
        "id" : "d02f977f-acec-43d6-980b-729532ab5c0e",
        "parentId" : "8662836e-0608-4b63-a0a9-1b6f7245cf65",
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "To be clear, failed to rotate one file won't affect other files, right?",
        "createdAt" : "2019-03-07T18:08:46Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "1fb7d503-75ac-4aa5-9470-9df18f0427a2",
        "parentId" : "8662836e-0608-4b63-a0a9-1b6f7245cf65",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "It shouldn't now that we catch exceptions from Rotate-File in Rotate-Files.",
        "createdAt" : "2019-03-07T18:41:39Z",
        "updatedAt" : "2019-03-07T18:42:40Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "0a21d644f5e4cb565c0563d4ab146d0f656cd9b0",
    "line" : 105,
    "diffHunk" : "@@ -1,1 +265,269 @@  if ($ret -eq $INVALID_SET_FILE_POINTER -and $err -ne $NO_ERROR) {\n    Close-Handle -Handle $handle\n    throw \"Failed to set file pointer for handle ${handle}, system error code: ${err}\"\n  }\n"
  }
]