[
  {
    "id" : "4deb4667-cc67-410f-8cea-9a313571fe66",
    "prId" : 88181,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88181#pullrequestreview-360617275",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9c0a1ce5-cbed-4b57-ab3b-561a4395e4c9",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "instead of relying on shell splitting behavior we use an explicit array / argv for the healthcheck command\r\n\r\nthis is the reason for all of the changes related to `healthcheck_command` ",
        "createdAt" : "2020-02-15T00:22:06Z",
        "updatedAt" : "2020-02-15T00:26:50Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      },
      {
        "id" : "d6665287-4e3f-4d91-a204-b46f99617b20",
        "parentId" : "9c0a1ce5-cbed-4b57-ab3b-561a4395e4c9",
        "authorId" : "7aca96c2-45d7-4567-99be-0323d7556c55",
        "body" : "At some point (soon) we may want to reverse the default behavior from docker to crictl. ",
        "createdAt" : "2020-02-18T18:25:33Z",
        "updatedAt" : "2020-02-18T18:25:33Z",
        "lastEditedBy" : "7aca96c2-45d7-4567-99be-0323d7556c55",
        "tags" : [
        ]
      },
      {
        "id" : "f33947e0-17f7-46e2-8e37-b6292b4940f6",
        "parentId" : "9c0a1ce5-cbed-4b57-ab3b-561a4395e4c9",
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "SGTM\r\n\r\ncan you approve? :upside_down_face: ",
        "createdAt" : "2020-02-18T19:37:15Z",
        "updatedAt" : "2020-02-18T19:37:15Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "4454ce6f373c6687f803ab7822ba37a4750604c3",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +34,38 @@  # will also fail, and docker will be killed. This is undesirable especially when\n  # docker live restore is disabled.\n  local healthcheck_command=(docker ps)\n  if [[ \"${CONTAINER_RUNTIME:-docker}\" != \"docker\" ]]; then\n    healthcheck_command=(\"${crictl}\" pods)"
  },
  {
    "id" : "5c30b179-c17d-489a-b887-7624f1bee703",
    "prId" : 88181,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88181#pullrequestreview-359284552",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "afcd35b3-c73c-4e23-add5-5f2514dbdde6",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "equivalent but clearer",
        "createdAt" : "2020-02-15T00:23:00Z",
        "updatedAt" : "2020-02-15T00:26:51Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "4454ce6f373c6687f803ab7822ba37a4750604c3",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +72,76 @@  local -r max_seconds=10\n  local output=\"\"\n  while true; do\n    if ! output=$(curl -m \"${max_seconds}\" -f -s -S http://127.0.0.1:10248/healthz 2>&1); then\n      # Print the response and/or errors."
  },
  {
    "id" : "4ace4358-e921-42ee-bfbe-8e7ca1998555",
    "prId" : 88181,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88181#pullrequestreview-359284552",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5c88f49b-d8d4-4f61-993f-4ac716e4a9f0",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "avoid re-splitting etc by quoting the string. not a big deal here but technically a correctness fix.",
        "createdAt" : "2020-02-15T00:23:27Z",
        "updatedAt" : "2020-02-15T00:26:51Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "4454ce6f373c6687f803ab7822ba37a4750604c3",
    "line" : 37,
    "diffHunk" : "@@ -1,1 +75,79 @@    if ! output=$(curl -m \"${max_seconds}\" -f -s -S http://127.0.0.1:10248/healthz 2>&1); then\n      # Print the response and/or errors.\n      echo \"${output}\"\n      echo \"Kubelet is unhealthy!\"\n      systemctl kill kubelet"
  },
  {
    "id" : "4cce9578-bf95-4540-8f57-e219f94068f2",
    "prId" : 88181,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88181#pullrequestreview-359284552",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "67f10d13-d876-424e-bd0c-18cae3061ff7",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "I'm pretty sure this is what we previously intended. \r\n\r\nThe old code results in `${component}` not being expanded within quotes AND not having any quotes printed in the output.\r\n\r\nHaving quotes next to it suggests we wanted one of those things, if we just wanted it to be expanded within quotes then the quotes in the middle are totally unnecessary, so I guessed we wanted it to print like:\r\n`Health monitoring for component \"foo\" is not supported!`\r\n\r\nwhich this now does.",
        "createdAt" : "2020-02-15T00:26:22Z",
        "updatedAt" : "2020-02-15T00:26:51Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "4454ce6f373c6687f803ab7822ba37a4750604c3",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +109,113 @@  kubelet_monitoring\nelse\n  echo \"Health monitoring for component \\\"${component}\\\" is not supported!\"\nfi"
  },
  {
    "id" : "f8d447a4-3a0b-4d90-add9-897391e48a14",
    "prId" : 25425,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2da8a9b7-8914-45ce-ab86-7ee2c7f06061",
        "parentId" : null,
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "https://github.com/kubernetes/kubernetes/blob/master/cluster/saltbase/salt/supervisor/kubelet-checker.sh adds an extra curl here that isn't piped to `/dev/null` before killing the kubelet. For debugging, it would be nice to know what healthz was reporting prior to being killed. In container-vm, that log would end up in a supervisor log location, where can we put it on GCI?\n",
        "createdAt" : "2016-05-18T18:36:47Z",
        "updatedAt" : "2016-05-18T22:16:14Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "a0c6934b-06f0-4a13-8f4d-8a6114def512",
        "parentId" : "2da8a9b7-8914-45ce-ab86-7ee2c7f06061",
        "authorId" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "body" : "The extra curl uses http, but the first curl uses https. Is this intentionally or a typo? And the extra curl is with a \"-s\" flag which means \"don't output anything\". I guess this is incorrect.\n",
        "createdAt" : "2016-05-18T18:52:35Z",
        "updatedAt" : "2016-05-18T22:16:14Z",
        "lastEditedBy" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "tags" : [
        ]
      },
      {
        "id" : "e08e2356-4b88-4bdc-a981-d7f65323c75b",
        "parentId" : "2da8a9b7-8914-45ce-ab86-7ee2c7f06061",
        "authorId" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "body" : "@roberthbailey @dchen1107 I just verified that the two curls in https://github.com/kubernetes/kubernetes/blob/master/cluster/saltbase/salt/supervisor/kubelet-checker.sh produce different things. The second one is incorrect. I can update it in this PR, or leave it to others to fix.\n",
        "createdAt" : "2016-05-18T20:14:19Z",
        "updatedAt" : "2016-05-18T22:16:14Z",
        "lastEditedBy" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "tags" : [
        ]
      },
      {
        "id" : "266719a3-490f-4652-9078-204f06c92218",
        "parentId" : "2da8a9b7-8914-45ce-ab86-7ee2c7f06061",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "My guess is a typo. Let's fix it in this PR (so that we don't add a 1 line PR to the submit queue). \n",
        "createdAt" : "2016-05-18T20:54:56Z",
        "updatedAt" : "2016-05-18T22:16:14Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "a25124ba-84de-4fae-af39-9cd63c7afa9d",
        "parentId" : "2da8a9b7-8914-45ce-ab86-7ee2c7f06061",
        "authorId" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "body" : "Fixed\n",
        "createdAt" : "2016-05-18T21:17:23Z",
        "updatedAt" : "2016-05-18T22:16:14Z",
        "lastEditedBy" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "tags" : [
        ]
      }
    ],
    "commit" : "a737e1eba13262a4e47b65bba2a861d9b6550943",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +44,48 @@  while [ 1 ]; do\n    if ! curl --insecure -m \"${max_seconds}\" -f -s https://127.0.0.1:${KUBELET_PORT:-10250}/healthz > /dev/null; then\n      echo \"Kubelet is unhealthy!\"\n      curl --insecure https://127.0.0.1:${KUBELET_PORT:-10250}/healthz\n      pkill kubelet"
  }
]