[
  {
    "id" : "5413d209-15a8-4ad9-8acc-255b6b37b393",
    "prId" : 98569,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/98569#pullrequestreview-579656734",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "47775d68-88d0-48f4-994d-51b60bfb0eda",
        "parentId" : null,
        "authorId" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "body" : "@saschagrunert are we not concerned about the base image caching issue that previously broke this when switching to buildx? (see https://github.com/kubernetes/kubernetes/pull/97982 for more info)",
        "createdAt" : "2021-01-29T12:55:12Z",
        "updatedAt" : "2021-01-29T12:55:18Z",
        "lastEditedBy" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "tags" : [
        ]
      },
      {
        "id" : "dacde32d-282e-465d-acd6-e03096ee536f",
        "parentId" : "47775d68-88d0-48f4-994d-51b60bfb0eda",
        "authorId" : "36b049e7-5c64-46e2-809a-9067732f0056",
        "body" : "Just a bit (?) :innocent: \r\n\r\nI tested it right now and it seems to work:\r\nhttps://console.cloud.google.com/cloud-build/builds/478d0c13-4dfc-4f0c-9d82-5fff0708c810?project=kubernetes-release-test\r\n\r\n\r\nCan you share some more insights which error cases we might face?",
        "createdAt" : "2021-01-29T14:43:20Z",
        "updatedAt" : "2021-01-29T14:46:22Z",
        "lastEditedBy" : "36b049e7-5c64-46e2-809a-9067732f0056",
        "tags" : [
        ]
      },
      {
        "id" : "ea52f1ba-d0de-4625-b2f7-9045b6288971",
        "parentId" : "47775d68-88d0-48f4-994d-51b60bfb0eda",
        "authorId" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "body" : "@saschagrunert we were previously hitting a bug with the base image not being cached on registry mirror, but it is possible that issue has been addressed on GCR side (https://github.com/kubernetes/kubernetes/pull/92042) :+1: ",
        "createdAt" : "2021-01-29T14:50:30Z",
        "updatedAt" : "2021-01-29T14:50:30Z",
        "lastEditedBy" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "tags" : [
        ]
      },
      {
        "id" : "fb046ec5-d52d-4b50-97d9-d7f62e60977f",
        "parentId" : "47775d68-88d0-48f4-994d-51b60bfb0eda",
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "this is also addressed on the buildx side going forward (should fallback to the non mirror endpoint like docker build does), thought it may be some time before we're using the patched version.",
        "createdAt" : "2021-01-29T22:16:49Z",
        "updatedAt" : "2021-01-29T22:16:50Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "e9fbdff7c6b4404f32bb168981a3adb3c655edfd",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +60,64 @@\t\t--platform linux/${ARCH} \\\n\t\t--load \\\n\t\t--pull \\\n\t\t-t ${REGISTRY}/conformance-${ARCH}:${VERSION} \\\n\t\t${TEMP_DIR}"
  },
  {
    "id" : "7e86eec9-df16-4478-99a9-239273a9cb6f",
    "prId" : 98569,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/98569#pullrequestreview-580704391",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5c4d8426-5a23-4bad-81c8-888cbbc76de0",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "- where is buildx being initialized in the case that the host does not have it initialized already?\r\n- we're not setting the DOCKER_CLI_EXPERIMENTAL=enabled anywhere that I see either?",
        "createdAt" : "2021-02-01T08:30:40Z",
        "updatedAt" : "2021-02-01T08:30:40Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      },
      {
        "id" : "3ae9ff18-d9ec-4e67-858d-4c29f77de0fe",
        "parentId" : "5c4d8426-5a23-4bad-81c8-888cbbc76de0",
        "authorId" : "36b049e7-5c64-46e2-809a-9067732f0056",
        "body" : "> * where is buildx being initialized in the case that the host does not have it initialized already?\r\n\r\nCurrently nowhere, we have an `init-buildx.sh` script in k/release which could be vendored over here: https://github.com/kubernetes/release/blob/master/hack/init-buildx.sh\r\n\r\nDo we wanna do that?\r\n\r\n> * we're not setting the DOCKER_CLI_EXPERIMENTAL=enabled anywhere that I see either?\r\n\r\nSame as above, the CI / release process right now ensures that it is set. Following docker versions will set it per default as well: https://github.com/docker/cli/blob/e31e00585363e6a989e37fa92cf06481ea218344/docs/deprecated.md#configuration-options-for-experimental-cli-features\r\n\r\nAnyways, we can still add it to the build scripts, which should not hurt.",
        "createdAt" : "2021-02-01T08:44:49Z",
        "updatedAt" : "2021-02-01T08:44:49Z",
        "lastEditedBy" : "36b049e7-5c64-46e2-809a-9067732f0056",
        "tags" : [
        ]
      },
      {
        "id" : "00811456-3e4a-4f3f-9f90-05761e93b679",
        "parentId" : "5c4d8426-5a23-4bad-81c8-888cbbc76de0",
        "authorId" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "body" : "@saschagrunert Related: looks like we are not setting it currently in the build canary (https://prow.k8s.io/view/gcs/kubernetes-jenkins/logs/ci-kubernetes-build-canary/1355584153801723904)\r\n\r\nDo you want to go ahead and handle setup in k/k or try to just fix jobs in intermediate?",
        "createdAt" : "2021-02-01T14:15:33Z",
        "updatedAt" : "2021-02-01T14:15:33Z",
        "lastEditedBy" : "36d7f8b5-3497-43b0-96eb-612a05dccdf8",
        "tags" : [
        ]
      },
      {
        "id" : "679126f2-94e1-4d2f-9608-dcde8a088626",
        "parentId" : "5c4d8426-5a23-4bad-81c8-888cbbc76de0",
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "> Currently nowhere, we have an init-buildx.sh script in k/release which could be vendored over here: https://github.com/kubernetes/release/blob/master/hack/init-buildx.sh\r\n\r\nwell I'd say yes, but the original source for that is in fact:\r\nhttps://github.com/kubernetes-sigs/kind/commits/master/hack/build/init-buildx.sh\r\nðŸ™ƒ \r\n\r\nWithout this, you can't consistently rely on there being a builder provisioned, causing builds to fail on clean hosts (except on docker desktop, where there's one provided OOTB).",
        "createdAt" : "2021-02-01T19:45:16Z",
        "updatedAt" : "2021-02-01T19:45:16Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "e9fbdff7c6b4404f32bb168981a3adb3c655edfd",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +57,61 @@\tcd ${TEMP_DIR} && sed -i.back \"s|BASEIMAGE|${BASEIMAGE}|g\" Dockerfile\n\n\tdocker buildx build \\\n\t\t--platform linux/${ARCH} \\\n\t\t--load \\"
  },
  {
    "id" : "fa4b76d9-128d-4438-8b34-44a0608feb94",
    "prId" : 74608,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/74608#pullrequestreview-208738038",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bdb1d09e-e715-406a-8871-302c6ac7cf4e",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "this should have remained staging - you can't push to k8s.gcr.io directly, only to staging.",
        "createdAt" : "2019-02-27T19:13:10Z",
        "updatedAt" : "2019-02-27T19:13:11Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "be2a67ce-f48b-4e0b-9a98-820136a1c7b8",
        "parentId" : "bdb1d09e-e715-406a-8871-302c6ac7cf4e",
        "authorId" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "body" : "aha. will fix in a next rev",
        "createdAt" : "2019-02-27T20:05:04Z",
        "updatedAt" : "2019-02-27T20:05:04Z",
        "lastEditedBy" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "tags" : [
        ]
      }
    ],
    "commit" : "23b33f5c852beb60eabd4d0cbb92f5ef00cf647a",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +18,22 @@#   [ARCH=amd64] [REGISTRY=\"k8s.gcr.io\"] make (build|push) VERSION={some_released_version_of_kubernetes}\n\nREGISTRY?=k8s.gcr.io\nARCH?=amd64\nOUT_DIR?=_output"
  },
  {
    "id" : "6c513ac7-8ea6-4a34-9c27-2c2aa725a12f",
    "prId" : 69368,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69368#pullrequestreview-164376440",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "why hyperkube?",
        "createdAt" : "2018-10-11T23:24:24Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "a6086098-f387-438d-80fd-274a105f4a94",
        "parentId" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "authorId" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "body" : "i needed something that had `ca-certificates` and just reusing the existing image.",
        "createdAt" : "2018-10-12T01:35:23Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "tags" : [
        ]
      },
      {
        "id" : "1f8061ba-8fcc-43c4-a9f5-f64bccc11d53",
        "parentId" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "authorId" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "body" : "https://github.com/heptio/kube-conformance/blob/master/Dockerfile#L20",
        "createdAt" : "2018-10-12T01:35:29Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "tags" : [
        ]
      },
      {
        "id" : "426f93cc-0d97-4c26-881f-4391ed650e51",
        "parentId" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "you could also potentially `clean-install ca-certificates` in the Dockerfile for conformance. hyperkube-base has a lot of extra stuff you don't really need...",
        "createdAt" : "2018-10-12T18:18:57Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "f64fb41d-7be8-4f34-887c-273ff7b0cd8f",
        "parentId" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "OTOH installing packages at build time is not great, so I'm OK with leaving this as-is for now.",
        "createdAt" : "2018-10-12T18:57:10Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "d1936787-b49e-417e-b401-a9ff1d8ddc7c",
        "parentId" : "16e6ed1f-e293-4285-b024-ceb1c75af0db",
        "authorId" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "body" : "whew! thanks :)",
        "createdAt" : "2018-10-12T19:18:22Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "tags" : [
        ]
      }
    ],
    "commit" : "6830bad2a6d082bf40e1fbb8026bf3018ccc0707",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +26,30 @@CLUSTER_DIR?=$(shell pwd)/../../../cluster/\n\nBASEIMAGE=k8s.gcr.io/debian-hyperkube-base-$(ARCH):0.10.2\nTEMP_DIR:=$(shell mktemp -d -t conformanceXXXXXX)\n"
  },
  {
    "id" : "5ef8e90c-4353-4c91-a485-451cde0a5ade",
    "prId" : 69368,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69368#pullrequestreview-164072450",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ee553e28-d8c0-4699-b905-ba40fe677dbb",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "maybe `build/lib/release.sh` could set these variables, since it really knows the path?",
        "createdAt" : "2018-10-11T23:25:14Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "0403ab16-1db4-4a77-aed7-81090f447d93",
        "parentId" : "ee553e28-d8c0-4699-b905-ba40fe677dbb",
        "authorId" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "body" : "was just following the pattern from `cluster/images/hyperkube/Makefile` could we do this in a later PR? (clean up both)",
        "createdAt" : "2018-10-12T01:36:38Z",
        "updatedAt" : "2018-10-12T19:33:50Z",
        "lastEditedBy" : "bd04f755-e62f-45fb-8771-4cc2b5db49d4",
        "tags" : [
        ]
      }
    ],
    "commit" : "6830bad2a6d082bf40e1fbb8026bf3018ccc0707",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +21,25 @@ARCH?=amd64\nOUT_DIR?=_output\nGINKGO_BIN?=$(shell pwd)/../../../$(OUT_DIR)/dockerized/bin/linux/$(ARCH)/ginkgo\nKUBECTL_BIN?=$(shell pwd)/../../../$(OUT_DIR)/dockerized/bin/linux/$(ARCH)/kubectl\nE2E_TEST_BIN?=$(shell pwd)/../../../$(OUT_DIR)/dockerized/bin/linux/$(ARCH)/e2e.test"
  },
  {
    "id" : "865706f3-f4b1-40fa-860c-63d1d22963f2",
    "prId" : 69368,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69368#pullrequestreview-164398808",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ce8c541e-227f-4a44-9b88-f02a9268b4c2",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "technically this should be 2018 but I don't really care",
        "createdAt" : "2018-10-12T20:31:46Z",
        "updatedAt" : "2018-10-12T20:31:46Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      }
    ],
    "commit" : "6830bad2a6d082bf40e1fbb8026bf3018ccc0707",
    "line" : 1,
    "diffHunk" : "@@ -1,1 +-1,3 @@# Copyright 2016 The Kubernetes Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");"
  }
]