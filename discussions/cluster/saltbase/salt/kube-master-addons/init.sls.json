[
  {
    "id" : "ccb471d0-5874-45e6-8990-afdc91f85925",
    "prId" : 10211,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f166e5cc-2315-4a93-bcff-8cb9f8056364",
        "parentId" : null,
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "Can you explain _why_ the order here is important. My best guess is that because this script is what side-loads the docker images for the master components, so the kubelet won't be able to start them before the images are side-loaded (attempts to fetch them from gcr.io will fail). But I'm not sure how that eliminates the race condition. Won't the images be side loaded right after the kubelet starts (potentially before it restarts docker) -- meaning that there will be a race between when salt decides to side load the images into docker and when the kubelet tries to launch pods from the manifest?\n\nIf the kubelet waits to launch pods from the manifest until after the networking is configured, I don't see how this would have any additional effect -- it shouldn't matter when the docker images are side loaded if the kubelet isn't trying to use them until it is safe to do so.  \n",
        "createdAt" : "2015-06-23T08:30:26Z",
        "updatedAt" : "2015-06-23T23:29:53Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "b27d4ad7-3a0c-497f-973a-a5a99d22373e",
        "parentId" : "f166e5cc-2315-4a93-bcff-8cb9f8056364",
        "authorId" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "body" : "God, the coffee just isn't kicking this morning. Ignore both comments, I just remembered this is a separate script. So horribly embarrassed.\n\nOkay, I worked out how this helps and now am on the same. I was worried because the manifest files are laid out on disk when Salt runs, and they're laid out in arbitrary order (because Salt). But this service is the only thing doing the `docker load` from the binary tar files, so yes, as @roberthbailey worked out, kubelet won't be able to start them until they're side-loaded. (Slowly waking up.)\n\nNow that I've caught up - this does feel like a noop patch. I'm not sure what guarantees it's trying to provide.\n",
        "createdAt" : "2015-06-23T13:31:04Z",
        "updatedAt" : "2015-06-23T23:29:53Z",
        "lastEditedBy" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "tags" : [
        ]
      },
      {
        "id" : "6c015376-e608-4e1f-a823-87cc5959668e",
        "parentId" : "f166e5cc-2315-4a93-bcff-8cb9f8056364",
        "authorId" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "body" : "I explained why the order is very important here: https://github.com/GoogleCloudPlatform/kubernetes/issues/10122#issuecomment-114566063\n",
        "createdAt" : "2015-06-23T16:40:05Z",
        "updatedAt" : "2015-06-23T23:29:53Z",
        "lastEditedBy" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "tags" : [
        ]
      },
      {
        "id" : "8dfd7afa-4f42-46e9-80d9-cfbaf3ef64fa",
        "parentId" : "f166e5cc-2315-4a93-bcff-8cb9f8056364",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "Please add a brief note here as well so that the explanation stays with the code. Something along the lines of \"Don't allow the kubelet that is pre-installed on the container vm to launch any of the side-loaded containers since it is being replaced by salt.\"\n\nYou might also note that once we move these containers to gcr.io with proper release versions, this sideloading will be unnecessary and we will need another way to control this. \n",
        "createdAt" : "2015-06-23T18:48:23Z",
        "updatedAt" : "2015-06-23T23:29:53Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "09f81251-ef10-40d9-a2df-7e8abfe5343b",
        "parentId" : "f166e5cc-2315-4a93-bcff-8cb9f8056364",
        "authorId" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "body" : "more comments for this one. But please note that even we have current kubelet included in container vm image, this change is still good. Basically unnecessary fast restart those docker containers might introduce some issues in general. We can remove this until we never push new docker flags through salt, and reinstall new kubelet through salt. \n",
        "createdAt" : "2015-06-23T23:32:07Z",
        "updatedAt" : "2015-06-23T23:32:07Z",
        "lastEditedBy" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "tags" : [
        ]
      }
    ],
    "commit" : "9dbe6fe4e45aeeb5cb5abad8a7d216a3da1d6f57",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +57,61 @@    - require:\n      - service: docker\n      - service: kubelet\n    - watch:\n      - file: master-docker-image-tags"
  },
  {
    "id" : "260f9668-c1b9-44b0-b4c8-4b4d87f8ede3",
    "prId" : 6823,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "07930fbd-8fad-4fb2-a9a6-86bfbc9e7990",
        "parentId" : null,
        "authorId" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "body" : "Why we watch this script file here?\n",
        "createdAt" : "2015-04-14T21:51:27Z",
        "updatedAt" : "2015-04-15T00:53:33Z",
        "lastEditedBy" : "a6409368-42e0-44a9-bf79-9d3042ac3b65",
        "tags" : [
        ]
      },
      {
        "id" : "baa362dd-f717-4f5b-b13e-08a1ae617a6a",
        "parentId" : "07930fbd-8fad-4fb2-a9a6-86bfbc9e7990",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "@dchen1107 so that the service can restart if we have to load more docker images.\n",
        "createdAt" : "2015-04-14T21:56:53Z",
        "updatedAt" : "2015-04-15T00:53:33Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      }
    ],
    "commit" : "a908bb78ea0ec8364c95545feab633bb04610414",
    "line" : null,
    "diffHunk" : "@@ -1,1 +36,40 @@    - watch:\n      - file: master-docker-image-tags\n      - file: /etc/kubernetes/kube-master-addons.sh"
  }
]