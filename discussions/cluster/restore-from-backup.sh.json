[
  {
    "id" : "70ffdab9-c596-4164-a5a9-6c2015a1d0f5",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "62eb3057-f37d-499e-902c-c30007eced37",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "these `i` loop variables are unused placeholders to accomplish the seq loop, `_` is clearer that we intend to ignore them and makes shellcheck happy.",
        "createdAt" : "2019-06-26T06:47:16Z",
        "updatedAt" : "2019-06-26T06:52:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +77,81 @@  # However, we should come with a regex for it to avoid future break.\n  health_ok=\"{\\\"health\\\": \\\"true\\\"}\"\n  for _ in $(seq 120); do\n    # TODO: Is it enough to look into /health endpoint?\n    health=$(curl --silent \"http://127.0.0.1:${port}/health\")"
  },
  {
    "id" : "91180158-c2f4-4cd2-9316-ab0be6834d14",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ac15fae4-c2d1-4314-9194-7e324f0b4b2d",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "equivilant. more explicit & efficient",
        "createdAt" : "2019-06-26T06:47:42Z",
        "updatedAt" : "2019-06-26T06:52:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +106,110 @@  for _ in $(seq 120); do\n    etcd=$(docker ps | grep -c etcd-server)\n    apiserver=$(docker ps | grep -c apiserver)\n    # TODO: Theoretically it is possible, that apiserver and or etcd\n    # are currently down, but Kubelet is now restarting them and they"
  },
  {
    "id" : "0bcb3650-474f-4356-85fc-99a3b6bb64d7",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "30880e1f-82c2-40fc-bb92-0254cde8d667",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "the test command is unspecified in POSIX with > 4 arguments. it's probably fine (?) in practice in bash even though we're using the posix test. but this is better & functionally equivilant.\r\n\r\nthis is the minimally equivalent-yet-more-correct form",
        "createdAt" : "2019-06-26T06:49:22Z",
        "updatedAt" : "2019-06-26T06:52:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +110,114 @@    # are currently down, but Kubelet is now restarting them and they\n    # will reappear again. We should avoid it.\n    if [ \"${etcd}\" -eq \"0\" ] && [ \"${apiserver}\" -eq \"0\" ]; then\n      return 0\n    fi"
  },
  {
    "id" : "9afe4603-1525-4be2-bee5-cca4a9eec48f",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f2720453-02d0-4abb-bac2-0a616f358028",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "`*.snap` could become an argument if you had say `-.snap` on disk. unprefixed globs are bad practice.\r\nthe leading `./` shouldn't be considered an argument by anything.",
        "createdAt" : "2019-06-26T06:50:23Z",
        "updatedAt" : "2019-06-26T06:52:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +154,158 @@  mkdir -p \"${BACKUP_DIR}/member/wal\"\n  # If the cluster is relatively new, there can be no .snap file.\n  mv ./*.snap \"${BACKUP_DIR}/member/snap/\" || true\n  mv ./*.wal \"${BACKUP_DIR}/member/wal/\"\n"
  },
  {
    "id" : "e1502c17-6e08-47cc-97b3-58af79b12018",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "82e5106e-9502-40e0-9cc8-35dadb25bc3a",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "functionally equivalent, but avoids the pitfalls of trying to check `$?` and potentially having it overwritten by something before you get to reading it.",
        "createdAt" : "2019-06-26T06:51:12Z",
        "updatedAt" : "2019-06-26T06:52:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 62,
    "diffHunk" : "@@ -1,1 +159,163 @@  # TODO(jsz): This won't work with HA setups (e.g. do we need to set --name flag)?\n  echo \"Starting etcd ${ETCD_VERSION} to restore data\"\n  if ! image=$(docker run -d -v ${BACKUP_DIR}:/var/etcd/data \\\n    --net=host -p ${etcd_port}:${etcd_port} \\\n    \"k8s.gcr.io/etcd:${ETCD_VERSION}\" /bin/sh -c \\"
  },
  {
    "id" : "14055581-7a45-43ed-86c4-7c230002baec",
    "prId" : 79410,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/79410#pullrequestreview-254409419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7b6886c1-d0ad-4fa7-9059-b7c9469a2e32",
        "parentId" : null,
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "quote to avoid globbing/splitting/ per the comments above this should be a string of the form \"binary-version/api-mode\" like \"2.2.1/etcd2\" so we shouldn't have been wanting splitting / globbing here.",
        "createdAt" : "2019-06-26T06:52:16Z",
        "updatedAt" : "2019-06-26T06:52:20Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "6fe891b7377f94e1ce9528da80afb50d42c5a697",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +55,59 @@fi\nVERSION_CONTENTS=\"$(cat ${VERSION_FILE})\"\nETCD_VERSION=\"$(echo \"$VERSION_CONTENTS\" | cut -d '/' -f 1)\"\nETCD_API=\"$(echo \"$VERSION_CONTENTS\" | cut -d '/' -f 2)\"\n"
  },
  {
    "id" : "3a80743c-f483-4e7a-8acd-b1ce8b3c279c",
    "prId" : 35784,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/35784#pullrequestreview-6304440",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4364a230-083d-466a-a911-9af27b422274",
        "parentId" : null,
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "will this fail if version.txt already exists?\n",
        "createdAt" : "2016-10-28T15:08:08Z",
        "updatedAt" : "2016-10-31T07:18:04Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "1c10e812-350a-40a7-adca-249b030eec61",
        "parentId" : "4364a230-083d-466a-a911-9af27b422274",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "No. Should it?\n",
        "createdAt" : "2016-10-28T19:23:58Z",
        "updatedAt" : "2016-10-31T07:18:04Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "7fe1e06f079cd9fc99bbcd52c33983035e134374",
    "line" : null,
    "diffHunk" : "@@ -1,1 +49,53 @@# with VERSION_CONTENTS env var.\nif [ -n \"${VERSION_CONTENTS:-}\" ]; then\n  echo \"${VERSION_CONTENTS}\" > \"${VERSION_FILE}\"\nfi\nif [ ! -f \"${VERSION_FILE}\" ]; then"
  },
  {
    "id" : "8422bab4-a1a5-4cf7-b456-cad8ce47daed",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-6108786",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "47442066-8b44-448f-b061-5ab0bbcf18c1",
        "parentId" : null,
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "@roberthbailey @fabioy this in particular means, we \"silently\" assume, that (unless this version file exists, and it doesn't for now - it will be introduced when we launch etcd v3), etcd is running 2.2.1 binary. Is it a safe assumption in case of GKE?\n",
        "createdAt" : "2016-10-13T11:03:04Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      },
      {
        "id" : "41fa703d-59dd-4276-b7ed-69e181971bc1",
        "parentId" : "47442066-8b44-448f-b061-5ab0bbcf18c1",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "yes\n",
        "createdAt" : "2016-10-19T22:39:26Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "fd7edb87-6c3e-4d9f-8375-22ef8009fddb",
        "parentId" : "47442066-8b44-448f-b061-5ab0bbcf18c1",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "I'm not sure we care, but you could also make this overridable by an env variable / flag. But I think it's just as easy to modify the script if the auto-detection doesn't work. \n",
        "createdAt" : "2016-10-27T08:13:58Z",
        "updatedAt" : "2016-10-27T08:17:12Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "e1f1a700-a0af-46bc-bd4c-ecd8732bf6c0",
        "parentId" : "47442066-8b44-448f-b061-5ab0bbcf18c1",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "I will do it in a followup (in the followup I will add param to clear etcd events in case of its corruption).\n",
        "createdAt" : "2016-10-27T17:34:23Z",
        "updatedAt" : "2016-10-27T17:34:56Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : 44,
    "diffHunk" : "@@ -1,1 +42,46 @@# <etcd binary version>/<etcd api mode> (e.g. \"3.0.12/etcd3\").\n#\n# If the file doesn't exist we assume \"2.2.1/etcd2\" configuration is\n# the current one and create a file with such configuration.\n# The restore procedure is chosen based on this information."
  },
  {
    "id" : "2d3e19f2-b3d3-4017-be32-e5c5b1413d9d",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-4297054",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0111aac9-05b2-41b6-a81e-cd39c665175c",
        "parentId" : null,
        "authorId" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "body" : "Is 2.2.1 the only version k8s has ever run on prior to this update?\n",
        "createdAt" : "2016-10-13T22:23:58Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "tags" : [
        ]
      },
      {
        "id" : "fd0e7a2f-1367-4107-a823-8381b183bac3",
        "parentId" : "0111aac9-05b2-41b6-a81e-cd39c665175c",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "We are running 2.2.1 since half-an-year plus. That said, in my opinion we can asusme that we won't be restoring to backup from more than half-an-yesr ago.\n@roberthbailey @fabioy - WDYT?\n",
        "createdAt" : "2016-10-14T06:44:03Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      },
      {
        "id" : "a39dc0f0-a988-4119-91c3-ec982840cf93",
        "parentId" : "0111aac9-05b2-41b6-a81e-cd39c665175c",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "seems reasonable to me. \n",
        "createdAt" : "2016-10-14T16:01:31Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : null,
    "diffHunk" : "@@ -1,1 +47,51 @@VERSION_FILE=\"version.txt\"\nif [ ! -f \"${VERSION_FILE}\" ]; then\n  echo \"2.2.1/etcd2\" > \"${VERSION_FILE}\"\nfi\nVERSION_CONTENTS=\"$(cat ${VERSION_FILE})\""
  },
  {
    "id" : "57c03c2b-5378-47da-8395-1d1b49383fd3",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-5233447",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b5f36800-43ea-45de-8663-b8a3494fe5f8",
        "parentId" : null,
        "authorId" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "body" : "Where does this directory name come from?\n",
        "createdAt" : "2016-10-13T22:27:04Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "tags" : [
        ]
      },
      {
        "id" : "0239f61c-4c82-4c7f-bd7f-5f51b3a63287",
        "parentId" : "b5f36800-43ea-45de-8663-b8a3494fe5f8",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "It can potentially be any directory - it doesn't have to be anything specific.\n",
        "createdAt" : "2016-10-21T10:33:59Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : null,
    "diffHunk" : "@@ -1,1 +131,135 @@# Create the sort of directory structure that etcd expects.\n# If this directory already exists, remove it.\nBACKUP_DIR=\"/var/tmp/backup\"\nrm -rf \"${BACKUP_DIR}\"\nif [ \"${ETCD_API}\" == \"etcd2\" ]; then"
  },
  {
    "id" : "76df4c0c-e08f-4ab9-aaa2-a4212ebc414f",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-5800043",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dcc51962-c50f-4479-92fa-71e9c78d193f",
        "parentId" : null,
        "authorId" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "body" : "What if docker fails?\n",
        "createdAt" : "2016-10-13T22:28:47Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "d324e241-a7f0-4ace-bda2-4174b07bdb18",
        "tags" : [
        ]
      },
      {
        "id" : "fa729814-836c-4c8f-ae91-96a10e624017",
        "parentId" : "dcc51962-c50f-4479-92fa-71e9c78d193f",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "Added error handling\n",
        "createdAt" : "2016-10-26T07:59:45Z",
        "updatedAt" : "2016-10-26T08:00:25Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : 148,
    "diffHunk" : "@@ -1,1 +146,150 @@\n  # TODO(jsz): This won't work with HA setups (e.g. do we need to set --name flag)?\n  image=$(docker run -d -v ${BACKUP_DIR}:/var/etcd/data \\\n    --net=host -p ${etcd_port}:${etcd_port} \\\n    \"gcr.io/google_containers/etcd:${ETCD_VERSION}\" /bin/sh -c \\"
  },
  {
    "id" : "cfd65d96-52ef-4e6d-9d8c-db712c33302f",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-5233447",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2a3478b9-f945-4aea-9bff-8b9cb18a7e84",
        "parentId" : null,
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "Should we document what commands are run to generate the snap/wal or db files that are necessary for restoring from backup? Is that documented elsewhere that we can link to?\n",
        "createdAt" : "2016-10-19T22:38:58Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "b17e4837-4d7a-429b-9ff0-a387e5f17b0d",
        "parentId" : "2a3478b9-f945-4aea-9bff-8b9cb18a7e84",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "I think we don't have it. Added a comment about it here.\n",
        "createdAt" : "2016-10-21T10:24:08Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +16,20 @@\n# This script performs disaster recovery of etcd from the backup data.\n# Assumptions:\n# - backup was done using etcdctl command:\n#   a) in case of etcd2"
  },
  {
    "id" : "d58dfa96-5ef2-40a2-8eb4-f4a4f46b4c3a",
    "prId" : 34696,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34696#pullrequestreview-5800043",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a854d449-e825-4ac5-a4dc-94fdd322d9e1",
        "parentId" : null,
        "authorId" : "109e4fe5-4b7d-49ac-a32f-b25103830bbf",
        "body" : "This check may break if etcd ever changes the format of the result slightly. Is there a cheap regex you could do?\n",
        "createdAt" : "2016-10-21T21:32:36Z",
        "updatedAt" : "2016-10-26T07:59:59Z",
        "lastEditedBy" : "109e4fe5-4b7d-49ac-a32f-b25103830bbf",
        "tags" : [
        ]
      },
      {
        "id" : "95b37c86-d4e1-4efa-8768-e4bf17d9368c",
        "parentId" : "a854d449-e825-4ac5-a4dc-94fdd322d9e1",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "I checked and all 2.\\* and 3.\\* version return this string. Since I don't have a good idea for this regex and it seems to be pretty stable I just added a TODO for it.\n",
        "createdAt" : "2016-10-26T07:55:44Z",
        "updatedAt" : "2016-10-26T08:00:25Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "2725393fdf07e04c8319d8bd0daaf318b762a6d0",
    "line" : 74,
    "diffHunk" : "@@ -1,1 +72,76 @@    # TODO: Is it enough to look into /health endpoint?\n    health=$(curl --silent http://127.0.0.1:${port}/health)\n    if [ \"${health}\" == \"${health_ok}\" ]; then\n      return 0\n    fi"
  }
]