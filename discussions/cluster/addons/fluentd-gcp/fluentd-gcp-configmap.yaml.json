[
  {
    "id" : "8c7ef4e2-ddf7-460e-ae62-de6af7fcd68c",
    "prId" : 66485,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/66485#pullrequestreview-142463119",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9f825cbd-71c1-48b7-a2f9-50de23bad1b2",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "We should apply this to `fluentd-gcp-configmap-old.yaml` as well.",
        "createdAt" : "2018-07-23T16:34:13Z",
        "updatedAt" : "2018-08-06T15:26:51Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      },
      {
        "id" : "098d1670-f198-4bcf-b7a1-06e813158a01",
        "parentId" : "9f825cbd-71c1-48b7-a2f9-50de23bad1b2",
        "authorId" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "body" : "I'm not sure that we want to make changes to the existing configmap, why do you want to bundle changes to existing configs?",
        "createdAt" : "2018-08-01T16:06:12Z",
        "updatedAt" : "2018-08-06T15:26:51Z",
        "lastEditedBy" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "tags" : [
        ]
      },
      {
        "id" : "4d93512e-f8fa-4f9d-a672-7f9ad0054734",
        "parentId" : "9f825cbd-71c1-48b7-a2f9-50de23bad1b2",
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Sync'ed offline. Will leave the old config as-is.",
        "createdAt" : "2018-08-01T16:38:38Z",
        "updatedAt" : "2018-08-06T15:26:51Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "32c2bfadfdd4e74e42f55810460640df4436b5f6",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +411,415 @@      # Set the chunk limit conservatively to avoid exceeding the recommended\n      # chunk size of 5MB per write request.\n      buffer_chunk_limit 512k\n      # Cap the combined memory usage of this buffer and the one below to\n      # 512KiB/chunk * (6 + 2) chunks = 4 MiB"
  },
  {
    "id" : "842ed3b5-c91a-4a34-a18c-679e31b8bebc",
    "prId" : 62076,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62076#pullrequestreview-109545472",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6d399a31-c044-4eed-a15c-9e82baaaf191",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "For `gke_container` resource, we are sending `log` field as `text_payload` after `time`/`severity`/`stream` are extracted. For every other resources, we are sending `message` field as textPayload if it is the only field.\r\n\r\nTo assure the same behavior for `k8s_container`, we can either rename the `log` field to `message` in the configuration, or hardcode an exception in the fluent-plugin-google-cloud gem next to the `gke_container` resource.\r\n\r\nI'm slightly leaning towards handling it via configuration instead of hardcoding it in the gem. The only issue is that when there are additional fields (other than `time`/`severity`/`stream`/`log`), the behavior might be different. For the `gke_container` resource, we seem to be dropping all other fields (That feel like a bug to me, isn't it?). For the `k8s_container` resource, we will keep the jsonPayload structure and retain the additional fields.\r\n\r\nWDYT? @bmoyles0117 @igorpeshansky",
        "createdAt" : "2018-04-04T02:35:05Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      },
      {
        "id" : "ecf126d2-2cd3-45eb-b503-478a32e5cd6b",
        "parentId" : "6d399a31-c044-4eed-a15c-9e82baaaf191",
        "authorId" : "0b2de092-e468-4d99-9434-b45bb8947530",
        "body" : "For `gke_container`, the implementation and the configuration on the Kubernetes side were carefully crafted to work together. This, as you observed, was very fragile.\r\nThe semantics you propose is simple and straightforward. We can document that the logging agent expects the text payload in a `message` field, and rename `log` to `message` in the configuration.",
        "createdAt" : "2018-04-04T02:54:59Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "0b2de092-e468-4d99-9434-b45bb8947530",
        "tags" : [
        ]
      },
      {
        "id" : "7b8322e1-a284-4d7f-bf9e-dcead48727a7",
        "parentId" : "6d399a31-c044-4eed-a15c-9e82baaaf191",
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Sounds good.",
        "createdAt" : "2018-04-04T14:07:07Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      },
      {
        "id" : "12eeff6b-416c-48db-8809-f5b0d2fd8d1a",
        "parentId" : "6d399a31-c044-4eed-a15c-9e82baaaf191",
        "authorId" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "body" : "+1 to what Igor said.",
        "createdAt" : "2018-04-05T00:39:28Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbec62ada4b34af0000033ee19c7d7ad2083d5f2",
    "line" : 110,
    "diffHunk" : "@@ -1,1 +94,98 @@        # 'k8s_container.<namespace_name>.<pod_name>.<container_name>'.\n        \"logging.googleapis.com/local_resource_id\" ${\"k8s_container.#{tag_suffix[4].rpartition('.')[0].split('_')[1]}.#{tag_suffix[4].rpartition('.')[0].split('_')[0]}.#{tag_suffix[4].rpartition('.')[0].split('_')[2].rpartition('-')[0]}\"}\n        # Rename the field 'log' to a more generic field 'message'. This way the\n        # fluent-plugin-google-cloud knows to flatten the field as textPayload\n        # instead of jsonPayload after extracting 'time', 'severity' and"
  },
  {
    "id" : "dab0e1fd-5b4c-458f-91de-0925aa81ff5a",
    "prId" : 62076,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62076#pullrequestreview-109483852",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "01740fcf-0f51-479e-866e-3b17538569f6",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "NOTE: This whole `record_reformer` section sets up the `local_resource_id` for `k8s_container` resource. It's present in `fluentd-gcp-configmap.yaml` only (not `fluentd-gcp-configmap-old.yaml`).",
        "createdAt" : "2018-04-04T20:22:43Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbec62ada4b34af0000033ee19c7d7ad2083d5f2",
    "line" : 102,
    "diffHunk" : "@@ -1,1 +87,91 @@\n    <match reform.**>\n      @type record_reformer\n      enable_ruby true\n      <record>"
  },
  {
    "id" : "67852e3c-31e3-4628-8b2b-cca8e3521e85",
    "prId" : 62076,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62076#pullrequestreview-109483852",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "08afd388-9bc4-4e1c-9226-0eed69514f69",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "NOTE: This `enable_metadata_agent true` configuration is present in `fluentd-gcp-configmap.yaml` only (not `fluentd-gcp-configmap-old.yaml`).",
        "createdAt" : "2018-04-04T20:23:46Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbec62ada4b34af0000033ee19c7d7ad2083d5f2",
    "line" : 173,
    "diffHunk" : "@@ -1,1 +422,426 @@      num_threads 2\n      use_grpc true\n      # Use Metadata Agent to get monitored resource.\n      enable_metadata_agent true\n    </match>"
  },
  {
    "id" : "72ab5b02-0870-4d0d-9a10-c620040a980d",
    "prId" : 62076,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62076#pullrequestreview-109483852",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e6a1fd6c-4d23-4866-b43a-8d19e86c3875",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "NOTE: This `enable_metadata_agent true` configuration is present in `fluentd-gcp-configmap.yaml` only (not `fluentd-gcp-configmap-old.yaml`).",
        "createdAt" : "2018-04-04T20:23:55Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbec62ada4b34af0000033ee19c7d7ad2083d5f2",
    "line" : 174,
    "diffHunk" : "@@ -1,1 +459,463 @@      use_grpc true\n      # Use Metadata Agent to get monitored resource.\n      enable_metadata_agent true\n    </match>\nmetadata:"
  },
  {
    "id" : "c80b650c-1365-4957-97ae-65f37ccba906",
    "prId" : 62076,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62076#pullrequestreview-109576674",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ada9bb2b-5d1c-42c4-b9ac-e4fccb78cfaf",
        "parentId" : null,
        "authorId" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "body" : "Careful, I don't think `NODE_NAME` exists, it would need to be added to the daemonset yaml as an environment variable pulled from the downwards api. This is what I've used historically.\r\n\r\n```\r\n        - env:\r\n          - name: NODE_NAME\r\n            valueFrom:\r\n              fieldRef:\r\n                apiVersion: v1\r\n                fieldPath: spec.nodeName\r\n```",
        "createdAt" : "2018-04-05T00:42:58Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "tags" : [
        ]
      },
      {
        "id" : "46652a21-db1f-43d5-b98b-113bfca9a22f",
        "parentId" : "ada9bb2b-5d1c-42c4-b9ac-e4fccb78cfaf",
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Oops. This used to be there. I removed it in the last commit thinking it was only used by the `metadata_agent_url` and no longer needed. Just added it back.",
        "createdAt" : "2018-04-05T05:21:34Z",
        "updatedAt" : "2018-04-06T12:48:26Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "cbec62ada4b34af0000033ee19c7d7ad2083d5f2",
    "line" : 184,
    "diffHunk" : "@@ -1,1 +431,435 @@      enable_ruby true\n      <record>\n        \"logging.googleapis.com/local_resource_id\" ${\"k8s_node.#{ENV['NODE_NAME']}\"}\n      </record>\n    </filter>"
  },
  {
    "id" : "0fd2084d-b134-42f3-b0cb-8c45ddd19190",
    "prId" : 59128,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/59128#pullrequestreview-99152433",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0046cfe9-161f-4b9e-885d-859f79a1fb17",
        "parentId" : null,
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Is it required to split this parser into an individual section? I recall that we changed this when debugging a separate issue. Is this the culprit though?\r\n\r\nIf we do need to change it, maybe reply to this thread to clarify the reason?",
        "createdAt" : "2018-02-25T18:18:26Z",
        "updatedAt" : "2018-02-26T19:05:41Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      },
      {
        "id" : "e2374cf3-79ed-4f15-94e5-a3fa36ce21d2",
        "parentId" : "0046cfe9-161f-4b9e-885d-859f79a1fb17",
        "authorId" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "body" : "I'm pretty confident using this as a filter plugin squelched the logs that were being emitted to invalid formats. However, I don't see that I have `emit_invalid_record_to_error` in this section, so now I'm a little confused. I'll test locally and try to get a better story around this.",
        "createdAt" : "2018-02-25T18:23:13Z",
        "updatedAt" : "2018-02-26T19:05:41Z",
        "lastEditedBy" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "tags" : [
        ]
      },
      {
        "id" : "9fc6d7ef-cbd2-4086-a3b4-e601109c56e9",
        "parentId" : "0046cfe9-161f-4b9e-885d-859f79a1fb17",
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Thanks for checking!",
        "createdAt" : "2018-02-25T18:45:23Z",
        "updatedAt" : "2018-02-26T19:05:41Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      },
      {
        "id" : "0905c588-fe63-462d-aaf1-e962c617aab1",
        "parentId" : "0046cfe9-161f-4b9e-885d-859f79a1fb17",
        "authorId" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "body" : "Just confirmed, the previous way of incorporating format multi_format into the source causes the plugin to emit an error complaining about not being able to parse the format, which gets directed to stdout/stderr, which causes an infinite loop of not being able to parse logs from the containers directory. The change as we have it ensures that that parse failure does not get emitted, and it just gracefully exhausts each format in the multi format plugin.",
        "createdAt" : "2018-02-25T18:53:10Z",
        "updatedAt" : "2018-02-26T19:05:41Z",
        "lastEditedBy" : "b787a5e8-0552-4d8e-b0b7-df6e8633dd77",
        "tags" : [
        ]
      },
      {
        "id" : "a9c20f28-7167-48a7-998e-1e6cf15a1939",
        "parentId" : "0046cfe9-161f-4b9e-885d-859f79a1fb17",
        "authorId" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "body" : "Sounds good. Thanks!",
        "createdAt" : "2018-02-25T19:11:58Z",
        "updatedAt" : "2018-02-26T19:05:41Z",
        "lastEditedBy" : "b6d26bb4-a0e1-418a-8ea1-8f2e86b6d1d1",
        "tags" : [
        ]
      }
    ],
    "commit" : "84a86cffce5408e600443d7f806471b9b8578e29",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +56,60 @@\n    <filter reform.**>\n      @type parser\n      key_name message\n      <parse>"
  },
  {
    "id" : "365abea4-0ba4-40eb-b20a-33a485818cc1",
    "prId" : 52565,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/52565#pullrequestreview-63150304",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1e08262e-e0d3-4096-8555-66496d29fddd",
        "parentId" : null,
        "authorId" : "0b2de092-e468-4d99-9434-b45bb8947530",
        "body" : "Is this a good time to sync with the official config and make the buffer_chunk_size smaller (we have it at 1M)? Smaller bundles have less latency, allowing for more throughput with fewer threads... Also below.",
        "createdAt" : "2017-09-15T20:06:41Z",
        "updatedAt" : "2017-09-15T20:30:24Z",
        "lastEditedBy" : "0b2de092-e468-4d99-9434-b45bb8947530",
        "tags" : [
        ]
      },
      {
        "id" : "62909a71-a8ad-4b49-9a57-ccbd494d1173",
        "parentId" : "1e08262e-e0d3-4096-8555-66496d29fddd",
        "authorId" : "fb41b733-ba12-42d8-b026-942db6e3696f",
        "body" : "Done, thanks!",
        "createdAt" : "2017-09-15T20:09:54Z",
        "updatedAt" : "2017-09-15T20:30:24Z",
        "lastEditedBy" : "fb41b733-ba12-42d8-b026-942db6e3696f",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae132a09007eb43800fb584672b8bf0eb6d8609f",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +369,373 @@      # Collect metrics in Prometheus registry about plugin activity.\n      enable_monitoring true\n      monitoring_type prometheus\n      # Set the buffer type to file to improve the reliability and reduce the memory consumption\n      buffer_type file"
  }
]