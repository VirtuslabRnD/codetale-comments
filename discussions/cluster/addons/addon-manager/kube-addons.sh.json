[
  {
    "id" : "f985ee57-92b7-44ef-8f43-c7ef17f7acaa",
    "prId" : 82237,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82237#pullrequestreview-290676049",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "69da814c-9ffc-4fc2-a174-bc9cd72a4f16",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Do these `\"` need to be `\"\\\"\"`?",
        "createdAt" : "2019-09-19T15:23:01Z",
        "updatedAt" : "2019-09-19T15:23:01Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "bccb6cc0-4a00-42dd-b91d-30fd69cedb04",
        "parentId" : "69da814c-9ffc-4fc2-a174-bc9cd72a4f16",
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "no, this parses as `cat \"${addon_filename}\"` being up to the subshell",
        "createdAt" : "2019-09-19T16:00:24Z",
        "updatedAt" : "2019-09-19T16:00:24Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      }
    ],
    "commit" : "35a7924327f974d228c964f1ebc3ebc809afbd55",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +134,138 @@  local -r namespace=$4\n\n  create_resource_from_string \"$(cat \"${addon_filename}\")\" \"${tries}\" \"${delay}\" \"${addon_filename}\" \"${namespace}\"\n}\n"
  },
  {
    "id" : "f48e693d-83b1-4523-b420-777926a74415",
    "prId" : 82237,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82237#pullrequestreview-295673438",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "051043df-25a6-4ea5-8950-1534a5ae0db4",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "You can use `\"${KUBECTL_OPTS[@]}\"` if you turn it into an array.",
        "createdAt" : "2019-09-19T15:23:57Z",
        "updatedAt" : "2019-09-19T15:23:58Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "62a58f6f-ba30-4ca4-ad3d-0c46fe58e5a1",
        "parentId" : "051043df-25a6-4ea5-8950-1534a5ae0db4",
        "authorId" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "body" : "IIRC this is a string all the way up as a poor way for the caller to specify additional flags in more than a few of these scripts :/",
        "createdAt" : "2019-09-19T16:02:00Z",
        "updatedAt" : "2019-09-19T16:03:19Z",
        "lastEditedBy" : "46e1ba13-482b-4bcd-8fb1-be821bac3b04",
        "tags" : [
        ]
      },
      {
        "id" : "8160d4ff-69f9-43ca-a62d-a93468cb975c",
        "parentId" : "051043df-25a6-4ea5-8950-1534a5ae0db4",
        "authorId" : "e7b8fd7e-f93b-44b6-b6d0-4331207d901c",
        "body" : "Thank you for your help. @BenTheElder \r\nBecause `${KUBECTL_OPTS}` is a string as `kubectl` argument, I chose to ignore this lint error to avoid causing other problems.",
        "createdAt" : "2019-09-22T07:39:32Z",
        "updatedAt" : "2019-09-22T07:39:32Z",
        "lastEditedBy" : "e7b8fd7e-f93b-44b6-b6d0-4331207d901c",
        "tags" : [
        ]
      },
      {
        "id" : "bfd5a531-bfdc-43b9-aebb-d1a24b4518bb",
        "parentId" : "051043df-25a6-4ea5-8950-1534a5ae0db4",
        "authorId" : "e7b8fd7e-f93b-44b6-b6d0-4331207d901c",
        "body" : "ping @BenTheElder @thockin ",
        "createdAt" : "2019-10-01T15:01:26Z",
        "updatedAt" : "2019-10-01T15:01:27Z",
        "lastEditedBy" : "e7b8fd7e-f93b-44b6-b6d0-4331207d901c",
        "tags" : [
        ]
      }
    ],
    "commit" : "35a7924327f974d228c964f1ebc3ebc809afbd55",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +169,173 @@  log INFO \"== Reconciling with deprecated label ==\"\n  # shellcheck disable=SC2086\n  # Disabling because \"${KUBECTL_OPTS}\" needs to allow for expansion here\n  ${KUBECTL} ${KUBECTL_OPTS} apply -f ${ADDON_PATH} \\\n    -l ${CLUSTER_SERVICE_LABEL}=true,${ADDON_MANAGER_LABEL}!=EnsureExists \\"
  },
  {
    "id" : "f7d5bf01-bdbd-4694-b536-a32b2c07b103",
    "prId" : 67743,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/67743#pullrequestreview-149007629",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e9ef6496-9e02-4779-b0f8-90e01b76f833",
        "parentId" : null,
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "Humm..Some of these seems really stale. e.g. Workloads API was GA a while back.",
        "createdAt" : "2018-08-23T03:14:38Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      },
      {
        "id" : "2b1ef3ef-c65d-4a38-b5be-c86026ba77f4",
        "parentId" : "e9ef6496-9e02-4779-b0f8-90e01b76f833",
        "authorId" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "body" : "We can change the list here, but we can't easily change the list in `kubectl apply --prune`, because that is going to be a breaking change in kubectl. That is also why I think we should have our own copy of list here.\r\n\r\nI can change this to GA, if we think that is better.",
        "createdAt" : "2018-08-23T06:59:49Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "tags" : [
        ]
      },
      {
        "id" : "43f068c3-376a-407a-9e50-58db96400c0b",
        "parentId" : "e9ef6496-9e02-4779-b0f8-90e01b76f833",
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "I think this is okay, I'm assuming API group conversion will be done by apiserver anyway.",
        "createdAt" : "2018-08-23T17:05:46Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      }
    ],
    "commit" : "6a880b2567eff17ef0a2bdeaf6ed6c77696dd989",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +50,54 @@  extensions/v1beta1/ReplicaSet\n  apps/v1beta1/StatefulSet\n  apps/v1beta1/Deployment\n)\n"
  },
  {
    "id" : "cb140d92-8a5c-4141-84ab-507cee6fc5dc",
    "prId" : 67743,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/67743#pullrequestreview-149007629",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "187f2ed7-32c2-4ca7-a055-126c4da6ebed",
        "parentId" : null,
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "I can see this being easily diverged from the original one. Instead of copying the default values, maybe just let addon-manager don't add that whitelist flag if KUBECTL_PRUNE_WHITELIST is empty? In that way we are at least off the burden of maintaining these in two places.",
        "createdAt" : "2018-08-23T03:18:35Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      },
      {
        "id" : "24ed17f8-5415-4b3c-a076-8bbd5c5168bb",
        "parentId" : "187f2ed7-32c2-4ca7-a055-126c4da6ebed",
        "authorId" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "body" : "> I can see this being easily diverged from the original one.\r\n\r\nThat is why I say \"currently\", because I think this **SHOULD** diverge from the default one in the future.\r\n\r\nThe main reason is that addon manager is not the only user of `kubectl apply --prune`:\r\n1) `kubectl apply --prune` default whitelist is not designed for the addon manager (and it should not be even if it was), it is just a general default for most use cases.\r\n2) When we need to extend/retract the default list for the addon manager, `kubectl apply --prune` can't be easily changed, because that is a breaking change for most users.\r\n\r\nHowever, if we have a separate list for the addon manager, it can be very flexible, because addon manager is the only user. And we can extend/retract this list to make it a better fit for addon manager even today.\r\n\r\n> In that way we are at least off the burden of maintaining these in two places.\r\n\r\nThe problem is that when you need to specify one extra resource, you need to specify the whole whitelist (once --prune-whitelist is specified, the default `kubectl` prune whitelist won't apply).\r\n\r\nThink about if you are a vendor, and you need a new resource, you have to specify the whole whitelist -- a copy of OSS default whitelist + the extra resource. This means that all vendors who need extra prune resource will have to maintain a copy of the default whitelist, which will be maintained >> 2 places.",
        "createdAt" : "2018-08-23T07:00:06Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "tags" : [
        ]
      },
      {
        "id" : "d8a32a1d-c8c0-4980-8fd8-2e61ff503da8",
        "parentId" : "187f2ed7-32c2-4ca7-a055-126c4da6ebed",
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "Thanks for the explanation, that makes more sense now. I scanned too quick and didn't realize you are adding \"extra whitelists\".\r\n\r\nAnother thought would be letting `kubectl apply` to have the ability to take extra whitelists, though given the state of this feature, it might not worth it. Would really hope we can get rid of these whole thing soonish :)",
        "createdAt" : "2018-08-23T17:06:48Z",
        "updatedAt" : "2018-09-01T01:43:55Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      }
    ],
    "commit" : "6a880b2567eff17ef0a2bdeaf6ed6c77696dd989",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +33,37 @@# This is currently the same with the default in:\n# https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/apply.go\nKUBECTL_PRUNE_WHITELIST=(\n  core/v1/ConfigMap\n  core/v1/Endpoints"
  },
  {
    "id" : "c64eaeec-0698-40b8-b8cd-44f2b95bca2c",
    "prId" : 60095,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/60095#pullrequestreview-97968650",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b1466e58-0b33-4ab8-a7ce-8ab60c070bce",
        "parentId" : null,
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "NOTE: Added back namespace to this function as it is required per the code comment:\r\nhttps://github.com/kubernetes/kubernetes/blob/ec7f7a5c5fa7c7751e476a697e79b1527f8ac8b3/cluster/addons/addon-manager/kube-addons.sh#L188-L194\r\n\r\nThis will not affect the apply/ensure loop, which is handled by another functions (`ensure_addons`, `reconcile_addons`).",
        "createdAt" : "2018-02-20T20:01:53Z",
        "updatedAt" : "2018-02-20T20:03:34Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      }
    ],
    "commit" : "677f740adf61f9c56d0719eacabfeae3b0787256",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +108,112 @@  local -r namespace=$5;\n  while [ ${tries} -gt 0 ]; do\n    echo \"${config_string}\" | ${KUBECTL} ${KUBECTL_OPTS} --namespace=\"${namespace}\" apply -f - && \\\n      log INFO \"== Successfully started ${config_name} in namespace ${namespace} at $(date -Is)\" && \\\n      return 0;"
  },
  {
    "id" : "44ac227d-32f3-4b26-9c7b-f98ec700ced4",
    "prId" : 59378,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/59378#pullrequestreview-96630389",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d8de322f-4d7f-4aa8-ade0-b38db7d38845",
        "parentId" : null,
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "I think this will work, but I need to confirm how `--prune` behave when multiple namespaces appear in manifest. Will give an update soon.",
        "createdAt" : "2018-02-14T19:13:02Z",
        "updatedAt" : "2018-02-16T18:48:33Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      },
      {
        "id" : "596f4024-bb88-4425-8fa4-4774cb52fb82",
        "parentId" : "d8de322f-4d7f-4aa8-ade0-b38db7d38845",
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "Seems like it should work with the multiple namespaces case, kubectl records the visited namespaces for pruning:\r\nhttps://github.com/kubernetes/kubernetes/blob/48388fec7eaad4ac8d84fbe20673ffacf41964a1/pkg/kubectl/cmd/apply.go#L391-L402\r\n\r\nAlso a bad news, at this moment the object types for pruning is hardcoded so don't think it will work well with the CRDs added by istio...\r\nhttps://github.com/kubernetes/kubernetes/blob/48388fec7eaad4ac8d84fbe20673ffacf41964a1/pkg/kubectl/cmd/apply.go#L418-L440",
        "createdAt" : "2018-02-14T19:35:25Z",
        "updatedAt" : "2018-02-16T18:48:33Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      },
      {
        "id" : "f30e165f-d600-4f43-a6c9-39836d7aaa47",
        "parentId" : "d8de322f-4d7f-4aa8-ade0-b38db7d38845",
        "authorId" : "fffb94f3-7361-41f5-b634-dbfbab8bad42",
        "body" : "Thanks for verifying this. I think this falls into the same bucket as namespace. Having CRDs and namespace hanging around after uninstall won't be a problem in terms of functionality. It is something we can add to apply --prune unless there's a good reason to exclude it. I need to investigate this but I don't think it's a blocker.",
        "createdAt" : "2018-02-14T19:42:04Z",
        "updatedAt" : "2018-02-16T18:48:33Z",
        "lastEditedBy" : "fffb94f3-7361-41f5-b634-dbfbab8bad42",
        "tags" : [
        ]
      }
    ],
    "commit" : "ec7f7a5c5fa7c7751e476a697e79b1527f8ac8b3",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +130,134 @@\n  log INFO \"== Reconciling with addon-manager label ==\"\n  ${KUBECTL} ${KUBECTL_OPTS} apply -f ${ADDON_PATH} \\\n    -l ${CLUSTER_SERVICE_LABEL}!=true,${ADDON_MANAGER_LABEL}=Reconcile \\\n    --prune=true --recursive | grep -v configured"
  },
  {
    "id" : "332cd62c-aaad-4022-97d3-8257e1133306",
    "prId" : 55466,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/55466#pullrequestreview-76106636",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3a14a9b-4750-4b0a-a49a-adf5c86bebeb",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "This real pokes around at the internals. We want to start moving the addon manager to use the front door. Can you look at the controller-manager leader election result instead? cc @tallclair ",
        "createdAt" : "2017-11-10T19:47:28Z",
        "updatedAt" : "2017-11-14T12:14:36Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "83fe4444-0c4f-4de4-9392-1230de5dce4d",
        "parentId" : "f3a14a9b-4750-4b0a-a49a-adf5c86bebeb",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "The leader election results for kube-controller-manager are stored on it's endpoints object:\r\n\r\nkubectl -n kube-system get ep kube-controller-manager -o json",
        "createdAt" : "2017-11-10T19:49:11Z",
        "updatedAt" : "2017-11-14T12:14:36Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "b48464dc-dedb-4a6d-b256-11deae833518",
        "parentId" : "f3a14a9b-4750-4b0a-a49a-adf5c86bebeb",
        "authorId" : "e2aaf386-2908-41e6-860b-bcb2cffa1cc7",
        "body" : "Thanks for pointing this one! Done.",
        "createdAt" : "2017-11-13T13:55:51Z",
        "updatedAt" : "2017-11-14T12:14:36Z",
        "lastEditedBy" : "e2aaf386-2908-41e6-860b-bcb2cffa1cc7",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae6e506fdc466e290d3b6b38f3e4fafe28c5d592",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +146,150 @@}\n\nfunction is_leader() {\n  # In multi-master setup, only one addon manager should be running. We use\n  # existing leader election in kube-controller-manager instead of implementing"
  },
  {
    "id" : "f20336e0-c9ee-4987-bac9-9a40a52d7cb3",
    "prId" : 23600,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5df1f955-83ce-4ba9-a4ea-a7991b2aa3b5",
        "parentId" : null,
        "authorId" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "body" : "Sorry for late comment. Is this the path of the instance, or the path inside a container? If it is the former, this will not work on GCI.\n",
        "createdAt" : "2016-05-05T21:30:31Z",
        "updatedAt" : "2016-05-06T18:01:15Z",
        "lastEditedBy" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "tags" : [
        ]
      },
      {
        "id" : "7755c455-5aed-4d9b-ae46-cad099559def",
        "parentId" : "5df1f955-83ce-4ba9-a4ea-a7991b2aa3b5",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "This path is inside the container.\n",
        "createdAt" : "2016-05-05T21:56:11Z",
        "updatedAt" : "2016-05-06T18:01:15Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "fc82e384-8076-49c6-9d37-5521fecd8ceb",
        "parentId" : "5df1f955-83ce-4ba9-a4ea-a7991b2aa3b5",
        "authorId" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "body" : "Thanks for clarifying it.\n",
        "createdAt" : "2016-05-05T22:31:59Z",
        "updatedAt" : "2016-05-06T18:01:15Z",
        "lastEditedBy" : "34f7b744-302a-4493-8e2d-95681077e4a8",
        "tags" : [
        ]
      }
    ],
    "commit" : "3e1c0b59517c8ceb39dfdc59e1748688f5f86688",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +66,70 @@\n# Create the namespace that will be used to host the cluster-level add-ons.\nstart_addon /opt/namespace.yaml 100 10 \"\" &\n\n# Wait for the default service account to be created in the kube-system namespace."
  },
  {
    "id" : "09d7e63b-1286-4657-986e-2870bbdb7e12",
    "prId" : 23600,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a8f139bd-2fa1-441a-a28b-38d93184bb35",
        "parentId" : null,
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "Why did we shrink this from 5m --> 10s?\n",
        "createdAt" : "2016-05-05T22:35:40Z",
        "updatedAt" : "2016-05-06T18:01:15Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "cf105f00-62e1-4ae8-99c5-955a5dc357ef",
        "parentId" : "a8f139bd-2fa1-441a-a28b-38d93184bb35",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Unconstrained, the addon manager consumes a full cpu for a few seconds every iteration. This is a documentation shortcoming:\n\nhttps://github.com/mikedanese/kubernetes/blob/addon-manager/cluster/addons/addon-manager/kube-addon-update.sh#L36\n\nTo mitigate this, we set a 10 minute interval between runs (a value that needs to be adjusted in e2e because it is so unresponsive). Now that we are running the kube addon manager in a container we can deprioritize it by giving it a very small cpu share while making it more responsive.\n",
        "createdAt" : "2016-05-06T17:24:09Z",
        "updatedAt" : "2016-05-06T18:01:15Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "68580c12-ec9b-4888-9ef4-75a6dbb3226c",
        "parentId" : "a8f139bd-2fa1-441a-a28b-38d93184bb35",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "Thanks. \n",
        "createdAt" : "2016-05-06T21:24:00Z",
        "updatedAt" : "2016-05-06T21:24:00Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      }
    ],
    "commit" : "3e1c0b59517c8ceb39dfdc59e1748688f5f86688",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +20,24 @@KUBECTL=${KUBECTL_BIN:-/usr/local/bin/kubectl}\n\nADDON_CHECK_INTERVAL_SEC=${TEST_ADDON_CHECK_INTERVAL_SEC:-10}\n\nSYSTEM_NAMESPACE=kube-system"
  }
]