[
  {
    "id" : "66d8c480-9008-44d5-92de-bf53f1b7ae12",
    "prId" : 65022,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/65022#pullrequestreview-128461460",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "write access to pods is new, and atypical for a network plugin. why does calico require this?",
        "createdAt" : "2018-06-13T13:46:45Z",
        "updatedAt" : "2018-06-13T13:46:45Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "4271d6a0-575c-4613-b2c9-b42bb9e14db6",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "body" : "When using the Kubernetes datastore driver (i.e. no extra database for Calico), the Calico CNI plugin writes the IP allocation back to the Pod as an annotation.  Without that, we had to wait for the kubelet to write the IP back to the Pod status, which can take 30s.",
        "createdAt" : "2018-06-13T14:15:07Z",
        "updatedAt" : "2018-06-13T14:15:08Z",
        "lastEditedBy" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "tags" : [
        ]
      },
      {
        "id" : "f0f8aa8e-ae49-44d4-9707-f2c5cc5d4484",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "that can be done with an update (or patch) of pods/status, which is more appropriate, since it doesn't let calico modify the pod spec (including the image being run)",
        "createdAt" : "2018-06-13T14:19:56Z",
        "updatedAt" : "2018-06-13T14:20:08Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "5cf50252-084e-4208-a17e-3659cfb93f80",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "body" : "We initially had a solution that patched the PodIP field but we found that kubelet will often back out that change and then reapply it later so the fix didn't work.",
        "createdAt" : "2018-06-13T14:51:55Z",
        "updatedAt" : "2018-06-13T14:51:56Z",
        "lastEditedBy" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "tags" : [
        ]
      },
      {
        "id" : "b4619e2d-6805-4101-a963-8bd7841c9c3a",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "> the Calico CNI plugin writes the IP allocation back to the Pod as an annotation\r\n\r\nthe annotation can be written as part of a status patch",
        "createdAt" : "2018-06-13T14:54:37Z",
        "updatedAt" : "2018-06-13T14:54:38Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "7fbed735-54e7-4102-8686-34f132515e9f",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "body" : "Are you sure about that?  I thought we'd tried that and it didn't work.",
        "createdAt" : "2018-06-13T15:09:23Z",
        "updatedAt" : "2018-06-13T15:09:24Z",
        "lastEditedBy" : "5f47b0b2-3ee8-43f8-bd41-28cfc0ebbf5b",
        "tags" : [
        ]
      },
      {
        "id" : "516eb318-9844-4600-a6ef-07006b937c6c",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "yes\r\n\r\n```sh\r\ncurl http://localhost:8080/api/v1/namespaces/default/pods/busybox/status \\\r\n  -X PATCH \\\r\n  -H \"Content-Type:application/merge-patch+json\" \\\r\n  --data '{\"metadata\":{\"annotations\":{\"test\":\"value\"}}}'\r\n\r\n{\r\n  \"kind\": \"Pod\",\r\n  \"apiVersion\": \"v1\",\r\n  \"metadata\": {\r\n    \"name\": \"busybox\",\r\n    \"namespace\": \"default\",\r\n    \"selfLink\": \"/api/v1/namespaces/default/pods/busybox/status\",\r\n    \"uid\": \"c3dceff8-6f22-11e8-a4aa-acbc32c1ca87\",\r\n    \"resourceVersion\": \"2550\",\r\n    \"creationTimestamp\": \"2018-06-13T15:59:34Z\",\r\n    \"annotations\": {\r\n      \"test\": \"value\"\r\n    }\r\n  },\r\n...\r\n```",
        "createdAt" : "2018-06-13T16:03:45Z",
        "updatedAt" : "2018-06-13T16:03:45Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "027aa3b0-68ad-442d-851f-88198af9f305",
        "parentId" : "4c7bc3a7-e035-4d6c-ac66-be458fb335b8",
        "authorId" : "d168965e-f2a1-46dc-9041-18f8ba845ebe",
        "body" : "I've raised an issue against Calico to track this - agree it would be nice to clean up. https://github.com/projectcalico/libcalico-go/issues/888",
        "createdAt" : "2018-06-13T16:28:09Z",
        "updatedAt" : "2018-06-13T16:28:09Z",
        "lastEditedBy" : "d168965e-f2a1-46dc-9041-18f8ba845ebe",
        "tags" : [
        ]
      }
    ],
    "commit" : "b365408e8886145e4b23faa7de7b97347ebd97dd",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +37,41 @@      - list\n      - watch\n      - patch\n  - apiGroups: [\"\"]\n    resources:"
  }
]