[
  {
    "id" : "7bbda644-3517-4a72-b27e-c04c75b181fa",
    "prId" : 24124,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Ok I noticed that you modified the kube dns addon for vsphere here. I did not look if you modified more of the vsphere deployment so I cc'ed @imkin if he wants to look over this PR\n",
        "createdAt" : "2016-04-14T17:04:52Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "fab249c2-593c-42c6-bb98-a24260c55e39",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "I didn't modify the vSphere kube-up code yet. This change doesn't break it (DNS doesn't work there), but it's an incomplete fix. Another change will be needed to get the UI and DNS to work with the vSphere kube-up. I plan to do that in the next week or so after I get a couple other things cleared up.\n",
        "createdAt" : "2016-04-14T17:22:16Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "fb468c34-0427-4996-be4b-de30dc5f3b1c",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "ok why do you need this? is there no routable pod network?\n",
        "createdAt" : "2016-04-15T20:39:03Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "4d60a411-4521-47d5-8532-f32db760f82e",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "The pod network is internally routable, but I need access to the external DNS server, and that is not routable in our environment without access to the host network.\n",
        "createdAt" : "2016-04-15T21:37:33Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "e6497755-649c-4006-951e-4ec73adfa6a1",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "> I need access to the external DNS server, and that is not routable in our environment without access to the host network\n\nCan you explain this a little more? Using hostNetwork is bad practice and should be avoided if at all possible.\n",
        "createdAt" : "2016-04-25T16:22:57Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "99ea3ff4-42c0-4ee1-bc6a-18af1c5be255",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "Without the use of host networking, attempts to resolve hostnames were slow. I tracked it down to the attempt to inherit DNS from the host: this allows us to use the site's DNS to resolve names that are not maintained by SkyDNS. \n\nThis was because the pod wasn't able to access to access the hosts network (It eventually times out, which is why it was slow, not a failure.). Giving it access to the host network solved the problem.\n\nI wasn't aware of it being a bad practice to use host networking and would love to know more. \n\nIt's possible that I've misunderstood the Kubernetes networking model, and I've set things up in a way that is not correct. Should it be different? I read over http://kubernetes.io/docs/admin/networking/ and it says:\n\n> Kubernetes imposes the following fundamental requirements on any networking implementation (barring any intentional network segmentation policies):\n> - all containers can communicate with all other containers without NAT\n> - all nodes can communicate with all containers (and vice-versa) without NAT\n> - the IP that a container sees itself as is the same IP that others see it as\n\nAs far as I can tell, I've implemented the expected networking model... but it's also clear that I needed to set host networking and other kube-up implementations didn't, so perhaps I haven't fully understood.\n",
        "createdAt" : "2016-04-25T16:58:00Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "6fc22142-9d37-4bc0-b2ac-74728a40a519",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "FYI: This is really the only comment I care about resolving before merging\n\nFrom http://kubernetes.io/docs/user-guide/config-best-practices/:\n\n> Don’t use hostPort (which specifies the port number to expose on the host) unless absolutely necessary, e.g., for a node daemon. When you bind a Pod to a hostPort, there are a limited number of places that pod can be scheduled, due to port conflicts— you can only schedule as many such Pods as there are nodes in your Kubernetes cluster. If you only need access to the port for debugging purposes, you can use the kubectl proxy and apiserver proxy or kubectl port-forward. You can use a Service object for external service access. If you do need to expose a pod’s port on the host machine, consider using a NodePort service before resorting to hostPort. Avoid using hostNetwork, for the same reasons as hostPort.\n\nIt seems unnecessary in this situation. So the issue is:\n\n> I tracked it down to the attempt to inherit DNS from the host: this allows us to use the site's DNS to resolve names that are not maintained by SkyDNS.\n\nThis is the correct behavior of skydns and should not be slow even when using pod network. @ArtfulCoder, @kubernetes/goog-cluster can you advise on how to debug this slowness?\n",
        "createdAt" : "2016-04-25T18:14:04Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "f6e68216-a743-4a1f-b7f8-6b8168503cf2",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "I agree: this is the biggest question in my head as well. \n\nIn this case, I don't think the issue is the use of hostPort: I added a \"hostNetwork\" clause, not a \"hostPort\" clause. \n\nTo be clear, I understand why it was slow. It was slow because the pod couldn't access the parent DNS because it didn't have connectivity to the node's network. This change allows us to access the parent DNS because we have access to the node's network.\n\nI think the possible resolutions are:\n- Accept as-is because it's a reasonable change\n- Disable inheriting DNS when using Photon Controller... but then when pods lookup DNS records, they can only find the ones in the Kubernetes cluster. (Will users expect to inherit DNS?)\n- Figure out how to have the pod access the node's network to access DNS. (Is this appropriate?)\n- ... Something else I don't know about.\n\nIf it helps to discuss this live (phone, Hangout, Slack), I'm happy to do that. I'm free all day except 2:00 - 3:00pm Pacific. \n",
        "createdAt" : "2016-04-25T18:27:56Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "69fff34b-a956-4377-bf14-cf79454d292c",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "> In this case, I don't think the issue is the use of hostPort: I added a \"hostNetwork\" clause, not a \"hostPort\" clause.\n\nThe last sentence in the best practice quote says \"Avoid using hostNetwork, for the same reasons as hostPort.\" so the advice applies here. I'd love to get someone familar with the DNS subsystem to look at this.\n",
        "createdAt" : "2016-04-25T18:31:43Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "e0779a7a-e824-4343-8bde-324601819582",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "Ah, I missed that, sorry. Yes, I agree, I'd love to get an opinion on this. I'll update the code with all your other changes in the meantime.\n",
        "createdAt" : "2016-04-25T18:45:58Z",
        "updatedAt" : "2016-04-25T20:24:40Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "ca7d5918-ed5c-4ff9-bc1b-e494cd63f97b",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Hey guys, surprise this broke things.\n\n#25020\n\nThere are a bunch of scripts that process this file and sed in the correct values.  They are all broken now.\n\nI think the real fix is is find a way to configure kube-dns to know which nameserver(s) and searches to use, one option being \"whatever my host is using\".  What does Photon do in the normal docker case - do you demand a --dns flag for every container?  Do you set it on the daemon?\n\nKubelet has a --resolv-conf flag which lets you point it at an alternate file, I think that should handle this case for you?\n\nIn the meantime we need to either roll this PR back or find a fix that doesn't break all the scripts (and I don't think the answer is \"fix the scripts\").  Either use resolv-conf flag in your setting and get rid of this conditional or else fork this file or this dir into a photon-specific place.\n\nASAP please.\n",
        "createdAt" : "2016-05-01T05:13:34Z",
        "updatedAt" : "2016-05-01T05:13:35Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "a4d672b5-fdb8-435d-8146-deff0fe2ad8c",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "I'm going to rollback the changes to this single file. @thockin Why was this not caught in CI? We have multiple DNS e2e tests. I also pinged the cluster team for review and got no response. I'm not sure what more we could have done to avoid this.\n\nThis change adds valid jinja to a jinja template. It's unreasonable that we can't make a change like this locally.\n",
        "createdAt" : "2016-05-01T21:49:34Z",
        "updatedAt" : "2016-05-01T21:49:34Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "02e7c109-223b-4e2e-a45c-6f41908f1b43",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "Before you roll back, could you look at this pull request and see if it addresses the problem?\nhttps://github.com/kubernetes/kubernetes/pull/24124\nIt looks like it could be merged, but it hasn't been--I'm not sure why.\n\nThe issue this was solving wasn't about knowing which nameservers to contact, it was about actually being able to contact them: without enabling the use of the host network, we were unable to communicate with the DNS server. \n\nUltimately, this change was meant to only affect the vSphere and Photon Controller implementations. Clearly I didn't do that correctly. Is there a way we can keep the underlying change without breaking other implementations?\n",
        "createdAt" : "2016-05-01T21:56:00Z",
        "updatedAt" : "2016-05-01T21:56:00Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "e24186a9-a394-4efe-90b5-bc48234eed74",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "I don't disagree that it's a bad situation, but it is what it is.  This\nfile is processed by other scripts that are not using jinja to do the\nexpansion.  We'll need to find a better way to do this (if indeed we want\nto do this)\n\nOn Sun, May 1, 2016 at 2:50 PM, Mike Danese notifications@github.com\nwrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/kubernetes/kubernetes/pull/24124#discussion_r61693688\n> :\n> \n> > @@ -19,6 +19,9 @@ spec:\n> >          version: v11\n> >          kubernetes.io/cluster-service: \"true\"\n> >      spec:\n> > +{% if grains['cloud'] is defined and grains['cloud'] in [ 'vsphere', 'photon-controller' ] %}\n> \n> I'm going to rollback the changes to this single file. @thockin\n> https://github.com/thockin Why was this not caught in CI? We have\n> multiple DNS e2e tests. I also pinged the cluster team for review and got\n> no response. I'm not sure what more we could have done to avoid this.\n> \n> This change adds valid jinja to a jinja template. It's unreasonable that\n> we can't make a change like this locally.\n> \n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly or view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/24124/files/5699d51efadb41b6c010f45672c4844d84de0b84#r61693688\n",
        "createdAt" : "2016-05-01T22:02:53Z",
        "updatedAt" : "2016-05-01T22:02:53Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "fd98127b-09d3-4d66-8d22-149150da6aab",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "You linked me back to this same PR - ?\n\nSorry for the chaos, you've just ended up in territory that has outgrown\nthe current implementation...  This yaml.in file didn't start as a jinja\ntemplate, it started as an example, which grew into a jinja template, but\nin the meantime, other uses of it are not jinja...\n\nOn Sun, May 1, 2016 at 2:56 PM, Alain Roy notifications@github.com wrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/kubernetes/kubernetes/pull/24124#discussion_r61693813\n> :\n> \n> > @@ -19,6 +19,9 @@ spec:\n> >          version: v11\n> >          kubernetes.io/cluster-service: \"true\"\n> >      spec:\n> > +{% if grains['cloud'] is defined and grains['cloud'] in [ 'vsphere', 'photon-controller' ] %}\n> \n> Before you roll back, could you look at this pull request and see if it\n> addresses the problem?\n> #24124 https://github.com/kubernetes/kubernetes/pull/24124\n> It looks like it could be merged, but it hasn't been--I'm not sure why.\n> \n> The issue this was solving wasn't about knowing which nameservers to\n> contact, it was about actually being able to contact them: without enabling\n> the use of the host network, we were unable to communicate with the DNS\n> server.\n> \n> Ultimately, this change was meant to only affect the vSphere and Photon\n> Controller implementations. Clearly I didn't do that correctly. Is there a\n> way we can keep the underlying change without breaking other\n> implementations?\n> \n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly or view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/24124/files/5699d51efadb41b6c010f45672c4844d84de0b84#r61693813\n",
        "createdAt" : "2016-05-01T22:04:58Z",
        "updatedAt" : "2016-05-01T22:04:58Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "a83518db-24f2-41a6-842d-4566a930cc86",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "Sorry about the bad link. I meant https://github.com/kubernetes/kubernetes/pull/24883 but it seems like you found it.\n",
        "createdAt" : "2016-05-01T22:39:38Z",
        "updatedAt" : "2016-05-01T22:39:38Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "585dc592-5649-4fd0-b59b-54546cc30445",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "And, I should have said--my apologies for breaking this! If there's anything I should have done differently, please let me know so I can avoid it next time. \n",
        "createdAt" : "2016-05-01T23:33:25Z",
        "updatedAt" : "2016-05-01T23:33:25Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "20f008cb-ab9f-4205-a885-141cbf10b63c",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "IMO this is our fault for allowing the inital sed change without a presubmit (https://github.com/kubernetes/kubernetes/issues/25031). It isn't specific to DNS but applies to all addons and static pods (so etcd, kube-proxy etc). What did we expect? :)\n",
        "createdAt" : "2016-05-01T23:46:25Z",
        "updatedAt" : "2016-05-01T23:46:25Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      },
      {
        "id" : "3096aecb-41c9-4f42-8b9b-a44e7d038f53",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "I'm in favor of reverting the changes to this file. It was meant to be a [temporary](https://github.com/kubernetes/kubernetes/pull/24124#issuecomment-214926660) fix and it's not worth plumbing logic through multiple other cloud providers to accommodate. #25029\n",
        "createdAt" : "2016-05-02T00:25:43Z",
        "updatedAt" : "2016-05-02T00:25:43Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "6c521383-4d64-40cc-be1f-521731b73e66",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "Re hostnetwork: why is the kubedns pod not able to reach the actual DNS server? \n\n> It was slow because the pod couldn't access the parent DNS because it didn't have connectivity to the node's network.\n\nI don't understand this explanation. So the pod can't ping another node's ip? kube-dns needs to talk to the apiserver anyway, how does that work? \n",
        "createdAt" : "2016-05-02T00:41:51Z",
        "updatedAt" : "2016-05-02T00:41:51Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      },
      {
        "id" : "dcb8dc39-d68a-4121-a23e-51f77a632b1b",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "I'm sorry it wasn't clear--let me provide more detail. If it's not clear enough, I'm happy to talk outside of a github issue (phone, hangout, Slack) if that helps.\n\nWhen the Photon Controller kube-up implementation runs, it creates the VMs in some network. In my case, it's the 10.146.0.0/16 network. The VMs use DHCP to get IP addresses and the datacenter's DNS server, also in the 10.146.0.0/16 network. \n\nWhen the pods are created, they're in a private network. By default, we use 10.244.0.0/16, though it's configurable. The master and nodes have been configured with appropriate IP routes, and we're running kube-proxy (which configures IP tables) so communication between nodes, pods, and services work fine. As far as I understand, we meet the requirements listed at http://kubernetes.io/docs/admin/networking/ . That is, pod-to-pod, pod-to-service, and external-to-service network communications all function correctly. What we don't have (and I don't see in the networking model) is pod to external IP addresses. Perhaps it's a misunderstanding on my part?\n\nTherefore when SkyDNS runs in a pod in our setup, it cannot contact the DNS server in the datacenter network (10.146.0.0/16). Enabling host networking allows it to contact the DNS server and everything works as expected.\n\nWhat I found was that when SkyDNS is configured to inherit DNS but it can't contact the external DNS server, responses are very slow, even if it's only resolving something like kubernetes.default. Once communication with the external DNS works, responses are consistently fast. \n\nDoes this help? \n",
        "createdAt" : "2016-05-02T04:35:44Z",
        "updatedAt" : "2016-05-02T04:35:44Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "5cb92bdd-d747-453a-a732-1f7111626a9e",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Let's move the discussion to #25020 \n",
        "createdAt" : "2016-05-02T16:10:52Z",
        "updatedAt" : "2016-05-02T16:10:52Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "1262faed-a5b0-461c-8928-0e144d34c350",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "@AlainRoy as a general problem with this integration: your pods need to be able to do DNS lookups beyond the cluster, or they will likely be unhappy.  Running your DNS server as `hostNetwork` seems like a bad answer to me - you will be doing DNS lookups for hosts that pods (ostensibly) can't reach.\n\nWe can either configure Kube-DNS to have an arbitrary upstream DNS (e.g. 8.8.8.8) or you can configure it to not have upstream DNS or you can find a way to bridge your pod network and your host network.  It is not strictly a requirement that Pods be able to DNS-resolve anything outside of the cluster (though the impl might demand it, that should be fixed).  This is a policy decision for you, the owner of the integration.\n\nDo you believe that all users of Photon will be ok with DNS not working except for in-cluster names? \n",
        "createdAt" : "2016-05-02T16:19:21Z",
        "updatedAt" : "2016-05-02T16:19:21Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "6fda1b2c-ac93-43dc-b21d-0643cc2e7383",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "body" : "I don't think our users will have different requirements from other Kubernetes users. Are other users okay with it not working with upstream DNS servers? \n\nWhat is the general expectation for pods? Should they be able to reach external networks (DNS or otherwise) without using the hostNetwork option? \n",
        "createdAt" : "2016-05-02T16:29:54Z",
        "updatedAt" : "2016-05-02T16:29:54Z",
        "lastEditedBy" : "bb464d4f-4a58-4d08-b13f-95c8358b7ff1",
        "tags" : [
        ]
      },
      {
        "id" : "0936f7de-76b5-4144-88ed-8ecce7b1fa6d",
        "parentId" : "efdfe1d6-ea74-40eb-8cf3-94e23c1d70b8",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "The general answer is that pods don't assume.  There are places where they\ndon't need to escape their cluster and places where they will.  I expect a\nlot of OSS projects _will_ want some way to get internet access, but that\nbecomes a policy thing.\n\nThat it doesn't work at all -- CAN'T be made to work it seems -- makes me a\nlittle nervous about overall utility of the solution, but that's not on me\nto judge.  If your solution demands that pods can not access anything\noutside of themselves, then there's little need for an upstream DNS at\nall...\n\nOn Mon, May 2, 2016 at 9:30 AM, Alain Roy notifications@github.com wrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/kubernetes/kubernetes/pull/24124#discussion_r61762838\n> :\n> \n> > @@ -19,6 +19,9 @@ spec:\n> >          version: v11\n> >          kubernetes.io/cluster-service: \"true\"\n> >      spec:\n> > +{% if grains['cloud'] is defined and grains['cloud'] in [ 'vsphere', 'photon-controller' ] %}\n> \n> I don't think our users will have different requirements from other\n> Kubernetes users. Are other users okay with it not working with upstream\n> DNS servers?\n> \n> What is the general expectation for pods? Should they be able to reach\n> external networks (DNS or otherwise) without using the hostNetwork option?\n> \n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly or view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/24124/files/5699d51efadb41b6c010f45672c4844d84de0b84#r61762838\n",
        "createdAt" : "2016-05-04T07:28:03Z",
        "updatedAt" : "2016-05-04T07:28:03Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      }
    ],
    "commit" : "fa9d79df75d0a5326fb6ca72308ebbaf5bde603e",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +20,24 @@        kubernetes.io/cluster-service: \"true\"\n    spec:\n{% if grains['cloud'] is defined and grains['cloud'] in [ 'vsphere', 'photon-controller' ] %}\n      hostNetwork: true\n{% endif %}"
  },
  {
    "id" : "3015d51c-044f-462b-a5fe-9529fad7f88d",
    "prId" : 14625,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5888af07-6bac-4649-aea5-a8eb0b07bf8d",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "What happens when SkyDNS fixes their bug and this suddenly is \"too short\" ?\n",
        "createdAt" : "2015-09-29T06:59:50Z",
        "updatedAt" : "2015-09-29T06:59:50Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "749afa2d-8c92-48a9-b01f-2fba4c6d3826",
        "parentId" : "5888af07-6bac-4649-aea5-a8eb0b07bf8d",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "We will re-adjust / remove this flag if/when we pick the latest skydns release.\n\nAlso, hopefully, we will stop using skydns as a forwarder, making this flag redundant.\n",
        "createdAt" : "2015-09-29T17:34:55Z",
        "updatedAt" : "2015-09-29T17:34:55Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "4fec792f-bf80-415e-a3dd-259f86107d06",
        "parentId" : "5888af07-6bac-4649-aea5-a8eb0b07bf8d",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Please file an issue, assign to yourself with the details.\n\nOn Tue, Sep 29, 2015 at 10:35 AM, Abhi Shah notifications@github.com\nwrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/kubernetes/kubernetes/pull/14625#discussion_r40702079\n> :\n> \n> > @@ -58,6 +58,7 @@ spec:\n> >          # command = \"/skydns\"\n> >          - -machines=http://localhost:4001\n> >          - -addr=0.0.0.0:53\n> > -        - -rtimeout=1s\n> \n> We will re-adjust / remove this flag if/when we pick the latest skydns\n> release.\n> \n> Also, hopefully, we will stop using skydns as a forwarder, making this\n> flag redundant.\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/14625/files#r40702079.\n",
        "createdAt" : "2015-09-29T20:29:33Z",
        "updatedAt" : "2015-09-29T20:29:33Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "7e1f8238-8375-47ff-9375-1a906bf3c196",
        "parentId" : "5888af07-6bac-4649-aea5-a8eb0b07bf8d",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "filed #14807\n",
        "createdAt" : "2015-09-30T05:21:46Z",
        "updatedAt" : "2015-09-30T05:21:46Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "32dcf1f2-799d-4b6d-acd6-f336c0064d4c",
        "parentId" : "5888af07-6bac-4649-aea5-a8eb0b07bf8d",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "fixed\n",
        "createdAt" : "2015-10-20T20:29:22Z",
        "updatedAt" : "2015-10-20T20:29:22Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      }
    ],
    "commit" : "5d2f3e6683f09ccfe0262634a5b4d2618b0f1ed3",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +59,63 @@        - -machines=http://localhost:4001\n        - -addr=0.0.0.0:53\n        - -rtimeout=1s\n        - -domain={{ pillar['dns_domain'] }}.\n        ports:"
  },
  {
    "id" : "d5d0aba4-77ce-4609-b3db-0ada10c2bc30",
    "prId" : 11055,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6c54969d-6bb7-4345-83e1-45de3f247463",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "this is a subdir of the volumeMount - is that intentional?\n",
        "createdAt" : "2015-07-10T15:17:53Z",
        "updatedAt" : "2015-07-10T16:28:23Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "1c76ce1f-cfcd-4797-ada4-74fa6fdecc24",
        "parentId" : "6c54969d-6bb7-4345-83e1-45de3f247463",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "I have now mounted mounted emptydir on /var/etcd/data \nI used that as a mount mount for consistency. Our other etcd container on master uses /var/etcd/data\n",
        "createdAt" : "2015-07-10T15:56:16Z",
        "updatedAt" : "2015-07-10T16:28:23Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      }
    ],
    "commit" : "bc99a57915182389791355745a78f5099171d5bb",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +30,34 @@        - /usr/local/bin/etcd\n        - -data-dir\n        - /var/etcd/data\n        - -listen-client-urls\n        - http://127.0.0.1:2379,http://127.0.0.1:4001"
  },
  {
    "id" : "e9978f59-be83-43b7-a0a9-d878aedef78d",
    "prId" : 11055,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4c75ac83-89a9-4dcc-9b96-61a2aba269f6",
        "parentId" : null,
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "optional nit: etcd logs would also be nice\n",
        "createdAt" : "2015-07-10T15:25:05Z",
        "updatedAt" : "2015-07-10T16:28:23Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      },
      {
        "id" : "002ce3f4-af38-4871-9458-b5a2b68c1b21",
        "parentId" : "4c75ac83-89a9-4dcc-9b96-61a2aba269f6",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "I will have to wrap the etcd command in a shell for stdout and stderr to be redirected. I can do it in a separate PR\n",
        "createdAt" : "2015-07-10T15:58:38Z",
        "updatedAt" : "2015-07-10T16:28:23Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "4392021c-8abd-47b9-83e3-c4049bd996b9",
        "parentId" : "4c75ac83-89a9-4dcc-9b96-61a2aba269f6",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "don't redirect stdout/err - then 'kubectl logs` won't work\n\nOn Fri, Jul 10, 2015 at 8:59 AM, Abhi Shah notifications@github.com wrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/11055#discussion_r34368610\n> :\n> \n> > ```\n> >      - -listen-client-urls\n> >      - http://127.0.0.1:2379,http://127.0.0.1:4001\n> >      - -advertise-client-urls\n> >      - http://127.0.0.1:2379,http://127.0.0.1:4001\n> >      - -initial-cluster-token\n> >      - skydns-etcd\n> > ```\n> > -        volumeMounts:\n> \n> I will have to wrap the etcd command in a shell for stdout and stderr to\n> be redirected. I can do it in a separate PR\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/11055/files#r34368610\n> .\n",
        "createdAt" : "2015-07-10T16:01:28Z",
        "updatedAt" : "2015-07-10T16:28:23Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "9fa8df04-7e0d-47d5-9384-e27149a6799d",
        "parentId" : "4c75ac83-89a9-4dcc-9b96-61a2aba269f6",
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "I guess I just want -debug https://github.com/coreos/etcd/blob/master/Documentation/configuration.md, but it looks like it isn't available in etcd 2.0 :\\\n",
        "createdAt" : "2015-07-10T16:40:24Z",
        "updatedAt" : "2015-07-10T16:40:47Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      }
    ],
    "commit" : "bc99a57915182389791355745a78f5099171d5bb",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +37,41 @@        - -initial-cluster-token\n        - skydns-etcd\n        volumeMounts:\n        - name: etcd-storage\n          mountPath: /var/etcd/data"
  },
  {
    "id" : "52558fe3-6251-42d3-8fb5-8c7aee1fe568",
    "prId" : 11004,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f035d7e7-3f4c-4272-805b-529af0656ee6",
        "parentId" : null,
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "I think this container is tiny enough that it will fit in somewhere. Do we need to give it a tenth of a core? \n\nEDIT: I guess best practices dictates we should specify limits for everything, I'll give it less cpu.\n",
        "createdAt" : "2015-07-09T18:24:59Z",
        "updatedAt" : "2015-07-09T22:15:25Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      },
      {
        "id" : "51f6e4fa-1275-4035-8c85-97b928d7bee9",
        "parentId" : "f035d7e7-3f4c-4272-805b-529af0656ee6",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "We don't have any \"outer\" shared limits yet that would let you get away with 0.  You could spec 10m for CPU :)\n",
        "createdAt" : "2015-07-09T21:13:24Z",
        "updatedAt" : "2015-07-09T22:15:25Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "d32a2fd8-bc06-405c-99d5-0320158bd5b9",
        "parentId" : "f035d7e7-3f4c-4272-805b-529af0656ee6",
        "authorId" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "body" : "I was planning on 10m. What do you mean by outer shared limits? like a limit range on the ns (that kube-system doesn't have).\n",
        "createdAt" : "2015-07-09T21:46:52Z",
        "updatedAt" : "2015-07-09T22:15:25Z",
        "lastEditedBy" : "395f4f9a-98be-4485-b436-51f0897d7c9f",
        "tags" : [
        ]
      },
      {
        "id" : "fc7b4bb8-8a8f-42e7-bf5c-e4e4b6827275",
        "parentId" : "f035d7e7-3f4c-4272-805b-529af0656ee6",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "10m should be fine, you have 100m now.\n\n\"outer\" means a limit for the pod, such that something with 0 CPU could use whatever CPU was free in the pod\n",
        "createdAt" : "2015-07-09T21:53:28Z",
        "updatedAt" : "2015-07-09T22:15:25Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      }
    ],
    "commit" : "412467fe2780bba1dd4a0dd753ab76297b97c8c4",
    "line" : null,
    "diffHunk" : "@@ -1,1 +71,75 @@      - name: healthz\n        image: gcr.io/google_containers/exechealthz:1.0\n        resources:\n          limits:\n            cpu: 10m"
  },
  {
    "id" : "a7d6176d-2d8e-48f3-9a5c-238b0d8abc4d",
    "prId" : 11004,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dc052d9e-2a59-4657-b6c9-6eb2e6cbfb09",
        "parentId" : null,
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "you should not need to say pillar['dns_domain']\njust kubernetes.default.svc should be enough\n",
        "createdAt" : "2015-07-10T16:05:18Z",
        "updatedAt" : "2015-07-10T16:05:18Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "2f0813a4-cbc7-497b-89f8-d33a392654b6",
        "parentId" : "dc052d9e-2a59-4657-b6c9-6eb2e6cbfb09",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "Never mind my prev comment.. \nwe need the whole path..\n",
        "createdAt" : "2015-07-10T16:07:06Z",
        "updatedAt" : "2015-07-10T16:07:06Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "95b71039-a699-4349-a6a9-1c0ab3ccce53",
        "parentId" : "dc052d9e-2a59-4657-b6c9-6eb2e6cbfb09",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "I want this to be an absoluet lookup\n\nOn Fri, Jul 10, 2015 at 9:05 AM, Abhi Shah notifications@github.com wrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/11004#discussion_r34369250\n> :\n> \n> > @@ -61,4 +61,23 @@ spec:\n> >          - containerPort: 53\n> >            name: dns-tcp\n> >            protocol: TCP\n> > -        livenessProbe:\n> > -          httpGet:\n> > -            path: /healthz\n> > -            port: 8080\n> > -            scheme: HTTP\n> > -          initialDelaySeconds: 30\n> > -          timeoutSeconds: 5\n> > -      - name: healthz\n> > -        image: gcr.io/google_containers/exechealthz:1.0\n> > -        resources:\n> > -          limits:\n> > -            cpu: 10m\n> > -            memory: 20Mi\n> > -        args:\n> > -        - -cmd=nslookup kubernetes.default.svc.{{ pillar['dns_domain'] }} localhost >/dev/null\n> \n> you should not need to say pillar['dns_domain']\n> just kubernetes.default.svc should be enough\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/11004/files#r34369250\n> .\n",
        "createdAt" : "2015-07-10T16:07:59Z",
        "updatedAt" : "2015-07-10T16:07:59Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "367318e3-f0fd-4619-9ca0-e5709ee958bf",
        "parentId" : "dc052d9e-2a59-4657-b6c9-6eb2e6cbfb09",
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "relative path wont work either..\nwe dont have the search domain suffixes on this pod.\n",
        "createdAt" : "2015-07-10T16:10:56Z",
        "updatedAt" : "2015-07-10T16:10:56Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      }
    ],
    "commit" : "412467fe2780bba1dd4a0dd753ab76297b97c8c4",
    "line" : 45,
    "diffHunk" : "@@ -1,1 +76,80 @@            memory: 20Mi\n        args:\n        - -cmd=nslookup kubernetes.default.svc.{{ pillar['dns_domain'] }} localhost >/dev/null\n        - -port=8080\n        ports:"
  },
  {
    "id" : "97c562b7-a3bf-418b-9359-df7a124e5de7",
    "prId" : 8718,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6872930d-1c81-48db-bd5b-91fcc7afd967",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "You also have to bump the -v flag in the RC name\n",
        "createdAt" : "2015-05-28T18:15:28Z",
        "updatedAt" : "2015-06-02T00:00:15Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "cb16d161-5226-44e8-87b5-918b5f163483",
        "parentId" : "6872930d-1c81-48db-bd5b-91fcc7afd967",
        "authorId" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "body" : "Done\n",
        "createdAt" : "2015-06-01T19:27:27Z",
        "updatedAt" : "2015-06-02T00:00:15Z",
        "lastEditedBy" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "tags" : [
        ]
      }
    ],
    "commit" : "404558f29c75584ae6fba15e69e64b9f893fb89e",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +31,35 @@        - skydns-etcd\n      - name: kube2sky\n        image: gcr.io/google_containers/kube2sky:1.8\n        args:\n        # command = \"/kube2sky\""
  },
  {
    "id" : "3e3a65c7-a586-4a14-bf46-8abe1abf3c17",
    "prId" : 8718,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b20678d7-821d-4944-9910-6fb1efa25120",
        "parentId" : null,
        "authorId" : "0970b119-085d-41b4-8f33-e10409965eba",
        "body" : "IMO, This will still not work since KUBERNETES_SERVICE_HOST is 10.0.0.2 which is not on the cert.\n\nhttps://github.com/GoogleCloudPlatform/kubernetes/issues/8314#issuecomment-107695866\n\nHas this change been verified manually ?\n",
        "createdAt" : "2015-06-01T20:23:53Z",
        "updatedAt" : "2015-06-02T00:00:15Z",
        "lastEditedBy" : "0970b119-085d-41b4-8f33-e10409965eba",
        "tags" : [
        ]
      },
      {
        "id" : "d6f9710f-06fa-4d52-878e-9fab8ace6ec0",
        "parentId" : "b20678d7-821d-4944-9910-6fb1efa25120",
        "authorId" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "body" : "This PR is not intended to address #8314. This is meant to make a kube2sky release that does not connect to the master insecurely by default.\n",
        "createdAt" : "2015-06-01T20:34:34Z",
        "updatedAt" : "2015-06-02T00:00:15Z",
        "lastEditedBy" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "tags" : [
        ]
      }
    ],
    "commit" : "404558f29c75584ae6fba15e69e64b9f893fb89e",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +36,40 @@        - -domain={{ pillar['dns_domain'] }}\n        - -kubecfg_file=/etc/dns_token/kubeconfig\n        - -kube_master_url=https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT}\n        volumeMounts:\n        - mountPath: /etc/dns_token"
  },
  {
    "id" : "92e38694-1ca6-4b55-8a11-7e094b71be35",
    "prId" : 7675,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cd371122-6a13-42a2-ae52-1eace5182ae9",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Where is the Dockerfile for this?  What is significant about our releease vs upstream?\n",
        "createdAt" : "2015-05-05T17:30:18Z",
        "updatedAt" : "2015-05-05T17:30:18Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "0e414d3d-cba6-4206-8f75-9b7b04004a9b",
        "parentId" : "cd371122-6a13-42a2-ae52-1eace5182ae9",
        "authorId" : "0ac5d6cd-da87-46a2-9b30-0d21db1063a2",
        "body" : "What @thockin said. And yes, I'm using quay.io. Thanks\nOn May 5, 2015 18:31, \"Tim Hockin\" notifications@github.com wrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/7675#discussion_r29692032\n> :\n> \n> > @@ -21,15 +21,17 @@ desiredState:\n> >          dnsPolicy: \"Default\"  # Don't use cluster DNS.\n> >          containers:\n> >            - name: etcd\n> > -            image: quay.io/coreos/etcd:v2.0.3\n> > -            image: gcr.io/google_containers/etcd:2.0.9\n> \n> Where is the Dockerfile for this? What is significant about our releease\n> vs upstream?\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/7675/files#r29692032\n> .\n",
        "createdAt" : "2015-05-05T19:06:56Z",
        "updatedAt" : "2015-05-05T19:06:56Z",
        "lastEditedBy" : "0ac5d6cd-da87-46a2-9b30-0d21db1063a2",
        "tags" : [
        ]
      },
      {
        "id" : "ba8335ad-57b4-44af-bc53-b647432aa8ed",
        "parentId" : "cd371122-6a13-42a2-ae52-1eace5182ae9",
        "authorId" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "body" : "@thockin See https://github.com/GoogleCloudPlatform/kubernetes/blob/master/cluster/images/etcd/Dockerfile\n\nThis is the same etcd that we use for apiserver. I'm not sure what's different from upstream though. \n",
        "createdAt" : "2015-05-05T19:43:42Z",
        "updatedAt" : "2015-05-05T19:43:42Z",
        "lastEditedBy" : "c2b5c827-efcd-438f-8db5-52d917b1cde9",
        "tags" : [
        ]
      },
      {
        "id" : "d13e82b4-eee6-47d3-a227-109654739092",
        "parentId" : "cd371122-6a13-42a2-ae52-1eace5182ae9",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "As long as we have a Dockerfile for it, I am ok.  I see that it is an ultra-minimal Dockerfile, which I like.  But it still pulls code from externally.  We should probably vendor it in, no?\n\n@dchen1107 \n",
        "createdAt" : "2015-05-05T23:56:56Z",
        "updatedAt" : "2015-05-05T23:56:56Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "5b320719-bcb9-44ce-88b7-729235eb25d1",
        "parentId" : "cd371122-6a13-42a2-ae52-1eace5182ae9",
        "authorId" : "0ac5d6cd-da87-46a2-9b30-0d21db1063a2",
        "body" : "It works, thank you @roberthbailey!\n",
        "createdAt" : "2015-05-06T00:09:29Z",
        "updatedAt" : "2015-05-06T00:09:29Z",
        "lastEditedBy" : "0ac5d6cd-da87-46a2-9b30-0d21db1063a2",
        "tags" : [
        ]
      }
    ],
    "commit" : "a21713a771a2e66beb3f579326fe1f47bdea95a9",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +22,26 @@        containers:\n          - name: etcd\n            image: gcr.io/google_containers/etcd:2.0.9\n            command: [\n                    \"/usr/local/bin/etcd\","
  },
  {
    "id" : "0e909dd2-f800-4ba5-af46-48dfbe3553b9",
    "prId" : 7154,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "38564778-573f-4b9e-9fdf-ba07faa832ec",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "@pmorie have we fixed or disproved the Secret idempotency problem?\n",
        "createdAt" : "2015-04-22T06:02:32Z",
        "updatedAt" : "2015-04-22T06:10:59Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      }
    ],
    "commit" : "e982ac5b550dbbb8613d937f15bb9ece4482689b",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +57,61 @@              secret:\n                target:\n                  kind: Secret\n                  namespace: default\n                  name: token-system-dns"
  },
  {
    "id" : "976ff1fd-3304-4417-87e7-aa60669fa2b7",
    "prId" : 4812,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f0d5399a-995a-4529-91ed-a0e31fed06a7",
        "parentId" : null,
        "authorId" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "body" : "Does this work? The command seems wrong to me.\n\nAlso can you stick to the existing format for yaml files in other examples. Example:\n\n``` shell\ncommand:\n          - \"/bin/sh\"\n          - \"-c\"\n          - \"echo ok\n```\n",
        "createdAt" : "2015-02-25T22:02:08Z",
        "updatedAt" : "2015-02-25T22:02:08Z",
        "lastEditedBy" : "c4b970b3-3b9c-4773-bc9b-f8d005b15fd1",
        "tags" : [
        ]
      },
      {
        "id" : "b78bc8b5-25f2-43c8-85d6-014668196066",
        "parentId" : "f0d5399a-995a-4529-91ed-a0e31fed06a7",
        "authorId" : "f5266f11-2f35-463a-bf70-5a4f0c966b69",
        "body" : "Since I'm not that knowledgeable around Docker I can't answer with certainty, but here is how I understand it:\n- both etcd images (latest and 2.0.3) have ENTRYPOINT defined as /etcd and empty cmd (https://quay.io/repository/coreos/etcd?image=201a4476d171)\n- such configuration causes docker run etcd_image to just execute ENTRYPOINT and cmd (https://docs.docker.com/reference/builder/#entrypoint)\n- I'm not sure why, but running $ etcd /etcd will start etcd without any error; moreover $ etcd /etcd -listen-client-urls=http://0.0.0.0:2379,http://0.0.0.0:4001 will not really run etcd with the command line flag as expect\n- I've tested manually configuration in my PR and it works\n- I believe that previous configuration wasn't really correct; I think it only worked just because the provided flags were equal to the defaults (otherwise the provided flags would not have any effect).\n\nRegarding your request to stick with \"bin/sh\". I don't think it will really work. As I understand one of the reasons for ENTRYPOINT equal to /etcd is for users to use that entrypoint and just configure the application from command line. Entrypoint can be override by --entrypoint docker flag, however it won't work in case of etcd image since it doesn't contain /bin/sh.\n",
        "createdAt" : "2015-02-26T07:42:17Z",
        "updatedAt" : "2015-02-26T07:42:17Z",
        "lastEditedBy" : "f5266f11-2f35-463a-bf70-5a4f0c966b69",
        "tags" : [
        ]
      }
    ],
    "commit" : "b05274e237d3050ccae71f5c56040be889f3e364",
    "line" : 10,
    "diffHunk" : "@@ -1,1 +23,27 @@            image: quay.io/coreos/etcd:v2.0.3\n            command: [\n                    # entrypoint = \"/etcd\",\n                    \"-listen-client-urls=http://0.0.0.0:2379,http://0.0.0.0:4001\",\n                    \"-initial-cluster-token=skydns-etcd\","
  },
  {
    "id" : "d5d0b71a-c3b0-4b3b-9caf-d4f8c8c568a4",
    "prId" : 3601,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fb5b14a8-503c-44df-9ad7-4d8d188135ec",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "There is a doc that explain to mortal users how DNS works.  Needs updates?\n",
        "createdAt" : "2015-01-20T17:26:07Z",
        "updatedAt" : "2015-01-21T20:26:01Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "34b9bb7b-6878-4c24-a5d6-60d5ae2685ad",
        "parentId" : "fb5b14a8-503c-44df-9ad7-4d8d188135ec",
        "authorId" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "body" : "Will check and update. It became more convoluted on our end, certainly - not sure about the end-users side, though, hopefully.\n",
        "createdAt" : "2015-01-20T17:32:10Z",
        "updatedAt" : "2015-01-21T20:26:01Z",
        "lastEditedBy" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "tags" : [
        ]
      },
      {
        "id" : "eb299bd8-3831-4842-a6f9-7b34a0857a58",
        "parentId" : "fb5b14a8-503c-44df-9ad7-4d8d188135ec",
        "authorId" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "body" : "Hm. Are you talking about `cluster/addons/dns/README.md`? Those\ninstructions don't look right ... they don't include any instructions on\nhow you'd bonk salt to update the minions for the `DNS_SERVER_IP`. They\nlook pre-ENABLE_CLUSTER_DNS, pre-salt config, at the very least. At the\nmoment, the configuration seems pretty static once you create the cluster,\nunless you know the right incantations.\n\nGiven that, would you mind a separate pull for cleanup on the docs?\n\nOn Tue, Jan 20, 2015 at 9:26 AM, Tim Hockin notifications@github.com\nwrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601#discussion-diff-23238511\n> :\n> \n> > @@ -5,7 +5,7 @@ namespace: default\n> >  labels:\n> >    k8s-app: skydns\n> >  desiredState:\n> > -  replicas: {DNS_REPLICAS}\n> > -  replicas: {{ pillar['dns_replicas'] }}\n> \n> There is a doc that explain to mortal users how DNS works. Needs updates?\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601/files#r23238511\n> .\n",
        "createdAt" : "2015-01-20T17:45:20Z",
        "updatedAt" : "2015-01-21T20:26:01Z",
        "lastEditedBy" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "tags" : [
        ]
      },
      {
        "id" : "a0376cb4-23b9-4393-b3ce-42e4413413e4",
        "parentId" : "fb5b14a8-503c-44df-9ad7-4d8d188135ec",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Those assume that the salt stuff is done - it's more hand-holding for\nlaunching the skydns pods.  I'd be happy ot see that bit removed, with a\nreference to \"and then we salt it and the pod gets scheduled\"\n\nOn Tue, Jan 20, 2015 at 9:45 AM, Zach Loafman notifications@github.com\nwrote:\n\n> In cluster/addons/dns/skydns-rc.yaml.in\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601#discussion-diff-23239852\n> :\n> \n> > @@ -5,7 +5,7 @@ namespace: default\n> >  labels:\n> >    k8s-app: skydns\n> >  desiredState:\n> > -  replicas: {DNS_REPLICAS}\n> > -  replicas: {{ pillar['dns_replicas'] }}\n> \n> Hm. Are you talking about `cluster/addons/dns/README.md`? Those\n> instructions don't look right ... they don't include any instructions on\n> how you'd bonk salt to update the minions for the `DNS_SERVER_IP`. They\n> look pre-ENABLE_CLUSTER_DNS, pre-salt config, at the very least. At the\n> moment, the configuration seems pretty static once you create the cluster,\n> unless you know the right incantations. Given that, would you mind a\n> separate pull for cleanup on the docs?\n> ... <#14b0876ce70e1c20_>\n> On Tue, Jan 20, 2015 at 9:26 AM, Tim Hockin notifications@github.com\n> wrote: In cluster/addons/dns/skydns-rc.yaml.in <\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601#discussion-diff-23238511>\n> : > @@ -5,7 +5,7 @@ namespace: default > labels: > k8s-app: skydns >\n> desiredState: > - replicas: {DNS_REPLICAS} > + replicas: {{\n> pillar['dns_replicas'] }} There is a doc that explain to mortal users how\n> DNS works. Needs updates? -- Reply to this email directly or view it on\n> GitHub <\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601/files#r23238511>\n> .\n> \n> ## \n> \n> Reply to this email directly or view it on GitHub\n> https://github.com/GoogleCloudPlatform/kubernetes/pull/3601/files#r23239852\n> .\n",
        "createdAt" : "2015-01-20T18:36:04Z",
        "updatedAt" : "2015-01-21T20:26:01Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "d6ce8fac-0b52-44d3-b7dc-b09a48607b49",
        "parentId" : "fb5b14a8-503c-44df-9ad7-4d8d188135ec",
        "authorId" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "body" : "Will fix.\n",
        "createdAt" : "2015-01-20T22:00:33Z",
        "updatedAt" : "2015-01-21T20:26:01Z",
        "lastEditedBy" : "a92f8f9e-31fd-4510-b4d9-3553f7025485",
        "tags" : [
        ]
      }
    ],
    "commit" : "a305269e1830b0ebc00a83af734712ab3be2cad3",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +6,10 @@  k8s-app: skydns\ndesiredState:\n  replicas: {{ pillar['dns_replicas'] }}\n  replicaSelector:\n    k8s-app: skydns"
  }
]