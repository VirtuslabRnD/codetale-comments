[
  {
    "id" : "53f4afcf-7fee-4d21-ae03-e29cd28e1ab7",
    "prId" : 92718,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/92718#pullrequestreview-445910100",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "parentId" : null,
        "authorId" : "b714f738-aa05-4f49-a624-eaaf3e0cbb70",
        "body" : "@prameshj \r\n\r\nWe've had people run into this # of concurrents as an issue for DNS masq.\r\nIs there a link or reference (embed as a comment) as to how this value was determined?",
        "createdAt" : "2020-07-09T15:26:32Z",
        "updatedAt" : "2020-07-09T15:26:42Z",
        "lastEditedBy" : "b714f738-aa05-4f49-a624-eaaf3e0cbb70",
        "tags" : [
        ]
      },
      {
        "id" : "84452d1e-dad5-4a35-a53a-3d352ac4dac6",
        "parentId" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "authorId" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "body" : "Here is my reasoning: https://github.com/coredns/deployment/pull/233#issue-438151578",
        "createdAt" : "2020-07-09T15:40:50Z",
        "updatedAt" : "2020-07-09T15:41:02Z",
        "lastEditedBy" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "tags" : [
        ]
      },
      {
        "id" : "0a8f1207-732c-4dc5-a0b0-996cd4c03d19",
        "parentId" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "authorId" : "c1166017-761f-41df-8ad7-07e3dd792799",
        "body" : "My understanding was also that since this only applies to forwarded queries, cached responses and \"cluster.local\" queries would continue to be handled. Thanks for the explanation above. Good to know that the client will get a SERVFAIL rather than timeout after no response.\r\n\r\nI am curious, how the memory overhead of 2 MB was measured?Any test that queried 1000 unique external names in parallel? From https://golang.org/doc/go1.2#stack_size, if a single goroutine took up 4KB, this could use upto 4MB?",
        "createdAt" : "2020-07-09T15:49:44Z",
        "updatedAt" : "2020-07-09T15:49:44Z",
        "lastEditedBy" : "c1166017-761f-41df-8ad7-07e3dd792799",
        "tags" : [
        ]
      },
      {
        "id" : "9a15f3bc-9b03-4a31-ab45-9b1d107b3190",
        "parentId" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "authorId" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "body" : "> My understanding was also that since this only applies to forwarded queries, cached responses and \"cluster.local\" queries would continue to be handled.\r\n\r\nYes, that's correct.\r\n\r\n> From https://golang.org/doc/go1.2#stack_size, if a single goroutine took up 4KB, this could use upto 4MB?\r\n\r\nI was basing it on 2k per go-routine https://golang.org/doc/go1.4#runtime.  Nonetheless, 2MB is admittedly an arbitrary number.  The default memory limit per CoreDNS Pod is 170Mi, so there is _a lot_ of headroom before an OOM happens.\r\n\r\nIf we are not comfortable picking number at this time, we can just leave the it out.  When people see OOMs due to query spikes, they can add this manually.\r\n\r\n",
        "createdAt" : "2020-07-09T18:55:00Z",
        "updatedAt" : "2020-07-09T18:55:00Z",
        "lastEditedBy" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "tags" : [
        ]
      },
      {
        "id" : "111435b8-e595-476e-9b54-5edad5dd8c76",
        "parentId" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "authorId" : "c1166017-761f-41df-8ad7-07e3dd792799",
        "body" : "Based on past issues that have been reported, most of the parallel queries are related to searchpath expansion and will have the \"cluster.local\" suffix. This will be handled by the  \"kubernetes\" plugin, and hence unaffected by the 1000 connection limit. It seems reasonable to add this new limit to prevent OOMs of coreDNS pods. @bowei what do you think?",
        "createdAt" : "2020-07-09T19:10:39Z",
        "updatedAt" : "2020-07-09T19:10:40Z",
        "lastEditedBy" : "c1166017-761f-41df-8ad7-07e3dd792799",
        "tags" : [
        ]
      },
      {
        "id" : "0bf28d38-4f93-4b5f-8b61-50ec9dfa257f",
        "parentId" : "2ccab9fb-80d2-4d70-8087-a33aa3d7105f",
        "authorId" : "b714f738-aa05-4f49-a624-eaaf3e0cbb70",
        "body" : "sgtm\r\n\r\n/lgtm\r\n/approve",
        "createdAt" : "2020-07-09T19:33:24Z",
        "updatedAt" : "2020-07-09T19:33:24Z",
        "lastEditedBy" : "b714f738-aa05-4f49-a624-eaaf3e0cbb70",
        "tags" : [
        ]
      }
    ],
    "commit" : "adffc7fccac0152463ca1482700aa6bc77a174b8",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +75,79 @@        prometheus :9153\n        forward . /etc/resolv.conf {\n            max_concurrent 1000\n        }\n        cache 30"
  },
  {
    "id" : "8680baea-d0c8-4178-b19d-7ff7f57081c1",
    "prId" : 69940,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69940#pullrequestreview-166692612",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a85fcc86-ef51-4fe4-958b-30a54089a126",
        "parentId" : null,
        "authorId" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "body" : "Is this label guaranteed to be present on node? When was this introduced?",
        "createdAt" : "2018-10-18T20:01:48Z",
        "updatedAt" : "2018-10-26T18:49:31Z",
        "lastEditedBy" : "26bd3fa6-ac8d-4cb0-b746-a30dc1dc2931",
        "tags" : [
        ]
      },
      {
        "id" : "dace728b-3810-46d8-a748-0ee0a398fbf5",
        "parentId" : "a85fcc86-ef51-4fe4-958b-30a54089a126",
        "authorId" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "body" : "Looks like it's been around for at least 17 months.\r\nDocumentation implies this is automatically populated on the node by kubelet.",
        "createdAt" : "2018-10-18T20:22:46Z",
        "updatedAt" : "2018-10-26T18:49:31Z",
        "lastEditedBy" : "7c932efe-83b7-4b24-aab2-9db6d920473f",
        "tags" : [
        ]
      },
      {
        "id" : "80a552fb-390d-4e05-a3c1-ce856e0368a6",
        "parentId" : "a85fcc86-ef51-4fe4-958b-30a54089a126",
        "authorId" : "c89f3702-5ef8-4a99-825c-f57a17eb68e2",
        "body" : "Just to sanity check myself out of pure paranoia, the value of this default label comes from goruntime.GOOS.\r\n\r\nHere are the permissible values as I understand them - \r\n[https://github.com/golang/go/blob/master/src/go/build/syslist.go]\r\nconst goosList = \"aix android darwin dragonfly freebsd js linux nacl netbsd openbsd plan9 solaris windows zos \"\r\n\r\nI believe \"linux\" is the only value pertinent to coredns, given that the official Dockerfile is bound to debian.\r\n[https://github.com/coredns/coredns/blob/master/Dockerfile]",
        "createdAt" : "2018-10-19T20:54:22Z",
        "updatedAt" : "2018-10-26T18:49:31Z",
        "lastEditedBy" : "c89f3702-5ef8-4a99-825c-f57a17eb68e2",
        "tags" : [
        ]
      }
    ],
    "commit" : "eb818f95d1b39b85a9f803edaf01acdd521eef12",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +114,118 @@          operator: \"Exists\"\n      nodeSelector:\n        beta.kubernetes.io/os: linux\n      containers:\n      - name: coredns"
  }
]