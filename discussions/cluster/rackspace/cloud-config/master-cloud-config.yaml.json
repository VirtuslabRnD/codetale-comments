[
  {
    "id" : "96c65d71-ecee-4320-9b0c-410269349db7",
    "prId" : 1832,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "884e6625-e53b-4dae-a20c-967d37f57018",
        "parentId" : null,
        "authorId" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "body" : "I'd take a closer look at some point about making the failure modes for these scripts a little more robust.  As things stand if, say, etcdctl fails it'll be hard to figure out what is going on.\n",
        "createdAt" : "2014-10-16T16:18:27Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "tags" : [
        ]
      },
      {
        "id" : "c6dab635-1bd7-4b13-93f9-3a8da012954d",
        "parentId" : "884e6625-e53b-4dae-a20c-967d37f57018",
        "authorId" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "body" : "Totally agree. We'll work on iterating these little scripts to make them more robust. I wonder if building smaller 3rd party Go binaries would be the best course of action. Thoughts?\n",
        "createdAt" : "2014-10-16T17:39:51Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "tags" : [
        ]
      },
      {
        "id" : "cea48de6-5ed3-4bbc-bb94-62732cac9144",
        "parentId" : "884e6625-e53b-4dae-a20c-967d37f57018",
        "authorId" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "body" : "I'm not sure -- I could see going either way.  No need to lock it down now though.\n\nIn any case, it might be worthwhile to create a mime-encoded cloud-init package vs. putting everything into a single yaml file.  That is how we could start using the stuff from #1831.\n",
        "createdAt" : "2014-10-16T17:56:32Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "tags" : [
        ]
      }
    ],
    "commit" : "d513854851bff0aeb78bf972019900c71b29172b",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +6,10 @@    content: |\n      #!/bin/sh\n      m=$(echo $(etcdctl ls --recursive /corekube/minions | cut -d/ -f4 | sort) | tr ' ' ,)\n      echo \"Found $m\"\n      mkdir -p /run/apiserver"
  },
  {
    "id" : "d30e35db-8f87-4c78-903e-abe4977502bc",
    "prId" : 1832,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2563e847-1286-4bfe-a870-9ba53e0294a6",
        "parentId" : null,
        "authorId" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "body" : "Cool -- I'll keep this in mind as we 'docker-ify' the rest of our server components and may steal/copy/ask you to merge this into main k8s.\n\nIf you want to move that into our repo now instead of later I'm game with that too.  We can include that stuff in the set of tars that we create (perhaps a peer to the salt tar?) and minimize the dependencies on git and github.\n",
        "createdAt" : "2014-10-16T16:19:18Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "tags" : [
        ]
      }
    ],
    "commit" : "d513854851bff0aeb78bf972019900c71b29172b",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +14,18 @@    content: |\n      #!/bin/bash\n      git clone https://github.com/doublerr/kubernetes_nginx /opt/kubernetes_nginx\n      /usr/bin/cp /opt/.kubernetes_auth /opt/kubernetes_nginx/.kubernetes_auth\n      docker build -t kubernetes_nginx:latest /opt/kubernetes_nginx"
  },
  {
    "id" : "f0cf09e4-b475-45c5-816e-578bc322ebc9",
    "prId" : 1832,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "500cdbfc-b939-4f41-bd07-8afda077beb8",
        "parentId" : null,
        "authorId" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "body" : "We don't need fleet, so this can be removed\n",
        "createdAt" : "2014-10-17T01:10:24Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "tags" : [
        ]
      },
      {
        "id" : "da337964-172e-476d-8506-5c72e3be8f10",
        "parentId" : "500cdbfc-b939-4f41-bd07-8afda077beb8",
        "authorId" : "a836fbea-a82d-4888-b541-a4fa442a7d2c",
        "body" : "counterpoint: It's much harder to add fleet metadata after the fact, so having this here costs nothing but provides a benefit later if you want to run fleet commands on the cluster segregated by kubernetes_role.\n",
        "createdAt" : "2014-10-17T01:52:42Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "a836fbea-a82d-4888-b541-a4fa442a7d2c",
        "tags" : [
        ]
      },
      {
        "id" : "bb3aa61c-0275-4400-8f33-b59d744dcd84",
        "parentId" : "500cdbfc-b939-4f41-bd07-8afda077beb8",
        "authorId" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "body" : "Ya, I wanted fleet for both metadata and the ability to control the cluster via fleet if needed. Originally I wanted run the nginx service via fleet but ran into some problems.\n",
        "createdAt" : "2014-10-17T13:55:31Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "tags" : [
        ]
      }
    ],
    "commit" : "d513854851bff0aeb78bf972019900c71b29172b",
    "line" : null,
    "diffHunk" : "@@ -1,1 +51,55 @@      command: start\n    - name: fleet.service\n      command: start\n    - name: download-release.service\n      command: start"
  },
  {
    "id" : "6299f99e-aea0-40a6-8418-f5557c2c70f6",
    "prId" : 1832,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c2b8ab35-24fb-4272-9d79-23e5cbc31a1e",
        "parentId" : null,
        "authorId" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "body" : "Oh, is this necessary?  I thought I was seeing that systemd was clever enough to realise the EnvironmentFile had changed, and restarted the master-apiserver.service unit - without any further code.\n",
        "createdAt" : "2014-10-17T01:12:22Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "tags" : [
        ]
      },
      {
        "id" : "208545a9-fbe6-4144-a892-c2cdefeaebbd",
        "parentId" : "c2b8ab35-24fb-4272-9d79-23e5cbc31a1e",
        "authorId" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "body" : "When I tested this, it wasn't restarting the apiserver very often. I do think it checks at some point but it certainly didn't seem to be \"watching\" the file. The sighup seems to work just fine.\n",
        "createdAt" : "2014-10-17T13:56:54Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "tags" : [
        ]
      }
    ],
    "commit" : "d513854851bff0aeb78bf972019900c71b29172b",
    "line" : 92,
    "diffHunk" : "@@ -1,1 +90,94 @@      content: |\n        [Service]\n        ExecStart=/usr/bin/pkill -SIGHUP -f apiserver\n    - name: minion-finder.service\n      command: start"
  },
  {
    "id" : "5bb67528-e96a-4587-a705-828e0c0b2feb",
    "prId" : 1832,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "29188aed-dd34-4958-8d51-b87a27a6bb64",
        "parentId" : null,
        "authorId" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "body" : "Is there a reason to build this again locally, rather than just have (you) publish a docker image directly?\n\nOh, is this just to get the kubernetes_auth user:pass inside the container?  Can we just pass those via regular docker environment variables (or volume mounts, if we want to avoid them appearing in environment/command lines)?\n",
        "createdAt" : "2014-10-17T01:18:42Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "58cf89ce-9cc3-4dce-b99b-49ae3682cc9a",
        "tags" : [
        ]
      },
      {
        "id" : "0b61552c-9333-4332-bc35-573b0a7aae0a",
        "parentId" : "29188aed-dd34-4958-8d51-b87a27a6bb64",
        "authorId" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "body" : "It's mostly to regenerate the self-signed certificate at build time and store that in the image.\n\nThe other piece is as you said, just for the http auth. I don't think ENVs are the best option since you would need some way to turn those variables into an htpasswd file and restart nginx. Doable, which way is less dirty?\n\nVolume mounts would be interesting too and I didn't really think about those. I'm a fan of keeping everything contained in the image if possible but I can see that working too.\n",
        "createdAt" : "2014-10-17T13:43:04Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "3cf2dcca-f7ef-4dac-8e32-cef63a80b255",
        "tags" : [
        ]
      },
      {
        "id" : "94d35122-e9e4-49aa-8273-034f5535d92b",
        "parentId" : "29188aed-dd34-4958-8d51-b87a27a6bb64",
        "authorId" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "body" : "It might be worthwhile to add a comment that this image builds new certs when `docker build` is run and that is why the build is being done at install time instead of earlier.  We can look to find another way to generate/share certs later if need be.\n",
        "createdAt" : "2014-10-17T16:45:25Z",
        "updatedAt" : "2014-10-20T17:19:03Z",
        "lastEditedBy" : "e19009d8-ed5c-45bb-b5ce-4f8d956c6c45",
        "tags" : [
        ]
      },
      {
        "id" : "9b5fb6fb-0384-4724-9cd0-102cdc412623",
        "parentId" : "29188aed-dd34-4958-8d51-b87a27a6bb64",
        "authorId" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "body" : "we are about to have support for authentication tokens, which are just ascii strings and don't require htpasswd building.    What would you consider the cleanest way to pass those from kube-up to the master (for my benefit if I have to modify this code subsequently to use tokens)\n",
        "createdAt" : "2014-10-21T14:11:28Z",
        "updatedAt" : "2014-10-21T14:11:28Z",
        "lastEditedBy" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "tags" : [
        ]
      }
    ],
    "commit" : "d513854851bff0aeb78bf972019900c71b29172b",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +16,20 @@      git clone https://github.com/doublerr/kubernetes_nginx /opt/kubernetes_nginx\n      /usr/bin/cp /opt/.kubernetes_auth /opt/kubernetes_nginx/.kubernetes_auth\n      docker build -t kubernetes_nginx:latest /opt/kubernetes_nginx\n  - path: /opt/bin/download-release.sh\n    permissions: 0755"
  }
]