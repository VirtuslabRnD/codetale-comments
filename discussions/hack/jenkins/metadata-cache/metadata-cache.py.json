[
  {
    "id" : "b4c10eba-a5d5-416a-945d-f89b9ecd4bf9",
    "prId" : 24131,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5d63df1f-b380-4bf6-8d1f-9f5e75913e39",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "do we want to hold the lock while running the request?\n",
        "createdAt" : "2016-04-13T23:43:43Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "dd67068c-e255-4c51-ac28-ace1d89ff409",
        "parentId" : "5d63df1f-b380-4bf6-8d1f-9f5e75913e39",
        "authorId" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "body" : "yes, it is simple to understand and since we make each request once the impact is essentially zero.\n",
        "createdAt" : "2016-04-13T23:52:55Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "tags" : [
        ]
      }
    ],
    "commit" : "7605ff038062582ed6394b28a6689f8aa150e988",
    "line" : 106,
    "diffHunk" : "@@ -1,1 +104,108 @@    with LOCK:\n      if uri not in _global_cache:\n        r2, ok = proxy_request(uri)\n        if not ok:\n          logger.warn('Request failed: %s %s' % (uri, r2))"
  },
  {
    "id" : "3c311296-14c0-47a8-a6c3-1dbff9d03bcf",
    "prId" : 24131,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "111edef0-131d-4244-9324-2237410ddcb5",
        "parentId" : null,
        "authorId" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "body" : "does this only support one request at a time?\n",
        "createdAt" : "2016-04-13T23:45:39Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "719d0e19-fcef-4b47-afac-404318b9514f",
        "tags" : [
        ]
      },
      {
        "id" : "4a1d29e6-8042-4319-bdb2-bda35f14579d",
        "parentId" : "111edef0-131d-4244-9324-2237410ddcb5",
        "authorId" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "body" : "no, see http://flask.pocoo.org/docs/0.10/quickstart/#accessing-request-data\n",
        "createdAt" : "2016-04-13T23:51:40Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "tags" : [
        ]
      }
    ],
    "commit" : "7605ff038062582ed6394b28a6689f8aa150e988",
    "line" : 117,
    "diffHunk" : "@@ -1,1 +115,119 @@  \"\"\"Proxy a request to uri using a connection to 169.254.169.254.\"\"\"\n  logger.info('GET: %s' % uri)\n  headers = dict(flask.request.headers)\n  headers['Host'] = 'metadata.google.internal'\n  resp = SESSION.get("
  },
  {
    "id" : "c46d8a99-68c9-4a08-9c5e-515156e5e807",
    "prId" : 24131,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d533e1b3-6d65-45db-93a5-120e25ec5627",
        "parentId" : null,
        "authorId" : "c532215f-ed76-4a19-b066-8676d269eaf1",
        "body" : "Why check this outside the lock if we're just going to recheck once we lock?\n",
        "createdAt" : "2016-04-20T19:00:15Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "c532215f-ed76-4a19-b066-8676d269eaf1",
        "tags" : [
        ]
      },
      {
        "id" : "4ea367d5-84c7-490a-be00-27665227b215",
        "parentId" : "d533e1b3-6d65-45db-93a5-120e25ec5627",
        "authorId" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "body" : "If it is already in the cache I don't want to bother waiting to acquire the lock.\n\nSee double-checked locking: https://en.wikipedia.org/wiki/Double-checked_locking\n",
        "createdAt" : "2016-04-20T19:04:38Z",
        "updatedAt" : "2016-04-26T06:15:37Z",
        "lastEditedBy" : "185604f6-2915-4313-8d6b-1d55757d0d22",
        "tags" : [
        ]
      }
    ],
    "commit" : "7605ff038062582ed6394b28a6689f8aa150e988",
    "line" : 103,
    "diffHunk" : "@@ -1,1 +101,105 @@\ndef cache_request(uri):\n  if uri not in _global_cache:\n    with LOCK:\n      if uri not in _global_cache:"
  }
]