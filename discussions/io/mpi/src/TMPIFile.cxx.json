[
  {
    "id" : "7cb73ec2-323b-4a30-a3fc-7597b247c5f0",
    "prId" : 4375,
    "prUrl" : "https://github.com/root-project/root/pull/4375#pullrequestreview-306760480",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0dd4e606-dd70-481a-98d7-628669addda2",
        "parentId" : null,
        "authorId" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "body" : "This means that above you may be allocating a buf with zero elements, which seems wasteful.",
        "createdAt" : "2019-10-17T06:53:52Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "tags" : [
        ]
      },
      {
        "id" : "9a3dd6d2-6bba-4701-8f48-e4da655a8305",
        "parentId" : "0dd4e606-dd70-481a-98d7-628669addda2",
        "authorId" : "14b013ba-c8cd-46b1-b15c-8ea1491eb637",
        "body" : "This empty MPI message signals the end of the worker. It is necessary for the sense that the collector cannot close before all workers reach their ends. So we have a counter on the collector side that counts how many workers finished their work. Thus every time the collector \"gets\" an empty message, it will firstly update the counter and then receive this message. Make sense?",
        "createdAt" : "2019-10-23T23:46:50Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "14b013ba-c8cd-46b1-b15c-8ea1491eb637",
        "tags" : [
        ]
      },
      {
        "id" : "22951832-a9a5-466f-b94e-028d0fe5a11f",
        "parentId" : "0dd4e606-dd70-481a-98d7-628669addda2",
        "authorId" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "body" : "That does not answer my question. When `number_bytes == 0`, you allocate `buf` with a size of `0`, which you could avoid by moving that inside the if statement on the `else` part, where `number_bytes > 0`.",
        "createdAt" : "2019-10-24T12:05:23Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "tags" : [
        ]
      },
      {
        "id" : "bccac081-f8d8-4ab5-8356-c80c60000e6e",
        "parentId" : "0dd4e606-dd70-481a-98d7-628669addda2",
        "authorId" : "14b013ba-c8cd-46b1-b15c-8ea1491eb637",
        "body" : "I updated this part by using std::vector so the data allocation overhead you mentioned should be trivial right now. The reason that we still need this empty buffer is we do MPI_Recv in either cases. Without the empty buffer, mpi-receive will return a seg fault.",
        "createdAt" : "2019-10-24T17:58:23Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "14b013ba-c8cd-46b1-b15c-8ea1491eb637",
        "tags" : [
        ]
      }
    ],
    "commit" : "8bfad4c128ae9646e889890d43dd3fd3d9dd219a",
    "line" : 151,
    "diffHunk" : "@@ -1,1 +149,153 @@\n      // empty message signifies a Worker exited\n      if (number_bytes == 0) {\n         this->UpdateEndProcess();\n      } else {"
  },
  {
    "id" : "efdc4064-d7bd-4325-aebe-5fd71255c297",
    "prId" : 4375,
    "prUrl" : "https://github.com/root-project/root/pull/4375#pullrequestreview-303027790",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b6ebc8c4-e1af-4bf8-8f1c-e1a416f661a9",
        "parentId" : null,
        "authorId" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "body" : "Isn't `fSendBuf` going to leak if `sent` is `false`?",
        "createdAt" : "2019-10-17T07:12:36Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "a66b5f61-1206-4ddd-b280-befb0005276f",
        "tags" : [
        ]
      }
    ],
    "commit" : "8bfad4c128ae9646e889890d43dd3fd3d9dd219a",
    "line" : 420,
    "diffHunk" : "@@ -1,1 +418,422 @@   if (!IsReceived()) {\n      MPI_Wait(&fMPIRequest, MPI_STATUS_IGNORE);\n   }\n   delete[] fSendBuf; // empty the buffer once received by master\n   fSendBuf = nullptr;"
  },
  {
    "id" : "1fc9dccd-6689-4743-848d-a2cd090121d8",
    "prId" : 4375,
    "prUrl" : "https://github.com/root-project/root/pull/4375#pullrequestreview-325403366",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "42c1794d-6840-4d4d-be75-7a68875a256d",
        "parentId" : null,
        "authorId" : "335eabbd-4b70-43fb-a046-bf82995f5dd3",
        "body" : "Since this probably indicate a user error, shouldn't it 'return' rather than continue the function?",
        "createdAt" : "2019-12-02T17:23:09Z",
        "updatedAt" : "2019-12-11T22:45:18Z",
        "lastEditedBy" : "335eabbd-4b70-43fb-a046-bf82995f5dd3",
        "tags" : [
        ]
      }
    ],
    "commit" : "8bfad4c128ae9646e889890d43dd3fd3d9dd219a",
    "line" : 398,
    "diffHunk" : "@@ -1,1 +396,400 @@{\n   if (this->IsCollector()) {\n      Error(\"CreateBufferAndSend\", \" should not be called by a collector\");\n      return;\n   }"
  }
]