[
  {
    "id" : "97f301b8-7290-47d9-8a5a-4811ca8bf688",
    "prId" : 9593,
    "prUrl" : "https://github.com/apache/airflow/pull/9593#pullrequestreview-459861493",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "74d6cfcd-7889-4290-953a-ba3bc1e3b2ef",
        "parentId" : null,
        "authorId" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "body" : "if cluster is in creating state should you block til it reaches running?",
        "createdAt" : "2020-07-10T00:01:47Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "tags" : [
        ]
      },
      {
        "id" : "7cf626fa-d763-491e-9dcf-afa9721b2559",
        "parentId" : "74d6cfcd-7889-4290-953a-ba3bc1e3b2ef",
        "authorId" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "body" : "If cluster already exists (I assume this is checked by cluster id / name) then you should assert that it matches the any configuration explicitly specified in this operator by the user (e.g. a cluster could exist with this ID but have different dataproc version / missing init actions / etc.) you would not want to consider this a successful run of this operator as it did not meet it's contract of creating a cluster with explicit XYZ config provided by the user.\r\n\r\nIMO this should result in a task failure as it is not clear what the operator should do in this scenario? delete the existing cluster? add a uuid suffix to avoid the name clash and create a new cluster?",
        "createdAt" : "2020-07-10T00:06:49Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "tags" : [
        ]
      },
      {
        "id" : "8ba9dda5-afdd-4364-a71f-3956b9aadbae",
        "parentId" : "74d6cfcd-7889-4290-953a-ba3bc1e3b2ef",
        "authorId" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "body" : "@jaketf is there any bulletproof, simple way to compare cluster configuration? Comparing dicts doesn't sound like a way to go because created cluster includes more information than the user provided config",
        "createdAt" : "2020-07-27T09:25:18Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "tags" : [
        ]
      },
      {
        "id" : "0f1adbfc-a79a-444b-8ca4-03aeeb50e90b",
        "parentId" : "74d6cfcd-7889-4290-953a-ba3bc1e3b2ef",
        "authorId" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "body" : "I think you'd just compare the keys of the dict that were specified by the user.\r\nThis might be easier said than done.",
        "createdAt" : "2020-07-29T23:17:10Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "tags" : [
        ]
      },
      {
        "id" : "14f318ec-060d-4a57-afb7-bd30b6e3e843",
        "parentId" : "74d6cfcd-7889-4290-953a-ba3bc1e3b2ef",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Yeah. See my \"terraform\" comment above. I think we are pretty good with manual deletion of the cluster in case we want to change configuration, I don't think we should handle all potential complexity of computing difference between expected/actual cluster configuration.",
        "createdAt" : "2020-08-03T09:01:54Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "09d1ff8337d5443aee0e4c397369013a81bda130",
    "line" : 199,
    "diffHunk" : "@@ -1,1 +611,615 @@                raise\n            self.log.info(\"Cluster already exists.\")\n            cluster = self._get_cluster(hook)\n\n        # Check if cluster is not in ERROR state"
  },
  {
    "id" : "7afd2763-221f-4173-afa7-f2fdf8abc1cb",
    "prId" : 9593,
    "prUrl" : "https://github.com/apache/airflow/pull/9593#pullrequestreview-459861493",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6b943844-3159-4fd4-903c-943790c343ba",
        "parentId" : null,
        "authorId" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "body" : "should there be a similar configurable parameter like \"delete_on_configuration_mismatch\" that defaults to False?",
        "createdAt" : "2020-07-10T00:27:06Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "c6742e4c-543e-4eea-b495-c6ec28597226",
        "tags" : [
        ]
      },
      {
        "id" : "86931081-528c-4671-854a-54ad5e54d56d",
        "parentId" : "6b943844-3159-4fd4-903c-943790c343ba",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "I think this case will be difficult to handle in all cases correctly. You will not always need to create a new cluster when the configuration is different eg. additional components installed do not affect the usability of the cluster.",
        "createdAt" : "2020-07-29T10:19:56Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "11b2a3ac-f660-4f57-87c1-22bf129202dc",
        "parentId" : "6b943844-3159-4fd4-903c-943790c343ba",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I think this is not really something that should be handled by the operator itself. I'd argue that if you really want to change configuration of cluster you can simply delete it manually and let it be re-created. I think working in a \"terraformy\" or \"kubectly\" \"apply\" fashion in this case should be left to terraform. I.e. if you really want to use this kind of approach, why not write a terraform script and run terraform.\r\n\r\nBTW. Offtop - but should not we think about adding a Terraform/Terragrunt operator to Airflow ? I'd say it might be a good idea to have such an operator with some pre-defined ways on how to get terraform/terragrunt scripts in and how to integrate with airflow's JINJA templating. ",
        "createdAt" : "2020-08-03T08:58:58Z",
        "updatedAt" : "2020-08-05T09:26:40Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "09d1ff8337d5443aee0e4c397369013a81bda130",
    "line" : 34,
    "diffHunk" : "@@ -1,1 +444,448 @@    :parm delete_on_error: If true the cluster will be deleted if created with ERROR state. Default\n        value is true.\n    :type delete_on_error: bool\n    :parm use_if_exists: If true use existing cluster\n    :type use_if_exists: bool"
  }
]