[
  {
    "id" : "934d700e-9bb1-468c-bd4d-d19022b762d0",
    "prId" : 8877,
    "prUrl" : "https://github.com/apache/airflow/pull/8877#pullrequestreview-428163250",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "30cbe161-c0cc-48ec-b59d-d20cf19243f0",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Why are we relying on env vars, rather Airflow Variables+templates? `{{ var.s3_key}}`",
        "createdAt" : "2020-05-16T17:47:55Z",
        "updatedAt" : "2020-06-09T13:13:30Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "ee514afc-fcee-414c-9a17-b407eb7de18b",
        "parentId" : "30cbe161-c0cc-48ec-b59d-d20cf19243f0",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "We have this in all of our system tests. So that we can easily pass them to the example dags. See https://github.com/apache/airflow/blob/master/TESTING.rst#environment-for-system-tests",
        "createdAt" : "2020-05-16T18:52:04Z",
        "updatedAt" : "2020-06-09T13:13:30Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "32cb7722-9480-49c8-87d8-a83607694d99",
        "parentId" : "30cbe161-c0cc-48ec-b59d-d20cf19243f0",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "I think it makes sense to switch to Airflow Variables+templates like Ash said and set them via env variables: https://airflow.apache.org/docs/stable/concepts.html?highlight=xcom#storing-variables-in-environment-variables. \r\n\r\nSo we only need to prefix all env vars with `AIRFLOW_VAR`.\r\nFor example: set `AIRFLOW_VAR_S3_KEY=key` in `variables.env` and access them via `{{ var.s3_key}}` here. WDYT @potiuk @turbaszek ?",
        "createdAt" : "2020-06-06T07:42:38Z",
        "updatedAt" : "2020-06-09T13:13:30Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "83640d12-9e27-48c5-8ede-5f76d67aa486",
        "parentId" : "30cbe161-c0cc-48ec-b59d-d20cf19243f0",
        "authorId" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "body" : "But how do we then define defaults in case these `var.`s are not set? Or should we make all vars required then?",
        "createdAt" : "2020-06-09T11:07:47Z",
        "updatedAt" : "2020-06-09T13:13:30Z",
        "lastEditedBy" : "e29ffafb-ac51-434b-b9e0-af262caae1ee",
        "tags" : [
        ]
      },
      {
        "id" : "b5511edf-2381-48aa-8e56-e73ae326cda1",
        "parentId" : "30cbe161-c0cc-48ec-b59d-d20cf19243f0",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I think this is fine and when we automate it, we should define files where we define ENV variables.\r\n\r\nUsing  Airflow Variables in example DAGs is a very bad idea. People use it as  - well - examples - and using airflow Variables in DAGs in this way is very bad from Database load point of view. Until we avoid parsing the DAGs by all entities frequently we should not use variables in this way (we even have best practice about it)  - basically every time the DAG is parsed, DB communication occurs and the extra connection is made - that is quite bad for scalability and not obvious at all, so if people take that literally as examples (which they did in the past) they will implement bad practices.",
        "createdAt" : "2020-06-10T15:18:18Z",
        "updatedAt" : "2020-06-10T15:19:43Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "3c93c08d416b13eac22f00f9f2cd9860b79fe511",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +31,35 @@# [START howto_operator_s3_to_redshift_env_variables]\nS3_BUCKET = getenv(\"S3_BUCKET\")\nS3_KEY = getenv(\"S3_KEY\", \"key\")\nREDSHIFT_TABLE = getenv(\"REDSHIFT_TABLE\", \"test_table\")\n# [END howto_operator_s3_to_redshift_env_variables]"
  }
]