[
  {
    "id" : "6cc64bd6-3b95-4dc4-ae79-1b1b9aa0b59d",
    "prId" : 8974,
    "prUrl" : "https://github.com/apache/airflow/pull/8974#pullrequestreview-423809159",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "757627d5-9cb0-4b85-929c-a2706553eefb",
        "parentId" : null,
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "This would error if we don't have `kv_engine_version` in `extra_dejson` unless we set the default in `VaultHook`",
        "createdAt" : "2020-06-03T12:08:34Z",
        "updatedAt" : "2020-06-17T16:13:45Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      },
      {
        "id" : "8b3b9a3e-eacd-4c2d-bb7d-5ab96ad2fce6",
        "parentId" : "757627d5-9cb0-4b85-929c-a2706553eefb",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Not really. Why ? dejson.get() returns None in this case and we have if conn_version one line below.\r\n```kv_engine_version = int(conn_version) if conn_version else DEFAULT_KV_ENGINE_VERSION``` . I think it is sound :).",
        "createdAt" : "2020-06-03T18:07:19Z",
        "updatedAt" : "2020-06-17T16:13:45Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "e1f0a8a5-0db5-4b5e-a83d-60dccdc92624",
        "parentId" : "757627d5-9cb0-4b85-929c-a2706553eefb",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I see. It was the copy&pasted description in pydoc. Fixed in the pydoc.",
        "createdAt" : "2020-06-03T18:12:09Z",
        "updatedAt" : "2020-06-17T16:13:45Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "522f0aeb83f78c934b6f79c367a7e1e9cdbe00bc",
    "line" : 88,
    "diffHunk" : "@@ -1,1 +132,136 @@\n        if not kv_engine_version:\n            conn_version = self.connection.extra_dejson.get(\"kv_engine_version\")\n            try:\n                kv_engine_version = int(conn_version) if conn_version else DEFAULT_KV_ENGINE_VERSION"
  },
  {
    "id" : "5f94529f-f34e-4cd9-9b75-827f23da571d",
    "prId" : 8974,
    "prUrl" : "https://github.com/apache/airflow/pull/8974#pullrequestreview-423809888",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a1fb2501-756b-414e-b3b3-25845bec8024",
        "parentId" : null,
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "```suggestion\r\n        kv_engine_version: Optional[int] = DEFAULT_KV_ENGINE_VERSION,\r\n```\r\n\r\nBased on comment on L122 ",
        "createdAt" : "2020-06-03T12:09:12Z",
        "updatedAt" : "2020-06-17T16:13:45Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      },
      {
        "id" : "d228db91-3dd6-4fca-b103-35e43846f564",
        "parentId" : "a1fb2501-756b-414e-b3b3-25845bec8024",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "I fixed the description. It was misleading indeed:\r\n\r\n* Hook's constructor kv_engine_version overrides whatever we have in connection. If we set anything there - so be it.\r\n* If we did not set anything in the connection (or set it to None) we check the connection one and use what we find there. If there is nothing in the connection we default to 2. \r\n\r\nWe cannot have default in the constructor otherwise we would not be able to distinguish \"not set\" from \"set to 2\".\r\n\r\n\r\n",
        "createdAt" : "2020-06-03T18:13:08Z",
        "updatedAt" : "2020-06-17T16:13:45Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "522f0aeb83f78c934b6f79c367a7e1e9cdbe00bc",
    "line" : 67,
    "diffHunk" : "@@ -1,1 +111,115 @@        auth_type: Optional[str] = None,\n        auth_mount_point: Optional[str] = None,\n        kv_engine_version: Optional[int] = None,\n        role_id: Optional[str] = None,\n        kubernetes_role: Optional[str] = None,"
  },
  {
    "id" : "3cb29e5c-0c4d-4efd-b563-0e0410e4f04a",
    "prId" : 9333,
    "prUrl" : "https://github.com/apache/airflow/pull/9333#pullrequestreview-432318527",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "269be8bb-df44-4815-8bfc-fff3c1ec1deb",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Why do we pass `gcp_key_path, gcp_scopes` in to this function (same for kube below) -- aren't they guaranteed to only ever by None as they are local variables that are assigned a value based on the return",
        "createdAt" : "2020-06-17T09:45:27Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "b5046787-e756-4625-8788-39742731991e",
        "parentId" : "269be8bb-df44-4815-8bfc-fff3c1ec1deb",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Nope. They are parameters of constructor. Can be overridden.",
        "createdAt" : "2020-06-17T10:06:51Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "78ae0026-e7d3-4d3d-8c68-1c44c67ef529",
        "parentId" : "269be8bb-df44-4815-8bfc-fff3c1ec1deb",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Do we need/want them to be in extra and constructor args? (i.e. what workload are we supporting on the hook where we want to pull _some_ fields from a connection but others from constructor args?)",
        "createdAt" : "2020-06-17T10:59:09Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "42af84a9-f679-4b51-8521-86a8cbf4c3f7",
        "parentId" : "269be8bb-df44-4815-8bfc-fff3c1ec1deb",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "We do not need to. But if found it useful to be able to override some of the parameters - especially that this gives indication of what extras you can provide in the vault connection:\r\n\r\n```\r\n    The extras in the connection are named the same as the parameters (`mount_point`,'kv_engine_version' ...).\r\n```\r\n\r\nSince this is not basic authentication information (host/user/password/port which are part of the connection) but they are put in the extras. My assumption was that any \"extra\" can be also added as initialisation parameter. I looked at other hooks and we do it differently in different hooks, but often when there are \"extras\", you can set those extras  in the hook init param (also because setting extras via connection is not straightforward if you do not add your own connection type (and then it's not backportable). So this is mostly convenience also useful when you start playing with the hook and would like to try it before having to put them in connection extras.\r\n\r\nBut I have no strong opinion here. \r\n\r\nI am fine to remove those if you think it's not good. Particularly in the next PR i will definitely remove keyfile_dict (as it contains secret information that should not be put as parameter). But gcp_key_path and gcp_scopes fall IMHO into  the same category as all other extras (kubernetes_role, kv_engine_version etc.) so we either keep them all (mostly for  convenience) or remove them all. \r\n\r\nI am fine with both -  if you have strong opinion I am happy to follow it.\r\n",
        "createdAt" : "2020-06-17T11:44:40Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "de15de0a0fe332a5303dda34977ec1a32ee82dcb",
    "line" : 118,
    "diffHunk" : "@@ -1,1 +116,120 @@\n        gcp_key_path, gcp_scopes = \\\n            self._get_gcp_parameters_from_connection(gcp_key_path, gcp_scopes) \\\n            if auth_type == 'gcp' else (None, None)\n        kubernetes_jwt_path, kubernetes_role = \\"
  },
  {
    "id" : "aa24bc69-0e37-4667-9258-3855276a24a1",
    "prId" : 9333,
    "prUrl" : "https://github.com/apache/airflow/pull/9333#pullrequestreview-432282370",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "115c1f36-7ce0-490b-83c5-623aa55ee076",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "```suggestion\r\n            secret_id=self.secret_id,\r\n```\r\n\r\nI think?",
        "createdAt" : "2020-06-17T09:46:50Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "e38fcc7b-4d8e-4319-b51b-d3d636d158b0",
        "parentId" : "115c1f36-7ce0-490b-83c5-623aa55ee076",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "In the hook I mapped secret_id from the password (this is only used in approle method). it makes more sense to use password from the connection - mostly because it is replaced with *********  in the UI, so storing that in extras as \"secret_id\" is not a good idea I think.\r\n\r\nThis is explained in the Hook's docstring\r\n```\r\n    Login/Password are used as credentials:\r\n\r\n        * approle: password -> secret_id\r\n        * ldap: login -> username,   password -> password\r\n        * userpass: login -> username, password -> password\r\n\r\n```",
        "createdAt" : "2020-06-17T10:11:15Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "797b4628-8dde-43d6-afd2-fc0de7346dbf",
        "parentId" : "115c1f36-7ce0-490b-83c5-623aa55ee076",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Ah gotcha. :+1: ",
        "createdAt" : "2020-06-17T10:49:47Z",
        "updatedAt" : "2020-06-17T14:55:56Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      }
    ],
    "commit" : "de15de0a0fe332a5303dda34977ec1a32ee82dcb",
    "line" : 150,
    "diffHunk" : "@@ -1,1 +148,152 @@            username=self.connection.login,\n            password=self.connection.password,\n            secret_id=self.connection.password,\n            role_id=role_id,\n            kubernetes_role=kubernetes_role,"
  }
]