[
  {
    "id" : "615e82ca-7093-40ee-8b23-b42be9f6cc62",
    "prId" : 14492,
    "prUrl" : "https://github.com/apache/airflow/pull/14492#pullrequestreview-600312307",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6891f23a-cd50-4854-890b-626482453b53",
        "parentId" : null,
        "authorId" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "body" : "@turbaszek created the `api_version` this way. Users can inform from the **AirbyteOperator** the version they like to use.",
        "createdAt" : "2021-02-28T22:20:14Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3067e16a792e304e34905a9d60e0c633bba8900",
    "line" : 106,
    "diffHunk" : "@@ -1,1 +104,108 @@        \"\"\"\n        return self.run(\n            endpoint=f\"api/{self.api_version}/jobs/get\",\n            json={\"id\": job_id},\n            headers={\"accept\": \"application/json\"},"
  },
  {
    "id" : "1f046b37-e19d-43cd-a02b-2de7a896964b",
    "prId" : 14492,
    "prUrl" : "https://github.com/apache/airflow/pull/14492#pullrequestreview-605364260",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "parentId" : null,
        "authorId" : "a1587925-b1c0-4469-a592-51497b162e71",
        "body" : "one thing that sticks out about this is, how do you know it's an error that should be a retry?\r\n\r\nfor example what if the requested job_id doesn't exist?\r\n\r\nmaybe that's just what you have to accept when using the httphook?\r\n\r\nthere is actually a `run_with_advanced_retry` which might be better and give you finer grain if desired.  but i don't think that needs to block this from being merged if you want to leave it \r\n\r\nperhaps @turbaszek has a thought here?\r\n\r\n",
        "createdAt" : "2021-03-04T19:21:33Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "a1587925-b1c0-4469-a592-51497b162e71",
        "tags" : [
        ]
      },
      {
        "id" : "32c8eb96-efdf-4114-9f13-371620ab9cd1",
        "parentId" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "authorId" : "a1587925-b1c0-4469-a592-51497b162e71",
        "body" : "yeah i mean looking at it more closely...\r\n\r\none thing is i'd put `continue` after logging retry.  for one this would signal more strongly what it's doing.  but additionally you don't need to proceed within this loop in a retry scenario --- you  need to try again.\r\n\r\nbut also, if the service is down or inaccessible do you want to keep trying for the full timeout duration? maybe better to limit retries to a given number with a stated retry interval that might not equal the job poke loop interval",
        "createdAt" : "2021-03-04T19:36:42Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "a1587925-b1c0-4469-a592-51497b162e71",
        "tags" : [
        ]
      },
      {
        "id" : "a88186fb-822c-46af-ae81-1f1d17b7ff80",
        "parentId" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "authorId" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "body" : "The `get_job` function calls the run then check_response from HttpHook. This function already manages responses different from 2XX or 3XX. Maybe this try/exception could be removed.\r\nhttps://github.com/apache/airflow/blob/9f37af25ae7eb85fa8dbb70b7dbb23bbd5505323/airflow/providers/http/hooks/http.py#L143-L156",
        "createdAt" : "2021-03-04T21:00:07Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "tags" : [
        ]
      },
      {
        "id" : "b72ba2c1-ce9c-4362-8466-e256ce7c7a5e",
        "parentId" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "authorId" : "a1587925-b1c0-4469-a592-51497b162e71",
        "body" : "if you want to leave it i'm good with it but i would suggest you add `continue` after retry scenario is encountered because there's no reason to finish the loop at that point",
        "createdAt" : "2021-03-04T22:01:45Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "a1587925-b1c0-4469-a592-51497b162e71",
        "tags" : [
        ]
      },
      {
        "id" : "d483c133-90e2-430c-9441-1df1560b9daa",
        "parentId" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "authorId" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "body" : "I kept the exception and add a `continue`",
        "createdAt" : "2021-03-05T09:34:51Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "4d061aeb-df1b-4501-924c-d89529aaeed0",
        "tags" : [
        ]
      },
      {
        "id" : "9cd687f6-5bd0-4e74-84bb-1f5d9ba3da00",
        "parentId" : "76b5750e-ae60-4411-9a9c-d660b984c977",
        "authorId" : "a1587925-b1c0-4469-a592-51497b162e71",
        "body" : "sorry the continue was actually a bad suggestion.  in my mind this bit was inside the loop after your retry check\r\n```python\r\n\r\n        if state == self.ERROR:\r\n            raise AirflowException(f\"Job failed:\\n{job}\")\r\n        if state == self.CANCELLED:\r\n            raise AirflowException(f\"Job was cancelled:\\n{job}\")\r\n```\r\nbut my view of the indents was obscured by all the comments.\r\n\r\nthere's no point in using continue when it's already the end of the loop... ",
        "createdAt" : "2021-03-05T15:55:42Z",
        "updatedAt" : "2021-03-06T02:14:05Z",
        "lastEditedBy" : "a1587925-b1c0-4469-a592-51497b162e71",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3067e16a792e304e34905a9d60e0c633bba8900",
    "line" : 71,
    "diffHunk" : "@@ -1,1 +69,73 @@                state = job.json()[\"job\"][\"status\"]\n            except AirflowException as err:\n                self.log.info(\"Retrying. Airbyte API returned server error when waiting for job: %s\", err)\n                continue\n"
  }
]