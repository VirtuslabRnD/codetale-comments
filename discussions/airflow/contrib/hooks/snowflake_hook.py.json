[
  {
    "id" : "c812fa3c-d6fd-43f7-80b5-1a65b155fda6",
    "prId" : 4721,
    "prUrl" : "https://github.com/apache/airflow/pull/4721#pullrequestreview-204529463",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ac51d115-12be-4e55-9bf6-4a3b50470e0c",
        "parentId" : null,
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "`role` here is an **optional** config.\r\n\r\nBut users will encounter `KeyError` if they don't explicitly specify `role`, due to this line.",
        "createdAt" : "2019-02-16T13:52:57Z",
        "updatedAt" : "2019-02-16T13:53:35Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      },
      {
        "id" : "2f4571ae-787d-488b-ab8c-e6e1cd6ab516",
        "parentId" : "ac51d115-12be-4e55-9bf6-4a3b50470e0c",
        "authorId" : "8c680a1a-3743-44ea-9ab0-a9f70d8fd124",
        "body" : "@XD-DENG in L65\r\n```python\r\n\"role\": self.role or role or '',\r\n```\r\nso will not raise `KeyError` I think. but when `role=''` and L75 will be\r\n```python\r\n{schema}?warehouse={warehouse}&role=''\r\n```\r\nalso not make sense",
        "createdAt" : "2019-02-16T14:38:40Z",
        "updatedAt" : "2019-02-16T14:38:40Z",
        "lastEditedBy" : "8c680a1a-3743-44ea-9ab0-a9f70d8fd124",
        "tags" : [
        ]
      },
      {
        "id" : "3a51a7a9-71bb-41b3-9eb8-fd9ed823a811",
        "parentId" : "ac51d115-12be-4e55-9bf6-4a3b50470e0c",
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "Thanks @zhongjiajie . Yes, I overlooked L65.\r\nYour point is correct. Hence there is still an issue here.",
        "createdAt" : "2019-02-16T14:42:32Z",
        "updatedAt" : "2019-02-16T14:42:33Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      },
      {
        "id" : "577161e3-cb68-4b47-acac-fe0f3edba892",
        "parentId" : "ac51d115-12be-4e55-9bf6-4a3b50470e0c",
        "authorId" : "8c680a1a-3743-44ea-9ab0-a9f70d8fd124",
        "body" : "@XD-DENG you are welcome.",
        "createdAt" : "2019-02-16T15:01:32Z",
        "updatedAt" : "2019-02-16T15:01:32Z",
        "lastEditedBy" : "8c680a1a-3743-44ea-9ab0-a9f70d8fd124",
        "tags" : [
        ]
      },
      {
        "id" : "e4d69325-361d-48fe-b109-61a30fb31cc5",
        "parentId" : "ac51d115-12be-4e55-9bf6-4a3b50470e0c",
        "authorId" : "a1587925-b1c0-4469-a592-51497b162e71",
        "body" : "I tested the uri when role is not supplied. It does not hurt anything to have the empty role=. The same is true for warehouse.  So, warehouse is an already an optional parameter, and role has been added in the exact same way.  \r\n\r\nSo for example if the connecting user has default warehouse and role defined already in the server, and they use a uri containing `?warehouse=&role=` at its end, then they still connect with their default role and warehouse.  It is like calling a python function with param=None. \r\n\r\nIf this hadn't worked, I would have changed the code to only supply the role param when a meaningful value is supplied.\r\n\r\nIn hindsight, I should have addressed this in the PR description.  I'll try to amend it now.\r\n\r\nLastly, one way to make this cleaner would be to replace the format string with snowflake sqlalchemy URL function (`from snowflake.sqlalchemy import URL`).  This would be cleaner and more extensible.  But depends on snowflake sqlalchemy, and I'm not sure if that's already required for this contrib module or how to manage that dependency.\r\n\r\n@XD-DENG  please let me know if you have any recommendation or if this is resolved as far as your concerned.",
        "createdAt" : "2019-02-16T18:27:53Z",
        "updatedAt" : "2019-02-16T19:54:51Z",
        "lastEditedBy" : "a1587925-b1c0-4469-a592-51497b162e71",
        "tags" : [
        ]
      }
    ],
    "commit" : "d447a552eeee73f8e1cdfb0461bf0287afc5bc77",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +73,77 @@        conn_config = self._get_conn_params()\n        uri = 'snowflake://{user}:{password}@{account}/{database}/'\n        uri += '{schema}?warehouse={warehouse}&role={role}'\n        return uri.format(**conn_config)\n"
  }
]