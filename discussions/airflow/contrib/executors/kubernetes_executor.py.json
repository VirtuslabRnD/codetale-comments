[
  {
    "id" : "8ff429cf-14a5-4e62-8fec-a939a422ebc2",
    "prId" : 3683,
    "prUrl" : "https://github.com/apache/airflow/pull/3683#pullrequestreview-157878993",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "50b06bd6-cc0c-445b-865f-8e256e8178fb",
        "parentId" : null,
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "Can you change this name to \"dags_in_image\"?",
        "createdAt" : "2018-09-21T22:38:19Z",
        "updatedAt" : "2018-09-21T22:42:54Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      }
    ],
    "commit" : "9401914f2db78f73ea505dc0937186a7514336b2",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +131,135 @@        # NOTE: user can build the dags into the docker image directly,\n        # this will set to True if so\n        self.dags_in_docker = conf.get(self.kubernetes_section, 'dags_in_docker')\n\n        # NOTE: `git_repo` and `git_branch` must be specified together as a pair"
  },
  {
    "id" : "9acf9640-9c8b-4ccd-a258-8737094455a5",
    "prId" : 3683,
    "prUrl" : "https://github.com/apache/airflow/pull/3683#pullrequestreview-157913533",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d4ede3d7-2a5d-4592-8f84-df695fa42fc0",
        "parentId" : null,
        "authorId" : "c389b2c0-5345-4f3d-b699-84a63fbcd23e",
        "body" : "this would collide with the changes in https://github.com/apache/incubator-airflow/pull/3770/files#diff-b1d8d65aeaa7d031dfe5b197d6c5aa69L200",
        "createdAt" : "2018-09-22T15:46:15Z",
        "updatedAt" : "2018-09-22T15:56:00Z",
        "lastEditedBy" : "c389b2c0-5345-4f3d-b699-84a63fbcd23e",
        "tags" : [
        ]
      }
    ],
    "commit" : "9401914f2db78f73ea505dc0937186a7514336b2",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +201,205 @@    def _validate(self):\n        if not self.dags_volume_claim and not self.dags_in_docker \\\n                and (not self.git_repo or not self.git_branch):\n            raise AirflowConfigException(\n                'In kubernetes mode the following must be set in the `kubernetes` '"
  },
  {
    "id" : "c3b51243-7e5c-41b4-b116-742f3f13593e",
    "prId" : 3994,
    "prUrl" : "https://github.com/apache/airflow/pull/3994#pullrequestreview-180741757",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "parentId" : null,
        "authorId" : "7e897532-4496-445b-8061-6a267d33ee51",
        "body" : "Dict *labels* doesn't contain *try_number* key, as it's not set in *WorkerConfiguration* make_pod. That's the reason why pods are not deleted.\r\nhttps://github.com/apache/incubator-airflow/blob/v1-10-stable/airflow/contrib/kubernetes/worker_configuration.py#L197",
        "createdAt" : "2018-11-28T09:45:20Z",
        "updatedAt" : "2018-11-28T09:45:43Z",
        "lastEditedBy" : "7e897532-4496-445b-8061-6a267d33ee51",
        "tags" : [
        ]
      },
      {
        "id" : "6256a741-2123-4e44-8fca-1e0d48349c6f",
        "parentId" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "D'oh.\r\n\r\nWould someone (@vardancse? @aliaksandr-d?) be able to fix this, or at least add a test case that covers this?",
        "createdAt" : "2018-11-28T09:47:52Z",
        "updatedAt" : "2018-11-28T09:47:52Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "6a01301c-5f4b-4dc7-8746-c2a5778788bf",
        "parentId" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "authorId" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "body" : "@ashb I'm looking into it",
        "createdAt" : "2018-11-28T14:50:38Z",
        "updatedAt" : "2018-11-28T14:50:38Z",
        "lastEditedBy" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "tags" : [
        ]
      },
      {
        "id" : "097f29bc-3951-4027-a551-9705838dad62",
        "parentId" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "authorId" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "body" : "@aliaksandr-d @ashb Is there any bug logged for the same so that I can raise the PR for the same?",
        "createdAt" : "2018-11-28T14:54:07Z",
        "updatedAt" : "2018-11-28T14:54:08Z",
        "lastEditedBy" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "tags" : [
        ]
      },
      {
        "id" : "43dc544c-01d3-4417-8f69-852454f58b68",
        "parentId" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "authorId" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "body" : "@aliaksandr-d can you please apply the [patch](https://github.com/apache/incubator-airflow/compare/master...vardancse:k8s_pod?expand=1) and confirm the resolution? ",
        "createdAt" : "2018-11-28T17:24:01Z",
        "updatedAt" : "2018-11-28T17:24:01Z",
        "lastEditedBy" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "tags" : [
        ]
      },
      {
        "id" : "dc192570-e3af-471a-8372-dab831aaa76d",
        "parentId" : "7945c7eb-ac30-4e8e-898f-deeb53840a97",
        "authorId" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "body" : "@aliaksandr-d https://github.com/apache/incubator-airflow/pull/4163 already created for the same by @wyndhblb ",
        "createdAt" : "2018-12-03T12:29:21Z",
        "updatedAt" : "2018-12-03T12:29:21Z",
        "lastEditedBy" : "0c0a2937-4012-41eb-b4a4-4716de9ebc4a",
        "tags" : [
        ]
      }
    ],
    "commit" : "4eebf95e7ecd75dc476e0076dbf72245726dee5e",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +455,459 @@                labels['dag_id'], labels['task_id'],\n                self._label_safe_datestring_to_datetime(labels['execution_date']),\n                labels['try_number'])\n        except Exception as e:\n            self.log.warn("
  },
  {
    "id" : "cbb98692-fca0-4301-92df-086062b70cc8",
    "prId" : 4163,
    "prUrl" : "https://github.com/apache/airflow/pull/4163#pullrequestreview-183524864",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "013a3b3f-be74-4573-9f8b-f615607847b2",
        "parentId" : null,
        "authorId" : "924e2557-c1ec-4669-95fd-7c988bf7503a",
        "body" : "This is the only call to make_pod? If so, then good.",
        "createdAt" : "2018-12-10T16:13:33Z",
        "updatedAt" : "2019-01-14T17:16:41Z",
        "lastEditedBy" : "924e2557-c1ec-4669-95fd-7c988bf7503a",
        "tags" : [
        ]
      },
      {
        "id" : "cf649d77-846b-44a3-a12c-54d751b62cd6",
        "parentId" : "013a3b3f-be74-4573-9f8b-f615607847b2",
        "authorId" : "886e601a-5d6a-4ade-923a-d9f9ed2eae92",
        "body" : "yes, the only call to this worker_config object function",
        "createdAt" : "2018-12-11T06:25:15Z",
        "updatedAt" : "2019-01-14T17:16:41Z",
        "lastEditedBy" : "886e601a-5d6a-4ade-923a-d9f9ed2eae92",
        "tags" : [
        ]
      }
    ],
    "commit" : "46c34536412ce950eeeeca46af9d55bd04abf0ea",
    "line" : 2,
    "diffHunk" : "@@ -1,1 +384,388 @@        self.log.debug(\"Kubernetes launching image %s\", self.kube_config.kube_image)\n        pod = self.worker_configuration.make_pod(\n            namespace=self.namespace, worker_uuid=self.worker_uuid,\n            pod_id=self._create_pod_id(dag_id, task_id),\n            dag_id=dag_id, task_id=task_id, try_number=try_number,"
  },
  {
    "id" : "bb0bb40b-d20c-422d-b552-376aa651c614",
    "prId" : 4319,
    "prUrl" : "https://github.com/apache/airflow/pull/4319#pullrequestreview-184812571",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "17c17ee3-35e2-41d5-8ea7-6552215569ce",
        "parentId" : null,
        "authorId" : "a6fb790a-7d0f-4313-a80f-948c085aad53",
        "body" : "This _might_ be considered a breaking change.  It appears that `getboolean` throws an exception if the value is empty, so if someone does not update their config file to include `dags_in_image` their setup will break.\r\n\r\nLooking for suggestions on how best to work around this.",
        "createdAt" : "2018-12-13T18:47:18Z",
        "updatedAt" : "2018-12-13T19:35:10Z",
        "lastEditedBy" : "a6fb790a-7d0f-4313-a80f-948c085aad53",
        "tags" : [
        ]
      }
    ],
    "commit" : "86f4ecc5c06e68ac9255e5c2c4978e655bd23073",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +140,144 @@        # NOTE: user can build the dags into the docker image directly,\n        # this will set to True if so\n        self.dags_in_image = conf.getboolean(self.kubernetes_section, 'dags_in_image')\n\n        # NOTE: `git_repo` and `git_branch` must be specified together as a pair"
  },
  {
    "id" : "296ceb3a-5bac-4c90-8234-c5605d6654d7",
    "prId" : 4636,
    "prUrl" : "https://github.com/apache/airflow/pull/4636#pullrequestreview-213261997",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c51ae5cc-3eef-4a67-a5cd-59f25064843f",
        "parentId" : null,
        "authorId" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "body" : "so if I'm understanding this correctly this will prevent any collisions. So if I have \"my*favorite*dag\" and \"my^favorite^dag\", then one will be \"myfavoritdag<hash1>\" and the second will be  \"myfavoritedag<hash2>\". Is that correct?",
        "createdAt" : "2019-03-12T04:24:07Z",
        "updatedAt" : "2019-03-22T10:59:50Z",
        "lastEditedBy" : "b8b84983-5876-4ccf-886c-2449d94ca22f",
        "tags" : [
        ]
      },
      {
        "id" : "e80ab713-614b-4ced-9cea-6de720122111",
        "parentId" : "c51ae5cc-3eef-4a67-a5cd-59f25064843f",
        "authorId" : "416bd013-4846-48c5-8469-d9a524e19690",
        "body" : "Yes that is correct.  As the regex and formatting syntax on the kubernetes docs is quite precise, if we were to simply hash only if the modified labels were above 63 chars then there is a strong possibility that it could lead to collisions if the label length is less than 63 chars, and the unsupported chars that were removed being the only difference between the dags (as you've mentioned above).  This also covers accentuated characters if they are used in dag names too.\r\n\r\nTherefor, in your example, for your first dag \"_myfavoritedag_\" this would have the label value set as \"_myfavoritedag_\", whereas the second dag \"_my^favorite^dag_\" would be set as \"_myfavouritedag-99a5a18ff_\" due to the fact that it is modified compared to the original value.",
        "createdAt" : "2019-03-12T09:04:34Z",
        "updatedAt" : "2019-03-22T10:59:50Z",
        "lastEditedBy" : "416bd013-4846-48c5-8469-d9a524e19690",
        "tags" : [
        ]
      }
    ],
    "commit" : "fa7abdf7d0703cd35a0225539899704d4f79a7dd",
    "line" : 37,
    "diffHunk" : "@@ -1,1 +495,499 @@        MAX_LABEL_LEN = 63\n\n        safe_label = re.sub(r'^[^a-z0-9A-Z]*|[^a-zA-Z0-9_\\-\\.]|[^a-z0-9A-Z]*$', '', string)\n\n        if len(safe_label) > MAX_LABEL_LEN or string != safe_label:"
  },
  {
    "id" : "e81b7dbe-56c0-41be-a6e3-002cfe6c2832",
    "prId" : 4636,
    "prUrl" : "https://github.com/apache/airflow/pull/4636#pullrequestreview-217668830",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dd0cb293-63da-4fdc-9491-2552fd0fd94a",
        "parentId" : null,
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "`53chars` is a typo?",
        "createdAt" : "2019-03-22T01:32:14Z",
        "updatedAt" : "2019-03-22T10:59:50Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      },
      {
        "id" : "e4c2e5cc-50aa-4e54-a2ed-a5e5ffea6af2",
        "parentId" : "dd0cb293-63da-4fdc-9491-2552fd0fd94a",
        "authorId" : "416bd013-4846-48c5-8469-d9a524e19690",
        "body" : "No that's correct.  If we are hashing the string after it's been modified in any way, we need to truncate the result from `AirflowKubernetesScheduler._make_safe_label_value()` to a maximum of 53chars, as we are adding a 9 char has to the end.  If we were to truncate to 63chars, when the has is added, it would then make the string 73chars max length, which would be too long for the label value length limit.",
        "createdAt" : "2019-03-22T09:57:02Z",
        "updatedAt" : "2019-03-22T10:59:50Z",
        "lastEditedBy" : "416bd013-4846-48c5-8469-d9a524e19690",
        "tags" : [
        ]
      }
    ],
    "commit" : "fa7abdf7d0703cd35a0225539899704d4f79a7dd",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +491,495 @@        If the label value is then greater than 63 chars once made safe, or differs in any\n        way from the original value sent to this function, then we need to truncate to\n        53chars, and append it with a unique hash.\n        \"\"\"\n        MAX_LABEL_LEN = 63"
  },
  {
    "id" : "421a38a1-826e-4bfd-ada6-a17b37619a49",
    "prId" : 5060,
    "prUrl" : "https://github.com/apache/airflow/pull/5060#pullrequestreview-228988898",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "31eb2845-4e64-412e-a2f5-b404cc03f4a6",
        "parentId" : null,
        "authorId" : "5babf5f1-bba6-4c79-94d8-52d3280acc3a",
        "body" : "value for request timeout can be supplied as array(connect and read timeouts) , since json.loads converts arrays to list, we would need to change it to tuple -- to be used here- https://github.com/kubernetes-client/python/blob/7fb3a25176395da26007aec7b4c843aa03514c21/kubernetes/client/rest.py#L143",
        "createdAt" : "2019-04-22T08:01:42Z",
        "updatedAt" : "2019-04-22T09:57:51Z",
        "lastEditedBy" : "5babf5f1-bba6-4c79-94d8-52d3280acc3a",
        "tags" : [
        ]
      }
    ],
    "commit" : "a13ceb2bb3760c272c92e6f412e083fb45c66f36",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +256,260 @@        if kube_client_request_args:\n            self.kube_client_request_args = json.loads(kube_client_request_args)\n            if self.kube_client_request_args['_request_timeout'] and \\\n                    isinstance(self.kube_client_request_args['_request_timeout'], list):\n                self.kube_client_request_args['_request_timeout'] = \\"
  }
]