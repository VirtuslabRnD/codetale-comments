[
  {
    "id" : "dca814d9-cf36-4162-90d2-1b90af79648b",
    "prId" : 5349,
    "prUrl" : "https://github.com/apache/airflow/pull/5349#pullrequestreview-269248569",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "We'll have to do something here to set a value for any existing rows.\r\n\r\nEither set a DB-level default, or some other bulk update mechanism.",
        "createdAt" : "2019-06-14T09:47:44Z",
        "updatedAt" : "2019-06-20T06:44:19Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "4959c22a-e1f5-4504-b133-1fe1b762a04c",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "7fbede4f-85b0-4371-a620-3b1f92a91855",
        "body" : "Good catch. I think we might need to do bulk update here. For upgrade, we will need to change all the existing rows with `pool=None` to `pool='default_pool'` and vice versa for downgrade.",
        "createdAt" : "2019-06-15T05:18:44Z",
        "updatedAt" : "2019-06-20T06:44:19Z",
        "lastEditedBy" : "7fbede4f-85b0-4371-a620-3b1f92a91855",
        "tags" : [
        ]
      },
      {
        "id" : "a902b1bc-1aa0-4251-85fc-29b89c523529",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "7fbede4f-85b0-4371-a620-3b1f92a91855",
        "body" : "added.",
        "createdAt" : "2019-06-15T06:44:13Z",
        "updatedAt" : "2019-06-20T06:44:19Z",
        "lastEditedBy" : "7fbede4f-85b0-4371-a620-3b1f92a91855",
        "tags" : [
        ]
      },
      {
        "id" : "ed6a4cb5-f2bd-475a-b863-1bf445731c9c",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "For future reference (i.e. don't change it, it is fine as it is) : I think we can get away with just defining the PK and columns we want to alter, so\r\n\r\n```python\r\nclass TaskInstance(Base):\r\n    __tablename__ = \"task_instance\"\r\n\r\n    task_id = Column(String(ID_LEN), primary_key=True)\r\n    dag_id = Column(String(ID_LEN), primary_key=True)\r\n    execution_date = Column(UtcDateTime, primary_key=True)\r\n    pool = Column(String(50), nullable=False)\r\n```\r\n\r\nwould work. I _think_.",
        "createdAt" : "2019-06-19T08:57:03Z",
        "updatedAt" : "2019-06-20T06:44:19Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "0a5969af-2c6c-4301-a03c-099c82121bea",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "42c25af7-a2e3-4c8b-bdb8-7d6afc7ac236",
        "body" : "FYI, this will break on MSSQL which I known isn't supported atm. One would need to drop the index 'ti_pool', alter the column, and recreate the index.",
        "createdAt" : "2019-07-31T13:16:11Z",
        "updatedAt" : "2019-07-31T13:16:11Z",
        "lastEditedBy" : "42c25af7-a2e3-4c8b-bdb8-7d6afc7ac236",
        "tags" : [
        ]
      },
      {
        "id" : "3373294b-bf9f-43ea-aabc-76afd4b11763",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Doesn't that make that an expensive operation on MSSQL - needing to re-create the entire index?  (Not that there's an option but that seems expensive)",
        "createdAt" : "2019-07-31T13:25:39Z",
        "updatedAt" : "2019-07-31T13:25:39Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "aab93ae0-7127-4f24-9850-7b57ce8e9ecf",
        "parentId" : "25a8f015-7d3e-4624-b216-90cbb8d9a237",
        "authorId" : "42c25af7-a2e3-4c8b-bdb8-7d6afc7ac236",
        "body" : "You're right, there is no other way: https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-table-transact-sql?view=sql-server-2017. It's a costly thing, but whether it takes a long time or not depends on the size of the table and your hardware. We are using MSSQL as a backend for Airflow and rebuilding the indexes is the least of my concern :-)",
        "createdAt" : "2019-07-31T20:00:35Z",
        "updatedAt" : "2019-07-31T20:00:35Z",
        "lastEditedBy" : "42c25af7-a2e3-4c8b-bdb8-7d6afc7ac236",
        "tags" : [
        ]
      }
    ],
    "commit" : "4f4f24b8a4d43caa31ffb8251e8c26309ec2b459",
    "line" : 101,
    "diffHunk" : "@@ -1,1 +99,103 @@            column_name='pool',\n            type_=sa.String(50),\n            nullable=False,\n        )\n"
  }
]