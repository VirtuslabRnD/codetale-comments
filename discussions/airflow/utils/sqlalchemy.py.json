[
  {
    "id" : "3c40a130-5fed-498c-83df-c566e834eae2",
    "prId" : 3516,
    "prUrl" : "https://github.com/apache/airflow/pull/3516#pullrequestreview-129397684",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9786b77e-0d7b-4bce-9987-7ec58f1a0964",
        "parentId" : null,
        "authorId" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "body" : "This is debatable. Without FK enabled, for SQLite, the migration script `2e82aab8ef20_rename_user_table.py` doesn't change the FK of `chart` and `known_event` tables, they would continue to point to `user` table which no longer exists. Alembic then fails with `NoSuchTableError`.\r\n\r\nDrawback is that existing SQLite DBs are not fixed. My assumtion is that SQLite is not used in production environment and doesn't contain long-living data. If that assumption is wrong I can add an additional migration script that checks and fixes the wrong FK for SQLite.",
        "createdAt" : "2018-06-17T13:03:49Z",
        "updatedAt" : "2018-06-18T21:31:13Z",
        "lastEditedBy" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "tags" : [
        ]
      },
      {
        "id" : "fabb283b-66ba-451c-8f0e-9d058eef38da",
        "parentId" : "9786b77e-0d7b-4bce-9987-7ec58f1a0964",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "All the docs say \"don't use SQLite for production\", correct.\r\n\r\nWhat will this do with when people run it against a local SQLite DB? Will it migrate without problems?  We want the test/\"I'm playing with Airflow\" experience to be nice too.",
        "createdAt" : "2018-06-17T13:11:03Z",
        "updatedAt" : "2018-06-18T21:31:13Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "77fcbf85-fb20-4cc1-9520-3650abf3880c",
        "parentId" : "9786b77e-0d7b-4bce-9987-7ec58f1a0964",
        "authorId" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "body" : "I tested quickly, with master I created a user, a chart, and a known event. Then switched to this branch. Startup works, but with FK enabled it's no longer possible to create new known events or to edit links between user and event/chart. I'll try to create another migration script to fix it.",
        "createdAt" : "2018-06-17T13:44:33Z",
        "updatedAt" : "2018-06-18T21:31:13Z",
        "lastEditedBy" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "tags" : [
        ]
      },
      {
        "id" : "212702d6-bbe4-4184-b4dd-0a082a2f47b3",
        "parentId" : "9786b77e-0d7b-4bce-9987-7ec58f1a0964",
        "authorId" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "body" : "Done, see 856955da8476_fix_sqlite_foreign_key.py\r\nSame test, FK and data is now properly migrated.\r\nOne caveat: If the database already contains inconsistent data (I set an non-existing user_id) then migration will fail.",
        "createdAt" : "2018-06-17T18:50:43Z",
        "updatedAt" : "2018-06-18T21:31:13Z",
        "lastEditedBy" : "44a4606a-9224-404a-87fd-9a2417fd2610",
        "tags" : [
        ]
      }
    ],
    "commit" : "680651f0ae2a314f8e9882a6bc38f4fa3795cdbe",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +106,110 @@        if 'sqlite3.Connection' in str(type(dbapi_connection)):\n            cursor = dbapi_connection.cursor()\n            cursor.execute(\"PRAGMA foreign_keys=ON\")\n            cursor.close()\n"
  },
  {
    "id" : "ee781f1d-dc22-46c5-a3e5-18ffaced263f",
    "prId" : 7370,
    "prUrl" : "https://github.com/apache/airflow/pull/7370#pullrequestreview-356606130",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "55b75433-44b2-4840-9d13-e52d6ff4092c",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Not that it strictly matters here, but time.time can go backwards, so should be avoided for measuring elapsed time:\r\n\r\n```suggestion\r\n            conn.info.setdefault('query_start_time', []).append(time.monotonic())\r\n```\r\n\r\n> **time.monotonic() â†’ float**\r\n> Return the value (in fractional seconds) of a monotonic clock, i.e. a clock that cannot go backwards. The clock is not affected by system clock updates. The reference point of the returned value is undefined, so that only the difference between the results of consecutive calls is valid.\r\n>\r\n> New in version 3.3.\r\n>\r\n> Changed in version 3.5: The function is now always available and always system-wide.",
        "createdAt" : "2020-02-10T13:42:34Z",
        "updatedAt" : "2020-02-11T15:33:24Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "f1febe2d-abab-464d-a714-db4a897eb149",
        "parentId" : "55b75433-44b2-4840-9d13-e52d6ff4092c",
        "authorId" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "body" : "Oh, I haven't known that ðŸ‘Œ",
        "createdAt" : "2020-02-10T14:42:25Z",
        "updatedAt" : "2020-02-11T15:33:24Z",
        "lastEditedBy" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "tags" : [
        ]
      },
      {
        "id" : "e55045d1-3384-4bcc-b4e0-17cce2d97337",
        "parentId" : "55b75433-44b2-4840-9d13-e52d6ff4092c",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "This came up in my twitter feed a few days ago, so I happened to check if python had a similar one:\r\n\r\nhttps://github.com/rust-lang/rust/blob/b6690a8c35e9afa3e0f65140cc69d4ba1b9e78c4/src/libstd/time.rs#L205-L232",
        "createdAt" : "2020-02-11T12:09:29Z",
        "updatedAt" : "2020-02-11T15:33:24Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      }
    ],
    "commit" : "543a91a6388bc2aa134b8cd783bf44b6699c1711",
    "line" : 59,
    "diffHunk" : "@@ -1,1 +72,76 @@        @event.listens_for(engine, \"before_cursor_execute\")\n        def before_cursor_execute(conn, cursor, statement, parameters, context, executemany):\n            conn.info.setdefault('query_start_time', []).append(time.time())\n\n        @event.listens_for(engine, \"after_cursor_execute\")"
  }
]