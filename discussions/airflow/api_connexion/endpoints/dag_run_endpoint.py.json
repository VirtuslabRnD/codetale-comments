[
  {
    "id" : "20ea7125-836a-473f-803b-81c3820e887e",
    "prId" : 9556,
    "prUrl" : "https://github.com/apache/airflow/pull/9556#pullrequestreview-439389566",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8f4ed43e-3a46-47a8-9447-7ddf2fe36b8f",
        "parentId" : null,
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "```\r\nbody = request.get_json()\r\ntry:\r\n     data = list_dag_runs_form_schema.load(body)\r\nexcept ValidationError as err:\r\n     raise BadRequest(detail=err.messages)\r\n```",
        "createdAt" : "2020-06-29T18:13:44Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      },
      {
        "id" : "95c5e194-d481-4857-8f0e-53013370bf07",
        "parentId" : "8f4ed43e-3a46-47a8-9447-7ddf2fe36b8f",
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "Your schema should be like this:\r\n\r\n```\r\nclass ListDagRunsFormSchema(Schema):\r\n    \"\"\" Schema for ListDagRunsForm \"\"\"\r\n\r\n    class Meta:\r\n        \"\"\" Meta \"\"\"\r\n        dateformat = 'iso'\r\n\r\n    page_offset = fields.Int(min=0)\r\n    page_limit = fields.Int(min=1, max=100)\r\n    dag_ids = fields.List(fields.Str())\r\n    execution_date_gte = fields.DateTime()\r\n    execution_date_lte = fields.DateTime()\r\n    start_date_gte = fields.DateTime()\r\n    start_date_lte = fields.DateTime()\r\n    end_date_gte = fields.DateTime()\r\n    end_date_lte = fields.DateTime()\r\n```\r\nthen instantiate it as `list_dag_runs_form_schema = ListDagRunsFormSchema(strict=True)`",
        "createdAt" : "2020-06-29T18:16:12Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      },
      {
        "id" : "5bef6ff1-4b5d-4c15-a12d-3294b8c52b35",
        "parentId" : "8f4ed43e-3a46-47a8-9447-7ddf2fe36b8f",
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "You have to add the schema at dag_runs_schema.py",
        "createdAt" : "2020-06-29T18:17:37Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      }
    ],
    "commit" : "104746fac0b5b89c51dc15aa5146f10eb422566e",
    "line" : 89,
    "diffHunk" : "@@ -1,1 +131,135 @@    \"\"\"\n    Get list of DAG Runs\n    \"\"\"\n    body = request.get_json()\n    try:"
  },
  {
    "id" : "4e2c7004-28e1-4e89-88fa-5cfbd401454e",
    "prId" : 9556,
    "prUrl" : "https://github.com/apache/airflow/pull/9556#pullrequestreview-442600428",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bb6fa0d7-5873-4890-85a0-9eafca5bbb2f",
        "parentId" : null,
        "authorId" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "body" : "In `api_connexion/parameters.py` we have some hardcoded params like those. Should we extend the list and use them here instead of using strings?",
        "createdAt" : "2020-07-04T09:25:51Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "tags" : [
        ]
      },
      {
        "id" : "87efb3ba-5ed4-4dde-af4e-46d2d4fa386b",
        "parentId" : "bb6fa0d7-5873-4890-85a0-9eafca5bbb2f",
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "It no longer exists but can be added back.",
        "createdAt" : "2020-07-04T09:28:27Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      },
      {
        "id" : "71e7a1dd-e0bc-4677-a3cb-60cd7d8b585e",
        "parentId" : "bb6fa0d7-5873-4890-85a0-9eafca5bbb2f",
        "authorId" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "body" : "Oh indeed, I'm ok with not adding this back",
        "createdAt" : "2020-07-04T10:00:56Z",
        "updatedAt" : "2020-07-12T05:30:53Z",
        "lastEditedBy" : "0d4fd7c4-f8ab-4371-acfe-b9cca6decaf5",
        "tags" : [
        ]
      }
    ],
    "commit" : "104746fac0b5b89c51dc15aa5146f10eb422566e",
    "line" : 105,
    "diffHunk" : "@@ -1,1 +146,150 @@                                              data[\"execution_date_gte\"], data[\"execution_date_lte\"],\n                                              data[\"start_date_gte\"], data[\"start_date_lte\"],\n                                              data[\"page_limit\"], data[\"page_offset\"])\n\n    return dagrun_collection_schema.dump(DAGRunCollection(dag_runs=dag_runs,"
  },
  {
    "id" : "d75ce147-d73a-4157-9d82-023cf8f3101f",
    "prId" : 10267,
    "prUrl" : "https://github.com/apache/airflow/pull/10267#pullrequestreview-465820134",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bb9221bd-1431-4168-a9ab-9f77e7b92dda",
        "parentId" : null,
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Is it possible to detect automatically if we have an API call without @security.requires_authentication",
        "createdAt" : "2020-08-11T09:43:45Z",
        "updatedAt" : "2020-08-11T14:10:46Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "ae4af672-dc73-491b-baba-dce0dd6f2142",
        "parentId" : "bb9221bd-1431-4168-a9ab-9f77e7b92dda",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "Yes, We can configure it on a higher layer, but prefer to be explicit than implicit, because we have two views that do not require authorization - `/health` and `/version`. ",
        "createdAt" : "2020-08-11T14:16:17Z",
        "updatedAt" : "2020-08-11T14:16:17Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "76572f26-b686-4806-b3e6-896687f6499a",
        "parentId" : "bb9221bd-1431-4168-a9ab-9f77e7b92dda",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Perfect!\r\n",
        "createdAt" : "2020-08-11T14:57:27Z",
        "updatedAt" : "2020-08-11T14:57:27Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "95075d34-9ccb-46e3-9154-298dbbbcc345",
        "parentId" : "bb9221bd-1431-4168-a9ab-9f77e7b92dda",
        "authorId" : "00f2d683-1e14-4545-aec8-d448205f3465",
        "body" : "if no auth is the exception here (i.e. only /health and /version), wouldn't it be safer to make auth required the default, then turn off auth specifically for those two endpoints?",
        "createdAt" : "2020-08-11T21:24:22Z",
        "updatedAt" : "2020-08-11T21:24:22Z",
        "lastEditedBy" : "00f2d683-1e14-4545-aec8-d448205f3465",
        "tags" : [
        ]
      },
      {
        "id" : "0c96f326-7c46-4647-ba66-1bd35a70cfbd",
        "parentId" : "bb9221bd-1431-4168-a9ab-9f77e7b92dda",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "I was based on how the experimental API is realized, but I will prepare a patch that will update the stable and experimental API.",
        "createdAt" : "2020-08-12T11:23:55Z",
        "updatedAt" : "2020-08-12T11:23:56Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      }
    ],
    "commit" : "ec9c378d5ec5d52a6f9ee86bc6ff76fe16371bb9",
    "line" : 44,
    "diffHunk" : "@@ -1,1 +157,161 @@\n\n@security.requires_authentication\n@provide_session\ndef post_dag_run(dag_id, session):"
  },
  {
    "id" : "44c89001-e57d-4cb9-9ae3-e6ffe0f608db",
    "prId" : 10594,
    "prUrl" : "https://github.com/apache/airflow/pull/10594#pullrequestreview-493103119",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "This would filter before any date limits are applied, and thus would get an incorrect count.",
        "createdAt" : "2020-09-21T17:11:49Z",
        "updatedAt" : "2020-09-22T03:17:54Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "e3befe7f-9784-4f80-b625-3901c7b6d09a",
        "parentId" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "authorId" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "body" : "Good catch. I think the original behavior included a bug. @mik-laj can you confirm that the count should be taken after filtering by date?",
        "createdAt" : "2020-09-22T01:58:52Z",
        "updatedAt" : "2020-09-22T03:17:55Z",
        "lastEditedBy" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "tags" : [
        ]
      },
      {
        "id" : "4f882a6b-bc87-4a04-a521-9c08595d2238",
        "parentId" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "`total_entries` should return the number of elements that are available on all the page of the current request.",
        "createdAt" : "2020-09-22T02:01:23Z",
        "updatedAt" : "2020-09-22T03:17:55Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "ab2edb0a-ba7e-47e4-b947-b0c7b772aef5",
        "parentId" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "authorId" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "body" : "Actually, I think we should maintain the existing behavior here and do the count prior to the date filtering. Just to keep scope limited. If we decide that the count should take place after the date filtering, let's make that behavioral change in a separate PR, just to reduce scope for this one somewhat.",
        "createdAt" : "2020-09-22T02:05:26Z",
        "updatedAt" : "2020-09-22T03:17:55Z",
        "lastEditedBy" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "tags" : [
        ]
      },
      {
        "id" : "7d9312bf-11a6-4d95-b77e-54c5d271dbc0",
        "parentId" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "authorId" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "body" : "Can you create a issues about it?",
        "createdAt" : "2020-09-22T02:07:54Z",
        "updatedAt" : "2020-09-22T03:17:55Z",
        "lastEditedBy" : "07638d17-cc8b-40a4-abdc-7b39759362ab",
        "tags" : [
        ]
      },
      {
        "id" : "2a245ba2-254a-4514-ab94-db660c6aa7b4",
        "parentId" : "97a51b15-3d7d-407d-9aa9-15c11ce21dc0",
        "authorId" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "body" : "I've created an issue to change how the total_entries are counted. #11074",
        "createdAt" : "2020-09-22T03:12:58Z",
        "updatedAt" : "2020-09-22T03:17:55Z",
        "lastEditedBy" : "f30d90ba-101c-4671-a1df-fa45531fa887",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7f590d1b4eedfb00ece0828e55e876ecd4babe3",
    "line" : 67,
    "diffHunk" : "@@ -1,1 +123,127 @@    offset,\n):\n    total_entries = query.count()\n    query = _apply_date_filters_to_query(\n        query,"
  },
  {
    "id" : "d3c10715-3590-4e81-a0f1-76cae0b02df8",
    "prId" : 15174,
    "prUrl" : "https://github.com/apache/airflow/pull/15174#pullrequestreview-627530143",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d3944399-ed82-4e07-8d16-477a86b9f955",
        "parentId" : null,
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "Can you add execution_date to the filter in line 256 instead of another query?",
        "createdAt" : "2021-04-03T14:41:40Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      },
      {
        "id" : "b16a2ec5-b385-4de2-b363-737e87cfb730",
        "parentId" : "d3944399-ed82-4e07-8d16-477a86b9f955",
        "authorId" : "29b924c6-b357-4b24-aba4-4989658ba9c1",
        "body" : "Originally I have decided to go with that logic, but there are two cases which can happen\r\n1. the DagRun.run_id is same and DagRun.execution_date is same\r\n2. the DagRun.run_id is different and DagRun.execution_date is same\r\n\r\nin both the cases it should throw the execution_date error as there are two unique constraints\r\n\r\nUniqueConstraint('dag_id', 'execution_date')\r\nUniqueConstraint('dag_id', 'run_id')\r\n\r\nIf I added the DagRun.execution_date in the same query on line 256 then, we are missing the AlreadyExists error when the DagRun.run_id is different, because of this the `dagrun_instance` will be a None result and the DagRun will get created.\r\n\r\nlet me know if anything is wrong with my logic\r\nThanks",
        "createdAt" : "2021-04-03T14:53:10Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "29b924c6-b357-4b24-aba4-4989658ba9c1",
        "tags" : [
        ]
      },
      {
        "id" : "646bc7c6-c7d8-43bc-bddb-ac76ca06ee45",
        "parentId" : "d3944399-ed82-4e07-8d16-477a86b9f955",
        "authorId" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "body" : "Oh, I see, just took a look at the table now. In that case, this will work instead of a separate query:\r\n```\r\nsession.query(DagRun).filter(DagRun.dag_id == dag_id).\r\n            filter(or_(DagRun.run_id == post_body[\"run_id\"],\r\n                    DagRun.execution_date == post_body[\"execution_date\"])).first()\r\n```\r\n",
        "createdAt" : "2021-04-03T20:50:27Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "c7b0cb1c-ff95-4ec9-a0c6-a9f1b5135a52",
        "tags" : [
        ]
      },
      {
        "id" : "8a76cfab-20a6-456c-9b61-143387651c5a",
        "parentId" : "d3944399-ed82-4e07-8d16-477a86b9f955",
        "authorId" : "29b924c6-b357-4b24-aba4-4989658ba9c1",
        "body" : "Thanks @ephraimbuddy \r\nI have added these changes",
        "createdAt" : "2021-04-04T07:18:11Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "29b924c6-b357-4b24-aba4-4989658ba9c1",
        "tags" : [
        ]
      },
      {
        "id" : "4ba2213c-f0b7-423a-a614-3bd511113801",
        "parentId" : "d3944399-ed82-4e07-8d16-477a86b9f955",
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "Agree with @ephraimbuddy , you are missing `.filter(DagRun.dag_id == dag_id)` that Ephraim suggested",
        "createdAt" : "2021-04-04T11:29:36Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      }
    ],
    "commit" : "37047e837a402cf0efc72fcc8a6e0946b0a00ce1",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +262,266 @@            f\"DAGRun ExecutionDate: '{post_body['execution_date']}' already exists\"\n        )\n\n    raise AlreadyExists(\n        detail=f\"DAGRun with DAG ID: '{dag_id}' and DAGRun ID: '{post_body['run_id']}' already exists\""
  },
  {
    "id" : "6d9f4a83-7dbb-4654-aa8d-b26d32b004cc",
    "prId" : 15174,
    "prUrl" : "https://github.com/apache/airflow/pull/15174#pullrequestreview-627548282",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6ef76aab-2e2c-4591-8679-0e77f88f8a87",
        "parentId" : null,
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "```suggestion\r\n            detail=f\"A DagRun with dag_id: '{dag_id}' and \"\r\n            f\"execution_date: '{post_body['execution_date']}' already exists\"\r\n```",
        "createdAt" : "2021-04-04T15:10:52Z",
        "updatedAt" : "2021-04-06T07:52:03Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      }
    ],
    "commit" : "37047e837a402cf0efc72fcc8a6e0946b0a00ce1",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +260,264 @@        raise AlreadyExists(\n            detail=f\"DAGRun with DAG ID: '{dag_id}' and \"\n            f\"DAGRun ExecutionDate: '{post_body['execution_date']}' already exists\"\n        )\n"
  }
]