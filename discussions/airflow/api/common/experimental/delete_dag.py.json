[
  {
    "id" : "f1051917-937b-4ef7-93fb-9839570dc702",
    "prId" : 4287,
    "prUrl" : "https://github.com/apache/airflow/pull/4287#pullrequestreview-182593702",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "aba38da8-ba0b-450d-a600-8436a2d9a535",
        "parentId" : null,
        "authorId" : "38d80383-47b9-439a-9efe-9282f79f8b2f",
        "body" : "does it work with the log is in remote(like s3)? And will it have two different behaviour(api vs webserver) when deleting the log?",
        "createdAt" : "2018-12-06T18:18:02Z",
        "updatedAt" : "2018-12-07T15:51:19Z",
        "lastEditedBy" : "38d80383-47b9-439a-9efe-9282f79f8b2f",
        "tags" : [
        ]
      },
      {
        "id" : "86dbedb8-aac6-4d5b-933b-654da914885e",
        "parentId" : "aba38da8-ba0b-450d-a600-8436a2d9a535",
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "Hi @feng-tao , regarding your questions:\r\n\r\n1. `delete_dag()` function does not touch the log files (plain text files in `/log` folder) at all. It only deletes records of given dag_id in the tables in the backend database, including \"dag\", \"task_instance\", \"dag_run\", etc. (actually all tables in which `dag_id` is available). Earlier it also deletes the records in \"log\" table in the database, which may not be ideal (logs should not be touched by anyone other than Admin). This is what this PR is trying to solve.\r\n\r\n1. The behaviour (API vs webserver/UI) will be consistent: when a user deletes a DAG from UI, what happens under the hood is that the URL of the button will invoke the API endpoint with the _default_ parameter (`keep_records_in_log=True`). The only difference is that users can delete records in `log` table using API if they want (of course they need to explicitly specify `keep_records_in_log=False`).\r\n\r\nPlease let me know if you need any other clarification. Thanks for reviewing!",
        "createdAt" : "2018-12-06T23:51:13Z",
        "updatedAt" : "2018-12-07T15:51:19Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      },
      {
        "id" : "330891eb-c2d8-495d-a8e3-fa9806769fc7",
        "parentId" : "aba38da8-ba0b-450d-a600-8436a2d9a535",
        "authorId" : "38d80383-47b9-439a-9efe-9282f79f8b2f",
        "body" : "thanks for the explanation. make sense",
        "createdAt" : "2018-12-07T07:34:36Z",
        "updatedAt" : "2018-12-07T15:51:19Z",
        "lastEditedBy" : "38d80383-47b9-439a-9efe-9282f79f8b2f",
        "tags" : [
        ]
      },
      {
        "id" : "7155a33b-e175-40d0-be84-289520bca76f",
        "parentId" : "aba38da8-ba0b-450d-a600-8436a2d9a535",
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "Thanks @feng-tao . May you help re-trigger the Travis test?\r\n\r\nEarlier most my test cases failed due to un-related tests. I believe it's some sort of transient errors.\r\n\r\nThanks!",
        "createdAt" : "2018-12-07T08:40:56Z",
        "updatedAt" : "2018-12-07T15:51:19Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      }
    ],
    "commit" : "f96af34ed7261c36d8d764835be479fea96f319f",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +50,54 @@    for m in models.Base._decl_class_registry.values():\n        if hasattr(m, \"dag_id\"):\n            if keep_records_in_log and m.__name__ == 'Log':\n                continue\n            cond = or_(m.dag_id == dag_id, m.dag_id.like(dag_id + \".%\"))"
  }
]