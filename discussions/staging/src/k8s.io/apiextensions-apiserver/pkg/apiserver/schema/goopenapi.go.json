[
  {
    "id" : "08fcced9-8903-4ad7-9e02-fea15252f1f5",
    "prId" : 77667,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/77667#pullrequestreview-235958903",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1364e17d-30f7-4095-a02c-3fd438176583",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "why nested inside `if len(g.Type) != 0`?",
        "createdAt" : "2019-05-09T20:59:33Z",
        "updatedAt" : "2019-05-10T15:41:43Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "57197105-7a0d-4b9a-9f08-327c9227dc0a",
        "parentId" : "1364e17d-30f7-4095-a02c-3fd438176583",
        "authorId" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "body" : "If the OpenAPI v3 type field is empty, nullable has no effect and we can just ignore it here. Actually, adding `type: null` would make the schema even stronger and wrong. In case of non-empty types, we add null to the type array: `type: [\"object\",\"null\"|`.\r\n\r\nI don't like that go-openapi has this JSON-schema-inspired type slice, but no nullable. The consequence is that JSON produced by go-openapi is either wrong (not OpenAPI v3 compliant), or we have to filter those multi-type values out. We do the latter in our v2 conversion.\r\n\r\nAfter 1.15 I would like to rethink our use of go-openapi. What we really need is\r\n1. OpenAPI v3 compatible types which can be marshalled to JSON (and preferribly also Protobuf to avoid many internal roundtrips)\r\n2. An OpenAPI v3 compatible validator.\r\n\r\nFor (1) I would rather create our own types than using broken 3rd party libs.\r\nFor (2) we can keep using go-openapi, but very locally in CRD validation.\r\n",
        "createdAt" : "2019-05-10T07:22:56Z",
        "updatedAt" : "2019-05-10T15:41:43Z",
        "lastEditedBy" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "tags" : [
        ]
      },
      {
        "id" : "b9add869-e134-4a09-9c66-aa7b334227b1",
        "parentId" : "1364e17d-30f7-4095-a02c-3fd438176583",
        "authorId" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "body" : "For the v2 conversion, compare https://github.com/kubernetes/kubernetes/blob/d0c3b708026f681f7467d36dcf9696f89ccfcfab/staging/src/k8s.io/apiextensions-apiserver/pkg/controller/openapi/conversion.go#L66.",
        "createdAt" : "2019-05-10T07:23:59Z",
        "updatedAt" : "2019-05-10T15:41:43Z",
        "lastEditedBy" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "tags" : [
        ]
      }
    ],
    "commit" : "19e29548f6b8886adc21cf59ae667f9f77183b1f",
    "line" : 60,
    "diffHunk" : "@@ -1,1 +58,62 @@\tif len(g.Type) != 0 {\n\t\tret.Type = spec.StringOrArray{g.Type}\n\t\tif g.Nullable {\n\t\t\t// go-openapi does not support nullable, but multiple type values.\n\t\t\t// Only when type is already non-empty, adding null to the types is correct though."
  },
  {
    "id" : "be63869e-7bef-4f57-872f-32c665a4b6d7",
    "prId" : 77667,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/77667#pullrequestreview-235824955",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "57276151-5eb4-4550-a25f-886098e2b23e",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "~~wrap in `if s.ValueValidation != nil`?~~\r\nedit: toGoOpenAPI() no-ops on nil, nevermind",
        "createdAt" : "2019-05-09T21:08:05Z",
        "updatedAt" : "2019-05-10T15:41:43Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "19e29548f6b8886adc21cf59ae667f9f77183b1f",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +46,50 @@\ts.Generic.toGoOpenAPI(ret)\n\ts.Extensions.toGoOpenAPI(ret)\n\ts.ValueValidation.toGoOpenAPI(ret)\n\n\treturn ret"
  }
]