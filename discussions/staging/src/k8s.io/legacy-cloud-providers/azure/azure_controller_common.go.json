[
  {
    "id" : "1fae5a58-55be-4419-b594-7e966d1e7acc",
    "prId" : 87945,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/87945#pullrequestreview-357934789",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "029d5e1e-47e5-4b5c-8585-b6ef7da83138",
        "parentId" : null,
        "authorId" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "body" : "since we are passing 8 parameters to the method now, can we instead create a DiskConfig struct and pass that as input for all disk ops?",
        "createdAt" : "2020-02-12T17:47:55Z",
        "updatedAt" : "2020-02-12T17:47:56Z",
        "lastEditedBy" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "tags" : [
        ]
      },
      {
        "id" : "847e91bc-bc2e-44ec-af54-dc44f8e2d7e2",
        "parentId" : "029d5e1e-47e5-4b5c-8585-b6ef7da83138",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "@aramase that will be a little refactor, will address this issue in another PR.",
        "createdAt" : "2020-02-13T03:14:37Z",
        "updatedAt" : "2020-02-13T03:14:37Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "78183c4c-707d-44c0-8aa6-9c0bebcf4d77",
        "parentId" : "029d5e1e-47e5-4b5c-8585-b6ef7da83138",
        "authorId" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "body" : "@andyzhangx sounds good! ",
        "createdAt" : "2020-02-13T03:30:26Z",
        "updatedAt" : "2020-02-13T03:30:27Z",
        "lastEditedBy" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "tags" : [
        ]
      }
    ],
    "commit" : "657dedc3be3470c19f2905889da878ccf83a95cb",
    "line" : 37,
    "diffHunk" : "@@ -1,1 +179,183 @@\tc.diskAttachDetachMap.Store(strings.ToLower(diskURI), \"attaching\")\n\tdefer c.diskAttachDetachMap.Delete(strings.ToLower(diskURI))\n\treturn lun, vmset.AttachDisk(isManagedDisk, diskName, diskURI, nodeName, lun, cachingMode, diskEncryptionSetID, writeAcceleratorEnabled)\n}\n"
  },
  {
    "id" : "32ec0879-3960-4a1a-8fc4-795be6842f92",
    "prId" : 85697,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/85697#pullrequestreview-325837385",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0c498db6-850c-4f83-bb3b-fc6c7351cb4e",
        "parentId" : null,
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "this should be in another cherry pick",
        "createdAt" : "2019-11-29T04:36:43Z",
        "updatedAt" : "2019-12-03T00:48:16Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "56a69a1d-a654-4abb-883c-bab81cce7bfb",
        "parentId" : "0c498db6-850c-4f83-bb3b-fc6c7351cb4e",
        "authorId" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "body" : "done!",
        "createdAt" : "2019-12-03T00:48:27Z",
        "updatedAt" : "2019-12-03T00:48:27Z",
        "lastEditedBy" : "62eb404a-5fe6-4b29-afab-583b57ce8f19",
        "tags" : [
        ]
      }
    ],
    "commit" : "718bf07a798943dfb278e8a26e862d33f236d2b9",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +175,179 @@\t// make the lock here as small as possible\n\tc.vmLockMap.LockEntry(strings.ToLower(string(nodeName)))\n\tc.diskAttachDetachMap.Store(strings.ToLower(diskURI), \"detaching\")\n\tresp, err := vmset.DetachDisk(diskName, diskURI, nodeName)\n\tc.diskAttachDetachMap.Delete(strings.ToLower(diskURI))"
  },
  {
    "id" : "ce773811-b358-4563-8900-1ae3a572a200",
    "prId" : 84917,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/84917#pullrequestreview-313437444",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f0ef2d30-98bc-4344-b73a-fe768bc7d30f",
        "parentId" : null,
        "authorId" : "0853f12c-1667-4dba-934b-5d8cd9ddd859",
        "body" : "Might want to rearrange the statements so that lock happens after the map is populated",
        "createdAt" : "2019-11-07T15:47:08Z",
        "updatedAt" : "2019-11-08T03:28:34Z",
        "lastEditedBy" : "0853f12c-1667-4dba-934b-5d8cd9ddd859",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6afc8604c3812e135497b3ec7c46471c2d44fe0",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +191,195 @@\t\tklog.V(2).Infof(\"azureDisk - update backing off: detach disk(%s, %s), err: %v\", diskName, diskURI, err)\n\t\tretryErr := kwait.ExponentialBackoff(c.cloud.RequestBackoff(), func() (bool, error) {\n\t\t\tdiskOpMutex.LockKey(instanceid)\n\t\t\tc.diskAttachDetachMap.Store(strings.ToLower(diskURI), \"detaching\")\n\t\t\tresp, err := vmset.DetachDisk(diskName, diskURI, nodeName)"
  },
  {
    "id" : "00be37b6-87e5-4529-81fa-cd78a80d3b1e",
    "prId" : 84917,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/84917#pullrequestreview-313764578",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7c56db07-5bc0-4882-8f12-99a464176f8d",
        "parentId" : null,
        "authorId" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "body" : "Can we please add a few UTs to cover this scenario ?",
        "createdAt" : "2019-11-07T15:59:15Z",
        "updatedAt" : "2019-11-08T03:28:34Z",
        "lastEditedBy" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "tags" : [
        ]
      },
      {
        "id" : "71831df4-573c-4801-9d30-8c9fd8353588",
        "parentId" : "7c56db07-5bc0-4882-8f12-99a464176f8d",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "we don't have a good fake UT framework to simulate this now.",
        "createdAt" : "2019-11-08T03:22:10Z",
        "updatedAt" : "2019-11-08T03:28:40Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6afc8604c3812e135497b3ec7c46471c2d44fe0",
    "line" : 34,
    "diffHunk" : "@@ -1,1 +185,189 @@\tc.diskAttachDetachMap.Store(strings.ToLower(diskURI), \"detaching\")\n\tresp, err := vmset.DetachDisk(diskName, diskURI, nodeName)\n\tc.diskAttachDetachMap.Delete(strings.ToLower(diskURI))\n\tdiskOpMutex.UnlockKey(instanceid)\n"
  },
  {
    "id" : "74db4922-2b1e-478d-ad6a-1a1f1a4d1194",
    "prId" : 84917,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/84917#pullrequestreview-313764578",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ebd27f0c-9952-444c-851b-504d7b1e5641",
        "parentId" : null,
        "authorId" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "body" : "What happens if the controller restarted or switched to another leader (once leader election is active) ? Wouldnâ€™t we lose track of the state ?",
        "createdAt" : "2019-11-07T16:01:15Z",
        "updatedAt" : "2019-11-08T03:28:34Z",
        "lastEditedBy" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "tags" : [
        ]
      },
      {
        "id" : "65835f93-faff-46a0-b29d-381ec6aa1024",
        "parentId" : "ebd27f0c-9952-444c-851b-504d7b1e5641",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "correct, this PR won't cover this, it requires data persistence, which is quite expensive, may not worthwile.",
        "createdAt" : "2019-11-08T03:23:15Z",
        "updatedAt" : "2019-11-08T03:28:40Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6afc8604c3812e135497b3ec7c46471c2d44fe0",
    "line" : 34,
    "diffHunk" : "@@ -1,1 +185,189 @@\tc.diskAttachDetachMap.Store(strings.ToLower(diskURI), \"detaching\")\n\tresp, err := vmset.DetachDisk(diskName, diskURI, nodeName)\n\tc.diskAttachDetachMap.Delete(strings.ToLower(diskURI))\n\tdiskOpMutex.UnlockKey(instanceid)\n"
  },
  {
    "id" : "26fe7ded-92e6-4ad8-b4d0-1c9aa5ebf1d1",
    "prId" : 84917,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/84917#pullrequestreview-314523573",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d41280b8-9f3e-4d45-824a-05f7593e2170",
        "parentId" : null,
        "authorId" : "5d31f34e-f4db-4593-83b9-c8606802efb4",
        "body" : "would `ToBeDetached` end in an error in 1.15 since it's got the older sdk? I assume you want to cherry pick this right?",
        "createdAt" : "2019-11-09T00:10:29Z",
        "updatedAt" : "2019-11-09T00:11:06Z",
        "lastEditedBy" : "5d31f34e-f4db-4593-83b9-c8606802efb4",
        "tags" : [
        ]
      },
      {
        "id" : "aafe55e7-1c3e-4045-a90a-0669fec581da",
        "parentId" : "d41280b8-9f3e-4d45-824a-05f7593e2170",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "that's ok, when I do the cherry-pick,  I will remove this code change since 1.15 don't have `ToBeDetached` field.",
        "createdAt" : "2019-11-09T00:16:43Z",
        "updatedAt" : "2019-11-09T00:16:43Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "5e473b43-a329-48b1-bf85-2a2d8624c8f1",
        "parentId" : "d41280b8-9f3e-4d45-824a-05f7593e2170",
        "authorId" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "body" : "@andyzhangx - we were doing some testing with https://github.com/kubernetes/kubernetes/pull/84958. Looks like with this we don't need those changes ?",
        "createdAt" : "2019-11-09T00:19:50Z",
        "updatedAt" : "2019-11-09T00:19:51Z",
        "lastEditedBy" : "e03e55d1-dd26-489d-a097-b5809c738bb7",
        "tags" : [
        ]
      },
      {
        "id" : "ff93a1aa-1237-46f1-808f-7c86cf1547c7",
        "parentId" : "d41280b8-9f3e-4d45-824a-05f7593e2170",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "@kkmsft I think that's ok, it's a double check, if there is `ToBeDetached` flag, then we should respect that. and if #84958 fixed that, we never go to that line of code.",
        "createdAt" : "2019-11-09T00:30:30Z",
        "updatedAt" : "2019-11-09T00:30:30Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6afc8604c3812e135497b3ec7c46471c2d44fe0",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +236,240 @@\t\t\t(disk.Vhd != nil && disk.Vhd.URI != nil && diskURI != \"\" && strings.EqualFold(*disk.Vhd.URI, diskURI)) ||\n\t\t\t(disk.ManagedDisk != nil && strings.EqualFold(*disk.ManagedDisk.ID, diskURI)) {\n\t\t\tif disk.ToBeDetached != nil && *disk.ToBeDetached {\n\t\t\t\tklog.Warningf(\"azureDisk - find disk(ToBeDetached): lun %d name %q uri %q\", *disk.Lun, diskName, diskURI)\n\t\t\t} else {"
  },
  {
    "id" : "c86c4a06-fe70-4700-bfd2-ed2be63b77cd",
    "prId" : 81266,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81266#pullrequestreview-276281245",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f41817ee-4135-499d-8cb6-74e89e0759bc",
        "parentId" : null,
        "authorId" : "0df1da34-610c-4ce5-b0cf-bbda668bf9c1",
        "body" : "Is there any possible \"disk.ManagedBy\" is equal to \"nodeName\"?",
        "createdAt" : "2019-08-18T11:33:03Z",
        "updatedAt" : "2019-08-18T11:33:03Z",
        "lastEditedBy" : "0df1da34-610c-4ce5-b0cf-bbda668bf9c1",
        "tags" : [
        ]
      },
      {
        "id" : "254d9c9d-d91d-40de-af24-5ab6b574f06e",
        "parentId" : "f41817ee-4135-499d-8cb6-74e89e0759bc",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "No, I have considered this condition, there is already disk attachment check right before invoke `AttachDisk` func: https://github.com/kubernetes/kubernetes/blob/091a5dc53b1b961f95de225ca4cddf33193051cd/pkg/volume/azure_dd/attacher.go#L70-L90\r\n\r\n",
        "createdAt" : "2019-08-18T14:25:08Z",
        "updatedAt" : "2019-08-18T14:25:08Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "1fe12be56e427720f71fc33e71efb4d563ac78e0",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +114,118 @@\t\t\tattachErr := fmt.Sprintf(\n\t\t\t\t\"disk(%s) already attached to node(%s), could not be attached to node(%s)\",\n\t\t\t\tdiskURI, *disk.ManagedBy, nodeName)\n\t\t\tattachedNode := path.Base(*disk.ManagedBy)\n\t\t\tklog.V(2).Infof(\"found dangling volume %s attached to node %s\", diskURI, attachedNode)"
  },
  {
    "id" : "8317f91c-9de6-4e3d-9c54-5adc94ac1743",
    "prId" : 81266,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81266#pullrequestreview-276366337",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "52e120fb-78f2-46ef-a7b0-c934e469c022",
        "parentId" : null,
        "authorId" : "a0c59012-abf9-423b-964f-ea00123f0c9a",
        "body" : "What if the disk is already attached to the node it should be attached to? Would it be possible to add a check if attachedNode equals nodeName and dont throw in this case?",
        "createdAt" : "2019-08-19T06:42:11Z",
        "updatedAt" : "2019-08-19T06:42:11Z",
        "lastEditedBy" : "a0c59012-abf9-423b-964f-ea00123f0c9a",
        "tags" : [
        ]
      },
      {
        "id" : "041d9ddd-ea2d-4329-bf98-9365098d5f23",
        "parentId" : "52e120fb-78f2-46ef-a7b0-c934e469c022",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "@MSSedusch there is already disk attachment check right before invoke `AttachDisk` func: https://github.com/kubernetes/kubernetes/blob/091a5dc53b1b961f95de225ca4cddf33193051cd/pkg/volume/azure_dd/attacher.go#L70-L90\r\n",
        "createdAt" : "2019-08-19T06:48:22Z",
        "updatedAt" : "2019-08-19T06:48:22Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "1fe12be56e427720f71fc33e71efb4d563ac78e0",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +118,122 @@\t\t\tklog.V(2).Infof(\"found dangling volume %s attached to node %s\", diskURI, attachedNode)\n\t\t\tdanglingErr := volerr.NewDanglingError(attachErr, types.NodeName(attachedNode), \"\")\n\t\t\treturn -1, danglingErr\n\t\t}\n\t}"
  }
]