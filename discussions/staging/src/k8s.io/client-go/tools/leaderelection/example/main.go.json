[
  {
    "id" : "5b51c2a3-8dda-4c22-92cf-3b628c6f75d4",
    "prId" : 71490,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71490#pullrequestreview-188147580",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9a874a1d-5572-418e-8335-c22a25bc7ff5",
        "parentId" : null,
        "authorId" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "body" : "This seems like a fairly hard guarantee to make.  Do we have an example, or are you planning a follow-on PR to make this easier?",
        "createdAt" : "2018-11-28T14:20:57Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "tags" : [
        ]
      },
      {
        "id" : "22bf7102-c2c5-4100-a233-8ddd245b929f",
        "parentId" : "9a874a1d-5572-418e-8335-c22a25bc7ff5",
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "There's a couple of options\r\n\r\n1. most controllers are reentrant, so it doesn't actually matter (the ones I would be concerned with in controller manager are the ones that talk to external systems and allocate things, and even they are probably ok)\r\n2. have a global \"disable client\" option when you get a client (basically a .Stop() on client) which is pretty easy to make work - this would be the best option for most people\r\n3. some controllers are correctly written even today to drain, it's reasonably easy to test them\r\n\r\nThe ones who would consume this first are things like 1.  I need to look at 2.",
        "createdAt" : "2018-11-28T15:45:30Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      },
      {
        "id" : "4c3208b8-41c0-4c16-9305-206b24d08154",
        "parentId" : "9a874a1d-5572-418e-8335-c22a25bc7ff5",
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "I implemented 2 - it should be fairly easy to use (I made the example demonstrate it)",
        "createdAt" : "2018-12-27T18:13:39Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe74efb1f90826b1903d2908ff9e528329bebea0",
    "line" : 107,
    "diffHunk" : "@@ -1,1 +105,109 @@\t\t// loop still running and another process could\n\t\t// get elected before your background loop finished, violating\n\t\t// the stated goal of the lease.\n\t\tReleaseOnCancel: true,\n\t\tLeaseDuration:   60 * time.Second,"
  },
  {
    "id" : "f06aae9f-8b03-4311-aeef-95bb632f3432",
    "prId" : 71490,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71490#pullrequestreview-179366283",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ddad7639-18c5-425b-921d-8e235cb29faa",
        "parentId" : null,
        "authorId" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "body" : "For example, one way we could make this error-proof is to have leaderelection run the controller loop that we're likely running here.",
        "createdAt" : "2018-11-28T14:22:18Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "tags" : [
        ]
      },
      {
        "id" : "46fb86ef-d223-4b93-9f7e-f675163ec7ea",
        "parentId" : "ddad7639-18c5-425b-921d-8e235cb29faa",
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "Only if exit of the run loop guarantees drain (some do, some don't)",
        "createdAt" : "2018-11-28T15:45:51Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe74efb1f90826b1903d2908ff9e528329bebea0",
    "line" : 112,
    "diffHunk" : "@@ -1,1 +110,114 @@\t\tRenewDeadline:   15 * time.Second,\n\t\tRetryPeriod:     5 * time.Second,\n\t\tCallbacks: leaderelection.LeaderCallbacks{\n\t\t\tOnStartedLeading: func(ctx context.Context) {\n\t\t\t\t// we're notified when we start - this is where you would"
  },
  {
    "id" : "02868376-81c6-4d63-8f4a-2ebbb202c69c",
    "prId" : 71490,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71490#pullrequestreview-179319108",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bef97e75-1683-4191-99e6-a735d5e40ee9",
        "parentId" : null,
        "authorId" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "body" : "I'm a big fan of using context instead of passing the channel around üëç ",
        "createdAt" : "2018-11-28T14:22:55Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe74efb1f90826b1903d2908ff9e528329bebea0",
    "line" : 96,
    "diffHunk" : "@@ -1,1 +94,98 @@\t\t<-ch\n\t\tlog.Printf(\"Received termination, signaling shutdown\")\n\t\tcancel()\n\t}()\n"
  },
  {
    "id" : "23f8c6ab-1ee1-45e0-a4ab-2b297433c9d0",
    "prId" : 71490,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71490#pullrequestreview-179412474",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f87c08e7-ce9b-402a-9293-03bd1b1d4951",
        "parentId" : null,
        "authorId" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "body" : "We should make sure that klog is a drop-in for log as well, I guess :-)",
        "createdAt" : "2018-11-28T14:23:56Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "tags" : [
        ]
      },
      {
        "id" : "00a23a77-eb02-4874-941c-cc6b372b1199",
        "parentId" : "f87c08e7-ce9b-402a-9293-03bd1b1d4951",
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "I can flip the example, not hard.  we don't do a ton of examples, but I wouldn't expect someone looking at this to have to use klog.",
        "createdAt" : "2018-11-28T15:46:33Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      },
      {
        "id" : "d8082725-40e0-4c19-8ee7-2fd01576131b",
        "parentId" : "f87c08e7-ce9b-402a-9293-03bd1b1d4951",
        "authorId" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "body" : "Right - this was more an action-item for myself as someone wanting to get involved in klog :-)",
        "createdAt" : "2018-11-28T17:06:28Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "8fc8f958-3c0e-47dd-a0fb-b8cc483b4efb",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe74efb1f90826b1903d2908ff9e528329bebea0",
    "line" : 60,
    "diffHunk" : "@@ -1,1 +58,62 @@\t}\n\tif err != nil {\n\t\tlog.Fatalf(\"failed to create client: %v\", err)\n\t}\n"
  },
  {
    "id" : "d677c26e-f116-48ad-a301-cdedd7e1a159",
    "prId" : 71490,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71490#pullrequestreview-182983051",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bc08f3d1-882c-4c76-a65f-e4adca2d9151",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Doesn't this need to be unique per instance of this main?",
        "createdAt" : "2018-12-05T01:01:04Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "945e8790-e811-44a1-9a54-b7cbd96cd4c9",
        "parentId" : "bc08f3d1-882c-4c76-a65f-e4adca2d9151",
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "Yes, as a test example you have to pass that in as an argument.",
        "createdAt" : "2018-12-09T15:33:05Z",
        "updatedAt" : "2019-01-11T17:50:16Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe74efb1f90826b1903d2908ff9e528329bebea0",
    "line" : 75,
    "diffHunk" : "@@ -1,1 +73,77 @@\t\tClient: kubernetes.NewForConfigOrDie(config).CoreV1(),\n\t\tLockConfig: resourcelock.ResourceLockConfig{\n\t\t\tIdentity: id,\n\t\t},\n\t}"
  }
]