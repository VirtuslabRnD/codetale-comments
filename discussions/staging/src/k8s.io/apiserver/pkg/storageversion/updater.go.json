[
  {
    "id" : "2a0a01c0-e561-47cb-beaf-fe87a4734897",
    "prId" : 96825,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96825#pullrequestreview-537995176",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "86d41cc2-f743-4be5-a4cd-b76965c0f0dd",
        "parentId" : null,
        "authorId" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "body" : "How about `versionChanged`?",
        "createdAt" : "2020-11-24T08:24:57Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "tags" : [
        ]
      },
      {
        "id" : "dc51f9c9-a917-4903-9edd-e244dbe64020",
        "parentId" : "86d41cc2-f743-4be5-a4cd-b76965c0f0dd",
        "authorId" : "695b6860-569c-4e63-a215-7342e2279a94",
        "body" : "I'd like to keep the current name so that the function can be used for other storage version conditions in future",
        "createdAt" : "2020-11-24T21:50:26Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "695b6860-569c-4e63-a215-7342e2279a94",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a28ca419e9c3c246937d1a3c1cdc7581ab06060",
    "line" : 79,
    "diffHunk" : "@@ -1,1 +98,102 @@// NOTE: forceTransition allows overwriting LastTransitionTime even when the status doesn't change.\nfunc setStatusCondition(conditions *[]v1alpha1.StorageVersionCondition, newCondition v1alpha1.StorageVersionCondition,\n\tforceTransition bool) {\n\tif conditions == nil {\n\t\treturn"
  },
  {
    "id" : "d0944ab8-b254-4a25-a9ff-34d7caef4c45",
    "prId" : 96825,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96825#pullrequestreview-543282184",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8a390241-8ef4-463b-9a98-4ddbd91b7f20",
        "parentId" : null,
        "authorId" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "body" : "I simplified the function a little, and it still passed the unit test, how about:\r\n\r\n```golang\r\n func setStatusCondition(conditions *[]v1alpha1.StorageVersionCondition, newCondition v1alpha1.StorageVersionCondition,\r\n     versionChanged bool) {\r\n     if conditions == nil {\r\n         return\r\n     }\r\n     existingCondition := findStatusCondition(*conditions, newCondition.Type)\r\n     if existingCondition == nil {\r\n         *conditions = append(*conditions, newCondition)\r\n         return\r\n     }\r\n     statusChanged := existingCondition.Status != newCondition.Status\r\n     if statusChanged || versionChanged {\r\n         existingCondition.LastTransitionTime = newCondition.LastTransitionTime\r\n     }\r\n     existingCondition.Status = newCondition.Status\r\n     existingCondition.Reason = newCondition.Reason\r\n     existingCondition.Message = newCondition.Message\r\n     existingCondition.ObservedGeneration = newCondition.ObservedGeneration\r\n }\r\n```",
        "createdAt" : "2020-11-24T08:25:43Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "tags" : [
        ]
      },
      {
        "id" : "fbedbc5a-7e37-41dd-bb4d-0adaf6ecb9d9",
        "parentId" : "8a390241-8ef4-463b-9a98-4ddbd91b7f20",
        "authorId" : "695b6860-569c-4e63-a215-7342e2279a94",
        "body" : "see https://github.com/kubernetes/kubernetes/pull/96825#discussion_r529899021",
        "createdAt" : "2020-11-24T21:50:53Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "695b6860-569c-4e63-a215-7342e2279a94",
        "tags" : [
        ]
      },
      {
        "id" : "2bf3101f-54db-4f5f-a6f1-8718fcf3c9c8",
        "parentId" : "8a390241-8ef4-463b-9a98-4ddbd91b7f20",
        "authorId" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "body" : "Got it. Then how about\r\n\r\n```golang\r\n func setStatusCondition(conditions *[]v1alpha1.StorageVersionCondition, newCondition v1alpha1.StorageVersionCondition,\r\n     forceTransition bool) {\r\n     if conditions == nil {\r\n         return\r\n     }\r\n     if newCondition.LastTransitionTime.IsZero() {\r\n          newCondition.LastTransitionTime = metav1.NewTime(time.Now())\r\n     }\r\n     existingCondition := findStatusCondition(*conditions, newCondition.Type)\r\n     if existingCondition == nil {\r\n         *conditions = append(*conditions, newCondition)\r\n         return\r\n     }\r\n     statusChanged := existingCondition.Status != newCondition.Status\r\n     if statusChanged || forceTransition {\r\n         existingCondition.LastTransitionTime = newCondition.LastTransitionTime\r\n     }\r\n     existingCondition.Status = newCondition.Status\r\n     existingCondition.Reason = newCondition.Reason\r\n     existingCondition.Message = newCondition.Message\r\n     existingCondition.ObservedGeneration = newCondition.ObservedGeneration\r\n }\r\n```",
        "createdAt" : "2020-12-02T22:02:10Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "tags" : [
        ]
      },
      {
        "id" : "c617a4f8-cabf-4fd9-a06e-398bacc4e055",
        "parentId" : "8a390241-8ef4-463b-9a98-4ddbd91b7f20",
        "authorId" : "695b6860-569c-4e63-a215-7342e2279a94",
        "body" : "updated",
        "createdAt" : "2020-12-02T22:14:18Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "695b6860-569c-4e63-a215-7342e2279a94",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a28ca419e9c3c246937d1a3c1cdc7581ab06060",
    "line" : 101,
    "diffHunk" : "@@ -1,1 +120,124 @@\texistingCondition.Message = newCondition.Message\n\texistingCondition.ObservedGeneration = newCondition.ObservedGeneration\n}\n\n// updateStorageVersionFor updates the storage version object for the resource."
  },
  {
    "id" : "1f9252ad-62ea-4b88-912d-f818d35975e5",
    "prId" : 96825,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96825#pullrequestreview-537558150",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8a93322d-48d7-4688-ac43-74a3c487a1eb",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "for free-form text we are likely to tweak in future versions, make sure we won't eternally duel with a future API server that sets a slightly different version of this condition. xref things like https://github.com/kubernetes/kubernetes/pull/78133",
        "createdAt" : "2020-11-24T14:42:45Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a28ca419e9c3c246937d1a3c1cdc7581ab06060",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +65,69 @@\t\tLastTransitionTime: metav1.NewTime(time.Now()),\n\t\tReason:             \"CommonEncodingVersionUnset\",\n\t\tMessage:            \"Common encoding version unset\",\n\t}\n\tif sv.Status.CommonEncodingVersion != nil {"
  },
  {
    "id" : "3bd5e24f-dfcf-4ce7-8733-887c8e89ac02",
    "prId" : 96825,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96825#pullrequestreview-543286832",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d909e04a-913e-476f-a89e-ad82c6feaed7",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this is the bit that seems likely to duel... should we skip if the ObservedGeneration of the existing condition is already set to the current generation?",
        "createdAt" : "2020-11-24T14:44:08Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "190b9236-9f7f-43c7-887b-014e07977717",
        "parentId" : "d909e04a-913e-476f-a89e-ad82c6feaed7",
        "authorId" : "695b6860-569c-4e63-a215-7342e2279a94",
        "body" : "StorageVersion has no spec, so the ObservedGeneration is always 0. \r\n\r\nIIUC, https://github.com/kubernetes/kubernetes/pull/78133 happened because one controller's update would always trigger another controller to do calculation and update. This doesn't apply to storage version because:\r\n- The GC only tries updating status if the live lookup object has stale record. The watch event of one controller finishing GC won't trigger another controller to do GC again.\r\n- The StorageVersion manager doesn't watch. ",
        "createdAt" : "2020-11-24T22:20:05Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "695b6860-569c-4e63-a215-7342e2279a94",
        "tags" : [
        ]
      },
      {
        "id" : "9adf8ce6-7272-403b-b806-268f0e9a668b",
        "parentId" : "d909e04a-913e-476f-a89e-ad82c6feaed7",
        "authorId" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "body" : "The two controllers updating the condition are the storageVersionGC and the API server. One storageVersion GC or on API server updating the condition of a storageVersion won't cause other GC or API server update the storageVersion again, so this won't cause a duel.",
        "createdAt" : "2020-12-02T22:22:16Z",
        "updatedAt" : "2020-12-02T22:33:16Z",
        "lastEditedBy" : "ca7e5a52-cab7-4f09-8ff8-da79f43339d4",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a28ca419e9c3c246937d1a3c1cdc7581ab06060",
    "line" : 99,
    "diffHunk" : "@@ -1,1 +118,122 @@\texistingCondition.Status = newCondition.Status\n\texistingCondition.Reason = newCondition.Reason\n\texistingCondition.Message = newCondition.Message\n\texistingCondition.ObservedGeneration = newCondition.ObservedGeneration\n}"
  },
  {
    "id" : "9e24ef47-8077-49ad-ba72-c056fd86311f",
    "prId" : 93873,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/93873#pullrequestreview-526729644",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6d13020f-d58f-4f11-8cc1-2b17063b374f",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "What happens if another apiserver modifies this object after the create but before this update?",
        "createdAt" : "2020-11-09T22:33:29Z",
        "updatedAt" : "2020-11-09T23:23:29Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "3247411b-f67b-4412-ac3b-8be873694a36",
        "parentId" : "6d13020f-d58f-4f11-8cc1-2b17063b374f",
        "authorId" : "695b6860-569c-4e63-a215-7342e2279a94",
        "body" : "The updater handles conflict and retry",
        "createdAt" : "2020-11-09T23:13:10Z",
        "updatedAt" : "2020-11-09T23:23:29Z",
        "lastEditedBy" : "695b6860-569c-4e63-a215-7342e2279a94",
        "tags" : [
        ]
      }
    ],
    "commit" : "23f77ce7c62db3761580d06622fbfb1cedaa1293",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +98,102 @@\t\t// assign the calculated status to the object just created, then update status\n\t\tcreatedSV.Status = updatedSV.Status\n\t\t_, err = c.UpdateStatus(context.TODO(), createdSV, metav1.UpdateOptions{})\n\t\treturn err\n\t}"
  }
]