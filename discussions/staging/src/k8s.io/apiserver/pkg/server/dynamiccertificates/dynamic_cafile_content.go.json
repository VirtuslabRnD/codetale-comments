[
  {
    "id" : "ae777b45-dad2-4a51-ba5e-a2b2a41d4cfd",
    "prId" : 104102,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/104102#pullrequestreview-723613604",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "312107b5-9b72-433d-85ef-9dc9399d20d7",
        "parentId" : null,
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "Please do this first in your method, so you will always trigger a check of the content when called.  Otherwise an error above could prevent the call.",
        "createdAt" : "2021-08-04T20:20:08Z",
        "updatedAt" : "2021-08-04T20:20:08Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      },
      {
        "id" : "eb074592-4d8a-4bdb-9448-2fdc730f651f",
        "parentId" : "312107b5-9b72-433d-85ef-9dc9399d20d7",
        "authorId" : "f8030d76-6069-40c7-9c21-93f9f4b262ad",
        "body" : "A trigger after starting the watch is required to prevent race condition that the file is updated after the last check and before starting the watch, for example, if the events happen in this order:\r\n1. trigger a check in the beginning of this method\r\n2. worker runs and reloads the file content\r\n3. the file is updated\r\n4. start watching the file\r\n\r\nIt will miss the file update in 3. \r\nAnd if the above returns an error, it should be because the file is missing so checking the content should fail too, do you think it's necessary to trigger it in the begining and after starting watch?",
        "createdAt" : "2021-08-05T01:33:44Z",
        "updatedAt" : "2021-08-05T04:37:34Z",
        "lastEditedBy" : "f8030d76-6069-40c7-9c21-93f9f4b262ad",
        "tags" : [
        ]
      },
      {
        "id" : "994df90f-41e0-4890-8dc0-1b1674420722",
        "parentId" : "312107b5-9b72-433d-85ef-9dc9399d20d7",
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "> And if the above returns an error, it should be because the file is missing so checking the content should fail too, do you think it's necessary to trigger it in the begining and after starting watch?\r\n\r\nYes, I think that's better.  I want to be sure we always trigger.  It effectively makes this method a \"fire every minute\" in the worst case and \"fire exactly when needed\" in the good cases.",
        "createdAt" : "2021-08-05T13:51:13Z",
        "updatedAt" : "2021-08-05T13:51:14Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      },
      {
        "id" : "adfefa5b-adcd-48ce-b643-25f9f1f2fd1a",
        "parentId" : "312107b5-9b72-433d-85ef-9dc9399d20d7",
        "authorId" : "f8030d76-6069-40c7-9c21-93f9f4b262ad",
        "body" : "done",
        "createdAt" : "2021-08-05T17:21:02Z",
        "updatedAt" : "2021-08-05T17:21:10Z",
        "lastEditedBy" : "f8030d76-6069-40c7-9c21-93f9f4b262ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "3cfe3d048ff37c1c6994d131ed8557f3c8bddc8a",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +184,188 @@\t}\n\t// Trigger a check in case the file is updated before the watch starts.\n\tc.queue.Add(workItemKey)\n\n\tfor {"
  }
]