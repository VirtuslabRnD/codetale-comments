[
  {
    "id" : "6d0ca5b2-ef9f-49c6-9570-f624f706a966",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-276195209",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4266a988-3937-4f52-8012-a7c43d6d42e9",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "`newRMState.priorityLevelStates[pl.Name] = state` needed in this case too.",
        "createdAt" : "2019-08-13T21:33:15Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      },
      {
        "id" : "cf08e2d6-59a5-4ed9-8d67-735c27a97a0b",
        "parentId" : "4266a988-3937-4f52-8012-a7c43d6d42e9",
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "Notice that this logic makes any edits to the exempt PriorityLevelConfiguration object ineffective, since this logic propagates the old `priorityLevelState` value into `newRMState.priorityLevelStates`.",
        "createdAt" : "2019-08-14T20:46:15Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      },
      {
        "id" : "81499c0a-06de-41d9-b134-fa23248386dc",
        "parentId" : "4266a988-3937-4f52-8012-a7c43d6d42e9",
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "If it is intended that updates to the exempt API object have effects then the only distinct treatment needed for an exempt priority level in this loop is to avoid adding its concurrency shares to shareSum.",
        "createdAt" : "2019-08-16T23:53:01Z",
        "updatedAt" : "2019-08-17T00:08:18Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 145,
    "diffHunk" : "@@ -1,1 +143,147 @@\t\t\tif state.config.Exempt {\n\t\t\t\tnewRMState.priorityLevelStates[pl.Name] = state\n\t\t\t\tcontinue\n\t\t\t}\n"
  },
  {
    "id" : "fbfb903c-16d6-4bc6-9335-014544342120",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-275126318",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7605100c-5b9f-4ae6-a245-0e58a170189f",
        "parentId" : null,
        "authorId" : "093f4806-3f92-4191-a80b-4e6cf3d6ffc0",
        "body" : "how is the log level decided? sometimes it is 6, and here it is 7",
        "createdAt" : "2019-08-14T20:30:08Z",
        "updatedAt" : "2019-08-19T17:01:57Z",
        "lastEditedBy" : "093f4806-3f92-4191-a80b-4e6cf3d6ffc0",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +53,57 @@\nfunc (reqMgmt *requestManagementSystem) triggerReload() {\n\tklog.V(7).Info(\"triggered request-management system reloading\")\n\treqMgmt.configQueue.Add(0)\n}"
  },
  {
    "id" : "cfded59d-16ef-4edc-9fbe-923c8c9531b2",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-276026974",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9d745595-71cf-4fc6-ac0d-645939b824d5",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "At this point, if `plState.config.Exempt` then the situation is that the PriorityLevelConfiguration API object named \"exempt\" has been deleted.  I think it is the intent of this PR to keep the corresponding `priorityLevelState` in `newRMState`, but that is not actually done.  This is moot if deletion of that API object is forbidden, but the current revision of this PR does _not_ forbid that.",
        "createdAt" : "2019-08-14T21:01:34Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      },
      {
        "id" : "6962801b-1b1e-4ca1-85a7-477c3d9346e8",
        "parentId" : "9d745595-71cf-4fc6-ac0d-645939b824d5",
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "This has been partially handled now.  The missing part is including this priority's contribution to `shareSum` in the non-exempt case.",
        "createdAt" : "2019-08-16T15:45:46Z",
        "updatedAt" : "2019-08-16T15:45:54Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 197,
    "diffHunk" : "@@ -1,1 +195,199 @@\t\t\t// keeps exempt or global-default\n\t\t\tnewRMState.priorityLevelStates[plName] = plState\n\t\t}\n\t}\n\tfor plName, plState := range newRMState.priorityLevelStates {"
  },
  {
    "id" : "d5068091-1337-4853-a831-f34e01d1d5c8",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-275462565",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "36d0c201-e151-46df-9513-473e6f665d92",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "I see no corresponding attempt to preserve the state with `config.GlobalDefault`; shouldn't that be here too?",
        "createdAt" : "2019-08-14T23:54:34Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      },
      {
        "id" : "9ec5e334-b319-4724-aab7-759074a48593",
        "parentId" : "36d0c201-e151-46df-9513-473e6f665d92",
        "authorId" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "body" : "i removed `GlobalDefault`",
        "createdAt" : "2019-08-15T14:30:46Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 143,
    "diffHunk" : "@@ -1,1 +141,145 @@\t\t\t}\n\t\t} else {\n\t\t\tif state.config.Exempt {\n\t\t\t\tnewRMState.priorityLevelStates[pl.Name] = state\n\t\t\t\tcontinue"
  },
  {
    "id" : "cd9f5bca-6d69-4be0-88a5-c4d38a9ce6ea",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-275461704",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a4de58a6-dea7-4c29-985c-aa063814ef20",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "At this point `fsSeq` is guaranteed to be empty.  There is no statement that adds anything to `fsSeq`.\r\n\r\nThere is also no statement that puts `fsSeq` in `newRMState`.",
        "createdAt" : "2019-08-14T23:56:00Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      },
      {
        "id" : "b95b2144-cdd4-458f-b3de-529e03aff3d0",
        "parentId" : "a4de58a6-dea7-4c29-985c-aa063814ef20",
        "authorId" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "body" : "fixed",
        "createdAt" : "2019-08-15T14:29:22Z",
        "updatedAt" : "2019-08-16T04:36:31Z",
        "lastEditedBy" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 170,
    "diffHunk" : "@@ -1,1 +168,172 @@\t\t}\n\t}\n\tsort.Sort(fsSeq)\n\tnewRMState.flowSchemas = fsSeq\n"
  },
  {
    "id" : "3bc1f6d1-06d5-4385-b0c9-4084f82950a6",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-276027673",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1bf47ab7-8a56-4045-b413-1722cca16624",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "It's worth attempting this only if it is a change, and emitting a log message on success as well as failure.\r\n\r\n(Same for the priority level status update.)",
        "createdAt" : "2019-08-16T15:47:07Z",
        "updatedAt" : "2019-08-16T15:47:45Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 242,
    "diffHunk" : "@@ -1,1 +240,244 @@\t}\n\n\trmtypesv1a1.SetFlowSchemaCondition(fs, *danglingCondition)\n\n\t_, err := reqMgmt.flowcontrolClient.FlowSchemas().UpdateStatus(fs)"
  },
  {
    "id" : "02779398-3d96-489e-8da3-3aa29cdc1889",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-276195209",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c924d2e5-ffde-4a8c-87ce-a042e0be0554",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "I see nothing here that preserves FlowSchema objects in the requestManagementState.",
        "createdAt" : "2019-08-16T23:54:12Z",
        "updatedAt" : "2019-08-17T00:08:18Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 163,
    "diffHunk" : "@@ -1,1 +161,165 @@\n\tfsSeq := make(rmtypesv1a1.FlowSchemaSequence, 0, len(newFSs))\n\tfor i, fs := range newFSs {\n\t\t_, flowSchemaExists := newRMState.priorityLevelStates[fs.Spec.PriorityLevelConfiguration.Name]\n\t\treqMgmt.syncFlowSchemaStatus(fs, !flowSchemaExists)"
  },
  {
    "id" : "e1afc65d-cec2-40fd-ae71-f304b0f2f488",
    "prId" : 81224,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81224#pullrequestreview-276195209",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3dc96ff9-8cb1-47a2-abea-e64c7d591d27",
        "parentId" : null,
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "I thought the plan here was to avoid both the exempt and the default PriorityLevelConfiguration.",
        "createdAt" : "2019-08-16T23:55:58Z",
        "updatedAt" : "2019-08-17T00:08:18Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a531c6ac594fac1835a231a83b4ec0b552bd2d6",
    "line" : 184,
    "diffHunk" : "@@ -1,1 +182,186 @@\t\t\t// undesired, empty, and never going to get another request\n\t\t\tklog.V(3).Infof(\"Priority level %s removed from implementation\", plName)\n\t\t} else if !plState.config.Exempt {\n\t\t\toState := *plState\n\t\t\tplState = &oState"
  }
]