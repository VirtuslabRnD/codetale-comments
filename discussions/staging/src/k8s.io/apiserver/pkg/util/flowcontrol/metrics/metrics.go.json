[
  {
    "id" : "fb8bd671-fbc3-408c-8362-b9652f9979a1",
    "prId" : 102859,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102859#pullrequestreview-694131907",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "435db104-ae75-45fb-8b76-f79097055333",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "This doesn't look safe if it is called concurrently from the same priorityLevel, is that possible? I suspect not. Please add a comment to the effect that that shouldn't/doesn't happen.",
        "createdAt" : "2021-06-25T22:26:58Z",
        "updatedAt" : "2021-06-25T22:26:58Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "217b19e1-34d3-4273-ba1a-ebd881efa954",
        "parentId" : "435db104-ae75-45fb-8b76-f79097055333",
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "I am not sure which sense of \"safe\" you are thinking about here.\r\nThe Prometheus library calls are safe for concurrent usage.\r\nPerhaps you are thinking about consistency among the several metrics updated by `SetDispatchMetrics`.  This is not a new issue; we already have several places in the code that update a handful of metrics in a series of calls.  Unless and until the Prometheus library supports atomic updating of multiple metrics, we have no hope of such an atomic update.",
        "createdAt" : "2021-06-28T16:00:29Z",
        "updatedAt" : "2021-06-28T16:00:29Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "3930629e130f1c98821f8033941870ab582db284",
    "line" : 84,
    "diffHunk" : "@@ -1,1 +309,313 @@\n// SetLatestS sets the latest-S (virtual time of dispatched request) gauge for the given priority level\nfunc SetDispatchMetrics(priorityLevel string, r, s, sMin, sMax, discountedSMin, discountedSMax float64) {\n\tapiserverDispatchR.WithLabelValues(priorityLevel).Set(r)\n\tapiserverLatestS.WithLabelValues(priorityLevel).Set(s)"
  },
  {
    "id" : "c59a5b13-dd85-441c-a059-7aa5a8f5c7c2",
    "prId" : 102859,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102859#pullrequestreview-694132987",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "296d56a8-ef46-4dce-8c4c-220ae69dbd89",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "I think no one is going to understand these, which is fine, but maybe we can add a breadcrumb, like an \"apf_\" prefix. Either here or in the help line (\"APF: \")?",
        "createdAt" : "2021-06-25T22:28:05Z",
        "updatedAt" : "2021-06-25T22:28:05Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "6abb1a53-1d03-4afa-aff1-669716787923",
        "parentId" : "296d56a8-ef46-4dce-8c4c-220ae69dbd89",
        "authorId" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "body" : "The `subsystem` already says \"flowcontrol\", which is the word we are using here instead of APF.\r\nSince the metric name includes \"flowcontrol\", I think we do not need to repeat that information in the help string.",
        "createdAt" : "2021-06-28T16:01:35Z",
        "updatedAt" : "2021-06-28T16:03:10Z",
        "lastEditedBy" : "7a59a326-58b3-4590-b70a-297d2e27daa5",
        "tags" : [
        ]
      }
    ],
    "commit" : "3930629e130f1c98821f8033941870ab582db284",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +149,153 @@\t\t\tNamespace:      namespace,\n\t\t\tSubsystem:      subsystem,\n\t\t\tName:           \"current_r\",\n\t\t\tHelp:           \"R(time of last change)\",\n\t\t\tStabilityLevel: compbasemetrics.ALPHA,"
  },
  {
    "id" : "e3600130-fc56-4c44-83b2-e64213f96fd5",
    "prId" : 96236,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96236#pullrequestreview-524387554",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2835ea2b-e04d-4087-8c85-38dcf7ebbe77",
        "parentId" : null,
        "authorId" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "body" : "did we forget to set the StabilityLevel everywhere in the metrics below?",
        "createdAt" : "2020-11-05T13:41:35Z",
        "updatedAt" : "2020-11-05T15:35:47Z",
        "lastEditedBy" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "tags" : [
        ]
      },
      {
        "id" : "401a46bd-d259-416c-94e3-a74deaf572ff",
        "parentId" : "2835ea2b-e04d-4087-8c85-38dcf7ebbe77",
        "authorId" : "521b6fc2-4b36-4594-8b5b-9d1e5bcc8759",
        "body" : "Done. Set all metrics to ALPHA.",
        "createdAt" : "2020-11-05T15:35:56Z",
        "updatedAt" : "2020-11-05T15:35:56Z",
        "lastEditedBy" : "521b6fc2-4b36-4594-8b5b-9d1e5bcc8759",
        "tags" : [
        ]
      }
    ],
    "commit" : "b16f36b251ddbfef5f12fed58640de53512631f0",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +36,40 @@\trequestKind   = \"request_kind\"\n\tpriorityLevel = \"priority_level\"\n\tflowSchema    = \"flow_schema\"\n\tphase         = \"phase\"\n\tmark          = \"mark\""
  },
  {
    "id" : "e2433419-3f69-4a06-bc85-07bcf4410184",
    "prId" : 88714,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88714#pullrequestreview-369229215",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b83cf472-6e2f-4e73-84ad-a4b60741a1ff",
        "parentId" : null,
        "authorId" : "09e31512-b413-47a1-bc83-20b5a77064ee",
        "body" : "What's the cardinality of flowSchema.Name?",
        "createdAt" : "2020-03-04T22:32:02Z",
        "updatedAt" : "2020-03-05T20:18:05Z",
        "lastEditedBy" : "09e31512-b413-47a1-bc83-20b5a77064ee",
        "tags" : [
        ]
      },
      {
        "id" : "5ca51888-2de6-4d63-b432-199a116fca9c",
        "parentId" : "b83cf472-6e2f-4e73-84ad-a4b60741a1ff",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "Maybe 10-20? If it gets much bigger than 100-1000, we'll need to make other changes (like compile a decision tree or something).",
        "createdAt" : "2020-03-05T00:52:08Z",
        "updatedAt" : "2020-03-05T20:18:05Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7b098ac6c276d65a79db6cfeb04f5f0f86eb315",
    "line" : 150,
    "diffHunk" : "@@ -1,1 +179,183 @@\n// AddDispatch increments the # of dispatched requests for flow control\nfunc AddDispatch(priorityLevel, flowSchema string) {\n\tapiserverDispatchedRequestsTotal.WithLabelValues(priorityLevel, flowSchema).Add(1)\n}"
  },
  {
    "id" : "81df0fc2-1af3-4791-a834-5723bb8e1da3",
    "prId" : 88311,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88311#pullrequestreview-363014824",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3bf019c-e114-4869-95b7-dec7a5b4872d",
        "parentId" : null,
        "authorId" : "4108cff4-d61c-4717-862b-6c3be3b73be2",
        "body" : "This should according to our instrumentation guideline also have the _total suffix.",
        "createdAt" : "2020-02-22T07:07:00Z",
        "updatedAt" : "2020-02-22T07:07:04Z",
        "lastEditedBy" : "4108cff4-d61c-4717-862b-6c3be3b73be2",
        "tags" : [
        ]
      }
    ],
    "commit" : "a1523a049ff9fc47d7dc2c4354b16b69d2eb4be2",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +53,57 @@\t\t\tNamespace: namespace,\n\t\t\tSubsystem: subsystem,\n\t\t\tName:      \"rejected_requests\",\n\t\t\tHelp:      \"Number of rejected requests by api priority and fairness system\",\n\t\t},"
  }
]