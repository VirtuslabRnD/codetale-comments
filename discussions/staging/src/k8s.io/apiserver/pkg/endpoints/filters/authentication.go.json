[
  {
    "id" : "2ed7affc-1e22-41ea-b0bf-6df0e5433d58",
    "prId" : 87631,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/87631#pullrequestreview-349803032",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4767b018-ae36-48b9-9b9c-4e2142ef6552",
        "parentId" : null,
        "authorId" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "body" : "The error is also logged by `recordMetrics`, so it's double logged here. Pick one.",
        "createdAt" : "2020-01-29T00:26:46Z",
        "updatedAt" : "2020-03-01T00:39:20Z",
        "lastEditedBy" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "tags" : [
        ]
      },
      {
        "id" : "76f838c9-dd59-4331-8b62-04beaccfe554",
        "parentId" : "4767b018-ae36-48b9-9b9c-4e2142ef6552",
        "authorId" : "6a76eaae-b750-44a3-afa5-0d64814ae70a",
        "body" : "Done.",
        "createdAt" : "2020-01-29T00:48:28Z",
        "updatedAt" : "2020-03-01T00:39:20Z",
        "lastEditedBy" : "6a76eaae-b750-44a3-afa5-0d64814ae70a",
        "tags" : [
        ]
      }
    ],
    "commit" : "c0bad80e5b4bf56757e1a4999e831a5341693203",
    "line" : 95,
    "diffHunk" : "@@ -1,1 +59,63 @@\t\tif !audiencesAreAcceptable(apiAuds, resp.Audiences) {\n\t\t\terr = fmt.Errorf(\"unable to match the audience: %v , accepted: %v\", resp.Audiences, apiAuds)\n\t\t\tklog.Error(err)\n\t\t\tfailed.ServeHTTP(w, req)\n\t\t\treturn"
  },
  {
    "id" : "bde96b8e-46ab-47ca-8d4b-69c5a2f35f68",
    "prId" : 82409,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82409#pullrequestreview-285090728",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "599f2c36-bb55-4051-9832-e9dac2aa8364",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "I think you want one of these on 108 and 106 with errorLabel and failureLabel.",
        "createdAt" : "2019-09-06T20:56:26Z",
        "updatedAt" : "2019-09-18T02:04:05Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c0d69e8be69fd2e1c62a292ed44be6c0d4158fc",
    "line" : 62,
    "diffHunk" : "@@ -1,1 +127,131 @@\t\tauthenticatedUserCounter.WithLabelValues(compressUsername(resp.User.GetName())).Inc()\n\t\tauthenticatedAttemptsCounter.WithLabelValues(successLabel).Inc()\n\t\tauthenticationLatency.WithLabelValues(successLabel).Observe(time.Since(authenticationStart).Seconds())\n\n\t\thandler.ServeHTTP(w, req)"
  },
  {
    "id" : "f0bb94ab-1558-4bd3-bed8-8b4159bdbdb8",
    "prId" : 82409,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82409#pullrequestreview-285666034",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a0e86b43-987a-4311-9a58-4222da748b52",
        "parentId" : null,
        "authorId" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "body" : "Are all of the metrics alpha?  There is another one in this file.",
        "createdAt" : "2019-09-09T03:21:26Z",
        "updatedAt" : "2019-09-18T02:04:05Z",
        "lastEditedBy" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "tags" : [
        ]
      },
      {
        "id" : "d4f09789-587f-4fa8-8934-bb6f2d555421",
        "parentId" : "a0e86b43-987a-4311-9a58-4222da748b52",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "Yeah, I think so. \r\nThere is no confidence for us to mark a metric with `stable` state when it is born.\r\n\r\nBy the way, alpha is default stability level for a metric and there is no beta stage(in future maybe )",
        "createdAt" : "2019-09-09T07:13:41Z",
        "updatedAt" : "2019-09-18T02:04:05Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "dc1e2e45-1027-43cb-8318-0181156b63ec",
        "parentId" : "a0e86b43-987a-4311-9a58-4222da748b52",
        "authorId" : "09e31512-b413-47a1-bc83-20b5a77064ee",
        "body" : "Yes, they all start in alpha.",
        "createdAt" : "2019-09-09T17:30:49Z",
        "updatedAt" : "2019-09-18T02:04:05Z",
        "lastEditedBy" : "09e31512-b413-47a1-bc83-20b5a77064ee",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c0d69e8be69fd2e1c62a292ed44be6c0d4158fc",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +62,66 @@\t\t\tName:           \"authentication_attempts\",\n\t\t\tHelp:           \"Counter of authenticated attempts.\",\n\t\t\tStabilityLevel: metrics.ALPHA,\n\t\t},\n\t\t[]string{\"result\"},"
  },
  {
    "id" : "50d65ed4-d079-43a1-a014-e4fe577334ef",
    "prId" : 82409,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82409#pullrequestreview-293263846",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "This bucketing might be a little abrasive depending on the actual latency. We may need to adjust.",
        "createdAt" : "2019-09-19T15:21:09Z",
        "updatedAt" : "2019-09-19T15:21:19Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "8ff1e95f-32e2-4f09-9298-06a017dde4a0",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "Could you give me some specific instructions?",
        "createdAt" : "2019-09-20T01:04:22Z",
        "updatedAt" : "2019-09-20T01:04:23Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "bb46cec4-4412-44c0-afcb-a8d8b7b34077",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "If I read this right, the buckets are:\r\n\r\n```\r\nn | 0.001 n^2\r\n1 | 0.001\r\n2 | 0.004\r\n3 | 0.009\r\n4 | 0.016\r\n5 | 0.025\r\n6 | 0.036\r\n7 | 0.049\r\n8 | 0.064\r\n9 | 0.081\r\n10 | 0.1\r\n11 | 0.121\r\n12 | 0.144\r\n13 | 0.169\r\n14 | 0.196\r\n15 | 0.225\r\n```\r\nWhat if authentication takes a second or ten seconds? It'll get put in the 15th bucket along with the ones the requests that took 0.2 seconds. In my experience, I've never been thrilled with exponential bucketing. Unless you actually have a good idea of performance before setting the parameters, it tends to cause weird data issues when you actually want to know how long stuff takes.",
        "createdAt" : "2019-09-20T01:19:38Z",
        "updatedAt" : "2019-09-20T01:19:39Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "e680c11b-235d-4af9-9022-ad37dcc647db",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "The buckets seem not what you think. Wait a moment, I try to dump from my local cluster.",
        "createdAt" : "2019-09-20T01:25:41Z",
        "updatedAt" : "2019-09-20T01:25:41Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "63bf3a54-0f8d-4b31-8e62-68e2d57f1a5c",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "This comes from my local cluster.\r\n```\r\n# HELP authentication_duration_seconds [ALPHA] Authentication duration in seconds broken out by result.\r\n# TYPE authentication_duration_seconds histogram\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.001\"} 1143\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.002\"} 1143\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.004\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.008\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.016\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.032\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.064\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.128\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.256\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"0.512\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"1.024\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"2.048\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"4.096\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"8.192\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"16.384\"} 1144\r\nauthentication_duration_seconds_bucket{result=\"success\",le=\"+Inf\"} 1144\r\nauthentication_duration_seconds_sum{result=\"success\"} 0.14704390199999995\r\nauthentication_duration_seconds_count{result=\"success\"} 1144\r\n```",
        "createdAt" : "2019-09-20T01:29:47Z",
        "updatedAt" : "2019-09-20T01:29:47Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "96fec71d-c0d3-44b1-a640-621687fb2fb3",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "@enj has pointed the similar issue. So, I enlarged the bucketed number from `10` to `15`. ",
        "createdAt" : "2019-09-20T01:35:57Z",
        "updatedAt" : "2019-09-20T01:35:57Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "cdd6ab94-1b4b-492a-ab56-b0fc1cab4666",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Oops, I did n^2 instead of 2^n. Those look fine for now although we may want higher density above 1 second in the future. ",
        "createdAt" : "2019-09-20T02:41:18Z",
        "updatedAt" : "2019-09-20T02:41:18Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "46222faf-6a4e-4136-a406-cd6be6e4c9c9",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "OK. By the way, most latency metric using the same bucket.\r\n\r\nNow let's call @liggitt help review and approve.\r\n",
        "createdAt" : "2019-09-20T02:46:52Z",
        "updatedAt" : "2019-09-20T02:46:53Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      },
      {
        "id" : "5b2a618a-0896-4708-b891-314157e81f2c",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "cc @brancz @logicalhan on bucket count/size",
        "createdAt" : "2019-09-24T05:03:45Z",
        "updatedAt" : "2019-09-24T05:03:46Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "a55573e3-e565-409f-b1e1-10934d31e8c7",
        "parentId" : "d898018f-7bb2-4214-86ed-22b2a059ba9a",
        "authorId" : "31a2ac00-6c67-4307-a4bc-bfd13f41ef27",
        "body" : "Bucket count/sizes look okay to me.",
        "createdAt" : "2019-09-25T18:03:49Z",
        "updatedAt" : "2019-09-25T18:03:50Z",
        "lastEditedBy" : "31a2ac00-6c67-4307-a4bc-bfd13f41ef27",
        "tags" : [
        ]
      }
    ],
    "commit" : "0c0d69e8be69fd2e1c62a292ed44be6c0d4158fc",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +71,75 @@\t\t\tName:           \"authentication_duration_seconds\",\n\t\t\tHelp:           \"Authentication duration in seconds broken out by result.\",\n\t\t\tBuckets:        metrics.ExponentialBuckets(0.001, 2, 15),\n\t\t\tStabilityLevel: metrics.ALPHA,\n\t\t},"
  },
  {
    "id" : "887d7b3c-c599-496b-b7aa-0ade51bedd09",
    "prId" : 81509,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81509#pullrequestreview-277520640",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "afa2ebe9-0776-46ee-b131-c119b2779084",
        "parentId" : null,
        "authorId" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "body" : "It is probably safer to avoid multiple paths that return:\r\n\r\n```go\r\nresp, ok, err := auth.AuthenticateRequest(req)\r\nif err != nil || !ok {\r\n\tif err != nil {\r\n\t\tklog.Errorf(\"Unable to authenticate the request due to an error: %v\", err)\r\n\t\tauthenticationErrorCounter.Inc()\r\n\t}\r\n\tif !ok {\r\n\t\tauthenticationFailureCounter.Inc()\r\n\t}\r\n\r\n\tfailed.ServeHTTP(w, req)\r\n\treturn\r\n}\r\n```",
        "createdAt" : "2019-08-20T18:16:05Z",
        "updatedAt" : "2019-08-28T18:00:17Z",
        "lastEditedBy" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "tags" : [
        ]
      },
      {
        "id" : "d36acc0b-2e56-4f36-b96d-ab59fb0b09a9",
        "parentId" : "afa2ebe9-0776-46ee-b131-c119b2779084",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "Done.",
        "createdAt" : "2019-08-21T01:39:32Z",
        "updatedAt" : "2019-08-28T18:00:17Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      }
    ],
    "commit" : "a7ac3b9bbe3f3e35117bd7109997e58ce467f0a9",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +93,97 @@\t\t\t}\n\n\t\t\tfailed.ServeHTTP(w, req)\n\t\t\treturn\n\t\t}"
  },
  {
    "id" : "380710ab-73fa-4ce2-ab94-a8053cea8d71",
    "prId" : 81509,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81509#pullrequestreview-280998476",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "029fead0-f1a8-489c-a249-a286f9c9ca98",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this double counts an attempt that results in `false, non-nil-err`... is that intentional?",
        "createdAt" : "2019-08-28T16:42:25Z",
        "updatedAt" : "2019-08-28T18:00:17Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "923254c8-1fad-4c26-a4db-1c8b8fa1d709",
        "parentId" : "029fead0-f1a8-489c-a249-a286f9c9ca98",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "good catch, probably want this to be an `else if`",
        "createdAt" : "2019-08-28T16:59:13Z",
        "updatedAt" : "2019-08-28T18:00:17Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "b3ba99f4-6de2-456c-ab96-bdcab10d3140",
        "parentId" : "029fead0-f1a8-489c-a249-a286f9c9ca98",
        "authorId" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "body" : "wonderful comments.\r\n\r\nDone.",
        "createdAt" : "2019-08-28T17:48:34Z",
        "updatedAt" : "2019-08-28T18:00:17Z",
        "lastEditedBy" : "ae15cfb8-5436-4398-94e0-d443e413b257",
        "tags" : [
        ]
      }
    ],
    "commit" : "a7ac3b9bbe3f3e35117bd7109997e58ce467f0a9",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +90,94 @@\t\t\t\tauthenticatedAttemptsCounter.WithLabelValues(errorLabel).Inc()\n\t\t\t} else if !ok {\n\t\t\t\tauthenticatedAttemptsCounter.WithLabelValues(failureLabel).Inc()\n\t\t\t}\n"
  },
  {
    "id" : "445a9c1f-b7da-47d9-b30d-d8dcdfa8e441",
    "prId" : 69607,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69607#pullrequestreview-164936802",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "36c1dd8c-5bbd-4ae1-9f90-7dd6291bde84",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "Once the response includes audience indication, will we verify the response audience matches one of apiAuds if non-empty?",
        "createdAt" : "2018-10-15T22:38:34Z",
        "updatedAt" : "2018-10-15T22:43:23Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "ab11fecf-39ca-4193-9bb0-e69f61e1c609",
        "parentId" : "36c1dd8c-5bbd-4ae1-9f90-7dd6291bde84",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "I suspect we will want to validate that here, in the webhook authenticator and in TokenReview.",
        "createdAt" : "2018-10-15T23:38:47Z",
        "updatedAt" : "2018-10-15T23:38:47Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      }
    ],
    "commit" : "21fd8f204128a7847786927b460d95be34a6dbde",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +58,62 @@\treturn http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n\t\tif len(apiAuds) > 0 {\n\t\t\treq = req.WithContext(genericapirequest.WithAudiences(req.Context(), apiAuds))\n\t\t}\n\t\tuser, ok, err := auth.AuthenticateRequest(req)"
  },
  {
    "id" : "1cc3dde5-12b4-4112-960d-7baf7b5098cd",
    "prId" : 69582,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69582#pullrequestreview-165363661",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "565df7e4-2f06-4f1b-8e7c-40b244097a9f",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "TODO to check if the response has a valid audience if apiAuds is non-empty",
        "createdAt" : "2018-10-16T13:32:21Z",
        "updatedAt" : "2018-10-22T19:11:52Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "80777dce-fc38-435c-8514-202eca458590",
        "parentId" : "565df7e4-2f06-4f1b-8e7c-40b244097a9f",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Added TODO here and in TokenReview storage.",
        "createdAt" : "2018-10-16T20:55:02Z",
        "updatedAt" : "2018-10-22T19:11:53Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      }
    ],
    "commit" : "809f278b032103cd24fcbb5ea2196c6c7caa6f63",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +74,78 @@\t\t// authorization header is not required anymore in case of a successful authentication.\n\t\treq.Header.Del(\"Authorization\")\n\n\t\treq = req.WithContext(genericapirequest.WithUser(req.Context(), resp.User))\n"
  }
]