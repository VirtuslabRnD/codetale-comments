[
  {
    "id" : "08685b5f-e0b7-48e3-a882-d6c31acc71e6",
    "prId" : 89305,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89305#pullrequestreview-381488321",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "408a6ff5-1b7c-4244-a8b4-86e526a6e1e2",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Fold into WithAudit so other external apiservers that have audit enabled get this for free? I see no reason why we don't always want this.",
        "createdAt" : "2020-03-20T18:22:44Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "1b52fee9-73e9-4eef-81a4-de40b68a7a51",
        "parentId" : "408a6ff5-1b7c-4244-a8b4-86e526a6e1e2",
        "authorId" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "body" : "I do not understand the request.\r\n\r\n`WithAuditAnnotations` is a distinct wrapper because we need something early in the chain before `WithAudit`.  `WithAudit` cannot be moved earlier in the chain because it relies on `WithAuthentication`.  This basically breaks the \"import cycle\" that authentication and audit have with each other.",
        "createdAt" : "2020-03-20T18:27:24Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "tags" : [
        ]
      },
      {
        "id" : "df42c171-698e-4e75-827b-8a6cb9c8cba5",
        "parentId" : "408a6ff5-1b7c-4244-a8b4-86e526a6e1e2",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "Ah, ordering...",
        "createdAt" : "2020-03-20T18:27:43Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "ed298f11-bba0-4ec9-bd85-8f6cc2074fbf",
        "parentId" : "408a6ff5-1b7c-4244-a8b4-86e526a6e1e2",
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "This is vaguely reminiscent of https://github.com/kubernetes/kubernetes/issues/86063\r\n\r\n",
        "createdAt" : "2020-03-25T19:31:55Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "b2210f71-ddf8-4ed7-bc77-cd1277daa297",
        "parentId" : "408a6ff5-1b7c-4244-a8b4-86e526a6e1e2",
        "authorId" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "body" : "Yeah, we may have taken this wrapping of handlers and context too far...",
        "createdAt" : "2020-03-25T19:56:19Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0bc62112adf270ef4efada37286319c229324c7b",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +30,34 @@func WithAuditAnnotations(handler http.Handler, sink audit.Sink, policy policy.Checker) http.Handler {\n\t// no need to wrap if auditing is disabled\n\tif sink == nil || policy == nil {\n\t\treturn handler\n\t}"
  },
  {
    "id" : "2db00fd2-690b-4901-8ba1-6aaa8c4c6364",
    "prId" : 89305,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89305#pullrequestreview-390402613",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f15fa4eb-9088-4545-bf67-6e3637f488b8",
        "parentId" : null,
        "authorId" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "body" : "It's pretty strange that these are passed in but not used. Can we change this to a `enabled bool` or just not call this function if audit is disabled? I have a preference towards checking this condition outside of this function.",
        "createdAt" : "2020-04-06T22:09:28Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "392f7c7a-6820-4848-94e2-2b8e009fec9d",
        "tags" : [
        ]
      },
      {
        "id" : "ee72d4c0-2da0-4a8b-8070-87f6fe1ae240",
        "parentId" : "f15fa4eb-9088-4545-bf67-6e3637f488b8",
        "authorId" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "body" : "The bulk of our handlers check their inputs and do no wrapping when disabled (ex: `WithAudit`, `WithAuthentication`):\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/0f76d5c5eb6d45acf20027a272b4f8ed418889bc/staging/src/k8s.io/apiserver/pkg/server/config.go#L660-L682\r\n\r\nTo me it would be better to get rid of those two `if` statements so that chain is easier to read.  Most of our wrappers are already `MaybeWithFoo` style functions.  I do not want to diverge from that.",
        "createdAt" : "2020-04-08T23:41:39Z",
        "updatedAt" : "2020-04-08T23:53:25Z",
        "lastEditedBy" : "e58080d6-2177-419f-a546-b51075d7bcb8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0bc62112adf270ef4efada37286319c229324c7b",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +28,32 @@// (such as authentication) to assert annotations.\n// If sink or audit policy is nil, no decoration takes place.\nfunc WithAuditAnnotations(handler http.Handler, sink audit.Sink, policy policy.Checker) http.Handler {\n\t// no need to wrap if auditing is disabled\n\tif sink == nil || policy == nil {"
  }
]