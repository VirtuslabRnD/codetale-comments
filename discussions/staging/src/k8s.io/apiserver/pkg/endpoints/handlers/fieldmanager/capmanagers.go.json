[
  {
    "id" : "f05b46bf-ada1-4a9e-a0ad-43368f99b5d3",
    "prId" : 88035,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88035#pullrequestreview-356999342",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a74dfe4f-2f9c-474f-bb78-b5a40795b93c",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "This sort routine doesn't actually matter for this bug, since it combines the oldest ones, it's fine if new ones have extra precision.",
        "createdAt" : "2020-02-11T21:14:42Z",
        "updatedAt" : "2020-02-11T21:14:42Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "888a322d9ca3070b811b348e05ee4a3ce7da6ae9",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +78,82 @@\t// If we have more than the maximum, sort the update entries by time, oldest first.\n\tsort.Slice(updaters, func(i, j int) bool {\n\t\tiTime, jTime, iSeconds, jSeconds := managed.Times()[updaters[i]], managed.Times()[updaters[j]], int64(0), int64(0)\n\t\tif iTime != nil {\n\t\t\tiSeconds = iTime.Unix()"
  },
  {
    "id" : "38c887c2-bd77-4f4f-bd6c-e8d1f94aee12",
    "prId" : 81816,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/81816#pullrequestreview-298369125",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1a8f494c-3ae2-42dc-8c4a-4a8be977b59b",
        "parentId" : null,
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Should we add a log at the end of the loop with the reduction in length and the total time the loop takes ?\r\n```\r\ndiff --git a/staging/src/k8s.io/apiserver/pkg/endpoints/handlers/fieldmanager/capmanagers.go b/staging/src/k8s.io/apiserver/pkg/endpoints/handlers/fieldmanager/capmanagers.go\r\nindex 8c38461613..e0e6223476 100644\r\n--- a/staging/src/k8s.io/apiserver/pkg/endpoints/handlers/fieldmanager/capmanagers.go\r\n+++ b/staging/src/k8s.io/apiserver/pkg/endpoints/handlers/fieldmanager/capmanagers.go\r\n@@ -24,6 +24,7 @@ import (\r\n        metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n        \"k8s.io/apimachinery/pkg/runtime\"\r\n        \"k8s.io/apiserver/pkg/endpoints/handlers/fieldmanager/internal\"\r\n+       \"k8s.io/klog\"\r\n        \"sigs.k8s.io/structured-merge-diff/fieldpath\"\r\n )\r\n\r\n@@ -93,6 +94,8 @@ func (f *capManagersManager) capUpdateManagers(managed Managed) (newManaged Mana\r\n\r\n        // Merge the oldest updaters with versioned bucket managers until the number of updaters is under the cap\r\n        versionToFirstManager := map[string]string{}\r\n+       originalLength := len(updaters)\r\n+       startTime := time.Now()\r\n        for i, length := 0, len(updaters); i < len(updaters) && length > f.maxUpdateManagers; i++ {\r\n                manager := updaters[i]\r\n                vs := managed.Fields()[manager]\r\n@@ -130,6 +133,7 @@ func (f *capManagersManager) capUpdateManagers(managed Managed) (newManaged Mana\r\n                        versionToFirstManager[version] = manager\r\n                }\r\n        }\r\n+       klog.Infof(\"reduced the number of updaters from %v to %v in %v\", originalLength, f.maxUpdateManagers, time.Now().Sub(startTime))\r\n\r\n        return managed, nil\r\n }\r\n```",
        "createdAt" : "2019-10-05T15:46:03Z",
        "updatedAt" : "2019-10-05T15:53:45Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "327c5db3-6652-4072-a3c7-62bdc49d754e",
        "parentId" : "1a8f494c-3ae2-42dc-8c4a-4a8be977b59b",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "Why would we do that?",
        "createdAt" : "2019-10-06T16:42:23Z",
        "updatedAt" : "2019-10-06T16:42:24Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      },
      {
        "id" : "aad2cfca-ba4a-47ae-aa05-c60c60be7388",
        "parentId" : "1a8f494c-3ae2-42dc-8c4a-4a8be977b59b",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "To have some idea how long the merge has taken.\r\nCurrently maxUpdateManagers is at 10. This may evolve in the future.",
        "createdAt" : "2019-10-06T16:56:37Z",
        "updatedAt" : "2019-10-06T16:56:37Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "1f206355-a6f3-4d2b-9a08-2c2cd8d065d4",
        "parentId" : "1a8f494c-3ae2-42dc-8c4a-4a8be977b59b",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "I think if we really cared about this value, then we would expose a metric for it rather than a log? @logicalhan \r\nAlso this is supposed to be very fast, we could also write a benchmark? These all seem good, but not as important as the other things we're doing.",
        "createdAt" : "2019-10-07T16:10:16Z",
        "updatedAt" : "2019-10-07T16:10:16Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      },
      {
        "id" : "ac997055-1d7b-4955-b553-9049216f858b",
        "parentId" : "1a8f494c-3ae2-42dc-8c4a-4a8be977b59b",
        "authorId" : "37324129-fa96-456d-92ea-e5f9b41f8c7f",
        "body" : "I think if we wanted to expose a metric about managedFields update latency, it should probably be from start to finish of the entire managedFields update, from when it starts being decoded to when it is finally encoded back into the object.",
        "createdAt" : "2019-10-07T19:49:33Z",
        "updatedAt" : "2019-10-07T19:49:33Z",
        "lastEditedBy" : "37324129-fa96-456d-92ea-e5f9b41f8c7f",
        "tags" : [
        ]
      }
    ],
    "commit" : "61b19c729892a150b61dde19359f6fb19e8d61f1",
    "line" : 96,
    "diffHunk" : "@@ -1,1 +94,98 @@\t// Merge the oldest updaters with versioned bucket managers until the number of updaters is under the cap\n\tversionToFirstManager := map[string]string{}\n\tfor i, length := 0, len(updaters); i < len(updaters) && length > f.maxUpdateManagers; i++ {\n\t\tmanager := updaters[i]\n\t\tvs := managed.Fields()[manager]"
  }
]