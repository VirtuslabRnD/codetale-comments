[
  {
    "id" : "ce813cc7-22f8-487c-84c7-c8e29f0536ae",
    "prId" : 102105,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102105#pullrequestreview-662570262",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c40d14c5-3a72-4318-a507-b1eb70b7770e",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this is fine for this PR, since we'll want to pick this back to 1.19-1.21, but in a follow-up, we should make the apimachinery annotations size validation public and use that instead of a fork so the logic doesn't drift\r\n\r\ncan you open an issue to track that for 1.22?",
        "createdAt" : "2021-05-18T20:47:32Z",
        "updatedAt" : "2021-05-18T20:47:32Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "627b8df4-1866-4014-b1a4-24f215e8f6a0",
        "parentId" : "c40d14c5-3a72-4318-a507-b1eb70b7770e",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Will do. Another option that sounds similar is we could call ValidateAnnotations and check that the error list is empty, but might be not ideal if ValidateAnnotations expands too much",
        "createdAt" : "2021-05-18T20:51:11Z",
        "updatedAt" : "2021-05-18T20:51:11Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      },
      {
        "id" : "b6e26e80-e639-407a-8287-caf2ba9b44f9",
        "parentId" : "c40d14c5-3a72-4318-a507-b1eb70b7770e",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "yeah, I don't want false-positives if another annotation in the update had a key with a disallowed character or something",
        "createdAt" : "2021-05-18T20:52:38Z",
        "updatedAt" : "2021-05-18T20:52:38Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "a7af6b7a-e8c1-4c87-9c2e-0af3a8b48d5e",
        "parentId" : "c40d14c5-3a72-4318-a507-b1eb70b7770e",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Done: https://github.com/kubernetes/kubernetes/issues/102110",
        "createdAt" : "2021-05-18T21:00:23Z",
        "updatedAt" : "2021-05-18T21:00:23Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      }
    ],
    "commit" : "6054320be1e50a450e9d1e19a79caa96f2035d4d",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +122,126 @@}\n\nfunc isAnnotationsValid(annotations map[string]string) error {\n\tvar totalSize int64\n\tfor k, v := range annotations {"
  },
  {
    "id" : "b959d924-cb2d-4729-8dc0-abd976fff9a9",
    "prId" : 90187,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/90187#pullrequestreview-395756015",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d69d7ccc-9698-410c-b3d9-71de1251b755",
        "parentId" : null,
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "I don't think these two lines are needed or even good here. You should probably just update rather than delete and re-insert.",
        "createdAt" : "2020-04-17T17:12:14Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      },
      {
        "id" : "04d8c55b-08d4-4971-9074-cbc1a54abf67",
        "parentId" : "d69d7ccc-9698-410c-b3d9-71de1251b755",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "We need to remove the last-applied annotation when we serialize the object since it will be in the annotation itself. Here's the corresponding client-side apply method:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/875d3b534e3f6f118c3bf7f7e5a6b4c6ac6fe92a/staging/src/k8s.io/kubectl/pkg/util/apply.go#L71-L74",
        "createdAt" : "2020-04-17T18:08:41Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      },
      {
        "id" : "63771af8-2517-4aab-9b63-c7dc51cfc730",
        "parentId" : "d69d7ccc-9698-410c-b3d9-71de1251b755",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "Ah yes, your right! Thanks :-)",
        "createdAt" : "2020-04-17T20:35:13Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      }
    ],
    "commit" : "e4368eb67e363d3d03f81214a8929268d2fe88ff",
    "line" : 95,
    "diffHunk" : "@@ -1,1 +93,97 @@\t}\n\tannotations[corev1.LastAppliedConfigAnnotation] = value\n\taccessor.SetAnnotations(annotations)\n\treturn nil\n}"
  },
  {
    "id" : "2f756bdb-3879-4cf7-9048-80aa9a258988",
    "prId" : 90187,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/90187#pullrequestreview-661582192",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d0dd5b4a-38dc-4d64-8dcc-88a0c207cbe0",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this needs to check if the new annotation value causes https://github.com/kubernetes/kubectl/issues/712 and if so, I think it should clear the annotation rather than populating annotations that fail validation",
        "createdAt" : "2021-05-18T01:49:00Z",
        "updatedAt" : "2021-05-18T01:49:00Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "637a8c7b-0c0d-485d-95e8-24cc49145c43",
        "parentId" : "d0dd5b4a-38dc-4d64-8dcc-88a0c207cbe0",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Ah will send a change",
        "createdAt" : "2021-05-18T02:33:02Z",
        "updatedAt" : "2021-05-18T02:33:02Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      }
    ],
    "commit" : "e4368eb67e363d3d03f81214a8929268d2fe88ff",
    "line" : 67,
    "diffHunk" : "@@ -1,1 +65,69 @@\t\tif err != nil {\n\t\t\treturn nil, nil, fmt.Errorf(\"failed to set last-applied annotation: %v\", err)\n\t\t}\n\t}\n\treturn liveObj, managed, err"
  }
]