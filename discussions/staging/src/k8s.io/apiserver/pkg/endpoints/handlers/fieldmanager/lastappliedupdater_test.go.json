[
  {
    "id" : "76a68a18-3a16-4df9-942e-eaf2751ac9ee",
    "prId" : 102105,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102105#pullrequestreview-662556702",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "I'm surprised we're updating an invalid CSA annotation to a valid one... shouldn't we just be dropping it in this case?",
        "createdAt" : "2021-05-18T20:16:11Z",
        "updatedAt" : "2021-05-18T20:16:11Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "7f7c7a6c-8af0-47c2-b77c-bc7d072dbc56",
        "parentId" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Currently we check if the annotation simply exists, but we could try to decode the annotation and otherwise drop it if it's invalid",
        "createdAt" : "2021-05-18T20:20:47Z",
        "updatedAt" : "2021-05-18T20:20:47Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      },
      {
        "id" : "c59d0313-90b7-49cb-9c6b-6b04b9b1e074",
        "parentId" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "Decoding sounds expensive... let's keep PR this focused on the size issue, I guess. How would someone wanting to transition from CSA to SSA and clear the annotation for space reasons do it with apply? Wouldn't they have to set it to \"\" in their SSA request? We should at least check that the old annotation is non-empty when deciding to update it.",
        "createdAt" : "2021-05-18T20:24:20Z",
        "updatedAt" : "2021-05-18T20:26:58Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "d502a8e0-122a-4a9d-a8d8-912e5907cfec",
        "parentId" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Yeah that sounds like a reasonable check. Currently, users would clear the annotation to opt out of this behavior, but setting it to \"\" sounds like they're also expressing that they want to opt-out of the behavior. I'll add a non-empty check.",
        "createdAt" : "2021-05-18T20:28:11Z",
        "updatedAt" : "2021-05-18T20:28:12Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      },
      {
        "id" : "bdbf1608-e7a1-4b9c-a154-88d16a23ede8",
        "parentId" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "> Currently, users would clear the annotation to opt out of this behavior\r\n\r\nthere's no way to clear an annotation you don't own with a server-side apply other than setting it to \"\", right?",
        "createdAt" : "2021-05-18T20:40:22Z",
        "updatedAt" : "2021-05-18T20:40:22Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "a9c73f4d-8f78-42f4-8f14-513be92233d8",
        "parentId" : "e7486ea5-d1f5-41c2-957e-5a5c0c527bbd",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "Oh right, when you don't have exclusive ownership. And in this case, CSA and SSA would always share ownership. Related: https://github.com/kubernetes/kubernetes/issues/99003",
        "createdAt" : "2021-05-18T20:45:20Z",
        "updatedAt" : "2021-05-18T20:45:21Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      }
    ],
    "commit" : "6054320be1e50a450e9d1e19a79caa96f2035d4d",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +112,116 @@\t\t\t\t\tNamespace: \"default\",\n\t\t\t\t\tAnnotations: map[string]string{\n\t\t\t\t\t\tcorev1.LastAppliedConfigAnnotation: \"nonempty\",\n\t\t\t\t\t},\n\t\t\t\t},"
  },
  {
    "id" : "df9e5df5-7c1f-4443-b78d-274e7444eee0",
    "prId" : 90187,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/90187#pullrequestreview-445140578",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f25d24d8-89ce-43ef-ad74-b78d3b914642",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "I'd feel more comfortable if this were checked golden data, or then actually run through the kubectl CSA logic to ensure that it's actually compatible.",
        "createdAt" : "2020-07-08T18:00:13Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "d8bf7895-2556-4c10-9ed4-132445f34e5e",
        "parentId" : "f25d24d8-89ce-43ef-ad74-b78d3b914642",
        "authorId" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "body" : "The integration test in test/cmd uses kubectl directly -- is this okay? Maybe we can do something better in test/integration/apiserver/apply/apply_test.go too.",
        "createdAt" : "2020-07-08T21:21:39Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "f40287b7-c508-4d95-b3ad-07d0de320962",
        "tags" : [
        ]
      },
      {
        "id" : "d020bf4a-b40f-41dd-befe-369dd86e08d0",
        "parentId" : "f25d24d8-89ce-43ef-ad74-b78d3b914642",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "Yeah that's probably good enough. As long as we would notice if it broke.",
        "createdAt" : "2020-07-08T21:25:58Z",
        "updatedAt" : "2020-07-08T23:14:31Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "e4368eb67e363d3d03f81214a8929268d2fe88ff",
    "line" : 86,
    "diffHunk" : "@@ -1,1 +84,88 @@\t}\n\n\tif lastApplied == originalLastApplied ||\n\t\t!strings.Contains(lastApplied, \"my-app\") ||\n\t\t!strings.Contains(lastApplied, \"my-image\") {"
  }
]