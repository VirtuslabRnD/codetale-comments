[
  {
    "id" : "27395499-1bfc-4a19-90dc-d91ff0ffe19a",
    "prId" : 102539,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102539#pullrequestreview-674603101",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1c1e360a-f7d8-41f4-8f31-3e11ef645f3d",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this ensures the invariant that resultCh is closed when run() returns",
        "createdAt" : "2021-06-02T19:26:20Z",
        "updatedAt" : "2021-06-02T19:26:21Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd2d63dd57e6011bfa3218e59e27fddaa295426b",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +48,52 @@\tvar recv, send watch.Event\n\tvar ok bool\n\tdefer close(d.resultCh)\n\tfor {\n\t\tselect {"
  },
  {
    "id" : "0d188207-a908-463d-8a31-5238749f78dd",
    "prId" : 102539,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102539#pullrequestreview-674604314",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bad1c47c-7550-4ff6-8cd9-f60e1e4729d8",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "always stop the underlying watcher if our context is done",
        "createdAt" : "2021-06-02T19:27:59Z",
        "updatedAt" : "2021-06-02T19:27:59Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd2d63dd57e6011bfa3218e59e27fddaa295426b",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +69,73 @@\t\t\tcase <-ctx.Done():\n\t\t\t\t// context timed out or was cancelled, stop the underlying watcher\n\t\t\t\td.w.Stop()\n\t\t\t\treturn\n\t\t\t}"
  },
  {
    "id" : "83f224a0-8fb8-452a-9bad-3834299ef70c",
    "prId" : 102539,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102539#pullrequestreview-674604950",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d7eb16f7-bcbb-461d-a69e-952f8495106c",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "directly call Stop on the underlying watcher, otherwise an always ready underlying watcher result channel can win the `select` race in the `run` loop and we might never hit the ctx.Done() case",
        "createdAt" : "2021-06-02T19:28:51Z",
        "updatedAt" : "2021-06-02T19:28:51Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd2d63dd57e6011bfa3218e59e27fddaa295426b",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +82,86 @@func (d *decoratedWatcher) Stop() {\n\t// stop the underlying watcher\n\td.w.Stop()\n\t// cancel our context\n\td.cancel()"
  },
  {
    "id" : "0fa7fe37-e183-4c63-97f9-f11afde17471",
    "prId" : 96393,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96393#pullrequestreview-549480776",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b7b17ef0-7892-4a04-8e5d-d44d674e0009",
        "parentId" : null,
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "reading down, this was actually still an ObjectFunc.  Can we leave it as one.",
        "createdAt" : "2020-12-10T18:21:51Z",
        "updatedAt" : "2021-01-08T19:14:39Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      }
    ],
    "commit" : "37b34f5b53edec78ca33929443bb4ba9a9534ed1",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +28,32 @@type decoratedWatcher struct {\n\tw         watch.Interface\n\tdecorator func(runtime.Object)\n\tcancel    context.CancelFunc\n\tresultCh  chan watch.Event"
  }
]