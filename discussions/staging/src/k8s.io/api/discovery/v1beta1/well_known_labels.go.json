[
  {
    "id" : "0c7158b6-e3ee-48d5-a307-3b771866a0cc",
    "prId" : 91637,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/91637#pullrequestreview-437001721",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "parentId" : null,
        "authorId" : "e83108b8-1fb2-416b-9298-d5b70c14f708",
        "body" : "I am wondering if the controller can look up the corresponding service in the cache to see if it has a selector or not, and decide whether it needs to mirror the endpoints. Instead of relying on the label. I guess these are the following scenarios.\r\n\r\n1. Service with selector. => no need to mirror\r\n2. Service without selector AND no Endpoints => no need to mirror\r\n3. Service without selector AND has an custom Endpoints object AND no skip mirror label => need to mirror\r\n4. Service without selector AND has an custom Endpoints object AND has skip mirror label => no need to mirror\r\n\r\n\r\n\r\n\r\n",
        "createdAt" : "2020-06-23T16:49:35Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "e83108b8-1fb2-416b-9298-d5b70c14f708",
        "tags" : [
        ]
      },
      {
        "id" : "cce73e6c-6ab8-421b-b8a4-df03c9687d99",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "body" : "This would be a relatively significant deviation from the KEP, but I think it could be worthwhile. This would mean I could remove all changes from the Endpoints controller as part of this PR, and maybe more significantly, would remove the need for the significant startup wait sequence for this controller. If there were any bugs in that startup wait sequence the controller may never actually start up. It looks like @thockin may already [suggested something like this here](https://github.com/kubernetes/enhancements/pull/1713#discussion_r426089134). If there are no objections, I'll start moving towards this approach.",
        "createdAt" : "2020-06-23T17:47:26Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "tags" : [
        ]
      },
      {
        "id" : "cad4473e-e1de-4b9c-9aeb-6d56d85408c0",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "body" : "I've updated this PR to use the suggested approach above, I think it is better than requiring the skip-mirror label to be set everywhere and blocking controller startup for that. One place I have not changed that is the self-referential API Server EndpointSlice. The `kubernetes` EndpointSlice is essentially a mirror of the `kubernetes` Endpoints resource, but it's managed by `pkg/master` and not the EndpointSliceMirroring controller. Changing that to use this controller would be messy at best. It also feels backwards to have API Server be dependent on kube-controller-manager.",
        "createdAt" : "2020-06-23T23:23:07Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "tags" : [
        ]
      },
      {
        "id" : "8fad31dd-b5da-4199-8f0e-92ea465534f6",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "mostly curiosity, is there a case of endpoints without services associated?",
        "createdAt" : "2020-06-24T10:51:57Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      },
      {
        "id" : "4015a2b9-6c11-41b0-b8db-888830837e2c",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "body" : "Great question. I can't think of any that are officially supported, though of course it can happen. From what I can tell, kube-proxy will disregard any endpoints that don't have an associated service. (It loops through services and gets any associated endpoints).",
        "createdAt" : "2020-06-24T17:10:58Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "399a0f74-29de-4365-9ae5-f743ae5f278c",
        "tags" : [
        ]
      },
      {
        "id" : "c873cbab-9144-4a14-a24c-6009d0564e81",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "just for clarification, the question was unrelated to this PR :smile: ",
        "createdAt" : "2020-06-24T20:52:41Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      },
      {
        "id" : "ade8ff6d-f39c-4cc7-8dc1-55c9fbbcc68a",
        "parentId" : "512585bc-ca02-4e88-a13e-367f13ad9b1f",
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "Endpoints without a same-name service are automatically removed eventually",
        "createdAt" : "2020-06-24T21:48:28Z",
        "updatedAt" : "2020-07-06T19:44:11Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      }
    ],
    "commit" : "fa59370e9348e3f04fdf86defa1b8de132e39562",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +29,33 @@\t// that the EndpointSliceMirroring controller should not mirror this\n\t// resource with EndpointSlices.\n\tLabelSkipMirror = \"endpointslice.kubernetes.io/skip-mirror\"\n)"
  }
]