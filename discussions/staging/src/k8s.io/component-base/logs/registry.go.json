[
  {
    "id" : "67647f42-ba52-4790-86ef-75f061f6ac40",
    "prId" : 92347,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/92347#pullrequestreview-435074738",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f992b7e5-a07b-456b-9522-86d30d30bd31",
        "parentId" : null,
        "authorId" : "7aca96c2-45d7-4567-99be-0323d7556c55",
        "body" : "I'm all for the locks being removed. However I believe part of the reasoning for removing the locks was that you can't reasonably add new loggers after initialization (or more specifically after validation). I think the API should reflect that. My preference would be to make Set/Register private. I know that lavalamp mentioned making them blow up if called after validation. (I would be fine with that as well)",
        "createdAt" : "2020-06-22T16:07:27Z",
        "updatedAt" : "2020-06-25T09:33:18Z",
        "lastEditedBy" : "7aca96c2-45d7-4567-99be-0323d7556c55",
        "tags" : [
        ]
      },
      {
        "id" : "22c652db-591d-4a19-96ae-312db17a3664",
        "parentId" : "f992b7e5-a07b-456b-9522-86d30d30bd31",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "Yeah it seems unlikely that people will accidentally make initialization multi-threaded.\r\n\r\nAccidentally registering post-validate / flag generation seems like a more likely error, I think it'd be reasonable to set a boolean and panic in that condition.",
        "createdAt" : "2020-06-22T16:11:06Z",
        "updatedAt" : "2020-06-25T09:33:18Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "68710208924f3378fe1c8be5dd118b1e037f983e",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +49,53 @@\t\treturn fmt.Errorf(\"log format is frozen, unable to register log format\")\n\t}\n\tif _, ok := lfr.registry[name]; ok {\n\t\treturn fmt.Errorf(\"log format: %s already exists\", name)\n\t}"
  },
  {
    "id" : "793363b1-a4f3-40f5-8ea4-fcb90b8c0304",
    "prId" : 92177,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/92177#pullrequestreview-434179535",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "086f1945-7b52-4b16-9996-147091609638",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "Why is this lock needed? If a format is registered after the help message is generated, it won't be included. It seems like at some point in time the format list should be frozen and we actually want to panic or error if an errant programmer registers a new one.\r\n\r\n(Not asking for a change in this PR, just noting that this is suspicious)",
        "createdAt" : "2020-06-19T15:13:53Z",
        "updatedAt" : "2020-06-19T15:57:56Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "d79ff49d-07d2-43b3-90a0-942588f5d31d",
        "parentId" : "086f1945-7b52-4b16-9996-147091609638",
        "authorId" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "body" : "Register was preemptively made thread safe, but after feedback from @cheftako I think we will remove lock.\r\nI added locking to List to be consistent with other methods. I will create separate PR to remove locking",
        "createdAt" : "2020-06-19T15:49:00Z",
        "updatedAt" : "2020-06-19T16:19:19Z",
        "lastEditedBy" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "tags" : [
        ]
      }
    ],
    "commit" : "5114dac5a441800685cdba2334530289fe71494e",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +83,87 @@// List names of registered log formats\nfunc (lfr *LogFormatRegistry) List() []string {\n\tlfr.mu.Lock()\n\tdefer lfr.mu.Unlock()\n\tformats := make([]string, 0, len(lfr.registry))"
  },
  {
    "id" : "f93b1de6-fc28-4615-9e1b-f06c31ccd9bb",
    "prId" : 91608,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/91608#pullrequestreview-423442003",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f4ae67ac-d490-4d2c-b2ce-9d9592cac157",
        "parentId" : null,
        "authorId" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "body" : "I think you forgot to import json ",
        "createdAt" : "2020-06-03T10:59:52Z",
        "updatedAt" : "2020-06-14T04:33:58Z",
        "lastEditedBy" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "tags" : [
        ]
      }
    ],
    "commit" : "a0f808f4d8ea710d31554d71766ad2a6aa83fbd1",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +84,88 @@\t// Text format is default klog format\n\tlogRegistry.Register(defaultLogFormat, nil)\n\tlogRegistry.Register(jsonLogFormat, json.JSONLogger)\n}"
  },
  {
    "id" : "c0446f0b-9193-482d-a6a1-dd1e43e2781c",
    "prId" : 91608,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/91608#pullrequestreview-427685393",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cd09a539-b39f-4526-b178-9cd4ce42a014",
        "parentId" : null,
        "authorId" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "body" : "nit: what does this constant add?",
        "createdAt" : "2020-06-09T13:22:07Z",
        "updatedAt" : "2020-06-14T04:33:58Z",
        "lastEditedBy" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "tags" : [
        ]
      },
      {
        "id" : "d1f08909-00a4-4615-9cc4-f8023e573c96",
        "parentId" : "cd09a539-b39f-4526-b178-9cd4ce42a014",
        "authorId" : "ac20bfc0-048b-4f7c-8f40-c004ff5299e1",
        "body" : "I think the  json log format string key should be fixed.",
        "createdAt" : "2020-06-10T03:26:21Z",
        "updatedAt" : "2020-06-14T04:33:58Z",
        "lastEditedBy" : "ac20bfc0-048b-4f7c-8f40-c004ff5299e1",
        "tags" : [
        ]
      }
    ],
    "commit" : "a0f808f4d8ea710d31554d71766ad2a6aa83fbd1",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +26,30 @@\nconst (\n\tjsonLogFormat = \"json\"\n)\n"
  },
  {
    "id" : "251c73e9-cf4d-4e55-ab8b-bdddc042706c",
    "prId" : 89683,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89683#pullrequestreview-396887598",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e540592a-712f-4076-8eed-71503e6ffdbc",
        "parentId" : null,
        "authorId" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "body" : "I don't think reading from map is thread safe.",
        "createdAt" : "2020-04-01T07:17:09Z",
        "updatedAt" : "2020-05-19T01:13:04Z",
        "lastEditedBy" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "tags" : [
        ]
      },
      {
        "id" : "46a3b4e9-2c1f-48f3-8d76-720c219b1abd",
        "parentId" : "e540592a-712f-4076-8eed-71503e6ffdbc",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "If there's not a performance bottleneck here, probably better to be defensive. ",
        "createdAt" : "2020-04-20T23:27:58Z",
        "updatedAt" : "2020-05-19T01:13:04Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "c60179260c013623a5b3fe4720a3858cd1e6bc13",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +44,48 @@\tlfr.mu.Lock()\n\tdefer lfr.mu.Unlock()\n\tif _, ok := lfr.registry[name]; ok {\n\t\treturn fmt.Errorf(\"log format: %s already exists\", name)\n\t}"
  },
  {
    "id" : "842f2ff2-68a9-4a2c-810b-9e865c75ab64",
    "prId" : 89683,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89683#pullrequestreview-396887598",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b773cee7-c70a-4673-92c0-f0a6976b6634",
        "parentId" : null,
        "authorId" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "body" : "@mtaufen should register be thread safe?",
        "createdAt" : "2020-04-01T07:17:26Z",
        "updatedAt" : "2020-05-19T01:13:04Z",
        "lastEditedBy" : "6ea93d56-a0ec-4969-ac42-11a78c2085e6",
        "tags" : [
        ]
      },
      {
        "id" : "f7c75670-745e-4c2d-aa32-47e3873a96b7",
        "parentId" : "b773cee7-c70a-4673-92c0-f0a6976b6634",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "IMO this is something that should be set up very early in the lifecycle, and not from multiple threads, but it's also easy to add a mutex and I don't think there's a performance issue, so why take the chance?",
        "createdAt" : "2020-04-20T23:34:07Z",
        "updatedAt" : "2020-05-19T01:13:04Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      }
    ],
    "commit" : "c60179260c013623a5b3fe4720a3858cd1e6bc13",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +36,40 @@\treturn &LogFormatRegistry{\n\t\tregistry: make(map[string]logr.Logger),\n\t\tmu:       sync.Mutex{},\n\t}\n}"
  }
]