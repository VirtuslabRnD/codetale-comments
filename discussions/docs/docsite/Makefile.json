[
  {
    "id" : "f26c8481-5915-4cf3-b708-71729aae599a",
    "prId" : 36604,
    "prUrl" : "https://github.com/ansible/ansible/pull/36604#pullrequestreview-98969224",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ea8115f4-ef86-409f-a170-9b6c54246fd0",
        "parentId" : null,
        "authorId" : "fa0144fc-7424-474a-9ab5-059de28814b7",
        "body" : "I think '?=' should work here.\r\n\r\n(The `ifdef MODULES` etc cases are needed because the make var being set is a different name\r\nthan the env/cli var. ie, 'MODULES=foo make' changes MODULE_ARGS)\r\n\r\n\r\n``` makefile\r\nBUILDIR ?= _build\r\n```",
        "createdAt" : "2018-02-23T16:28:13Z",
        "updatedAt" : "2018-02-23T16:28:14Z",
        "lastEditedBy" : "fa0144fc-7424-474a-9ab5-059de28814b7",
        "tags" : [
        ]
      }
    ],
    "commit" : "1696bb1b1e3244fd595e7ca5ee7a4e4c1796eb60",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +16,20 @@\tBUILDDIR = _build\nendif\n\nMODULE_ARGS=\nifdef MODULES"
  },
  {
    "id" : "2b2d4be1-8365-4041-a6e3-fcda6f0aa428",
    "prId" : 73616,
    "prUrl" : "https://github.com/ansible/ansible/pull/73616#pullrequestreview-591598697",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "parentId" : null,
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "I don't think symlinking is necessary. Just pass different configs and settings via CLI args.\r\nLook:\r\n```console\r\n$ sphinx-build --help\r\nusage: sphinx-build [OPTIONS] SOURCEDIR OUTPUTDIR [FILENAMES...]\r\n\r\n[...]\r\n\r\n\r\nbuild configuration options:\r\n  -c PATH           path where configuration file (conf.py) is located\r\n                    (default: same as SOURCEDIR)\r\n[...]\r\n  -D setting=value  override a setting in configuration file\r\n[...]\r\n```\r\n\r\nSo you could invoke something like\r\n```console\r\n$ python -m sphinx -c sphinx_conf_dir_2.10/ -D master_doc=ansible_index ...\r\n```\r\nand there would be no need to mutate files on disk.",
        "createdAt" : "2021-02-15T20:47:42Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      },
      {
        "id" : "1c9f0f57-35ff-4388-a8ba-f3665974ee24",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "Also, we could explore if using tags (https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#tags) for conditional ToCs...",
        "createdAt" : "2021-02-15T20:52:14Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      },
      {
        "id" : "66364cd9-e1a9-4f33-ae01-55f2dbcde855",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "659587dc-b401-4c91-aa40-a8a932100545",
        "body" : "fwiw - both were tried and rejected by others in favor of the symlink approach. We'll see what other comments there are.",
        "createdAt" : "2021-02-15T21:05:53Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "659587dc-b401-4c91-aa40-a8a932100545",
        "tags" : [
        ]
      },
      {
        "id" : "0be95fec-9807-41c9-9d86-f19ffd8af41f",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "These symlinks appear to be responsible for the package-data sanity test failure. Instead of linking them, have you tried copying them instead?",
        "createdAt" : "2021-02-15T22:59:05Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "daa36db7-5349-4c8c-a64a-808fecc5d9fe",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "659587dc-b401-4c91-aa40-a8a932100545",
        "body" : "Tried the copy instead of symlink localy and that does seem to work and removes the build errors, thanks!\r\n",
        "createdAt" : "2021-02-16T16:01:52Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "659587dc-b401-4c91-aa40-a8a932100545",
        "tags" : [
        ]
      },
      {
        "id" : "d6b81c9f-5c58-424f-a0d2-bd087e2cbee1",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "Hmmm... you wouldn't want the files (the copies inside of the docs/docsite/rst directory) to end up in the sdist, though, as they're generated files.  Does the build error go away because they do get added to the sdist if they're copied?  If so, it's not the correct fix.  Instead we probably want to add an exclude for those files to MANIFEST.in",
        "createdAt" : "2021-02-16T16:14:08Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      },
      {
        "id" : "eff24d3e-738e-4bf7-ba11-111151c79c30",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "In that case we'll need to ignore them in the sanity test instead of copying them, by adding them here:\r\n\r\nhttps://github.com/ansible/ansible/blob/00bd0b893d5d21de040b53032c466707bacb3b93/test/sanity/code-smell/package-data.py#L38",
        "createdAt" : "2021-02-16T16:26:15Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "26d165e6-9b71-418b-b014-cd201e0299f6",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "I've got this working.  For posterity, there are several locations that generated files may need to be listed:\r\n\r\n* `clean target` of a Makefile so that they're removed when make clean is run\r\n* `MANIFEST.in` they should normally be excluded in here so they do not end up in the tarball\r\n* `.gitignore` they should be added here so that they aren't checked in to the git repository\r\n* `test/sanity/code-smell/package-data.py` they may need to be added to an ignore list here if we don't want them in the tarball and they aren't ignored by an existing ignore pattern.",
        "createdAt" : "2021-02-16T17:11:17Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      },
      {
        "id" : "ed3247c1-983a-4485-b025-633ec981c428",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "@samccann what was the reason for not pointing to separate configs?",
        "createdAt" : "2021-02-16T17:33:55Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      },
      {
        "id" : "e1d62f23-6613-4540-b019-bf00c08bfec4",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "659587dc-b401-4c91-aa40-a8a932100545",
        "body" : "@webknjaz - I'm not sure at this point. I remember I hit a roadblock and had to have @abadger help me out of it. As part of that help, we went to symlinks instead of  the separate -c sphinx option and sphinx tags.  I can try it again post-merge and see if I can get it to work. At this point, we have something that works and we need it merged today/backported asap to get the release out the door.",
        "createdAt" : "2021-02-16T18:54:00Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "659587dc-b401-4c91-aa40-a8a932100545",
        "tags" : [
        ]
      },
      {
        "id" : "08c04a8b-dbe6-4385-b10d-15b5f1ca255c",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "@abadger I'd be interested in hearing the details. Over the past year or so I've learned a lot about Sphinx and making Sphinx extensions so maybe I'd be able to help out.",
        "createdAt" : "2021-02-16T18:57:01Z",
        "updatedAt" : "2021-02-16T19:25:33Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      },
      {
        "id" : "f475300f-2a29-417d-bf7b-93451b351a83",
        "parentId" : "9563cc39-65be-4bcf-b970-822c780b5b21",
        "authorId" : "0d301bd1-6b47-409f-ac92-439b799b2375",
        "body" : "I think if we're going to leave the version-switcher in place, we need to keep `index.html` as the name of the default main page.",
        "createdAt" : "2021-02-16T20:30:18Z",
        "updatedAt" : "2021-02-16T20:30:18Z",
        "lastEditedBy" : "0d301bd1-6b47-409f-ac92-439b799b2375",
        "tags" : [
        ]
      }
    ],
    "commit" : "c921094051a075cd1b1edf2d3e0ba2ac6db1dc47",
    "line" : 53,
    "diffHunk" : "@@ -1,1 +85,89 @@\t@echo \"Creating symlinks in core_generate_rst\"\n\t-ln -sf ../rst/core_index.rst rst/index.rst\n\t-ln -sf ../sphinx_conf/core_conf.py rst/conf.py\n\nhtmldocs: ansible_structure"
  },
  {
    "id" : "82f9e074-caaa-47fa-9e3d-dc9af35f2333",
    "prId" : 73746,
    "prUrl" : "https://github.com/ansible/ansible/pull/73746#pullrequestreview-604349212",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "451b2587-d5c9-4667-97d8-5c9b6ab354d9",
        "parentId" : null,
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "I haven't absorbed what needs to be done but this doesn't seem quite right. It feels like this command should somehow switch structure depending on whether it was making core or Ansible package docs. ",
        "createdAt" : "2021-03-04T15:34:06Z",
        "updatedAt" : "2021-03-04T22:23:01Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      },
      {
        "id" : "bc349c04-5ec7-40ba-8192-8b12e67200cb",
        "parentId" : "451b2587-d5c9-4667-97d8-5c9b6ab354d9",
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "Maybe like this:\r\n``` Makefile\r\n\r\ngettext: ansible_structure\r\n<TAB> CPUS=$(CPUS) $(MAKE) -f Makefile.sphinx gettext\r\n\r\ncore_gettext: core_structure   \r\n<TAB> CPUS=$(CPUS) $(MAKE) -f Makefile.sphinx gettext\r\n```",
        "createdAt" : "2021-03-04T17:12:59Z",
        "updatedAt" : "2021-03-04T22:23:01Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      }
    ],
    "commit" : "7d55fb106a449ee7694eec37c7f4b941231f4be4",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +104,108 @@\t-ln -sf ../sphinx_conf/all_conf.py rst/conf.py\n\ngettext: gettext_structure\n\tCPUS=$(CPUS) $(MAKE) -f Makefile.sphinx gettext\n\t# if msgcat is installed handle all indexes, otherwise use the index from gettext_structure."
  },
  {
    "id" : "f6b47236-f2f4-4519-b55d-64a361d3142c",
    "prId" : 73746,
    "prUrl" : "https://github.com/ansible/ansible/pull/73746#pullrequestreview-605447795",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "52176e91-4a70-4ebb-ad39-8e58ba89ef93",
        "parentId" : null,
        "authorId" : "f65394e6-7239-422a-9af5-c3575a283846",
        "body" : "Should we make this 2.10 the result of a dynamic command so we don't have to keep thinking about it in the future ?",
        "createdAt" : "2021-03-05T10:31:34Z",
        "updatedAt" : "2021-03-05T10:31:34Z",
        "lastEditedBy" : "f65394e6-7239-422a-9af5-c3575a283846",
        "tags" : [
        ]
      },
      {
        "id" : "e753e651-cbdb-4298-8597-0bfb250798ea",
        "parentId" : "52176e91-4a70-4ebb-ad39-8e58ba89ef93",
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "Spredzy and I talked about this on slack.  2.10 is a special case.  We have it for backwards compatibility only. (2.10_conf.py builds nearly all of the documentation as one website.  core_conf.py builds a subset for the /ansible-core/ site.  ansible_conf.py builds a subset for /ansible/3/ and beyond).  We're not going to have a 2.11_conf.py or a 3_conf.py; those versions are taken care of by the core_conf.py and ansible_conf.py.  So we shouldn't need to get the VERSION dynamically.",
        "createdAt" : "2021-03-05T17:30:51Z",
        "updatedAt" : "2021-03-05T17:30:52Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      }
    ],
    "commit" : "7d55fb106a449ee7694eec37c7f4b941231f4be4",
    "line" : 43,
    "diffHunk" : "@@ -1,1 +107,111 @@\tCPUS=$(CPUS) $(MAKE) -f Makefile.sphinx gettext\n\t# if msgcat is installed handle all indexes, otherwise use the index from gettext_structure.\n\t-msgcat \"$(POTDIR)/core_index.pot\" \"$(POTDIR)/ansible_index.pot\" \"$(POTDIR)/2.10_index.pot\" > \"$(POTDIR)/tmp_index.pot\" && mv \"$(POTDIR)/tmp_index.pot\" \"$(POTDIR)/index.pot\"\n\trm \"$(POTDIR)/core_index.pot\" \"$(POTDIR)/ansible_index.pot\" \"$(POTDIR)/2.10_index.pot\"\n"
  }
]