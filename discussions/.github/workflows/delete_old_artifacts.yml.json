[
  {
    "id" : "ccfb52c6-3cd4-4a53-b334-a5dafc2a337e",
    "prId" : 11079,
    "prUrl" : "https://github.com/apache/airflow/pull/11079#pullrequestreview-493476370",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dacc14d9-ac63-4ebb-8fc3-6a80216bad1d",
        "parentId" : null,
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "I would say \"Every day\" would be good enough, WDYT",
        "createdAt" : "2020-09-22T11:43:54Z",
        "updatedAt" : "2020-09-22T11:43:54Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      },
      {
        "id" : "a5156b9f-10cc-46b5-aff4-68e90b93dd66",
        "parentId" : "dacc14d9-ac63-4ebb-8fc3-6a80216bad1d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "There is a bit of a problem - we cannot rate-limit the action and we occasionally exhausted the limit now.\r\nI did some back-of-the-envelope calculations:\r\n\r\nThe limit is  5000 API calls / hr. So if we have > 3000 artifacts to delete, we are getting dangerously close to be able to exhaust our API calls within single run.\r\n\r\nWe have (tops) ~ 200 builds a day  with (tops) ~ 50 artifacts each (assume intensive period and increasing number of artifacts)  > 10.000 artifacts to delete a day. Running it 4 times/day is ~ 2.500 artifacts to delete for each run.\r\n",
        "createdAt" : "2020-09-22T11:52:06Z",
        "updatedAt" : "2020-09-22T11:52:07Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "6cfb86b7-7ca5-42b2-939e-652667b046fd",
        "parentId" : "dacc14d9-ac63-4ebb-8fc3-6a80216bad1d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "BTW. I am running the deletion now using the script with ~ 1000 deletions/hour ( I also hit rate limit with my personal token). With those assumptions and 90 day retention period, it will take ~ 10 days to delete all old artifacts (assuming we have 30% of the 10.000/day = 3000/day * 90 /24 ~ 10 days  :). ",
        "createdAt" : "2020-09-22T11:57:47Z",
        "updatedAt" : "2020-09-22T11:58:10Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "15b8245e-d4db-4f1f-9a6e-75009afd5f9a",
        "parentId" : "dacc14d9-ac63-4ebb-8fc3-6a80216bad1d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "BTW. I think my calculations were a bit too pessimistics. Seems that 24 hours ewere enough to delete the artifacts. The job started to succeed and it takes ~ 5 minutes to run when it runs. Also my script is now often finishing after some 30-50 artifacts so seems we got to a \"clean state\" much faster than I thought. \r\n\r\n",
        "createdAt" : "2020-09-22T13:45:11Z",
        "updatedAt" : "2020-09-22T13:45:12Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      },
      {
        "id" : "13221cf5-6215-47d6-886b-6439c029ce99",
        "parentId" : "dacc14d9-ac63-4ebb-8fc3-6a80216bad1d",
        "authorId" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "body" : "Yep. Now when I run \"delete\" and no jobs finish in the meantime there are no artifacts to delete :) @dimberman -> artifacts are cleaned up now..",
        "createdAt" : "2020-09-22T13:46:08Z",
        "updatedAt" : "2020-09-22T13:46:08Z",
        "lastEditedBy" : "e8563344-32ea-4c07-9731-a2fed8d2edf2",
        "tags" : [
        ]
      }
    ],
    "commit" : "3a20c77151428b7e78fe09dae691e2829cb032e3",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +2,6 @@on:\n  schedule:\n    - cron: '27 */6 * * *' # run every 6 hours\n\njobs:"
  }
]