[
  {
    "id" : "78e7a76d-c3bb-4d48-9895-ad334b5d8f06",
    "prId" : 41927,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/41927#pullrequestreview-23756790",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5b5f0387-8f4d-45c2-b681-d9eddc12bbbe",
        "parentId" : null,
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "handleError everywhere ",
        "createdAt" : "2017-02-24T16:42:01Z",
        "updatedAt" : "2017-02-24T16:42:01Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      }
    ],
    "commit" : "a3a2246f734cad04656a396fc1f0d3ba4b47dacc",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +956,960 @@\t\terr, retryDelay = s.processServiceDeletion(key)\n\tcase err != nil:\n\t\tglog.Errorf(\"Unable to retrieve service %v from store: %v\", key, err)\n\t\ts.queue.Add(key)\n\t\treturn err"
  },
  {
    "id" : "a168bdca-5872-4f8c-97d3-475d8f3d94c6",
    "prId" : 28568,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6dc95d63-cd7f-433a-bd77-6e71dcf48413",
        "parentId" : null,
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "Should we return the error directly ?\n",
        "createdAt" : "2016-07-07T02:58:53Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      },
      {
        "id" : "f5f2a54d-5a7c-44ea-9e6b-7870802e788d",
        "parentId" : "6dc95d63-cd7f-433a-bd77-6e71dcf48413",
        "authorId" : "ffc157a5-b8d0-4a06-b942-f8e5150e4215",
        "body" : "yes probably best to return the error here\n",
        "createdAt" : "2016-07-07T16:58:06Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "ffc157a5-b8d0-4a06-b942-f8e5150e4215",
        "tags" : [
        ]
      },
      {
        "id" : "a5cd1a50-bf3c-4c46-bda4-45c886113250",
        "parentId" : "6dc95d63-cd7f-433a-bd77-6e71dcf48413",
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "Thanks @jfrazelle ! I'm on vocation now, will fix it when I'm back to office.\n",
        "createdAt" : "2016-07-08T03:04:03Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ccd90d7418f764cc9a42abb0dd305a0732edb38",
    "line" : null,
    "diffHunk" : "@@ -1,1 +737,741 @@\t\t\t\t} else {\n\t\t\t\t\tensuredCount += 1\n\t\t\t\t}\n\t\t\t}\n\t\t}"
  },
  {
    "id" : "8cc36bd9-02d1-4051-b3bc-16542a316c04",
    "prId" : 28568,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4e34e71a-0687-45be-9980-04693e216b60",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "The error 2 lines below is not correct now. We need to keep track of number of missing cluster clients and number of failed ensureDNsRecords and return an error accordingly.\n",
        "createdAt" : "2016-07-21T17:39:50Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      },
      {
        "id" : "9305daad-9562-4179-8335-283ec3d8a14d",
        "parentId" : "4e34e71a-0687-45be-9980-04693e216b60",
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "Reasonable. The numbers may be counted by below?\n1. number of missing cluster clients: count of `key != clusterName`\n2. number of failed ensureDNsRecords: count of `when s.ensureDnsRecords return non nil`?\n\nIf so, we can define two new variables: `missedCount`, `unensuredCount`(instead current `ensuredCount`)\n",
        "createdAt" : "2016-07-22T01:38:48Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ccd90d7418f764cc9a42abb0dd305a0732edb38",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +740,744 @@\t\t\t}\n\t\t}\n\t}\n\tmissedCount := len(clusterNames) - ensuredCount - unensuredCount\n\tif missedCount > 0 || unensuredCount > 0 {"
  },
  {
    "id" : "bc059a48-d976-48d9-b6d2-1492d7318269",
    "prId" : 28568,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a4fcab0c-e62c-49cf-b984-5de9b265ce6b",
        "parentId" : null,
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "According to comments in last commit, code is changed to this.  Here I don't return the error of missing clients or unensured DNS records separately, because they may occur simultaneously, i.e. some clients may miss, and the not missed clients may fail to ensure DNS records.\n\n/cc @nikhiljindal @quinton-hoole @jfrazelle \n\nby nikhiljindal \n\n> The error 2 lines below is not correct now. We need to keep track of number of missing cluster clients and number of failed ensureDNsRecords and return an error accordingly.\n\nby xiangpengzhao\n\n> Reasonable. The numbers may be counted by below?\n> 1. number of missing cluster clients: count of key != clusterName\n> 2. number of failed ensureDNsRecords: count of when s.ensureDnsRecords return non nil?\n> If so, we can define two new variables: missedCount, unensuredCount(instead current ensuredCount)\n",
        "createdAt" : "2016-07-22T03:08:53Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ccd90d7418f764cc9a42abb0dd305a0732edb38",
    "line" : null,
    "diffHunk" : "@@ -1,1 +744,748 @@\tif missedCount > 0 || unensuredCount > 0 {\n\t\treturn fmt.Errorf(\"Failed to update DNS records for %d clusters for service %v due to missing clients [missed count: %d] and/or failing to ensure DNS records [unensured count: %d]\",\n\t\t\tlen(clusterNames), service, missedCount, unensuredCount)\n\t}\n\treturn nil"
  },
  {
    "id" : "ee374c38-dacd-4d6c-a323-80a49cbb0811",
    "prId" : 28568,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "50eff3bb-84d6-4e17-b9b4-6d2ae92499e1",
        "parentId" : null,
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "Log the error here?\n",
        "createdAt" : "2016-07-23T01:53:00Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      },
      {
        "id" : "f79fe9bd-a386-4bd8-890a-ae936d7ee7c1",
        "parentId" : "50eff3bb-84d6-4e17-b9b4-6d2ae92499e1",
        "authorId" : null,
        "body" : "@xiangpengzhao Yes, please do, at V(4)\n",
        "createdAt" : "2016-07-29T18:06:20Z",
        "updatedAt" : "2016-08-01T10:42:06Z",
        "lastEditedBy" : null,
        "tags" : [
        ]
      }
    ],
    "commit" : "4ccd90d7418f764cc9a42abb0dd305a0732edb38",
    "line" : null,
    "diffHunk" : "@@ -1,1 +733,737 @@\t\t\t\terr := s.ensureDnsRecords(clusterName, service)\n\t\t\t\tif err != nil {\n\t\t\t\t\tunensuredCount += 1\n\t\t\t\t\tglog.V(4).Infof(\"Failed to update DNS records for service %v from cluster %s: %v\", service, clusterName, err)\n\t\t\t\t} else {"
  },
  {
    "id" : "b4311bbc-c681-478b-9b37-5b7ce5830d92",
    "prId" : 28568,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0b4fa197-4b19-4f56-9790-9919db082d2c",
        "parentId" : null,
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "In my last commit, the way calculating missedCount is wrong. It cannot increment in the for loop. Fixed in this commit.\n\n@quinton-hoole According to your in-code comments in last commit, I add the V4 log info when s.ensureDnsRecords returns error (call `s.err` below). But I cancel including any error info (`s.err` or all-cluster-missed error) in the final returned error (call `final-err` below). There are some reasons:\n1. When there is more than one `s.err`: for debugging, if we don't care about `s.err`, it's not necessary to include it in `final-err`; if we care about `s.err`, only include the last `s.err` in `final.err` is not enough, we have to inspect the logged `s.err` in each loop, so it's not necessary to include it in `final-err` either.\n2. When there is no `s.err`, there may be two cases: 1). all cluster miss; 2) some clusters miss and other ensureDnsRecords successfully. If we set error for these two cases along with `s.err`, it will make the logic complicated and code somewhat ugly.\n\nIMO, the condition `if missedCount > 0 || unensuredCount > 0` can cover all abnormal cases, and it's error text give enough info.\n\nFor example, if it prints:\n`Failed to update DNS records for 5 clusters for service foo due to missing clients [missed count: 2] and/or failing to ensure DNS records [unensured count: 1]`\nwe know that there are 5 clusters, 2 missed, 1 failed to ensureDnsRecords and 2 succeeded.\n\nI'm not sure if I describe clearly. Any more discuss is welcome.\n",
        "createdAt" : "2016-08-01T11:46:53Z",
        "updatedAt" : "2016-08-01T11:46:53Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      },
      {
        "id" : "2dfb3789-e719-458c-a2e8-b512cafce2f6",
        "parentId" : "0b4fa197-4b19-4f56-9790-9919db082d2c",
        "authorId" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "body" : "BTW, the comments posted 10 days ago are listed here. We can ignore them here.\n",
        "createdAt" : "2016-08-01T11:48:30Z",
        "updatedAt" : "2016-08-01T11:48:30Z",
        "lastEditedBy" : "a09f2d48-fec0-4c0d-bd81-6de7378a6ebf",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ccd90d7418f764cc9a42abb0dd305a0732edb38",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +745,749 @@\t\treturn fmt.Errorf(\"Failed to update DNS records for %d clusters for service %v due to missing clients [missed count: %d] and/or failing to ensure DNS records [unensured count: %d]\",\n\t\t\tlen(clusterNames), service, missedCount, unensuredCount)\n\t}\n\treturn nil\n}"
  },
  {
    "id" : "45d1e754-19d6-4388-ae2e-4463da497da9",
    "prId" : 27748,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5b37dfa4-ab77-45ba-a497-c45fa2526243",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "cluster sync period should be updated as well?\n",
        "createdAt" : "2016-06-21T02:58:55Z",
        "updatedAt" : "2016-06-22T02:46:47Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      }
    ],
    "commit" : "669bf0773f59d5512097d092d3d14517726df44e",
    "line" : null,
    "diffHunk" : "@@ -1,1 +49,53 @@const (\n\tserviceSyncPeriod = 10 * time.Minute\n\tclusterSyncPeriod = 10 * time.Minute\n\n\t// How long to wait before retrying the processing of a service change."
  },
  {
    "id" : "2b18d403-fb37-41f7-9ea9-0e51c997c1ab",
    "prId" : 27511,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6cc8e565-3359-4b61-921e-c76e221987e0",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "up to you: Just the service name (instead of the whole service) will be more readable?\n",
        "createdAt" : "2016-06-16T00:39:41Z",
        "updatedAt" : "2016-06-16T00:39:41Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      },
      {
        "id" : "f2e11fed-f178-4cbb-ac46-af43affde7b4",
        "parentId" : "6cc8e565-3359-4b61-921e-c76e221987e0",
        "authorId" : null,
        "body" : "@nikhiljindal I do agree, and did try that.  But it's a bit tricky, as cachedService doesn't have a Name field, and so one would have to traverse a few possibly nil pointers to get to a useful name.  This leads to either complex code or runtime panics, neither of which seemed worth it for slightly prettier log messages.\n",
        "createdAt" : "2016-06-16T00:42:37Z",
        "updatedAt" : "2016-06-16T00:42:55Z",
        "lastEditedBy" : null,
        "tags" : [
        ]
      }
    ],
    "commit" : "7b5265c493cfaa52cde0a857c89072c699186f6c",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +723,727 @@\tif ensuredCount < len(clusterNames) {\n\t\treturn fmt.Errorf(\"Failed to update DNS records for %d of %d clusters for service %v due to missing clients for those clusters\",\n\t\t\tlen(clusterNames)-ensuredCount, len(clusterNames), service)\n\t}\n\treturn nil"
  },
  {
    "id" : "83e32920-aaba-45a7-8f1c-84198d71a3f9",
    "prId" : 27252,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "56e49a42-045c-4d6c-9167-c16f3427d6dc",
        "parentId" : null,
        "authorId" : null,
        "body" : "nit: Why not use a bool here instead of an int?\n",
        "createdAt" : "2016-06-13T19:54:37Z",
        "updatedAt" : "2016-06-14T07:40:56Z",
        "lastEditedBy" : null,
        "tags" : [
        ]
      }
    ],
    "commit" : "8e26283965a364746c22fa72d2ab412e6b4ee307",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +77,81 @@\t// cluster endpoint map hold subset info from kubernetes clusters\n\t// key clusterName\n\t// value is a flag that if there is ready address, 1 means there is ready address\n\tendpointMap map[string]int\n\t// serviceStatusMap map holds service status info from kubernetes clusters, keyed on clusterName"
  },
  {
    "id" : "dde003fa-5cd1-472a-829f-2f4444631667",
    "prId" : 27252,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bd7ecf2a-0e32-454c-8d89-6b557a9a84c8",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "You will need to add these flags to the controller-manager YAML: https://github.com/kubernetes/kubernetes/blob/master/federation/manifests/federation-controller-manager-deployment.yaml#L22. Otherwise, the e2e tests will start failing as soon as this PR is merged.\n\nYou can use the FEDERATION_NAME env var for federation name: https://github.com/kubernetes/kubernetes/blob/6e5faf59b24d326c13d8fb32cf4c2751b78cca97/federation/cluster/common.sh#L96\n You will have to add a similar env var for ZoneName\n",
        "createdAt" : "2016-06-14T07:08:11Z",
        "updatedAt" : "2016-06-14T07:40:56Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      }
    ],
    "commit" : "8e26283965a364746c22fa72d2ab412e6b4ee307",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +251,255 @@func (s *ServiceController) init() error {\n\tif s.federationName == \"\" {\n\t\treturn fmt.Errorf(\"ServiceController should not be run without federationName.\")\n\t}\n\tif s.zoneName == \"\" {"
  },
  {
    "id" : "32a83539-d29e-4380-80b0-01fdbb55ce24",
    "prId" : 27028,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c79ea92e-fd34-43a2-99c0-c8800262cf80",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "same. can you explain why this change?\nWill also be good to add a comment here in code explaining why we are using lastState and not appliedState.\n",
        "createdAt" : "2016-06-09T07:00:31Z",
        "updatedAt" : "2016-06-09T07:00:31Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      }
    ],
    "commit" : "640d7dc7d1c3358a07599088ab21062f8b329373",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +639,643 @@\tif ok {\n\t\tfor _, cachedService := range services {\n\t\t\tappliedState := cachedService.lastState\n\t\t\ts.processServiceForCluster(cachedService, clusterName, appliedState, cluster.clientset)\n\t\t}"
  },
  {
    "id" : "906dff30-2abe-4016-9f1e-b30225d6a659",
    "prId" : 26034,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7780f17a-7549-4fb7-a1f2-fd7f7719bb74",
        "parentId" : null,
        "authorId" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "body" : "nit: Some infof start with a capital letter, some dont :)\nWill be good to be consistent.\n",
        "createdAt" : "2016-05-26T22:52:09Z",
        "updatedAt" : "2016-05-28T16:25:20Z",
        "lastEditedBy" : "f2369046-26b1-4b8c-a8cd-5671ab22066c",
        "tags" : [
        ]
      }
    ],
    "commit" : "6133db345f010e121e9b369be3d45cceee5a9679",
    "line" : 406,
    "diffHunk" : "@@ -1,1 +404,408 @@\t\t}\n\t\tif errors.IsConflict(err) {\n\t\t\tglog.V(4).Infof(\"Not persisting update to service '%s/%s' that has been changed since we received it: %v\",\n\t\t\t\tservice.Namespace, service.Name, err)\n\t\t}"
  }
]