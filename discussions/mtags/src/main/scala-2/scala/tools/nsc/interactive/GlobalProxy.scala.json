[
  {
    "id" : "78eb4513-b677-4429-8932-b3048fd9e266",
    "prId" : 2476,
    "prUrl" : "https://github.com/scalameta/metals/pull/2476#pullrequestreview-583730728",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2001fd97-8913-4088-80f1-a079382b043c",
        "parentId" : null,
        "authorId" : "84490516-a7af-4f7f-9947-360c279c4400",
        "body" : "So I guess I don't fully understand this part. What exactly does creating and assigning a new WorkScheduler do? Mainly how does it help this situation?",
        "createdAt" : "2021-02-04T18:47:03Z",
        "updatedAt" : "2021-02-04T19:03:42Z",
        "lastEditedBy" : "84490516-a7af-4f7f-9947-360c279c4400",
        "tags" : [
        ]
      },
      {
        "id" : "420140eb-31ac-4576-b768-ebdadcad459e",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "body" : "This is a bit of a hack. When we shutdown the compiler the scheduler gets replaced with something like `NoWorkScheduler` which will not accept any work. We replace it back with the default one so that the modified thread can work with it.",
        "createdAt" : "2021-02-04T19:02:13Z",
        "updatedAt" : "2021-02-04T19:03:42Z",
        "lastEditedBy" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "tags" : [
        ]
      },
      {
        "id" : "b180488d-d770-443f-b2e1-00ff198ab23f",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "84490516-a7af-4f7f-9947-360c279c4400",
        "body" : "ðŸ¤” ok, just to make sure I understand, after we shutdown, and then right below when we create a new `MetalsGlobalThread`, don't we also get a new compiler, which would already have a new WorkScheduler?",
        "createdAt" : "2021-02-04T19:06:16Z",
        "updatedAt" : "2021-02-04T19:06:29Z",
        "lastEditedBy" : "84490516-a7af-4f7f-9947-360c279c4400",
        "tags" : [
        ]
      },
      {
        "id" : "89aed5e1-f82f-4472-b0df-95897d80ebd3",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "body" : "Whenever Global is created it comes with it's own thread and WorkScheduler, so we can't create a new one. Here, we shutdown the compiler, which shuts down the thread and replaces the scheduler. After that, we replace the scheduler with a working one and add the new thread, in this way hijack this particular Global object. ",
        "createdAt" : "2021-02-04T19:12:35Z",
        "updatedAt" : "2021-02-04T19:12:35Z",
        "lastEditedBy" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "tags" : [
        ]
      },
      {
        "id" : "a6159db7-4173-4640-8c34-7e53bad663f0",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "84490516-a7af-4f7f-9947-360c279c4400",
        "body" : "Alright, I think I understand. Thanks a lot for explaining.",
        "createdAt" : "2021-02-04T19:14:02Z",
        "updatedAt" : "2021-02-04T19:14:02Z",
        "lastEditedBy" : "84490516-a7af-4f7f-9947-360c279c4400",
        "tags" : [
        ]
      },
      {
        "id" : "e8f49903-9714-4fec-b52b-3973212c9619",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "body" : "I did dig into that for a while before @mlachkar suggestion, so I do understand your confusion here. It's not perfect, it would probably be much better to just use the defaults, but I don't want to change too much and the reason for the changed compiler thread might still exist.",
        "createdAt" : "2021-02-04T19:14:31Z",
        "updatedAt" : "2021-02-04T19:14:31Z",
        "lastEditedBy" : "f252b48f-54a9-478d-8bbb-85f01e5c28e7",
        "tags" : [
        ]
      },
      {
        "id" : "4420f578-9ed3-4532-8e60-85c54147d8fe",
        "parentId" : "2001fd97-8913-4088-80f1-a079382b043c",
        "authorId" : "84490516-a7af-4f7f-9947-360c279c4400",
        "body" : "Yea understandable, just trying to wrap my head around what's fully going on here.",
        "createdAt" : "2021-02-04T19:16:01Z",
        "updatedAt" : "2021-02-04T19:16:01Z",
        "lastEditedBy" : "84490516-a7af-4f7f-9947-360c279c4400",
        "tags" : [
        ]
      }
    ],
    "commit" : "0e5eb9531def3aff898c3b64e88b164c773fd1e7",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +51,55 @@      }\n    }\n    this.scheduler = new WorkScheduler\n    compileRunner = new MetalsGlobalThread(this, \"Metals\")\n    compileRunner.setDaemon(true)"
  }
]