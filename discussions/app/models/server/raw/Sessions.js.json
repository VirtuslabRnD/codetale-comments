[
  {
    "id" : "40603058-fc21-40af-a31a-0c25f069fae8",
    "prId" : 22381,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/22381#pullrequestreview-692236356",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9b0016f6-08af-4e40-967f-febd8509ff13",
        "parentId" : null,
        "authorId" : "34fde88b-e8d3-4125-af3a-0d4cc8bd83a8",
        "body" : "Why is this second group stage needed? ðŸ‘€ can't they be combined?",
        "createdAt" : "2021-06-22T20:03:18Z",
        "updatedAt" : "2021-06-22T21:37:13Z",
        "lastEditedBy" : "34fde88b-e8d3-4125-af3a-0d4cc8bd83a8",
        "tags" : [
        ]
      },
      {
        "id" : "a9ebc2fa-8709-4c69-82ae-24f052cb71d9",
        "parentId" : "9b0016f6-08af-4e40-967f-febd8509ff13",
        "authorId" : "300e6b86-7e45-416a-b277-55c605417b9b",
        "body" : "I don't think so ðŸ˜•\r\nThe first stage is used to group multiple sessions from each user in a day, while the second stage builds a **set** of active userIds for that day and counts it (that is, it gets the _amount of distinct active users_ in a given hour range), which is used to build many charts in the front-end side.\r\n\r\nI tried to group these two stages (using a conditional `$sum` to calculate `users` while creating the `usersList`). However, for that I'd need `users` to access the value of `usersList`, but `usersList` is still being created in **the same $group** and it seems like doing this is not allowed, it didn't work.",
        "createdAt" : "2021-06-22T23:16:06Z",
        "updatedAt" : "2021-06-22T23:16:06Z",
        "lastEditedBy" : "300e6b86-7e45-416a-b277-55c605417b9b",
        "tags" : [
        ]
      },
      {
        "id" : "556a7338-121b-4ecc-8604-b26c84b0c654",
        "parentId" : "9b0016f6-08af-4e40-967f-febd8509ff13",
        "authorId" : "34fde88b-e8d3-4125-af3a-0d4cc8bd83a8",
        "body" : "Well, it makes sense ðŸ˜¬ ",
        "createdAt" : "2021-06-24T21:26:02Z",
        "updatedAt" : "2021-06-24T21:27:33Z",
        "lastEditedBy" : "34fde88b-e8d3-4125-af3a-0d4cc8bd83a8",
        "tags" : [
        ]
      }
    ],
    "commit" : "b581e28b03e480dadf8ccd6ef6678fe615bb0cb8",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +150,154 @@\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\t$group: {\n\t\t\t\t\t_id: {"
  },
  {
    "id" : "b6135cb1-5747-4df8-9cc5-29efc6361df1",
    "prId" : 17783,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/17783#pullrequestreview-430963073",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "091969ef-6835-409d-b666-22bef702ed3d",
        "parentId" : null,
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "missing an index to perform this query",
        "createdAt" : "2020-06-15T21:30:45Z",
        "updatedAt" : "2020-06-20T16:03:30Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      }
    ],
    "commit" : "f0b3b1cd5da0eb6b61da3d4c01f523288db01a33",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +113,117 @@\t}\n\n\tasync findLastLoginByIp(ip) {\n\t\treturn (await this.col.find({\n\t\t\tip,"
  },
  {
    "id" : "0873089b-de1e-4a2e-a44c-f0e3fecaad2a",
    "prId" : 17783,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/17783#pullrequestreview-431006040",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6751cc7c-fdf7-4fc9-b3bf-5f36606e37b7",
        "parentId" : null,
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "Needs a compound index of `ip` and `loginAt`",
        "createdAt" : "2020-06-15T21:32:45Z",
        "updatedAt" : "2020-06-20T16:03:30Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      }
    ],
    "commit" : "f0b3b1cd5da0eb6b61da3d4c01f523288db01a33",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +115,119 @@\tasync findLastLoginByIp(ip) {\n\t\treturn (await this.col.find({\n\t\t\tip,\n\t\t}, {\n\t\t\tsort: { loginAt: -1 },"
  }
]