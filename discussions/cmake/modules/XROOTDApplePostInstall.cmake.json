[
  {
    "id" : "ced15f30-75f9-4f85-a89a-af5a695692b5",
    "prId" : 6128,
    "prUrl" : "https://github.com/root-project/root/pull/6128#pullrequestreview-466927217",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cc589fdc-faf1-4caf-a36b-6a02721768f5",
        "parentId" : null,
        "authorId" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "body" : "Else warning?",
        "createdAt" : "2020-08-13T16:31:34Z",
        "updatedAt" : "2020-08-14T07:49:47Z",
        "lastEditedBy" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "tags" : [
        ]
      }
    ],
    "commit" : "ccf8f7c007259fa78b73521fac9e1ae7e5201639",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +13,17 @@  find_program(INSTALL_NAME_TOOL install_name_tool)\n\n  if(INSTALL_NAME_TOOL)\n    message(STATUS \"Found tool ${INSTALL_NAME_TOOL}\")\n    message(STATUS \"Adjusting LC_RPATH variable of XRootD libraries in ${install_libdir}\")"
  },
  {
    "id" : "b24d346c-7622-4b9f-a3e4-5c7c731bbdcf",
    "prId" : 6128,
    "prUrl" : "https://github.com/root-project/root/pull/6128#pullrequestreview-467354979",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "31916667-964b-4cfb-aa93-cca5a505974c",
        "parentId" : null,
        "authorId" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "body" : "Do I understand correctly that this is not touching the libs in `$ROOTSYS/lib` but only in `${CMAKE_INSTALL_PREFIX}/lib`? If so: great! If not: that means one cannot use the ROOT build directory anymore after running `make install` - probably not a huge issue...",
        "createdAt" : "2020-08-13T16:33:30Z",
        "updatedAt" : "2020-08-14T07:49:47Z",
        "lastEditedBy" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "tags" : [
        ]
      },
      {
        "id" : "7df7e614-9d78-4935-8f79-a8220e881b82",
        "parentId" : "31916667-964b-4cfb-aa93-cca5a505974c",
        "authorId" : "82ce2c80-31ff-4f7b-91f0-fff78777d7f9",
        "body" : "Correct, this is only modifying `libXrd*` targets under `${CMAKE_INSTALL_PREFIX}/lib`",
        "createdAt" : "2020-08-14T07:14:03Z",
        "updatedAt" : "2020-08-14T07:49:47Z",
        "lastEditedBy" : "82ce2c80-31ff-4f7b-91f0-fff78777d7f9",
        "tags" : [
        ]
      }
    ],
    "commit" : "ccf8f7c007259fa78b73521fac9e1ae7e5201639",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +20,24 @@      execute_process(COMMAND ${INSTALL_NAME_TOOL} -rpath \n                              ${build_libdir} ${install_libdir} \n                              ${install_libdir}/${XRD_LIB_PATH}\n                      ERROR_QUIET\n      )"
  },
  {
    "id" : "81b03f41-e10b-418d-9ffc-098742572f9b",
    "prId" : 6128,
    "prUrl" : "https://github.com/root-project/root/pull/6128#pullrequestreview-467358879",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b8073ce2-bce3-4ce7-958f-45ad957b9c0f",
        "parentId" : null,
        "authorId" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "body" : "Why would it see the install RPATH? I'd expect that `make install` replaces `/usr/local/lib/libXrdFoo.so` by `${CMAKE_BUILD_DIR}/lib/libXrdFoo.so` which still has the build-time RPATH? ",
        "createdAt" : "2020-08-13T16:35:41Z",
        "updatedAt" : "2020-08-14T07:49:47Z",
        "lastEditedBy" : "09b7e073-cbeb-42e8-aa22-8b1468de56ae",
        "tags" : [
        ]
      },
      {
        "id" : "38aab9a5-01af-4e83-8ee1-867804256920",
        "parentId" : "b8073ce2-bce3-4ce7-958f-45ad957b9c0f",
        "authorId" : "82ce2c80-31ff-4f7b-91f0-fff78777d7f9",
        "body" : "It's a bit convoluted . The first time this [line](https://github.com/root-project/root/blob/b1b83e552c8418c74ccfb5c2828b4d8a9809e502/cmake/modules/SearchInstalledSoftware.cmake#L919) is executed the library would be moved from `${CMAKE_BUILD_DIR}/lib/libXrdFoo.so` to `${CMAKE_INSTALL_PREFIX}/lib/libXrdFoo.so`. Then this post-install script would call the following\r\n```\r\ninstall_name_tool -rpath ${CMAKE_BUILD_DIR}/lib ${CMAKE_INSTALL_PREFIX}/lib ${CMAKE_INSTALL_PREFIX}/lib/libXrdFoo.so\r\n```\r\nAnd this call would produce no errors since the current `LC_RPATH` variable for `libXrdFoo.so` is pointing to the build directory.\r\n\r\nBut then, anytime the user calls `make install` again, the routine above would be repeated with two big differences:\r\n* `make install` doesn't copy again from `build/lib` to `install/lib` if the library is already in the install folder.\r\n* now `LC_RPATH` is already pointing to `${CMAKE_INSTALL_PREFIX}/lib `. \r\n\r\nCalling `install_name_tool` would then error out\r\n```\r\nerror: install_name_tool: no LC_RPATH load command with path ${CMAKE_BUILD_DIR}/lib found in:\r\n${CMAKE_INSTALL_PREFIX}/lib/libXrdFoo.so, required for specified option\r\n\"-rpath ${CMAKE_BUILD_DIR}/lib ${CMAKE_INSTALL_PREFIX}/lib\"\r\n```\r\n\r\nAnd since we are happy with LC_RPATH pointing already to the install directory we can discard this type of error",
        "createdAt" : "2020-08-14T07:21:54Z",
        "updatedAt" : "2020-08-14T07:49:47Z",
        "lastEditedBy" : "82ce2c80-31ff-4f7b-91f0-fff78777d7f9",
        "tags" : [
        ]
      }
    ],
    "commit" : "ccf8f7c007259fa78b73521fac9e1ae7e5201639",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +3,7 @@# ${build_libdir} to ${install_libdir} with the `install_name_tool` executable.\n# On successive reiterations of the `cmake --install` command,\n# `install_name_tool` would error out since LC_RPATH would be already set to\n# ${install_libdir}. Since that is what we want in the end, we discard these\n# errors."
  }
]