[
  {
    "id" : "55c370ca-77b6-4bfe-9959-e9cfe11e8f65",
    "prId" : 10822,
    "prUrl" : "https://github.com/apache/kafka/pull/10822#pullrequestreview-687791197",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "parentId" : null,
        "authorId" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "body" : "How long does it take for all of the tests in this IT to run, say locally? IIUC, we're setting up a new Kafka cluster and Connect cluster for every test. How difficult would it be to share the same Kafka and Connect cluster across most of the tests?",
        "createdAt" : "2021-06-16T17:15:44Z",
        "updatedAt" : "2021-06-16T17:21:11Z",
        "lastEditedBy" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "tags" : [
        ]
      },
      {
        "id" : "61724358-d6cf-4b28-8e31-39cb0e2c2c4a",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "body" : "its on average 7-11sec per test (the ones with 35 sec are due to waiting in NOOP cases)\r\n![image](https://user-images.githubusercontent.com/29556518/122268900-42763900-cea2-11eb-8647-e417265a234d.png)\r\n\r\nLet me see if I can find a way to share and if it reduces the time.",
        "createdAt" : "2021-06-16T17:57:09Z",
        "updatedAt" : "2021-06-16T17:57:09Z",
        "lastEditedBy" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "tags" : [
        ]
      },
      {
        "id" : "7bb6e5b5-0858-4a01-960e-093cc07f75c8",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "body" : "Yeah, that's already a good portion of the total time to run the Connect unit and integration tests. It'd be great if we could avoid increasing the build times by that much.",
        "createdAt" : "2021-06-16T23:21:18Z",
        "updatedAt" : "2021-06-16T23:21:19Z",
        "lastEditedBy" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "tags" : [
        ]
      },
      {
        "id" : "5b0d3361-6649-44fc-86eb-a74724ec66e2",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "body" : "@rhauch  this was a good find, I just refactored the code, and this saved 2 min\r\n\r\n![image](https://user-images.githubusercontent.com/29556518/122320107-52fcd280-cee7-11eb-9e14-3c6f9af3a917.png)\r\n",
        "createdAt" : "2021-06-17T02:10:54Z",
        "updatedAt" : "2021-06-17T02:10:54Z",
        "lastEditedBy" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "tags" : [
        ]
      },
      {
        "id" : "a1dae860-ccac-42c7-8166-a4f13c8fe87c",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "body" : "Excellent! IIUC, the tests are only using 2 differently-sized clusters (1 node and 4 nodes), which is good because it minimizes the startup time. Can you confirm that statement is true? It seems like there are three total methods that take more than 30 seconds -- any reduction in duration on any of those three will have a very direct impact.",
        "createdAt" : "2021-06-17T16:00:11Z",
        "updatedAt" : "2021-06-17T16:00:15Z",
        "lastEditedBy" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "tags" : [
        ]
      },
      {
        "id" : "7057603c-1459-467e-8059-b4513c093a2d",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "body" : "I went with a different sleep duration and that cut the times by 1minute 15 sec \r\n![image](https://user-images.githubusercontent.com/29556518/122449965-132bfe80-cf6c-11eb-8658-e2a389163455.png)\r\n\r\nhttps://github.com/apache/kafka/pull/10822/commits/b60fb53a139dbd44c247ac1a4e2c927ef42ddc99.\r\nI chose 5sec because locally the test that sets up the cluster takes around 5 sec to do it and  most test after they setup the cluster finishes in <300ms, request propagation and restart isn't taking long but thats my local machine and I chose to do 15 times the wait in case cloud or other developer machines are slow.  @rhauch Could you please review to see if you agree with the fix as another idea is to reduce it to 1 sec?",
        "createdAt" : "2021-06-17T18:09:43Z",
        "updatedAt" : "2021-06-17T18:10:37Z",
        "lastEditedBy" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "tags" : [
        ]
      },
      {
        "id" : "ef4dc9b1-5084-46d2-a0ae-85f180a73a15",
        "parentId" : "9e79a338-54ca-4877-8d45-c502e43b93e0",
        "authorId" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "body" : "The new times after checking that API response didn't return any RESTARTING state is 13 sec and 10 sec out of it is in bringing up kafka cluster.\r\n\r\n![image](https://user-images.githubusercontent.com/29556518/122629722-ac4e3880-d084-11eb-8742-8cdaf703ba99.png)\r\n",
        "createdAt" : "2021-06-19T03:30:22Z",
        "updatedAt" : "2021-06-19T03:30:23Z",
        "lastEditedBy" : "094f6954-1557-4cfd-9696-2d85b89e8fea",
        "tags" : [
        ]
      }
    ],
    "commit" : "27100a789ac7b44c8bc13a9e1e65713f340be9e0",
    "line" : 65,
    "diffHunk" : "@@ -1,1 +63,67 @@ */\n@Category(IntegrationTest.class)\npublic class ConnectorRestartApiIntegrationTest {\n    private static final Logger log = LoggerFactory.getLogger(ConnectorRestartApiIntegrationTest.class);\n"
  }
]