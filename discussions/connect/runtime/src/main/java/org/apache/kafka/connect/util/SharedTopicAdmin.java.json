[
  {
    "id" : "7af55e53-0c38-48c1-818c-5462cd85f5ee",
    "prId" : 9780,
    "prUrl" : "https://github.com/apache/kafka/pull/9780#pullrequestreview-584032336",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e4eb882-246b-4fc5-8979-f5e7d0eeb77e",
        "parentId" : null,
        "authorId" : "e77724e7-3db9-47d6-b4d8-a865b1d06edc",
        "body" : "It's not immediately obvious to me what's the advantage compared to a synchronized `topicAdmin` or even `get`. \r\n\r\nI see that the value can go back to null. But we already have the guard with the `closed` to atomically decide whether this is closed or not. Lmk if I'm missing something, but I feel the points of indirection might be a few more than they have to be here (we have no gains in locking, since we'll need to atomically `updateAndGet` in every get and the advantage vs `synchronized` should be negligible here). ",
        "createdAt" : "2021-02-04T22:57:35Z",
        "updatedAt" : "2021-02-09T07:49:14Z",
        "lastEditedBy" : "e77724e7-3db9-47d6-b4d8-a865b1d06edc",
        "tags" : [
        ]
      },
      {
        "id" : "f13ceffa-8651-4959-9d25-685a03f2d065",
        "parentId" : "2e4eb882-246b-4fc5-8979-f5e7d0eeb77e",
        "authorId" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "body" : "I'm not sure there is much advantage either way, considering these methods are not called frequently and `synchronized` would indeed work. I personally like the simplicity of using `AtomicReference`, which to me seemed natural and straightforward, avoided having to synchronize the entire methods, and needed no if-checks in this method.",
        "createdAt" : "2021-02-05T01:22:27Z",
        "updatedAt" : "2021-02-09T07:49:14Z",
        "lastEditedBy" : "145db0de-7396-4643-9a2c-9977e1c6219b",
        "tags" : [
        ]
      },
      {
        "id" : "c8babab2-8ffd-45e3-92f3-9430ce8b10eb",
        "parentId" : "2e4eb882-246b-4fc5-8979-f5e7d0eeb77e",
        "authorId" : "e77724e7-3db9-47d6-b4d8-a865b1d06edc",
        "body" : "I'm happy to leave it as an example of the pattern that demonstrates how to apply `updateAndGet`. \r\n\r\nI just didn't feel that the two or three levels of indirection were worth to write the singleton pattern differently.",
        "createdAt" : "2021-02-05T05:27:26Z",
        "updatedAt" : "2021-02-09T07:49:14Z",
        "lastEditedBy" : "e77724e7-3db9-47d6-b4d8-a865b1d06edc",
        "tags" : [
        ]
      }
    ],
    "commit" : "54a3f10bc7be899cb47c6500d51ff2cec3e1e572",
    "line" : 82,
    "diffHunk" : "@@ -1,1 +80,84 @@     */\n    public TopicAdmin topicAdmin() {\n        return admin.updateAndGet(this::createAdmin);\n    }\n"
  }
]