[
  {
    "id" : "80a52691-3cf7-44ac-95ca-96bdce339791",
    "prId" : 56040,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/56040#pullrequestreview-98128168",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7b9087cf-9d86-44d1-a1fb-898a55a7a99e",
        "parentId" : null,
        "authorId" : "d2b16581-e7e9-48b8-9f76-6f6bcb9ec300",
        "body" : "It doesn't look like this is used.",
        "createdAt" : "2018-02-20T17:37:22Z",
        "updatedAt" : "2018-04-16T05:30:53Z",
        "lastEditedBy" : "d2b16581-e7e9-48b8-9f76-6f6bcb9ec300",
        "tags" : [
        ]
      },
      {
        "id" : "7d8c856d-7f74-4e48-aa40-9ca6cfac7615",
        "parentId" : "7b9087cf-9d86-44d1-a1fb-898a55a7a99e",
        "authorId" : "51f59c69-efc0-451a-bd8f-d9fa2c281fd3",
        "body" : "Thanks for catching this. Intention is to use it from checkpoint manager's ReadCheckpoint()",
        "createdAt" : "2018-02-21T09:48:53Z",
        "updatedAt" : "2018-04-16T05:30:53Z",
        "lastEditedBy" : "51f59c69-efc0-451a-bd8f-d9fa2c281fd3",
        "tags" : [
        ]
      }
    ],
    "commit" : "cedbd932550d15a3e649ddb02ac74784ade32f06",
    "line" : 88,
    "diffHunk" : "@@ -1,1 +63,67 @@\n// VerifyChecksum verifies that passed checksum is same as calculated checksum\nfunc (cp *Data) VerifyChecksum() error {\n\treturn cp.Checksum.Verify(*cp.Pod)\n}"
  },
  {
    "id" : "77204409-edb8-4a89-b709-1d45a8bc50be",
    "prId" : 50984,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/50984#pullrequestreview-71238570",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "83c84a79-2413-4c1c-9d82-db7306829845",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this means that removing the checkpoint annotation from a pod will never clean it up (here or in DeletePod)",
        "createdAt" : "2017-08-24T16:58:49Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "b9158759-2ea3-4600-a4a7-289c6b0ead76",
        "parentId" : "83c84a79-2413-4c1c-9d82-db7306829845",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "Good point, I'll create a UID cache so updates that remove cause a checkpoint delete. ",
        "createdAt" : "2017-08-24T18:12:02Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "ab831335-ef0c-4aee-b085-933a7e6c3619",
        "parentId" : "83c84a79-2413-4c1c-9d82-db7306829845",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "Fixed. ",
        "createdAt" : "2017-10-23T16:00:38Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      }
    ],
    "commit" : "763122ae4bc86a055e9c0cca5a3ac987caef23e2",
    "line" : 132,
    "diffHunk" : "@@ -1,1 +130,134 @@func (fcp *fileCheckPointManager) WritePod(pod *v1.Pod) error {\n\tvar err error\n\tif fcp.checkAnnotations(pod) {\n\t\tif blob, err := yaml.Marshal(pod); err == nil {\n\t\t\terr = safefile.WriteFile(fcp.getPodPath(pod), blob, 0644)"
  },
  {
    "id" : "cc7e87a2-801d-4222-a406-5557f0632d2b",
    "prId" : 50984,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/50984#pullrequestreview-75975210",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f60aa7c5-e298-4e79-bc9d-d104aebdff61",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "I'm curious -- why naming the file `Pod` (instead of `pod`)?",
        "createdAt" : "2017-11-02T01:38:53Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "608922ff-1171-4f19-b3e7-885e16e5ff5f",
        "parentId" : "f60aa7c5-e298-4e79-bc9d-d104aebdff61",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "No reason really, makes no different to me. ",
        "createdAt" : "2017-11-12T22:53:18Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      }
    ],
    "commit" : "763122ae4bc86a055e9c0cca5a3ac987caef23e2",
    "line" : 100,
    "diffHunk" : "@@ -1,1 +98,102 @@// getPodPath returns the full qualified path for the pod checkpoint\nfunc (fcp *fileCheckPointManager) getPodPath(pod *v1.Pod) string {\n\treturn fmt.Sprintf(\"%v/Pod%v%v.yaml\", fcp.path, delimiter, pod.GetUID())\n}\n"
  },
  {
    "id" : "25db8e37-cf64-4599-ba96-27adaf2d9760",
    "prId" : 50984,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/50984#pullrequestreview-78224123",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cce09de6-1923-4c32-adbf-aecfb352440b",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "There are already many implementations in kuberentes/kubelet doing the same thing. Do we need to vendor yet another external package for this?\r\n\r\nAlternatively, you could just use the filestore https://github.com/kubernetes/kubernetes/blob/v1.9.0-alpha.3/pkg/kubelet/util/store/store.go",
        "createdAt" : "2017-11-16T19:59:52Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "1e202965-4cef-4d1c-9de1-a0f59d1669e6",
        "parentId" : "cce09de6-1923-4c32-adbf-aecfb352440b",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "At this stage I would prefer to create a separate issue.  The safefile semantics are cleaner imo b/c they follow standard golang file handing api.  ",
        "createdAt" : "2017-11-17T14:55:33Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "3f7b544d-5909-4ccb-9966-81c0b9824ee7",
        "parentId" : "cce09de6-1923-4c32-adbf-aecfb352440b",
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "Ack. FYI, there is a new PR to consolidate the checkpointing code #56040",
        "createdAt" : "2017-11-21T19:04:22Z",
        "updatedAt" : "2017-11-21T19:04:23Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      }
    ],
    "commit" : "763122ae4bc86a055e9c0cca5a3ac987caef23e2",
    "line" : 134,
    "diffHunk" : "@@ -1,1 +132,136 @@\tif fcp.checkAnnotations(pod) {\n\t\tif blob, err := yaml.Marshal(pod); err == nil {\n\t\t\terr = safefile.WriteFile(fcp.getPodPath(pod), blob, 0644)\n\t\t}\n\t} else {"
  },
  {
    "id" : "ed4afaea-f242-4a9e-ad5c-3e5893013944",
    "prId" : 50984,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/50984#pullrequestreview-77994672",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "442960d5-c1cb-44c2-a9fe-b60d53a96901",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "IIUC, every update of a regular pod without the checkpoint annotation will trigger a deletion, which either calls `os.Stat` or `os.Remove`. That doesn't seem good. If you plan to optimize that in the future, please add a TODO. ",
        "createdAt" : "2017-11-16T22:15:26Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "884549cc-7bbf-4e86-b59a-ab691eb9d5f5",
        "parentId" : "442960d5-c1cb-44c2-a9fe-b60d53a96901",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "The stat precedes any delete, and again this is an opt-in behavior on master nodes for control plane bootstrapping, not general purpose checkpointing, but I can add a TODO to optimize if more generally used. ",
        "createdAt" : "2017-11-17T14:59:11Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "fbab8f7a-7b1d-4eb6-83f3-38722e780045",
        "parentId" : "442960d5-c1cb-44c2-a9fe-b60d53a96901",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "I updated below. ",
        "createdAt" : "2017-11-21T03:56:37Z",
        "updatedAt" : "2017-11-21T04:24:51Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      }
    ],
    "commit" : "763122ae4bc86a055e9c0cca5a3ac987caef23e2",
    "line" : 139,
    "diffHunk" : "@@ -1,1 +137,141 @@\t\t// This is to handle an edge where a pod update could remove\n\t\t// an annotation and the checkpoint should then be removed.\n\t\terr = fcp.DeletePod(pod)\n\t}\n\treturn err"
  },
  {
    "id" : "b3ddceb7-fd45-4ff8-95dd-7e8b1fae03e0",
    "prId" : 50984,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/50984#pullrequestreview-78225232",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "183328f4-13f1-4b28-b1a8-557122076d68",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "Would this possibly contain temporary files written by `safefile.WriteFile`? Could you check and ignore them?",
        "createdAt" : "2017-11-21T19:00:46Z",
        "updatedAt" : "2017-11-21T19:00:47Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "10417f4d-55e3-4d7a-8755-b3ce72a695c8",
        "parentId" : "183328f4-13f1-4b28-b1a8-557122076d68",
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "I think the code would print an warning, but it's quite annoying. Okay for an alpha feature though, as long as those temporary files are properly ignored. Please do check if that's the case.",
        "createdAt" : "2017-11-21T19:08:29Z",
        "updatedAt" : "2017-11-21T19:09:10Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      }
    ],
    "commit" : "763122ae4bc86a055e9c0cca5a3ac987caef23e2",
    "line" : 110,
    "diffHunk" : "@@ -1,1 +108,112 @@\t\treturn nil, err\n\t}\n\tfor _, f := range files {\n\t\t// get just the filename\n\t\t_, fname := filepath.Split(f.Name())"
  }
]