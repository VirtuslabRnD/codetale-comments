[
  {
    "id" : "9da85f19-83f8-4f1c-8ab7-13d9483fbc85",
    "prId" : 88006,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88006#pullrequestreview-357139514",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ef4fc957-ef7a-47eb-92ee-2330252b9b97",
        "parentId" : null,
        "authorId" : "542e5d2f-2ff9-4674-ab44-78f31768e7a1",
        "body" : "should be `pluginName`?",
        "createdAt" : "2020-02-12T01:03:01Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "542e5d2f-2ff9-4674-ab44-78f31768e7a1",
        "tags" : [
        ]
      },
      {
        "id" : "7520a562-88f1-4772-a9e1-cc0003674ea9",
        "parentId" : "ef4fc957-ef7a-47eb-92ee-2330252b9b97",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Since there is only one name in the struct, I think it is clear the name is plugin name.",
        "createdAt" : "2020-02-12T01:42:28Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7bde41478ffa395f35a3edd8985e874500a055c",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +79,83 @@type NamedPluginHandler struct {\n\tHandler PluginHandler\n\tName    string\n}\n"
  },
  {
    "id" : "bcb5a3ab-917d-4297-bd67-ff621cdf5ff8",
    "prId" : 88006,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88006#pullrequestreview-357543658",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e180442-f804-4fb7-9f8d-204c415fdabf",
        "parentId" : null,
        "authorId" : "30d919af-5437-40f9-91da-4589352c33f0",
        "body" : "Do we need import above two structs? Can we add plugin name and type info into the existing PluginInfo struct when the plugin finishes registering? ",
        "createdAt" : "2020-02-12T03:11:03Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "30d919af-5437-40f9-91da-4589352c33f0",
        "tags" : [
        ]
      },
      {
        "id" : "65cc089c-89fd-49f0-9a7a-215719b586dc",
        "parentId" : "2e180442-f804-4fb7-9f8d-204c415fdabf",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "PluginInfo is used by actualStateOfWorld struct :\r\n```\r\n\tsocketFileToInfo map[string]PluginInfo\r\n```\r\nFor actualStateOfWorld, the above two structs are not relevant.\r\nIt seems we shouldn't conflate PluginInfo with such information.",
        "createdAt" : "2020-02-12T03:20:26Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "dc719756-73f3-47e1-9f9b-057b4a944bb4",
        "parentId" : "2e180442-f804-4fb7-9f8d-204c415fdabf",
        "authorId" : "30d919af-5437-40f9-91da-4589352c33f0",
        "body" : "Why are they not relevant? Both plugin name and type are about plugin information, so why can't we add them into PluginInfo struct?",
        "createdAt" : "2020-02-12T03:25:23Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "30d919af-5437-40f9-91da-4589352c33f0",
        "tags" : [
        ]
      },
      {
        "id" : "3ab9284f-cd1d-459d-84b8-5095f7ad1ab3",
        "parentId" : "2e180442-f804-4fb7-9f8d-204c415fdabf",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "In the new struct, type is not involved.\r\nIf we change the map to:\r\n```\r\n\tHandlers map[string]PluginInfo\r\n```\r\nthere would be redundancy - SocketPath is in both key and value.\r\nIt seems current formation is better.",
        "createdAt" : "2020-02-12T15:25:34Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7bde41478ffa395f35a3edd8985e874500a055c",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +86,90 @@\tHandlers map[string]NamedPluginHandler\n\tsync.Mutex\n}\n\n// PluginInfo holds information of a plugin"
  },
  {
    "id" : "c6efb2c2-60e2-466b-9bd5-e54dc87b5170",
    "prId" : 88006,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/88006#pullrequestreview-370702324",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "91d6c558-86f9-42b8-93b2-f1ff666e88ae",
        "parentId" : null,
        "authorId" : "f8f9446d-82d7-43cf-88d1-cecfb048866d",
        "body" : "Can we use `sync.Map` here to store the map of socket path -> NamedPluginHandler, instead of creating a struct?",
        "createdAt" : "2020-03-06T20:00:41Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "f8f9446d-82d7-43cf-88d1-cecfb048866d",
        "tags" : [
        ]
      },
      {
        "id" : "0f9dac11-311c-48d4-83ff-a46d70962e76",
        "parentId" : "91d6c558-86f9-42b8-93b2-f1ff666e88ae",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "It seems both mutex-guarded map and sync.Map are used in the codebase.\r\nIf the use of sync.Map is not due to performance concern, I prefer to keep the current formation.\r\nSwitching to sync.Map can be done in a followup PR.",
        "createdAt" : "2020-03-07T00:41:10Z",
        "updatedAt" : "2020-03-31T13:57:34Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7bde41478ffa395f35a3edd8985e874500a055c",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +83,87 @@\n// SocketPluginHandlers contains the map from socket path to NamedPluginHandler\ntype SocketPluginHandlers struct {\n\tHandlers map[string]NamedPluginHandler\n\tsync.Mutex"
  },
  {
    "id" : "8ff7fa00-d5ec-48d7-bd01-f6720041adc1",
    "prId" : 73891,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73891#pullrequestreview-222503313",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "47695bb6-338f-49e7-b967-175a2999937e",
        "parentId" : null,
        "authorId" : "8e448017-7838-493d-a424-33cada0da657",
        "body" : "Add a compile type interface implementation check:\r\n\r\n```Go\r\nvar _ ActualStateOfWorld = &actualStateOfWorld{}\r\n```",
        "createdAt" : "2019-04-03T23:43:45Z",
        "updatedAt" : "2019-05-30T23:01:15Z",
        "lastEditedBy" : "8e448017-7838-493d-a424-33cada0da657",
        "tags" : [
        ]
      }
    ],
    "commit" : "5e185544421d5504b0fe2ae32c8ebfb3000a1224",
    "line" : 68,
    "diffHunk" : "@@ -1,1 +66,70 @@}\n\ntype actualStateOfWorld struct {\n\n\t// socketFileToInfo is a map containing the set of successfully registered plugins"
  },
  {
    "id" : "dfea4d66-23fb-40d8-bf8c-7bbf40aedcb7",
    "prId" : 73891,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73891#pullrequestreview-230453522",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2bd75b59-a4f1-457f-8573-be2ddf923a21",
        "parentId" : null,
        "authorId" : "8e448017-7838-493d-a424-33cada0da657",
        "body" : "This is super nit picky, but this code is so well factored, this might be worth fixing (it will discourage others from misusing it in the future).\r\n\r\n`Timestamp` is an internal implementation detail of actual and desired state. But because we require external callers to pass in the `PluginInfo` object they are forced to set it. Instead, it would be much cleaner if we did the following:\r\n\r\n1. Change `desiredStateOfWorld.AddOrUpdatePlugin(pluginInfo PluginInfo)` to only take the required parameters: `desiredStateOfWorld.AddOrUpdatePlugin(socketPath string, foundInDeprecatedDir bool)` (no `timestamp`).\r\n2. Change the implementation of `desiredStateOfWorld.AddOrUpdatePlugin(socketPath string, foundInDeprecatedDir bool)` to automatically set `plugininfo.Timestamp` to `time.Now()` for `dsw.socketFileToInfo[socketPath]`.\r\n3. Update the callers for `desiredStateOfWorld.AddOrUpdatePlugin(...)` so they no longer have to pass the full `PluginInfo` object (or the `Timestamp`).\r\n\r\nAlso, if you're feeling really inspired and want to get really fancy with separation of concerns, we could also rename `PluginInfo` to `pluginInfo` to make it [private](https://golang.org/ref/spec#Exported_identifiers) to the `cache` package. But that's a much bigger change, because it is being used all over the place.\r\n\r\nAll of this is totally optional, if you want to, if not, no worries.",
        "createdAt" : "2019-04-25T05:16:32Z",
        "updatedAt" : "2019-05-30T23:01:15Z",
        "lastEditedBy" : "8e448017-7838-493d-a424-33cada0da657",
        "tags" : [
        ]
      }
    ],
    "commit" : "5e185544421d5504b0fe2ae32c8ebfb3000a1224",
    "line" : 82,
    "diffHunk" : "@@ -1,1 +80,84 @@\tSocketPath           string\n\tFoundInDeprecatedDir bool\n\tTimestamp            time.Time\n}\n"
  },
  {
    "id" : "0fd91975-f663-45d6-88af-393b8170ec18",
    "prId" : 73891,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73891#pullrequestreview-244420888",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "addf0d82-f064-47d1-9120-8d0931c09a8f",
        "parentId" : null,
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Not sure why the check is needed - we can delete the entry directly.\r\nIt is fine if the key doesn't exist.",
        "createdAt" : "2019-05-31T17:11:47Z",
        "updatedAt" : "2019-05-31T17:34:42Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "5e185544421d5504b0fe2ae32c8ebfb3000a1224",
    "line" : 103,
    "diffHunk" : "@@ -1,1 +101,105 @@\tdefer asw.Unlock()\n\n\tif _, ok := asw.socketFileToInfo[socketPath]; ok {\n\t\tdelete(asw.socketFileToInfo, socketPath)\n\t}"
  }
]