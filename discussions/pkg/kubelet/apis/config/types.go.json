[
  {
    "id" : "5d0936af-143e-4cc3-9389-f08c9ef13d28",
    "prId" : 102823,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102823#pullrequestreview-694417097",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9f39ffb1-3191-4926-ae6e-4da9834656f1",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "I expected to see something in here indicating whether swap support was enabled, defaulting to the current behavior of the kubelet not allowing swap. Is this feature intended to unconditionally support swap once it graduates to beta/GA?",
        "createdAt" : "2021-06-28T21:13:50Z",
        "updatedAt" : "2021-06-28T21:16:04Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "e201e285-93b2-447c-96c9-9ce7f6147a3c",
        "parentId" : "9f39ffb1-3191-4926-ae6e-4da9834656f1",
        "authorId" : "31a2ac00-6c67-4307-a4bc-bfd13f41ef27",
        "body" : "In order to enable swap, one must also enable the `--fail-swap-on=false` flag on the kubelet. Otherwise, kubelet will not start when there is swap on the system.\r\n\r\nSo matrix is:\r\n\r\n| |fail-swap-on=true|fail-swap-on=false|\r\n|-|-|-|\r\n|feature-flag=false|Kubelet won't start if swap is available|Kubelet will default to current behaviour|\r\n|feature-flag=true|Kubelet won't start if swap is available|Kubelet will use swap config|\r\n\r\nMy plan is to eventually remove the feature flag, but there are no plans for removing the `--fail-swap-on` flag.",
        "createdAt" : "2021-06-28T21:32:34Z",
        "updatedAt" : "2021-06-28T21:32:34Z",
        "lastEditedBy" : "31a2ac00-6c67-4307-a4bc-bfd13f41ef27",
        "tags" : [
        ]
      },
      {
        "id" : "30447985-c8e4-43a7-b821-9e174e88d63d",
        "parentId" : "9f39ffb1-3191-4926-ae6e-4da9834656f1",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "ah, I missed the separate `failSwapOn` field in the kubelet config file. that's what I was looking for",
        "createdAt" : "2021-06-28T21:40:20Z",
        "updatedAt" : "2021-06-28T21:40:20Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "558472560582a48826a118b1795fc072957412b5",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +574,578 @@}\n\ntype MemorySwapConfiguration struct {\n\t// swapBehavior configures swap memory available to container workloads. May be one of\n\t// \"\", \"LimitedSwap\": workload combined memory and swap usage cannot exceed pod memory limit"
  },
  {
    "id" : "1cdb1619-bf62-4238-9a4c-4b2a46b6dbd0",
    "prId" : 99735,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/99735#pullrequestreview-605673331",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7e5837a5-b5c5-4f98-8710-043d724c94e3",
        "parentId" : null,
        "authorId" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "body" : "We're adding a new `+featureGate=GracefulNodeShutdown` tag - if you put it here, later tooling will use it automatically.",
        "createdAt" : "2021-03-05T22:47:24Z",
        "updatedAt" : "2021-03-05T23:25:31Z",
        "lastEditedBy" : "f87fe7d3-581c-4cb6-b17e-b807c6f2c789",
        "tags" : [
        ]
      },
      {
        "id" : "c8fef8b7-0385-4fd4-ba04-0c60d62de867",
        "parentId" : "7e5837a5-b5c5-4f98-8710-043d724c94e3",
        "authorId" : "db4d847e-0006-4342-9243-2f3f71f190b9",
        "body" : "thanks, I can add that.\r\n\r\nShould the `featureGate=GracefulNodeShutdown` tag be added here or in https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/kubelet/config/v1beta1/types.go (where I see there's already existing tags like `+optional`)?",
        "createdAt" : "2021-03-05T23:00:47Z",
        "updatedAt" : "2021-03-05T23:25:31Z",
        "lastEditedBy" : "db4d847e-0006-4342-9243-2f3f71f190b9",
        "tags" : [
        ]
      }
    ],
    "commit" : "893f5fd4f007775d48536cae192d79f209eeeac2",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +380,384 @@\tEnableSystemLogHandler bool\n\t// ShutdownGracePeriod specifies the total duration that the node should delay the shutdown and total grace period for pod termination during a node shutdown.\n\t// Defaults to 0 seconds.\n\t// +featureGate=GracefulNodeShutdown\n\t// +optional"
  },
  {
    "id" : "f22fb79e-472d-4adb-9bfb-6ac336dd866b",
    "prId" : 96129,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96129#pullrequestreview-525578710",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8b7a1545-7410-423d-9217-5ccd8ac9fa27",
        "parentId" : null,
        "authorId" : "85d51570-e06e-4b3f-a869-f5f820e49119",
        "body" : "please mention the default value",
        "createdAt" : "2020-11-05T19:23:15Z",
        "updatedAt" : "2020-11-12T21:48:27Z",
        "lastEditedBy" : "85d51570-e06e-4b3f-a869-f5f820e49119",
        "tags" : [
        ]
      },
      {
        "id" : "dc54ff82-8bf9-4cb4-9605-3293376631ac",
        "parentId" : "8b7a1545-7410-423d-9217-5ccd8ac9fa27",
        "authorId" : "85d51570-e06e-4b3f-a869-f5f820e49119",
        "body" : "Also the feature flag it is guarded with",
        "createdAt" : "2020-11-05T19:23:54Z",
        "updatedAt" : "2020-11-12T21:48:27Z",
        "lastEditedBy" : "85d51570-e06e-4b3f-a869-f5f820e49119",
        "tags" : [
        ]
      },
      {
        "id" : "72678400-06fd-4c6c-98d5-e813bc9284c6",
        "parentId" : "8b7a1545-7410-423d-9217-5ccd8ac9fa27",
        "authorId" : "db4d847e-0006-4342-9243-2f3f71f190b9",
        "body" : "Done.",
        "createdAt" : "2020-11-07T01:32:02Z",
        "updatedAt" : "2020-11-12T21:48:27Z",
        "lastEditedBy" : "db4d847e-0006-4342-9243-2f3f71f190b9",
        "tags" : [
        ]
      }
    ],
    "commit" : "16f71c6d47843c359e78c0eea2f34814f4cf055b",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +376,380 @@\t// EnableSystemLogHandler enables /logs handler.\n\tEnableSystemLogHandler bool\n\t// ShutdownGracePeriod specifies the total duration that the node should delay the shutdown and total grace period for pod termination during a node shutdown.\n\t// Defaults to 30 seconds, requires GracefulNodeShutdown feature gate to be enabled.\n\tShutdownGracePeriod metav1.Duration"
  },
  {
    "id" : "f3c42033-98aa-42fa-9252-9b2eb94dfecc",
    "prId" : 95479,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/95479#pullrequestreview-533753074",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "13550bea-6efb-4b28-9305-418966c21484",
        "parentId" : null,
        "authorId" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "body" : "How does this interact with the `SystemReserved`, `KubeReserved`, and `QOSReserved` flags? The documentation in the field and flag need to explain it.  Can you describe it for me here in a comment so i can review before it gets changed in the code?",
        "createdAt" : "2020-11-18T18:07:12Z",
        "updatedAt" : "2021-02-08T23:22:50Z",
        "lastEditedBy" : "6e2b5eda-1533-4798-a56c-432faaf38480",
        "tags" : [
        ]
      },
      {
        "id" : "7a27dfe2-fa10-4d52-aa99-87a7d6b5d0ea",
        "parentId" : "13550bea-6efb-4b28-9305-418966c21484",
        "authorId" : "1a01f766-6cee-4688-b28e-2e0e1f7e5b5f",
        "body" : "Hi @smarterclayton ,\r\n \r\nCould you provide a reference for `QOSReserved`? (I encounter this term first time)\r\n\r\nI hope the excerpt from the draft of official documentation helps (notice that the syntax for `--reserved-memory=` is outdated, we will update it in the final doc):\r\n\r\n### Reserved memory flag\r\n\r\n[Node Allocatable Feature](https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/) is commonly used by node administrators to reserve K8S node system resources for the kubelet or operating system processes in order to enhance the node stability. A dedicated set of flags can be used for this purpose to set the total amount of reserved memory for a node. This pre-configured value is subsequently utilized to calculate the real amount of node's \"allocatable\" memory available to pods. Also, K8S scheduler incorporates \"allocatable\" to optimise pod scheduling process. The foregoing flags include `--kube-reserved`, `--system-reserved` and `--eviction-threshold`. The sum of their values will account for the total amount of reserved memory.    \r\n\r\nA new `--reserved-memory` flag was added to Memory Manager to allow for this total reserved memory to be split (by a node administrator) and accordingly reserved across many NUMA nodes. \r\n\r\nSyntax: \r\n\r\n`--reserved-memory=[{numa-node=int,type=string,limit=string}][,][...]`\r\n* `numa-node` index, e.g. `0`\r\n* `type` of memory:\r\n  * `memory` - conventional memory\r\n  * `hugepages-2Mi` or `hugepages-1Gi` - hugepages \r\n* `limit` - the amount of reserved memory, e.g. `1Gi`\r\n\r\nExample usage:\r\n\r\n`--reserved-memory={numa-node=0,type=memory,limit=1Gi},{numa-node=1,type=memory,limit=2Gi}`\r\n\r\nWhen you specify values for `--reserved-memory` flag, you must comply with the setting that you prior provided via Node Allocatable Feature flags. That is, the following rule must be obeyed for each memory type: \r\n\r\n`sum(reserved-memory(i)) = kube-reserved + system-reserved + eviction-threshold`, \r\n\r\nwhere `i` is an index of a NUMA node. \r\n\r\nIf you do not follow the formula above, the Memory Manager will show an error on startup.\r\n\r\nIn other words, the example above illustrates that for the conventional memory (`type=memory`), we reserve `3Gi` in total, i.e.: \r\n\r\n`sum(reserved-memory(i)) = reserved-memory(0) + reserved-memory(1) = 1Gi + 2Gi = 3Gi`\r\n\r\nAn example of Node Allocatable Feature flags [configuration](https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/):\r\n* `--kube-reserved=cpu=500m,memory=50Mi`\r\n* `--system-reserved=cpu=123m,memory=333Mi`\r\n* `--eviction-hard=memory.available<500Mi`\r\n\r\n_NOTICE: hard eviction threshold is not equal to zero by default but `100Mi`, so do not forget to decrease the total amount set via `--reserved-memory` by this `100Mi`. Otherwise, the Memory Manager will display an error. Here is an example of a correct configuration:_\r\n\r\n```\r\n--feature-gates=MemoryManager=true \r\n--kube-reserved=cpu=4,memory=4Gi \r\n--system-reserved=cpu=1,memory=1Gi \r\n--memory-manager-policy=static \r\n--reserved-memory={numa-node=0,type=memory,limit=3Gi},{numa-node=1,type=memory,limit=2148Mi}\r\n```\r\nLet us validate the configuration above:\r\n1. `kube-reserved + system-reserved + eviction-hard(default) = reserved-memory(0) + reserved-memory(1)`\r\n2. `4Gi + 1Gi + 100Mi = 3Gi + 2148Mi`\r\n3. `5120Mi + 100Mi = 3072Mi + 2148Mi`\r\n4. `5220Mi = 5220Mi` (correct!)",
        "createdAt" : "2020-11-18T18:14:20Z",
        "updatedAt" : "2021-02-08T23:22:50Z",
        "lastEditedBy" : "1a01f766-6cee-4688-b28e-2e0e1f7e5b5f",
        "tags" : [
        ]
      },
      {
        "id" : "73642b1d-0c7b-4fb4-9a03-18c07ebcaa82",
        "parentId" : "13550bea-6efb-4b28-9305-418966c21484",
        "authorId" : "b15151c4-81af-487d-8c8f-a4f39690bd34",
        "body" : "Sure, we expect that the following formula must hold for each memory type:\r\n`sum(ReservedMemory(i)) = kube-reserved + system-reserved + hard-eviction-threshold`, it means that if\r\n```\r\n--kube-reserved=cpu=500m,memory=250Mi\r\n--system-reserved=cpu=500m,memory=250Mi\r\n--eviction-hard=memory.available<500Mi\r\n250+250+500=1Gi\r\n```\r\nthe total amount of memory defined under the reserved-memory flag should be equal to 1Gi, it can be different combinations, like, reserve all memory from the first NUMA node `--reserved-memory 0:memory=1Gi` or reserve equally from two NUMA nodes `--reserved-memory 0:memory=500Mi --reserved-memory 1:memory=500Mi`.\r\n\r\nUntil the documentation PR will be merged we can point to the KEP section, and once it merged I will update the link to point to the documentation(the same way that we have under the CLI flag).\r\n",
        "createdAt" : "2020-11-18T18:25:10Z",
        "updatedAt" : "2021-02-08T23:22:50Z",
        "lastEditedBy" : "b15151c4-81af-487d-8c8f-a4f39690bd34",
        "tags" : [
        ]
      }
    ],
    "commit" : "102124464a994946e151c976775cf751423b14f7",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +399,403 @@\t// 3. NUMAs nodes IDs that do not exist under the machine.\n\t// 4. memory types except for memory and hugepages-<size>\n\tReservedMemory []MemoryReservation\n}\n"
  },
  {
    "id" : "d18d5894-228a-4013-83ff-618ce39a5bd1",
    "prId" : 90494,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/90494#pullrequestreview-404365113",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e8559e1-0cfe-4817-8693-141325014a29",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "do we actually need this in the config or is it implied if RunOnce is false?",
        "createdAt" : "2020-04-27T13:44:56Z",
        "updatedAt" : "2020-05-17T01:34:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "f786f21e-497d-4cf8-ac4d-7cd66a4da159",
        "parentId" : "2e8559e1-0cfe-4817-8693-141325014a29",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "hmm... it looks like there are three things the kubelet serves:\r\n* secured port, governed by EnableServer\r\n* insecure port, governed by ReadOnlyPort\r\n* pod resources, governed by KubeletPodResources\r\n\r\nthose have evolved over time and aren't a very coherent config surface... I was hoping this would be improved when it moved into config rather than just replicated.",
        "createdAt" : "2020-04-27T13:50:32Z",
        "updatedAt" : "2020-05-17T01:34:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "52693313-120f-4a73-93b6-117ac3db9c81",
        "parentId" : "2e8559e1-0cfe-4817-8693-141325014a29",
        "authorId" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "body" : "What did you have in mind?\r\n\r\nOur main goal right now is to get to a versioned config format. Some refactoring is ok, but I'm wary of blocking on refactorings where the right thing to do may not be well-defined.",
        "createdAt" : "2020-04-28T17:08:59Z",
        "updatedAt" : "2020-05-17T01:34:36Z",
        "lastEditedBy" : "881df817-68e6-43dd-b4ea-f0b973f7dc41",
        "tags" : [
        ]
      },
      {
        "id" : "ccefa9c2-708a-40bf-a364-a11a874aab55",
        "parentId" : "2e8559e1-0cfe-4817-8693-141325014a29",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "I don't see a simplistic way to clean that up. I guess if v1beta1 is roughly equivalent to flags, and cleanup happens in later config versions, that could be ok",
        "createdAt" : "2020-05-01T19:51:15Z",
        "updatedAt" : "2020-05-17T01:34:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "8459c9b6f458f1e9e618e7be0d2ad63b5d434fd5",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +77,81 @@\t// enableServer enables Kubelet's secured server.\n\t// Note: Kubelet's insecure port is controlled by the readOnlyPort option.\n\tEnableServer bool\n\t// staticPodPath is the path to the directory containing local (static) pods to\n\t// run, or the path to a single static pod file."
  },
  {
    "id" : "c2d04472-174d-48a4-9c42-da31cfcea4ec",
    "prId" : 83592,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/83592#pullrequestreview-309870583",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "if the flag is a list, make this a `[]string` as well and use a flag.StringSliceVar",
        "createdAt" : "2019-10-30T14:28:53Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "492d8d33-8e5c-4a05-a651-05fea243c471",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "ee2e11d3-eec2-40c5-837f-b7bd6985d0e9",
        "body" : "so it can be 1,2,3,4, or 1,2,24-25, so I preferred to handle it as string",
        "createdAt" : "2019-10-30T15:12:10Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "ee2e11d3-eec2-40c5-837f-b7bd6985d0e9",
        "tags" : [
        ]
      },
      {
        "id" : "dd63dba2-8ff3-4e95-91a2-ced93ff3e2ac",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "they're unavoidable in CLI flags, but we generally avoid stringly typed config fields",
        "createdAt" : "2019-10-30T15:30:48Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "ebe00acd-30a6-45da-9bce-7223f4f162a7",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "this comment is still outstanding",
        "createdAt" : "2019-10-31T12:51:59Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "3aaae99a-c0ea-401a-91cc-91dce31b9620",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "ee2e11d3-eec2-40c5-837f-b7bd6985d0e9",
        "body" : "the reason string is used rather than []string is because cpuset.Parse take string as input; also \"-\" is expected, in addition to just \",\"",
        "createdAt" : "2019-10-31T13:13:31Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "ee2e11d3-eec2-40c5-837f-b7bd6985d0e9",
        "tags" : [
        ]
      },
      {
        "id" : "d47b0f14-82c5-49c3-b177-3a2f03bbc9f4",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "> also \"-\" is expected, in addition to just \",\"\r\n\r\niiuc, the - denotes a range, so `0,1,3-4` would parse to [\"0\",\"1\",\"3-4\"], right?",
        "createdAt" : "2019-10-31T13:18:29Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "efdd6727-45c0-4307-90d9-88612023cad0",
        "parentId" : "2117a6d2-ca1c-435d-aa28-67f0c9062691",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "looking at `Parse`, the string format is an [externally accepted format](http://man7.org/linux/man-pages/man7/cpuset.7.html#FORMATS). If that's the case, using that format in the config seems ok.",
        "createdAt" : "2019-10-31T13:20:46Z",
        "updatedAt" : "2019-11-06T12:37:36Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "89dfd244838f21ecaf9bc9bf28662a7cccdd8425",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +335,339 @@\t// This provide a \"static\" CPU list rather than the \"dynamic\" list by system-reserved and kube-reserved.\n\t// This option overwrites CPUs provided by system-reserved and kube-reserved.\n\tReservedSystemCPUs string\n}\n"
  },
  {
    "id" : "07302628-4f62-4ca0-a434-81bb9d20633c",
    "prId" : 82099,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82099#pullrequestreview-281114375",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0cacb1ad-737b-4f26-91c7-837220f5f282",
        "parentId" : null,
        "authorId" : "8eff55b7-2f52-4dd6-b8a6-b75a1c427179",
        "body" : "nit: misspelling of `is`",
        "createdAt" : "2019-08-28T21:29:59Z",
        "updatedAt" : "2019-08-30T13:31:14Z",
        "lastEditedBy" : "8eff55b7-2f52-4dd6-b8a6-b75a1c427179",
        "tags" : [
        ]
      }
    ],
    "commit" : "8ad1b5ba3b9be9558bef5213682734891eb1191b",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +64,68 @@\t// of NUMA alignment of a pod's CPU and device resources.\n\tNoneTopologyManagerPolicy = \"none\"\n\t// SingleNumaNodeTopologyManager Policy iis a mode in which kubelet only allows\n\t// pods with a single NUMA alignment of CPU and device resources.\n\tSingleNumaNodeTopologyManager = \"single-numa-node\""
  }
]