[
  {
    "id" : "edb37e20-244e-42d1-8b0e-8002bb9b84b2",
    "prId" : 71679,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/71679#pullrequestreview-225057422",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a72aec49-390e-409d-9163-efc2e3697202",
        "parentId" : null,
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Looking at the calls to ShouldMessageBePrinted(), it seems we don't need to call cleanupErrorTimeouts() for every call to ShouldMessageBePrinted() - since the calls may be frequent.\r\n\r\nHow about calling cleanupErrorTimeouts() every 1/N of l.identicalErrorDelay (where N is > 1) ?",
        "createdAt" : "2019-04-09T21:23:24Z",
        "updatedAt" : "2019-04-09T21:23:24Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "b951dab3-60c1-46db-8722-72830027a24f",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "@RobertKrawitz @derekwaynecarr @feiskyer\r\nWhat do you think of the above suggestion ?\r\n\r\nThanks",
        "createdAt" : "2019-04-09T21:48:40Z",
        "updatedAt" : "2019-04-09T21:48:40Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "bed062bb-985f-480f-a3ed-4ad305864dff",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "4aab55a0-5299-4d58-b630-6d54a352dba8",
        "body" : "I suppose we could do something like that; the purpose of cleanupErrorTimeouts() is to prevent a memory leak in the lastError and errorPrinted maps, so as long as we call cleanupErrorTimeouts() fairly regularly we should be OK.  I don't see any real harm in it being called every identicalErrorDelay; that will still result in cleaning things up reasonably promptly.  If someone does that, they might as well also change cleanupErrorTimeouts() to call nowfunc() only once.",
        "createdAt" : "2019-04-09T22:18:39Z",
        "updatedAt" : "2019-04-10T13:58:56Z",
        "lastEditedBy" : "4aab55a0-5299-4d58-b630-6d54a352dba8",
        "tags" : [
        ]
      },
      {
        "id" : "8b564a0d-decf-401d-bdd3-d533e70da5e7",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Another improvement is to record the number of successive logs of the same error message and show the count when error message changes (w.r.t. the same parentID).\r\nCurrently, within identicalErrorDelay, false is returned and we lose such count.\r\n\r\n",
        "createdAt" : "2019-04-09T22:58:38Z",
        "updatedAt" : "2019-04-09T22:58:38Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "2ec0abd2-215b-48c3-a650-5e89e049f841",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "4aab55a0-5299-4d58-b630-6d54a352dba8",
        "body" : "Please feel free to open an issue and/or a PR for this if you like.",
        "createdAt" : "2019-04-10T13:57:58Z",
        "updatedAt" : "2019-04-10T13:58:56Z",
        "lastEditedBy" : "4aab55a0-5299-4d58-b630-6d54a352dba8",
        "tags" : [
        ]
      },
      {
        "id" : "fd8f08b3-4527-4a95-a8d0-eb3aa4d31f74",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "issue #76358 was opened",
        "createdAt" : "2019-04-10T14:44:01Z",
        "updatedAt" : "2019-04-10T14:44:02Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      },
      {
        "id" : "2e792588-e74f-4cbf-b25c-e4713b9b4041",
        "parentId" : "a72aec49-390e-409d-9163-efc2e3697202",
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Looking at ShouldMessageBePrinted(), it doesn't have the message which is passed to klog method call.\r\nShould we pass the message to ShouldMessageBePrinted() ?\r\n\r\n@RobertKrawitz ",
        "createdAt" : "2019-04-10T15:42:38Z",
        "updatedAt" : "2019-04-10T15:42:38Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "022f7c2cd75f984ef0a3a3a7a826ef723a65b555",
    "line" : 60,
    "diffHunk" : "@@ -1,1 +58,62 @@\tl.errorMapLock.Lock()\n\tdefer l.errorMapLock.Unlock()\n\tl.cleanupErrorTimeouts()\n\tlastMsg, ok := l.lastError[parentID]\n\tlastPrinted, ok1 := l.errorPrinted[parentID]"
  }
]