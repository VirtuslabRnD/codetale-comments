[
  {
    "id" : "e0916ab0-1305-4a99-af2c-5eb4731d3073",
    "prId" : 94115,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/94115#pullrequestreview-472081872",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "336ad55d-c8fc-4752-8343-720563dc1152",
        "parentId" : null,
        "authorId" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "body" : "This is a little hacky but I think it's reasonable until we add a dedicated `TimedOutError` error for utilexec. For now we have to return `utilexec.CodeExitError` since the exec prober is expecting this for failed probes:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/442a69c3bdf6fe8e525b05887e57d89db1e2f3a5/pkg/probe/exec/exec.go#L60-L69\r\n\r\nAlternative, we can update the prober worker to stop ignoring errors from the prober:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/442a69c3bdf6fe8e525b05887e57d89db1e2f3a5/pkg/kubelet/prober/worker.go#L245-L249\r\n\r\nBut that change seems riskier since I'm not sure that all probe error should always lead to an actual probe failure. ",
        "createdAt" : "2020-08-21T01:34:14Z",
        "updatedAt" : "2020-11-09T18:05:18Z",
        "lastEditedBy" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "tags" : [
        ]
      }
    ],
    "commit" : "af40d18b6792cee723f1f25bd5bfd2db79de0fd7",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +393,397 @@\n\t\t// interpret DeadlineExceeded gRPC errors as timedout probes\n\t\tif status.Code(err) == codes.DeadlineExceeded {\n\t\t\terr = exec.NewTimeoutError(fmt.Errorf(\"command %q timed out\", strings.Join(cmd, \" \")), timeout)\n\t\t}"
  },
  {
    "id" : "8c15525a-e570-4410-93fa-89f6b69f1bb8",
    "prId" : 94115,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/94115#pullrequestreview-472652046",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb44f3fd-421b-4dee-8f9b-041d11205ff2",
        "parentId" : null,
        "authorId" : "d2b16581-e7e9-48b8-9f76-6f6bcb9ec300",
        "body" : "I don't actually see where we are returning this type of error from the dockershim.  What am I missing?",
        "createdAt" : "2020-08-21T16:46:35Z",
        "updatedAt" : "2020-11-09T18:05:18Z",
        "lastEditedBy" : "d2b16581-e7e9-48b8-9f76-6f6bcb9ec300",
        "tags" : [
        ]
      },
      {
        "id" : "ad1e79ae-25b6-4ff1-9e32-f0e4263c6b3e",
        "parentId" : "cb44f3fd-421b-4dee-8f9b-041d11205ff2",
        "authorId" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "body" : "This is specifically for fixing exec probe timeout from containerd actually. ",
        "createdAt" : "2020-08-21T16:58:50Z",
        "updatedAt" : "2020-11-09T18:05:18Z",
        "lastEditedBy" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "tags" : [
        ]
      },
      {
        "id" : "4fcd72d9-cf79-4bef-b8c6-ce8120f70773",
        "parentId" : "cb44f3fd-421b-4dee-8f9b-041d11205ff2",
        "authorId" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "body" : "The PR was originally open for dockershim, but @dchen1107 mentioned livenssprobe exec timeout was not working for contaienrd as well, which was caught in the e2e tests I re-enabled. This should fix that as well. \r\n\r\nReason for this change is probe worker throws away any non-nil error:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/442a69c3bdf6fe8e525b05887e57d89db1e2f3a5/pkg/kubelet/prober/worker.go#L245-L249\r\n\r\nSo to ensure timeouts are considered as actual probe failures, the generic exec Probe needs to receive a `CodeExitError` error here whenever the grpc error code is `DeadlineExceeded`:\r\n\r\nhttps://github.com/kubernetes/kubernetes/blob/442a69c3bdf6fe8e525b05887e57d89db1e2f3a5/pkg/probe/exec/exec.go#L60-L69\r\n",
        "createdAt" : "2020-08-21T17:04:29Z",
        "updatedAt" : "2020-11-09T18:05:18Z",
        "lastEditedBy" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "tags" : [
        ]
      },
      {
        "id" : "1a08a01d-8b37-4b7d-b72d-721eccf1a709",
        "parentId" : "cb44f3fd-421b-4dee-8f9b-041d11205ff2",
        "authorId" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "body" : "Today, `DeadlineExceeded` error from CRI ends up returning `probe.Unknonwn` and an error to the prober, which is ignored.",
        "createdAt" : "2020-08-21T17:05:40Z",
        "updatedAt" : "2020-11-09T18:05:18Z",
        "lastEditedBy" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "tags" : [
        ]
      }
    ],
    "commit" : "af40d18b6792cee723f1f25bd5bfd2db79de0fd7",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +393,397 @@\n\t\t// interpret DeadlineExceeded gRPC errors as timedout probes\n\t\tif status.Code(err) == codes.DeadlineExceeded {\n\t\t\terr = exec.NewTimeoutError(fmt.Errorf(\"command %q timed out\", strings.Join(cmd, \" \")), timeout)\n\t\t}"
  }
]