[
  {
    "id" : "30c812c8-4691-4a66-a686-082ea0125115",
    "prId" : 22891,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1e447aad-426c-4069-8979-63c19b46478d",
        "parentId" : null,
        "authorId" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "body" : "Hm...the r.*Version fields are written in the function and called periodically through Status(), but the fields can also be read by Version() or APIVersion() functions. Seems like a data race. \n",
        "createdAt" : "2016-03-12T02:21:29Z",
        "updatedAt" : "2016-03-15T23:35:33Z",
        "lastEditedBy" : "1bd2d65a-7c93-4c22-b408-c7794d037dc5",
        "tags" : [
        ]
      },
      {
        "id" : "9929e215-a166-4bb7-8366-c2052a7f60f8",
        "parentId" : "1e447aad-426c-4069-8979-63c19b46478d",
        "authorId" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "body" : " @yifan-gu As @yujuhong said, now `Version()` is called in goroutine https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/kubelet.go#L1022, while `Status()` is called in another goroutine https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/kubelet.go#L1025.\nThere is a data race here.\n\nIn dockertools, there is no such race now, because there is no cache - each time the version is re-fetched from docker client. https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/dockertools/manager.go#L914\n\nNo matter for docker or rkt, we should decide which approach should we take:\n1) Never cache version information, get it from runtime whenever we need it?\n2) Cache version information, update it in `Status()` or other periodically called functions, and add a lock to protect it?\n\nI prefer 1), because it is simpler, and `Version()` is only called every _10s_ and `Status()` every _5s_. :)\n",
        "createdAt" : "2016-03-13T08:00:10Z",
        "updatedAt" : "2016-03-15T23:35:33Z",
        "lastEditedBy" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "tags" : [
        ]
      },
      {
        "id" : "4395d158-7999-452c-8295-58af20b60a5b",
        "parentId" : "1e447aad-426c-4069-8979-63c19b46478d",
        "authorId" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "body" : "May be relevant to #21741.\n",
        "createdAt" : "2016-03-14T09:17:26Z",
        "updatedAt" : "2016-03-15T23:35:33Z",
        "lastEditedBy" : "4e418bc8-21fb-4523-80c1-9c751c193126",
        "tags" : [
        ]
      },
      {
        "id" : "f9cbaec5-9c46-4ea9-8764-209610eec4be",
        "parentId" : "1e447aad-426c-4069-8979-63c19b46478d",
        "authorId" : "7dd504ec-7e63-45b3-98f8-6eb1c683e9c2",
        "body" : "Yes, #21741 will add a version cache to dockertools, also, need to  cc @vishh\n",
        "createdAt" : "2016-03-14T09:20:48Z",
        "updatedAt" : "2016-03-15T23:35:33Z",
        "lastEditedBy" : "7dd504ec-7e63-45b3-98f8-6eb1c683e9c2",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe2c3c351a262d7f26104327de245b768cf90525",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +64,68 @@}\n\nfunc (r *Runtime) getVersions() error {\n\tr.versions.Lock()\n\tdefer r.versions.Unlock()"
  },
  {
    "id" : "a9ee7eb2-ccf9-4f69-9704-b163e9ad38d5",
    "prId" : 7465,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f2f9e6f4-2a54-4739-93b7-5768cdcf7bd6",
        "parentId" : null,
        "authorId" : "b7abca6a-d6be-4008-a014-3b5ca0e90529",
        "body" : "nit: You should be able to use `strings.TrimSpace`\n",
        "createdAt" : "2015-04-29T00:22:52Z",
        "updatedAt" : "2015-04-30T00:09:50Z",
        "lastEditedBy" : "b7abca6a-d6be-4008-a014-3b5ca0e90529",
        "tags" : [
        ]
      },
      {
        "id" : "5046d2be-6544-459e-9867-697bc6fa01eb",
        "parentId" : "f2f9e6f4-2a54-4739-93b7-5768cdcf7bd6",
        "authorId" : "227eb550-8b08-4420-9a78-279f840bd8de",
        "body" : "I didn't get it, I am splitting space here after trimspace\n",
        "createdAt" : "2015-04-29T06:49:56Z",
        "updatedAt" : "2015-04-30T00:09:50Z",
        "lastEditedBy" : "227eb550-8b08-4420-9a78-279f840bd8de",
        "tags" : [
        ]
      },
      {
        "id" : "d05b1f31-ee8e-41e7-a477-ac02f04c1418",
        "parentId" : "f2f9e6f4-2a54-4739-93b7-5768cdcf7bd6",
        "authorId" : "b7abca6a-d6be-4008-a014-3b5ca0e90529",
        "body" : "You're fine, I missed the split :)\n",
        "createdAt" : "2015-04-29T17:02:32Z",
        "updatedAt" : "2015-04-30T00:09:50Z",
        "lastEditedBy" : "b7abca6a-d6be-4008-a014-3b5ca0e90529",
        "tags" : [
        ]
      }
    ],
    "commit" : "305345efe1b4fe164fc61b5118c7dac51e35c0c5",
    "line" : 98,
    "diffHunk" : "@@ -1,1 +96,100 @@\t// appc version 0.3.0+git\n\tfor _, line := range output {\n\t\ttuples := strings.Split(strings.TrimSpace(line), \" \")\n\t\tif len(tuples) != 3 {\n\t\t\tglog.Warningf(\"rkt: cannot parse the output: %q.\", line)"
  }
]