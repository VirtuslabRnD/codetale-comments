[
  {
    "id" : "3a54b534-7878-403b-a128-688f56eb87a1",
    "prId" : 34246,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/34246#pullrequestreview-3157103",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0f414a5b-3a15-47bf-b88b-9aacca55f1b6",
        "parentId" : null,
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "just for edification but if you said clientv3.WithRev(0) you would get the history of a key? \n",
        "createdAt" : "2016-10-06T16:59:24Z",
        "updatedAt" : "2016-10-10T16:55:42Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "38c6c05d-9265-4baf-95b7-15eb1c0dbf39",
        "parentId" : "0f414a5b-3a15-47bf-b88b-9aacca55f1b6",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "\"0\" will returns latest state.\n",
        "createdAt" : "2016-10-06T17:01:52Z",
        "updatedAt" : "2016-10-10T16:55:42Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      }
    ],
    "commit" : "2516ab058d81e8b909bc6478668c7e173c6ee733",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +161,165 @@\t\tvar prevVal []byte\n\t\tif len(prevResp.Kvs) > 0 {\n\t\t\tprevVal = prevResp.Kvs[0].Value\n\t\t}\n\t\twc.sendEvent(parseKV(kv, prevVal))"
  },
  {
    "id" : "d8986916-3a04-49c2-acdb-b1a33c8145b1",
    "prId" : 33003,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/33003#pullrequestreview-817416",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c6a5513c-d485-48b6-bf6b-9f8703a55b4e",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "do this via defer if it should always happen. right now there's a case where it isn't called and I can't tell if that's bug or not.\n",
        "createdAt" : "2016-09-20T00:01:05Z",
        "updatedAt" : "2016-09-20T19:45:35Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "0d5f213c-a58a-4ae8-ab53-37d9b648a152",
        "parentId" : "c6a5513c-d485-48b6-bf6b-9f8703a55b4e",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "It shouldn't always happen --  it should happen only if watch chan is closed and no error message returned from watch chan.\n",
        "createdAt" : "2016-09-20T00:13:40Z",
        "updatedAt" : "2016-09-20T19:45:35Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      },
      {
        "id" : "175e2528-d5aa-4966-9594-3fc19d31e7c4",
        "parentId" : "c6a5513c-d485-48b6-bf6b-9f8703a55b4e",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "@lavalamp \nAny comment on this?\nIf not, can you remove \"requested change\"?\n",
        "createdAt" : "2016-09-20T17:37:51Z",
        "updatedAt" : "2016-09-20T19:45:35Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      },
      {
        "id" : "34dfbd33-7477-4e2a-a041-4c847334917a",
        "parentId" : "c6a5513c-d485-48b6-bf6b-9f8703a55b4e",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "It's incomprehensible to me why you'd want to only notify your caller under that condition. It seems the caller should be notified when this function exits for any reason. Please heavily comment or change. It's really confusing right now.\n",
        "createdAt" : "2016-09-20T19:01:34Z",
        "updatedAt" : "2016-09-20T19:45:35Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "8e3b40735af32019f5383aebea90712746685a5b",
    "line" : null,
    "diffHunk" : "@@ -1,1 +192,196 @@\t// If this watch chan is broken and context isn't cancelled, other goroutines will still hang.\n\t// We should notify the main thread that this goroutine has exited.\n\tclose(watchClosedCh)\n}\n"
  },
  {
    "id" : "e32ad929-fb02-4ad9-924a-33cfef5b8b80",
    "prId" : 33003,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/33003#pullrequestreview-873997",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ff8ad614-0740-489c-97b5-c871a935b77d",
        "parentId" : null,
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "does it do any harm to always close this?\n",
        "createdAt" : "2016-09-20T20:26:22Z",
        "updatedAt" : "2016-09-20T20:26:23Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "bd488643-6af9-4a05-aae9-04042c08492c",
        "parentId" : "ff8ad614-0740-489c-97b5-c871a935b77d",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "Answer is yes.\nOn error case, we are expecting to return error via the ResultChan() before closing the chan. If we always close it, we won't get same guarantee on that.\n",
        "createdAt" : "2016-09-20T20:35:15Z",
        "updatedAt" : "2016-09-20T20:35:24Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      },
      {
        "id" : "de85962c-6b2d-446a-b72f-15fe943151fb",
        "parentId" : "ff8ad614-0740-489c-97b5-c871a935b77d",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "ok, I still think this needs a lot of changes to be understandable, but I won't block this any more.\n",
        "createdAt" : "2016-09-20T21:04:27Z",
        "updatedAt" : "2016-09-20T21:04:27Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "1cd53cd3-6b2b-47d3-8e34-4605abd2fdce",
        "parentId" : "ff8ad614-0740-489c-97b5-c871a935b77d",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "+1. \n",
        "createdAt" : "2016-09-21T02:07:02Z",
        "updatedAt" : "2016-09-21T02:07:02Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      }
    ],
    "commit" : "8e3b40735af32019f5383aebea90712746685a5b",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +192,196 @@\t// If this watch chan is broken and context isn't cancelled, other goroutines will still hang.\n\t// We should notify the main thread that this goroutine has exited.\n\tclose(watchClosedCh)\n}\n"
  },
  {
    "id" : "b533d43c-e6c1-4e43-8eff-78b7158279f3",
    "prId" : 32907,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/32907#pullrequestreview-610539",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5e623351-8d88-412d-85f1-46eae4692f92",
        "parentId" : null,
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "I'm slightly confused why you would cancel the context when it already came back as canceled?\n",
        "createdAt" : "2016-09-19T18:24:37Z",
        "updatedAt" : "2016-09-19T18:24:53Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "c972a7b0-4474-439c-809b-f35ceacdbab7",
        "parentId" : "5e623351-8d88-412d-85f1-46eae4692f92",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "This is sort of last defense line -- what if we get context.Canceled but `wc.ctx` isn't canceled.\nWe want to make sure all goroutines in etcd3 watcher to stop regardlessly.\n",
        "createdAt" : "2016-09-19T18:36:02Z",
        "updatedAt" : "2016-09-19T18:36:02Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      }
    ],
    "commit" : "5a4a095e29627f13c480b8a1140bc0d628107aef",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +109,113 @@\tcase err := <-wc.errChan:\n\t\tif err == context.Canceled {\n\t\t\twc.cancel() // just in case\n\t\t\tbreak\n\t\t}"
  },
  {
    "id" : "a1b2e2ab-ca01-463d-a2fe-6ca5e340dbe8",
    "prId" : 24638,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3f70ecf-4e50-499b-bf55-2dbc89844d0c",
        "parentId" : null,
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "Why do we need grpc dependency?\nWe are still not using grpc anywhere in kubernetes.\n",
        "createdAt" : "2016-04-22T07:33:00Z",
        "updatedAt" : "2016-04-22T07:33:00Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      },
      {
        "id" : "aa0d2c99-ad26-4dda-b27e-55c494d7b529",
        "parentId" : "f3f70ecf-4e50-499b-bf55-2dbc89844d0c",
        "authorId" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "body" : "See [comment](https://github.com/kubernetes/kubernetes/pull/24638#discussion_r60678991).\n\nCurrently etcd client returns grpc error. It shouldn't though. We will fix it later by return \"context.Canceled\"\n",
        "createdAt" : "2016-04-22T07:47:50Z",
        "updatedAt" : "2016-04-22T07:47:50Z",
        "lastEditedBy" : "bb4cf218-381a-40ad-ac0c-0c2c66685cd4",
        "tags" : [
        ]
      },
      {
        "id" : "160c4ff4-4faf-4be7-abf1-67479d85c1ce",
        "parentId" : "f3f70ecf-4e50-499b-bf55-2dbc89844d0c",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "The comment explains the problem (which I understand) not why you are using grpc.\n\n> Currently etcd client returns grpc error. It shouldn't though. We will fix it later by return \"context.Canceled\"\n\nok - that makes sense.\n",
        "createdAt" : "2016-04-22T07:52:14Z",
        "updatedAt" : "2016-04-22T07:52:15Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0f4517e65f0a4c61696390ef78a45ac799d178b",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +287,291 @@\t// We should just stop all goroutines in watchChan without returning error.\n\t// TODO: etcd client should return context.Canceled instead of grpc specific error.\n\tif grpc.Code(err) == codes.Canceled || err == context.Canceled {\n\t\treturn\n\t}"
  },
  {
    "id" : "28392044-5144-4eea-9549-9db9740686cb",
    "prId" : 23694,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b7b36c16-233a-4dc3-b7a3-86b9da7832ef",
        "parentId" : null,
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "I'm wondering about this additional Get here - did you measure the performance impact of it?\n\nWith the v2 API that we are currently using, the previous version of an object was returned together with the response:\nhttps://github.com/kubernetes/kubernetes/blob/master/pkg/storage/etcd/etcd_watcher.go#L389\nwhich is way better.\n\nSo to summarize - I'm not sure if this approach is usable now, because for evet modification we are adding network operation, which is obviously relatively expensive. We definitely need some numbers of watch throughput in v2 and v3 api.\n",
        "createdAt" : "2016-04-13T06:35:21Z",
        "updatedAt" : "2016-04-18T13:42:09Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      },
      {
        "id" : "eb29a403-881a-4c24-a24c-cfae1134a59f",
        "parentId" : "b7b36c16-233a-4dc3-b7a3-86b9da7832ef",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "To clarify - this doesn't block this PR, but it may block switching to etcd v3.\n",
        "createdAt" : "2016-04-13T06:36:00Z",
        "updatedAt" : "2016-04-18T13:42:09Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      },
      {
        "id" : "37321077-fd58-4919-966b-e524a38cc208",
        "parentId" : "b7b36c16-233a-4dc3-b7a3-86b9da7832ef",
        "authorId" : "55c0e4a8-86f8-4426-a163-752ee421c57e",
        "body" : "> I'm wondering about this additional Get here - did you measure the performance impact of it?\n\nI would say do not worry about the perf right now. Let's get this working correctly first. Trust us, we are confident that we will make this faster than today's v2 storage layer together with the etcdv3 improvement and the \"optimizations\" we are going to make here in future prs.\n",
        "createdAt" : "2016-04-13T16:55:36Z",
        "updatedAt" : "2016-04-18T13:42:09Z",
        "lastEditedBy" : "55c0e4a8-86f8-4426-a163-752ee421c57e",
        "tags" : [
        ]
      },
      {
        "id" : "9b9a2133-3d50-45bb-a1fe-e3a582b04431",
        "parentId" : "b7b36c16-233a-4dc3-b7a3-86b9da7832ef",
        "authorId" : "24302707-9254-48df-89a5-cbcc349462b8",
        "body" : "@xiang90 - that's why I wrote that this is not blocking this PR. This is just something to keep in mind before switching to v3 api.\n",
        "createdAt" : "2016-04-14T10:05:58Z",
        "updatedAt" : "2016-04-18T13:42:09Z",
        "lastEditedBy" : "24302707-9254-48df-89a5-cbcc349462b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "e18b4e67be37357f46f518ead6813fa575322827",
    "line" : null,
    "diffHunk" : "@@ -1,1 +303,307 @@\t}\n\tif e.isDeleted || !e.isCreated {\n\t\tgetResp, err := client.Get(ctx, e.key, clientv3.WithRev(e.rev-1))\n\t\tif err != nil {\n\t\t\treturn nil, nil, err"
  }
]