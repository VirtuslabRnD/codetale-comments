[
  {
    "id" : "39be42da-b136-46b8-92ec-02eb5013be1a",
    "prId" : 99298,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/99298#pullrequestreview-608094944",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb0fb32d-344a-48bc-b9b0-245716047469",
        "parentId" : null,
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "I don't see this being done for any other mutable fields in this group and for other core types like Pod. Is this necessary?",
        "createdAt" : "2021-03-05T01:58:24Z",
        "updatedAt" : "2021-03-10T02:36:56Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      },
      {
        "id" : "a05547db-662e-425a-8530-739e5f67727a",
        "parentId" : "cb0fb32d-344a-48bc-b9b0-245716047469",
        "authorId" : "f64c354b-61cb-4b89-b58f-f464e7ad4f94",
        "body" : "this is mentioned by the removed comment above. honestly i am not sure if this is necessary. there are kinds using `Generation` e.g. `networking/ingressclass/strategy.go`",
        "createdAt" : "2021-03-05T02:30:40Z",
        "updatedAt" : "2021-03-10T02:36:56Z",
        "lastEditedBy" : "f64c354b-61cb-4b89-b58f-f464e7ad4f94",
        "tags" : [
        ]
      },
      {
        "id" : "1bc656fe-282d-48e5-b951-7654918e246d",
        "parentId" : "cb0fb32d-344a-48bc-b9b0-245716047469",
        "authorId" : "f64c354b-61cb-4b89-b58f-f464e7ad4f94",
        "body" : "it seems an informational field and as long as it is not decrementing, then it is fine. i.e. unset or increment. \r\n\r\n@liggitt do you have more to add about how this field is used?",
        "createdAt" : "2021-03-05T18:01:38Z",
        "updatedAt" : "2021-03-10T02:36:56Z",
        "lastEditedBy" : "f64c354b-61cb-4b89-b58f-f464e7ad4f94",
        "tags" : [
        ]
      },
      {
        "id" : "9d12c11d-9546-4ab3-8060-0412e790ff02",
        "parentId" : "cb0fb32d-344a-48bc-b9b0-245716047469",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "Incrementing generation is typically done for spec changes on objects which are reconciled by controllers and have a `status.observedGeneration` field, but it's fine to do this here as well.",
        "createdAt" : "2021-03-09T21:40:19Z",
        "updatedAt" : "2021-03-10T02:36:56Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ad1c71174e16b798525b8dd913451f1847e6a1b",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +107,111 @@\t// Any changes to the mutable fields increment the generation number.\n\tif !apiequality.Semantic.DeepEqual(oldCSIDriver.Spec.TokenRequests, newCSIDriver.Spec.TokenRequests) || !apiequality.Semantic.DeepEqual(oldCSIDriver.Spec.RequiresRepublish, newCSIDriver.Spec.RequiresRepublish) {\n\t\tnewCSIDriver.Generation = oldCSIDriver.Generation + 1\n\t}\n}"
  },
  {
    "id" : "fa599f2a-5c71-4a5b-95ea-0e6707492c8a",
    "prId" : 99298,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/99298#pullrequestreview-608094944",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b46d55fd-8b6f-4299-8ef1-c51cd4db0971",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "good catch",
        "createdAt" : "2021-03-09T21:40:39Z",
        "updatedAt" : "2021-03-10T02:36:56Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ad1c71174e16b798525b8dd913451f1847e6a1b",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +66,70 @@\tcsiDriver := obj.(*storage.CSIDriver)\n\n\treturn validation.ValidateCSIDriver(csiDriver)\n}\n"
  },
  {
    "id" : "0e62adbe-1dc7-4529-a91b-83ac61450418",
    "prId" : 80568,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/80568#pullrequestreview-271463607",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2dd3dcfe-4c73-47f4-8acc-2f7c70e458e6",
        "parentId" : null,
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "Also update the unit tests for these changes",
        "createdAt" : "2019-08-05T20:26:53Z",
        "updatedAt" : "2019-08-22T06:59:14Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      },
      {
        "id" : "82482851-517a-4ad7-9f07-ad3d5bf01ffd",
        "parentId" : "2dd3dcfe-4c73-47f4-8acc-2f7c70e458e6",
        "authorId" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "body" : "Done.\r\n",
        "createdAt" : "2019-08-06T16:22:14Z",
        "updatedAt" : "2019-08-22T06:59:14Z",
        "lastEditedBy" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "tags" : [
        ]
      }
    ],
    "commit" : "8270fe81e4916b599c8a9a83552a5381b434dd7f",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +46,50 @@// PrepareForCreate clears the VolumeLifecycleModes field if the corresponding feature is disabled.\nfunc (csiDriverStrategy) PrepareForCreate(ctx context.Context, obj runtime.Object) {\n\tif !utilfeature.DefaultFeatureGate.Enabled(features.CSIInlineVolume) {\n\t\tcsiDriver := obj.(*storage.CSIDriver)\n\t\tcsiDriver.Spec.VolumeLifecycleModes = nil"
  },
  {
    "id" : "2c664b4b-92c2-45a3-89a4-9e601ef9eb17",
    "prId" : 73883,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73883#pullrequestreview-203770121",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ceeacaae-054a-4636-9b6e-fa3e215d04ce",
        "parentId" : null,
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "This should clear the status field, similar to how it's done [here](https://sourcegraph.com/github.com/kubernetes/kubernetes/-/blob/pkg/registry/storage/volumeattachment/strategy.go#L49)",
        "createdAt" : "2019-02-14T00:12:56Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      },
      {
        "id" : "b8e3ec12-005e-4063-92c3-597b3417ee82",
        "parentId" : "ceeacaae-054a-4636-9b6e-fa3e215d04ce",
        "authorId" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "body" : "I have a similar question for PrepareForUpdate here: \r\nhttps://github.com/kubernetes/kubernetes/pull/73883#discussion_r256851068",
        "createdAt" : "2019-02-14T14:27:53Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "tags" : [
        ]
      }
    ],
    "commit" : "743d3a26e9767340110578f30bc774660b03396c",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +44,48 @@// ResetBeforeCreate clears the Status field which is not allowed to be set by end users on creation.\nfunc (csiDriverStrategy) PrepareForCreate(ctx context.Context, obj runtime.Object) {\n}\n\nfunc (csiDriverStrategy) Validate(ctx context.Context, obj runtime.Object) field.ErrorList {"
  },
  {
    "id" : "aabe4794-5eb4-423b-87c5-64604b4af771",
    "prId" : 73883,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73883#pullrequestreview-204367019",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dc405acb-52d5-4f7c-a075-d5429918a1ea",
        "parentId" : null,
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "similar process here, we should not allow status to be changed when csi driver is updated: https://sourcegraph.com/github.com/kubernetes/kubernetes/-/blob/pkg/registry/storage/volumeattachment/strategy.go#L95",
        "createdAt" : "2019-02-14T00:16:19Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      },
      {
        "id" : "71083185-e0b0-4b04-8cf6-a5f9e46d4ff6",
        "parentId" : "dc405acb-52d5-4f7c-a075-d5429918a1ea",
        "authorId" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "body" : "I saw this comment \"// allow modification of Status via main resource for v1beta1\" here:  https://sourcegraph.com/github.com/kubernetes/kubernetes/-/blob/pkg/registry/storage/volumeattachment/strategy.go#L103.\r\n\r\nI also saw this method was empty when VolumeAttachment was added as Alpha API:\r\nhttps://github.com/kubernetes/kubernetes/commit/d96c105d71e15865953244982cfded6035fa3d4d#diff-8f59387445704051522bce694da81806R61\r\nfunc (volumeAttachmentStrategy) PrepareForUpdate(ctx genericapirequest.Context, obj, old runtime.Object) {\r\n}\r\n\r\nSo I thought that means status can be changed before v1?\r\n\r\n\r\n",
        "createdAt" : "2019-02-14T14:19:23Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "tags" : [
        ]
      },
      {
        "id" : "29537d85-99c4-4212-af96-4a835f0716e1",
        "parentId" : "dc405acb-52d5-4f7c-a075-d5429918a1ea",
        "authorId" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "body" : "Also CSIDriver does not have a status field.  Only CSINodeInfo has a status field.",
        "createdAt" : "2019-02-14T15:16:22Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "tags" : [
        ]
      },
      {
        "id" : "09c2d2c1-cdec-4f43-9eec-d4b7b2adcc06",
        "parentId" : "dc405acb-52d5-4f7c-a075-d5429918a1ea",
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "For VolumeAttachment, Status should have always been a subresource, but it was an oversight that was caught while we were moving it to v1.",
        "createdAt" : "2019-02-14T16:29:30Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      },
      {
        "id" : "68008656-03fc-4d12-be16-8f247a33f400",
        "parentId" : "dc405acb-52d5-4f7c-a075-d5429918a1ea",
        "authorId" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "body" : "Addressed comments in CSINodeInfo strategy.  I didn't add status validation in CSIDriver because it does not have a status field.",
        "createdAt" : "2019-02-15T18:02:27Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "tags" : [
        ]
      }
    ],
    "commit" : "743d3a26e9767340110578f30bc774660b03396c",
    "line" : 66,
    "diffHunk" : "@@ -1,1 +64,68 @@\n// PrepareForUpdate sets the Status fields which is not allowed to be set by an end user updating a CSIDriver\nfunc (csiDriverStrategy) PrepareForUpdate(ctx context.Context, obj, old runtime.Object) {\n}\n"
  },
  {
    "id" : "6cd7cf53-ff9d-4d53-970e-6ebb660e6eaa",
    "prId" : 73883,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/73883#pullrequestreview-204365313",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "011b1a90-64ec-4183-b70b-16acd75599aa",
        "parentId" : null,
        "authorId" : "542e5d2f-2ff9-4674-ab44-78f31768e7a1",
        "body" : "not sure if this is just a common pattern i'm not familiar with but it feels weird to me to validate the old object separately, then do a \"update validation\" (which validates the new driver inside it).\r\n\r\nCan `ValidateCSIDriverUpdate` just validate both old and new? Or neither, and leave the single object validation to the caller?\r\n\r\nAgain, not sure if this is an established pattern, feel free to correct me.",
        "createdAt" : "2019-02-14T22:42:47Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "542e5d2f-2ff9-4674-ab44-78f31768e7a1",
        "tags" : [
        ]
      },
      {
        "id" : "cb21e393-d250-4f60-a127-58458ad791dd",
        "parentId" : "011b1a90-64ec-4183-b70b-16acd75599aa",
        "authorId" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "body" : "I'm also not familiar with this.  I followed this for VolumeAttachment: https://sourcegraph.com/github.com/kubernetes/kubernetes/-/blob/pkg/registry/storage/volumeattachment/strategy.go#L116\r\n\r\nI guess it first makes sure the newObj is okay, then validates update works.",
        "createdAt" : "2019-02-15T17:55:38Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "275dd783-53c3-4fed-8434-96ed6a2e0331",
        "tags" : [
        ]
      },
      {
        "id" : "5c4dd83f-633f-45f9-9599-3e120c0d4fc7",
        "parentId" : "011b1a90-64ec-4183-b70b-16acd75599aa",
        "authorId" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "body" : "There's usually two steps when validating an update:\r\n1. Check that the updated (new) object passes regular object validation\r\n2. Check that changes between old and new are allowed",
        "createdAt" : "2019-02-15T17:58:03Z",
        "updatedAt" : "2019-03-02T20:31:47Z",
        "lastEditedBy" : "209ee091-cf29-4efa-8a1b-a98334ea3f9a",
        "tags" : [
        ]
      }
    ],
    "commit" : "743d3a26e9767340110578f30bc774660b03396c",
    "line" : 73,
    "diffHunk" : "@@ -1,1 +71,75 @@\toldCSIDriverObj := old.(*storage.CSIDriver)\n\terrorList := validation.ValidateCSIDriver(newCSIDriverObj)\n\treturn append(errorList, validation.ValidateCSIDriverUpdate(newCSIDriverObj, oldCSIDriverObj)...)\n}\n"
  }
]