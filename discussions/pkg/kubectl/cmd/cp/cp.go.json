[
  {
    "id" : "9d70deb2-8b27-4de0-bfcd-f9817849057c",
    "prId" : 82143,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82143#pullrequestreview-281768166",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f4026eef-a845-4da2-bad1-356b4d78fea8",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "give a sample invocation",
        "createdAt" : "2019-08-29T23:21:08Z",
        "updatedAt" : "2019-09-03T08:44:53Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      }
    ],
    "commit" : "786acdb66878121064c289764ea2bb19fb5d48ae",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +48,52 @@\t\t#\n\t\t# For advanced use cases, such as symlinks, wildcard expansion or\n\t\t# file mode preservation consider using 'kubectl exec'.\n\n\t\t# Copy /tmp/foo local file to /tmp/bar in a remote pod in namespace <some-namespace>"
  },
  {
    "id" : "7266fa2e-2c72-43f9-8275-9bfee81170be",
    "prId" : 82143,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/82143#pullrequestreview-283100973",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a03cf831-2aa8-404a-bf42-651e05e19030",
        "parentId" : null,
        "authorId" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "body" : "nit: I would make this error message more consistent with the other one, so they can be visually scanned together\r\n```suggestion\r\n\t\t\t\tfmt.Fprintf(o.IOStreams.ErrOut, \"warning: skipping symlink: %q -> %q (consider using \\\"%s exec -n %q %q -- tar cf - %q | tar xf -\\\")\\n\", destFileName, o.ExecParentCmdName, src.PodNamespace, src.PodName, src.File)\r\n```",
        "createdAt" : "2019-09-03T16:00:50Z",
        "updatedAt" : "2019-09-03T16:00:50Z",
        "lastEditedBy" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "tags" : [
        ]
      }
    ],
    "commit" : "786acdb66878121064c289764ea2bb19fb5d48ae",
    "line" : 68,
    "diffHunk" : "@@ -1,1 +471,475 @@\t\tif mode&os.ModeSymlink != 0 {\n\t\t\tif !symlinkWarningPrinted && len(o.ExecParentCmdName) > 0 {\n\t\t\t\tfmt.Fprintf(o.IOStreams.ErrOut, \"warning: file %q is a symlink, skipping (consider using \\\"%s exec -n %q %q -- tar cf - %q | tar xf -\\\")\\n\", destFileName, o.ExecParentCmdName, src.PodNamespace, src.PodName, src.File)\n\t\t\t\tsymlinkWarningPrinted = true\n\t\t\t\tcontinue"
  },
  {
    "id" : "ed4f19bb-8b6f-4fc5-af20-1a5888cf728c",
    "prId" : 76788,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/76788#pullrequestreview-229766940",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6ec1d502-4b1e-4f79-a068-9d70a1b39212",
        "parentId" : null,
        "authorId" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "body" : "What happens here if the destination file is a directory? Can this get confused if the path ends in a `/`?",
        "createdAt" : "2019-04-18T22:57:52Z",
        "updatedAt" : "2019-04-26T20:20:14Z",
        "lastEditedBy" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "tags" : [
        ]
      },
      {
        "id" : "d12961b9-c6d1-46f8-b218-60625f68251d",
        "parentId" : "6ec1d502-4b1e-4f79-a068-9d70a1b39212",
        "authorId" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "body" : "Based on https://golang.org/pkg/path/filepath/#Split it should be solid. ",
        "createdAt" : "2019-04-19T21:09:08Z",
        "updatedAt" : "2019-04-26T20:20:14Z",
        "lastEditedBy" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "tags" : [
        ]
      },
      {
        "id" : "8d965ead-a468-4cb7-9d63-aa878694708a",
        "parentId" : "6ec1d502-4b1e-4f79-a068-9d70a1b39212",
        "authorId" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "body" : "Looking at the [implementation](https://golang.org/src/path/filepath/path.go?s=5432:5474#L185), it seems like the destination file would be included in the directory if the path end sin a slash, and the file would be \"\" I think.\r\n\r\nI think it's fine, but might be worth adding a test case?",
        "createdAt" : "2019-04-19T21:36:32Z",
        "updatedAt" : "2019-04-26T20:20:14Z",
        "lastEditedBy" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "tags" : [
        ]
      },
      {
        "id" : "bda5cbd9-123e-4bcf-a8dd-20dabc3a7ef4",
        "parentId" : "6ec1d502-4b1e-4f79-a068-9d70a1b39212",
        "authorId" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "body" : "I've added directory test, but that's actually handled a few lines earlier in \r\n```\r\ndestFileName := path.Join(destDir, header.Name[len(prefix):])\r\n```\r\n`destFileName` will get cleaned (`path.Join` calls `Clean` internally) even if it ends with `/`. ",
        "createdAt" : "2019-04-23T20:03:52Z",
        "updatedAt" : "2019-04-26T20:20:14Z",
        "lastEditedBy" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "tags" : [
        ]
      }
    ],
    "commit" : "7962231a8074eca544701b875cb52dcc4429903c",
    "line" : 59,
    "diffHunk" : "@@ -1,1 +459,463 @@\t\t// of the destination directory. This prevents any kind of path traversal\n\t\t// from within tar archive.\n\t\tdir, file := filepath.Split(destFileName)\n\t\tevaledPath, err := filepath.EvalSymlinks(dir)\n\t\tif err != nil {"
  },
  {
    "id" : "d0a3179c-e912-4082-8d29-ae925f454048",
    "prId" : 76788,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/76788#pullrequestreview-253694768",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "75e68286-a85d-48d3-b3fd-62ffcd4bb7a2",
        "parentId" : null,
        "authorId" : "2a0af86e-aa24-4092-b8fc-bcef3e8aa577",
        "body" : "I haven't had enough time to go through everything to understand the intention here, but I think the symlink checking is probably more aggressive than it should be.  Picking up this change breaks existing scripts that copy files to temp directories on Mac.\r\n\r\nPlease be aware that Mac's default `readlink` doesn't support canonicalizing a path, so it's not as easy to portably fix on the user's side as you might think (see: [stackoverflow](https://stackoverflow.com/questions/1055671/how-can-i-get-the-behavior-of-gnus-readlink-f-on-a-mac)).\r\n\r\n```\r\n$ FILE=path/to/file\r\n$ TMPD=$(mktemp -d)\r\n$ kubectl cp --no-preserve \"$NAMESPACE/$POD:$FILE\" \"$TMPD/$FILE\" -c $CONTAINER\r\nwarning: link \"/var/folders/h7/ydd9wql57gdf6883cj9779sm0zsnn7/T/tmp.3TVUBz8Mqe/path/to/file\" is pointing to \"\" which is outside target destination, skipping\r\n\r\n$ echo $TMPD\r\n/var/folders/h7/ydd9wql57gdf6883cj9779sm0zsnn7/T/tmp.3TVUBz8Mqe\r\n$ readlink -f $TMPD  # using GNU readlink\r\n/private/var/folders/h7/ydd9wql57gdf6883cj9779sm0zsnn7/T/tmp.3TVUBz8Mqe\r\n```",
        "createdAt" : "2019-06-24T22:42:49Z",
        "updatedAt" : "2019-06-24T22:44:06Z",
        "lastEditedBy" : "2a0af86e-aa24-4092-b8fc-bcef3e8aa577",
        "tags" : [
        ]
      }
    ],
    "commit" : "7962231a8074eca544701b875cb52dcc4429903c",
    "line" : 66,
    "diffHunk" : "@@ -1,1 +466,470 @@\t\t// For scrutiny we verify both the actual destination as well as we follow\n\t\t// all the links that might lead outside of the destination directory.\n\t\tif !isDestRelative(destDir, destFileName) || !isDestRelative(destDir, filepath.Join(evaledPath, file)) {\n\t\t\tfmt.Fprintf(o.IOStreams.ErrOut, \"warning: link %q is pointing to %q which is outside target destination, skipping\\n\", destFileName, header.Linkname)\n\t\t\tcontinue"
  },
  {
    "id" : "73ef34b2-f092-47e5-8c41-332ddea70b7b",
    "prId" : 75037,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75037#pullrequestreview-211362867",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4d48e1d9-02e0-48ab-9c61-f63be5250af9",
        "parentId" : null,
        "authorId" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "body" : "nit: \r\n```suggestion\r\n\t\t\t// verify if relative path is the same after removing backticks\r\n```",
        "createdAt" : "2019-03-06T17:16:59Z",
        "updatedAt" : "2019-03-06T17:17:07Z",
        "lastEditedBy" : "9f030d50-62db-4b00-a28c-847709b74d97",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee7edb77659902afbe2f7b872159cf9f952a8e23",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +467,471 @@\t\t\t// error is returned if linkname can't be made relative to destFile,\n\t\t\t// but relative can end up being ../dir that's why we also need to\n\t\t\t// verify if relative path is the same after Clean-ing\n\t\t\trelative, err := filepath.Rel(destFile, linkname)\n\t\t\tif path.IsAbs(linkname) && (err != nil || relative != stripPathShortcuts(relative)) {"
  },
  {
    "id" : "7edcd989-b224-49f1-8112-720005561177",
    "prId" : 75037,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/75037#pullrequestreview-211513894",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1d70776a-cc97-40b5-a98e-9288e8a086f8",
        "parentId" : null,
        "authorId" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "body" : "Should this check be separated into a util class so that other calls to os.Symlink() can utilize ?",
        "createdAt" : "2019-03-06T22:38:16Z",
        "updatedAt" : "2019-03-06T22:38:16Z",
        "lastEditedBy" : "42b1e004-4fa7-4e43-84cf-5378839b49ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee7edb77659902afbe2f7b872159cf9f952a8e23",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +469,473 @@\t\t\t// verify if relative path is the same after Clean-ing\n\t\t\trelative, err := filepath.Rel(destFile, linkname)\n\t\t\tif path.IsAbs(linkname) && (err != nil || relative != stripPathShortcuts(relative)) {\n\t\t\t\tfmt.Fprintf(o.IOStreams.ErrOut, \"warning: link %q is pointing to %q which is outside target destination, skipping\\n\", outFileName, header.Linkname)\n\t\t\t\tcontinue"
  },
  {
    "id" : "c02cc51e-2ac6-4f95-91a3-6adc48e95e29",
    "prId" : 69464,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/69464#pullrequestreview-162188597",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "57b64e5b-b55f-4e0c-91b4-e5cb9a266973",
        "parentId" : null,
        "authorId" : "d995a87c-4064-4495-9753-d0cf8a45072f",
        "body" : "Ditton on depending on other commands.",
        "createdAt" : "2018-10-05T20:19:32Z",
        "updatedAt" : "2018-10-06T17:01:28Z",
        "lastEditedBy" : "d995a87c-4064-4495-9753-d0cf8a45072f",
        "tags" : [
        ]
      }
    ],
    "commit" : "add731dff18b63ffdb40dd89342efe9e2c6f9ebb",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +31,35 @@\t\"k8s.io/client-go/kubernetes\"\n\trestclient \"k8s.io/client-go/rest\"\n\t\"k8s.io/kubernetes/pkg/kubectl/cmd/exec\"\n\t\"k8s.io/kubernetes/pkg/kubectl/cmd/templates\"\n\tcmdutil \"k8s.io/kubernetes/pkg/kubectl/cmd/util\""
  }
]