[
  {
    "id" : "126dbbd8-c772-459d-a00c-9f0a748a66ee",
    "prId" : 96317,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96317#pullrequestreview-530350828",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "what is the impact of this int -> float issue here?",
        "createdAt" : "2020-11-13T16:00:08Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "4af45fde-25c1-4e80-9ebf-18585e80bf2b",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "3f579bf7-089d-41f0-abf9-3bf5462ec695",
        "body" : "/cc @apelisse ",
        "createdAt" : "2020-11-13T16:22:12Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "3f579bf7-089d-41f0-abf9-3bf5462ec695",
        "tags" : [
        ]
      },
      {
        "id" : "a2e72e8e-f724-4add-bbf7-a0138d7e09f6",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "None.\r\n\r\n* Round tripping here is only done for the test.\r\n* CRD defaults are not problematic because they don't go through the generated default code.\r\n* `// +default=` directives are not problematic because there is only a single one in 1.20 and we know it's fine.\r\n* Before we open the floodgates to let people set more defaults, @Jefftree will update the default generation code to perform a typecheck and barf if the author is trying to stuff an int into a float in a way that loses precision, along with all other problems that can be caught by a typecheck. But this doesn't matter for 1.20, since we won't be adding more of these in 1.20.\r\n",
        "createdAt" : "2020-11-13T18:46:34Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "237d11df-e634-439f-aaeb-6240db38769b",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "> * `// +default=` directives are not problematic because there is only a single one in 1.20 and we know it's fine.\r\n\r\nA single one in-tree... but don't we have to handle data coming from aggregated servers as well that could start generating default-containing openapi?\r\n\r\nThis test was added to detect things that would make the merging controller falsely detect differences and churn re-merging \"updated\" specs - https://github.com/kubernetes/kubernetes/pull/71223#discussion_r254046361\r\n\r\nI wanted to make sure we're not reintroducing that possibility. I still can't tell if we are.",
        "createdAt" : "2020-11-13T19:14:20Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "e7923eb5-d49a-4b6e-84bd-0a110fa645c1",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "> This test was added to detect things that would make the merging controller falsely detect differences and churn re-merging \"updated\" specs \r\n\r\nThe merging controller strips the default like this test does. Isn't it testing the right thing then?",
        "createdAt" : "2020-11-13T19:16:36Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      },
      {
        "id" : "9ca223dd-ef9c-41a2-8ab2-939493c823bb",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "> but don't we have to handle data coming from aggregated servers as well that could start generating default-containing openapi?\r\n\r\nThey wouldn't publish these.",
        "createdAt" : "2020-11-13T19:22:24Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      },
      {
        "id" : "2549d04d-0830-4682-8377-472385d59b77",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "> don't we have to handle data coming from aggregated servers as well that could start generating default-containing openapi?\r\n\r\nNo. They're on their own for running SSA, and we strip defaults before publishing.",
        "createdAt" : "2020-11-13T19:26:35Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      },
      {
        "id" : "d78f492d-f290-4359-99d2-3baa2a999217",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "> The merging controller strips the default like this test does. Isn't it testing the right thing then?\r\n\r\nIf that changes, will we remember to change here in the same way? Should we use a \"prepare for publishing\" func consistently between the two? I just want to make sure this test will continue catching the problems that prompted its addition.",
        "createdAt" : "2020-11-13T19:31:34Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "8624749d-5f5f-40fa-a67b-42f33ec89a38",
        "parentId" : "25c832f0-a4d8-4f61-84e2-f20d832fb1a1",
        "authorId" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "body" : "We do want to fix this ASAP, and we absolutely want to fix it before we consider publishing the defaults.",
        "createdAt" : "2020-11-13T19:35:03Z",
        "updatedAt" : "2020-11-14T01:27:55Z",
        "lastEditedBy" : "a139439a-9f9e-4518-b4f3-9c602d956c57",
        "tags" : [
        ]
      }
    ],
    "commit" : "50e7aa49aa8f05c12ee72da92d1dc61900f86cac",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +32,36 @@\tfor name, value := range GetOpenAPIDefinitions(dummyRef) {\n\t\tt.Run(name, func(t *testing.T) {\n\t\t\t// TODO(kubernetes/gengo#193): We currently round-trip ints to floats.\n\t\t\tvalue.Schema = *handler.PruneDefaultsSchema(&value.Schema)\n\t\t\tdata, err := json.Marshal(value.Schema)"
  }
]