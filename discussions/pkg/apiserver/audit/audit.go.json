[
  {
    "id" : "16deadae-0421-4a1a-becb-4c52bd098ed8",
    "prId" : 27087,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3bacc01c-d570-468b-b046-c8c25b870936",
        "parentId" : null,
        "authorId" : "97269ff6-3eb2-4912-9dee-4e86f1f480da",
        "body" : "should this be `user.GetName()` instead of `<self>`.\n",
        "createdAt" : "2016-06-29T23:54:02Z",
        "updatedAt" : "2016-08-12T10:27:29Z",
        "lastEditedBy" : "97269ff6-3eb2-4912-9dee-4e86f1f480da",
        "tags" : [
        ]
      },
      {
        "id" : "dc34e33e-61b9-46cb-bf49-7e9e6e164173",
        "parentId" : "3bacc01c-d570-468b-b046-c8c25b870936",
        "authorId" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "body" : "imho, `<self>` is easier to grep than having double value for the username.\n",
        "createdAt" : "2016-06-30T14:27:06Z",
        "updatedAt" : "2016-08-12T10:27:29Z",
        "lastEditedBy" : "b7d2a698-a6e1-4031-bb69-8b45505badb5",
        "tags" : [
        ]
      },
      {
        "id" : "595ce001-952c-498d-a83c-cf060430505b",
        "parentId" : "3bacc01c-d570-468b-b046-c8c25b870936",
        "authorId" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "body" : "I think the usual use-case for grepping is by `as=xyz`, not by `user=xyz as=<self>`. I prefer less magic and double value in the log.\n",
        "createdAt" : "2016-07-14T08:27:38Z",
        "updatedAt" : "2016-08-12T10:27:29Z",
        "lastEditedBy" : "f0985d19-4073-49b4-832a-0b89b15a1431",
        "tags" : [
        ]
      },
      {
        "id" : "510e13f2-c813-4310-b1a8-fb3b7c418575",
        "parentId" : "3bacc01c-d570-468b-b046-c8c25b870936",
        "authorId" : "b86e7e78-bb07-417f-8470-39407559c779",
        "body" : "That seems like a solid argument. +1\n\nOn Thu, Jul 14, 2016 at 1:27 AM, Dr. Stefan Schimanski <\nnotifications@github.com> wrote:\n\n> In pkg/apiserver/audit/audit.go\n> https://github.com/kubernetes/kubernetes/pull/27087#discussion_r70767483\n> :\n> \n> > +// 1. the request line containing:\n> > +//    - unique id allowing to match the response line (see 2)\n> > +//    - source ip of the request\n> > +//    - HTTP method being invoked\n> > +//    - original user invoking the operation\n> > +//    - impersonated user for the operation\n> > +//    - namespace of the request or <none>\n> > +//    - uri is the full URI as requested\n> > +// 2. the response line containing the unique id from 1 and response code\n> > +func WithAudit(handler http.Handler, requestContextMapper api.RequestContextMapper) http.Handler {\n> > -   return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n> > -       ctx, _ := requestContextMapper.Get(req)\n> > -       user, _ := api.UserFrom(ctx)\n> > -       asuser := req.Header.Get(\"Impersonate-User\")\n> > -       if len(asuser) == 0 {\n> > -           asuser = \"<self>\"\n> \n> I think the usual use-case for grepping is by as=xyz, not by user=xyz\n> as=<self>. I prefer less magic and double value in the log.\n> \n> â€”\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/27087/files/752c551c39be25f16e03d37bec8a3c2567467370#r70767483,\n> or mute the thread\n> https://github.com/notifications/unsubscribe/AAnglsLx0miG4g8PL__wAlulXsyYN9Xgks5qVfMDgaJpZM4Ixcs-\n> .\n",
        "createdAt" : "2016-07-14T17:49:47Z",
        "updatedAt" : "2016-08-12T10:27:29Z",
        "lastEditedBy" : "b86e7e78-bb07-417f-8470-39407559c779",
        "tags" : [
        ]
      }
    ],
    "commit" : "24f1e1eaf636ae24be7a0edbc2667f94f23433e5",
    "line" : 88,
    "diffHunk" : "@@ -1,1 +86,90 @@\t\tasuser := req.Header.Get(\"Impersonate-User\")\n\t\tif len(asuser) == 0 {\n\t\t\tasuser = \"<self>\"\n\t\t}\n\t\tnamespace := api.NamespaceValue(ctx)"
  }
]