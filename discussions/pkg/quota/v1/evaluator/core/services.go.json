[
  {
    "id" : "11c22063-5b53-42cd-b623-7b9d27704859",
    "prId" : 97451,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/97451#pullrequestreview-562788117",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "parentId" : null,
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "do we also need to count usage by HealthCheckNodePort?",
        "createdAt" : "2021-01-06T14:00:03Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "71e13473-f012-4ed0-9be6-17c9ba7435af",
        "parentId" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "authorId" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "body" : "I'm not counting this yet. \r\nShould add 1 when `type is set to LoadBalancer and externalTrafficPolicy is set to Local`",
        "createdAt" : "2021-01-06T14:18:16Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "tags" : [
        ]
      },
      {
        "id" : "cd18758b-4f1c-401b-bc1f-7fffede9e7ab",
        "parentId" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "IMHO `HealthCheckNodePort` != `NodePort` , and as a user it may be confusing to have to consider them the same for quotas, but let's ask @thockin for his opinion",
        "createdAt" : "2021-01-06T14:36:00Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      },
      {
        "id" : "6a21b9b3-6c83-45cc-9ddd-f5d095a3ce7d",
        "parentId" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "authorId" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "body" : "It seems that HealthCheckNodePort is not taken into account in previous implementations. I'm not sure if we should count like below. \r\n```\r\ndiff --git a/pkg/quota/v1/evaluator/core/services.go b/pkg/quota/v1/evaluator/core/services.go\r\nindex ae5504a6eca..45b07526b59 100644\r\n--- a/pkg/quota/v1/evaluator/core/services.go\r\n+++ b/pkg/quota/v1/evaluator/core/services.go\r\nfunc portsWithNodePorts(svc *corev1.Service) *resource.Quantity {\r\n\tcount := 0\r\n+\tif svc.Spec.externalTrafficPolicy == api.ServiceExternalTrafficPolicyTypeLocal {\r\n+\t\tcount++\r\n+\t}\r\n\tfor _, p := range svc.Spec.Ports {\r\n\t\tif p.NodePort != 0 {\r\n\t\t\tcount++\r\n\t\t}\r\n\t}\r\n\treturn resource.NewQuantity(int64(count), resource.DecimalSI)\r\n}\r\n\r\n```",
        "createdAt" : "2021-01-06T14:39:09Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "tags" : [
        ]
      },
      {
        "id" : "bfcd46a7-9b22-44af-a3e4-571e60d263b6",
        "parentId" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "authorId" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "body" : "We probably want to backport this fix (at least the zero-value portion of it). Let's get this in as-is, then follow-up with including the health check node port in quota in a separate PR",
        "createdAt" : "2021-01-06T14:45:34Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "8be927c4-cfb4-4077-b355-f4f3d84849b8",
        "tags" : [
        ]
      },
      {
        "id" : "31ba1ebf-34be-4147-8919-a8b2258bcf11",
        "parentId" : "0fdbc53a-8fa6-442c-8ee6-ea495edcd7b3",
        "authorId" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "body" : "OK, I will test HealthCheckNodePort behavior tomorrow. Nice catch.",
        "createdAt" : "2021-01-06T15:14:18Z",
        "updatedAt" : "2021-01-06T23:16:11Z",
        "lastEditedBy" : "5e225159-999d-430a-8b58-d5220dc1429d",
        "tags" : [
        ]
      }
    ],
    "commit" : "15867d9e8a1faf007f6df563c26a9b5e8744b2a1",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +130,134 @@\t\tvalue := resource.NewQuantity(int64(ports), resource.DecimalSI)\n\t\tresult[corev1.ResourceServicesNodePorts] = *value\n\tcase corev1.ServiceTypeLoadBalancer:\n\t\t// load balancer services need to count node ports. If creation of node ports\n\t\t// is suppressed only ports with explicit NodePort values are counted."
  },
  {
    "id" : "24920ddf-5f37-4fa8-b19a-ca3d803be559",
    "prId" : 67870,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/67870#pullrequestreview-153074279",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6d52448e-89fe-4609-b095-35b6b8b8b622",
        "parentId" : null,
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "This I did not expect.  @derekwaynecarr Does this break evaluation when received via admission?\r\n\r\nActually, are we sure this works for both the admission side and the reconciliation side today?",
        "createdAt" : "2018-08-29T13:36:02Z",
        "updatedAt" : "2018-08-29T13:36:03Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      },
      {
        "id" : "d8da116c-6ae4-4690-988e-67a1dd0565f4",
        "parentId" : "6d52448e-89fe-4609-b095-35b6b8b8b622",
        "authorId" : "6eca0ade-9879-4dd7-ad14-547e16f5c041",
        "body" : "isnt this pr changing both admission and reconciliation side to always use external?",
        "createdAt" : "2018-09-06T18:52:49Z",
        "updatedAt" : "2018-09-06T18:52:49Z",
        "lastEditedBy" : "6eca0ade-9879-4dd7-ad14-547e16f5c041",
        "tags" : [
        ]
      },
      {
        "id" : "9b11efcf-33eb-4243-9c3f-7d3e08de413e",
        "parentId" : "6d52448e-89fe-4609-b095-35b6b8b8b622",
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "> isnt this pr changing both admission and reconciliation side to always use external?\r\n\r\n@derekwaynecarr yeah. See the switch of the helper function to external as well.",
        "createdAt" : "2018-09-06T18:56:36Z",
        "updatedAt" : "2018-09-06T18:56:36Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae628c548843de9973d3bdcda1dcce23eb35cc8f",
    "line" : 152,
    "diffHunk" : "@@ -1,1 +145,149 @@\n//GetQuotaServiceType returns ServiceType if the service type is eligible to track against a quota, nor return \"\"\nfunc GetQuotaServiceType(service *corev1.Service) corev1.ServiceType {\n\tswitch service.Spec.Type {\n\tcase corev1.ServiceTypeNodePort:"
  },
  {
    "id" : "a95f8ef0-eeaf-4375-8d5f-b746e29edf92",
    "prId" : 67870,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/67870#pullrequestreview-150563451",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c85d3ac4-0a8f-47e0-b2b1-66754ff383f0",
        "parentId" : null,
        "authorId" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "body" : "Ah, it's this function that does the magic.  ",
        "createdAt" : "2018-08-29T13:36:28Z",
        "updatedAt" : "2018-08-29T13:36:28Z",
        "lastEditedBy" : "fa477146-9a47-4754-b38c-de8062e65e13",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae628c548843de9973d3bdcda1dcce23eb35cc8f",
    "line" : 91,
    "diffHunk" : "@@ -1,1 +95,99 @@\n// convert the input object to an internal service object or error.\nfunc toExternalServiceOrError(obj runtime.Object) (*corev1.Service, error) {\n\tsvc := &corev1.Service{}\n\tswitch t := obj.(type) {"
  },
  {
    "id" : "c384d4ff-9cc3-4bec-8a04-e2d8e8b2d050",
    "prId" : 67870,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/67870#pullrequestreview-310295218",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "350b0cb3-8ae4-492e-9c7e-4ce1c2cd5be5",
        "parentId" : null,
        "authorId" : "cdb05f24-d700-4d96-a683-3e4de7effbf5",
        "body" : "> quota.ListerForResourceFunc\r\n\r\nIt has been renamed from \"k8s.io/kubernetes/pkg/quota\" to \"k8s.io/kubernetes/pkg/quota/v1\".\r\nI'm really surprised to see this package name, `quota`, still work here w/o declaring a package name alias!\r\n@yue9944882 any idea how this work?\r\n",
        "createdAt" : "2019-11-01T01:53:42Z",
        "updatedAt" : "2019-11-01T01:53:42Z",
        "lastEditedBy" : "cdb05f24-d700-4d96-a683-3e4de7effbf5",
        "tags" : [
        ]
      },
      {
        "id" : "33538311-aa7f-4f16-a80e-6a35d1b04307",
        "parentId" : "350b0cb3-8ae4-492e-9c7e-4ce1c2cd5be5",
        "authorId" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "body" : ">  \"k8s.io/kubernetes/pkg/quota/v1\".\r\n\r\nb/c we declared `package quota` in the source under `\"k8s.io/kubernetes/pkg/quota/v1\"`, we can call this an oversight when copy/pasting the quota codes.",
        "createdAt" : "2019-11-01T05:18:01Z",
        "updatedAt" : "2019-11-01T05:18:01Z",
        "lastEditedBy" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "tags" : [
        ]
      },
      {
        "id" : "33df25d0-3d4d-4e53-882d-a96b31b1bf67",
        "parentId" : "350b0cb3-8ae4-492e-9c7e-4ce1c2cd5be5",
        "authorId" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "body" : "how is that bothering you?",
        "createdAt" : "2019-11-01T05:18:29Z",
        "updatedAt" : "2019-11-01T05:18:40Z",
        "lastEditedBy" : "bc182326-9017-48d6-8ee0-4609046c1366",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae628c548843de9973d3bdcda1dcce23eb35cc8f",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +43,47 @@\n// NewServiceEvaluator returns an evaluator that can evaluate services.\nfunc NewServiceEvaluator(f quota.ListerForResourceFunc) quota.Evaluator {\n\tlistFuncByNamespace := generic.ListResourceUsingListerFunc(f, corev1.SchemeGroupVersion.WithResource(\"services\"))\n\tserviceEvaluator := &serviceEvaluator{listFuncByNamespace: listFuncByNamespace}"
  }
]