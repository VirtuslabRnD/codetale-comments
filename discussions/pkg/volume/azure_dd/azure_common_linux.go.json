[
  {
    "id" : "5bad442a-893d-46f9-bd72-a7e3ddd8d0ed",
    "prId" : 54334,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/54334#pullrequestreview-71744345",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "parentId" : null,
        "authorId" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "body" : "I used to use this heuristics but it is not reliable: on certain instances (last time I used F instance and found this test was different than D instance), this test fails.",
        "createdAt" : "2017-10-21T13:42:56Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "tags" : [
        ]
      },
      {
        "id" : "02965725-d7f5-46c2-9d66-a26e1ea75880",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "which test are you refering to? You mean \"\"/sys/bus/scsi/devices\"\" on different VM instance is different?",
        "createdAt" : "2017-10-21T15:06:59Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "f05713d2-5eda-4e22-9666-7c92520073d7",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "hi @rootfs I have tried coreos on `Standard F1s ` VM, it works well. Do you have any other instance suggestion?\r\n",
        "createdAt" : "2017-10-23T02:42:28Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "9aa17828-ec86-44f3-9a74-c816807faeeb",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "Paste all the info and logs on F instance, I attached two disks and try to detect Lun 1 disk:\r\n```\r\nazureuser@andy-coreosf /tmp $ ./detect-new-lun1\r\nAzure sys disks paths: []there is nothing under /dev/disk/azure/\r\nthere is nothing under /dev/disk/azure/\r\nthere is nothing under /dev/disk/azure/\r\nthere is nothing under /dev/disk/azure/\r\n/dev/sdd <nil>\r\nazureuser@andy-coreosf /tmp $ ls /sys/bus/scsi/devices -lt\r\ntotal 0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 target0:0:0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0000-8899-0000-000000000000/host0/target0:0:0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 target3:0:1 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0001-8899-0000-000000000000/host3/target3:0:1\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 target5:0:0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/f8b3781b-1e82-4818-a1c3-63d806ec15bb/host5/target5:0:0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 5:0:0:0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/f8b3781b-1e82-4818-a1c3-63d806ec15bb/host5/target5:0:0/5:0:0:0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 5:0:0:1 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/f8b3781b-1e82-4818-a1c3-63d806ec15bb/host5/target5:0:0/5:0:0:1\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host5 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/f8b3781b-1e82-4818-a1c3-63d806ec15bb/host5\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 3:0:1:0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0001-8899-0000-000000000000/host3/target3:0:1/3:0:1:0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host3 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0001-8899-0000-000000000000/host3\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host4 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/f8b3781a-1e82-4818-a1c3-63d806ec15bb/host4\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 0:0:0:0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0000-8899-0000-000000000000/host0/target0:0:0/0:0:0:0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host0 -> ../../../devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A03:00/device:07/VMBUS:01/00000000-0000-8899-0000-000000000000/host0\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host1 -> ../../../devices/pci0000:00/0000:00:07.1/ata1/host1\r\nlrwxrwxrwx. 1 root root 0 Oct 23 02:52 host2 -> ../../../devices/pci0000:00/0000:00:07.1/ata2/host2\r\n```",
        "createdAt" : "2017-10-23T02:58:20Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "2e4ccfa3-695b-42e5-a1ee-f780b069734d",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "body" : "`as observed, targets 0-3 are used by OS disks`, there are similar observations [too](https://github.com/Azure/azure-sdk-for-go/issues/315#issuecomment-215212498)\r\n\r\nHowever, this observation failed when i was using an F8s instance running RHEL. And that gave rise to this [fix](https://github.com/kubernetes/kubernetes/pull/44295)",
        "createdAt" : "2017-10-23T14:41:05Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "tags" : [
        ]
      },
      {
        "id" : "a2b948ab-88ac-4609-8e13-9eec9f1043f0",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "Hi @rootfs , thanks for the check. \r\nThe latest code already contains https://github.com/kubernetes/kubernetes/pull/44295, while current coreos issue is: since `/dev/disk/azure/` is not populated in coreos, which means there would be no filtering, see: https://github.com/kubernetes/kubernetes/blob/master/pkg/volume/azure_dd/azure_common_linux.go#L119-L124. In the end, `findDiskByLun` would return a wrong dev name which is actually os disk. So my fix is add back the skip logic if `azureDisks` is empty.\r\nI have also tested on RHEL F instance, my PR works well. Let me know if there is any other issue, thx.",
        "createdAt" : "2017-10-24T08:48:11Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      },
      {
        "id" : "b530158d-2db5-4280-81c5-71125ae09338",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "body" : "@andyzhangx thanks, please glog a message here. ",
        "createdAt" : "2017-10-24T13:15:45Z",
        "updatedAt" : "2017-10-25T05:20:25Z",
        "lastEditedBy" : "a7f673a6-4b23-4df6-aa10-f123fa9dcd5f",
        "tags" : [
        ]
      },
      {
        "id" : "0b7f5f29-a1f5-437d-9006-a2b7ec7485f2",
        "parentId" : "206eedf5-d78d-4122-9ffe-b5007ce1566a",
        "authorId" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "body" : "@rootfs done",
        "createdAt" : "2017-10-25T05:21:35Z",
        "updatedAt" : "2017-10-25T05:21:35Z",
        "lastEditedBy" : "e0218e0a-9e55-43f5-8929-04673eea9015",
        "tags" : [
        ]
      }
    ],
    "commit" : "db3c5a7881b8a98701ffab7087421151c3affb62",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +85,89 @@\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\t// as observed, targets 0-3 are used by OS disks. Skip them\n\t\t\t\tif target <= 3 {\n\t\t\t\t\tcontinue"
  }
]