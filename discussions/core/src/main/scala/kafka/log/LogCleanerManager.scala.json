[
  {
    "id" : "253aa45e-60b5-47ca-94b1-28942525694f",
    "prId" : 4580,
    "prUrl" : "https://github.com/apache/kafka/pull/4580#pullrequestreview-97363748",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0d97a490-e229-476f-89f2-f0660378fa90",
        "parentId" : null,
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "It would be a bit confusing if `s` is `None`. Maybe we'd want to have an explicit message for that case. Same for the other method.",
        "createdAt" : "2018-02-17T03:25:52Z",
        "updatedAt" : "2018-02-17T03:27:05Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      }
    ],
    "commit" : "19f1d2d181c5a8b26066cb88392e690a3fad878b",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +330,334 @@          pausedCleaningCond.signalAll()\n        case s =>\n          throw new IllegalStateException(s\"In-progress partition $topicPartition cannot be in $s state.\")\n      }\n    }"
  },
  {
    "id" : "b898c540-cd4b-4dd2-be89-9011f4ecb597",
    "prId" : 5439,
    "prUrl" : "https://github.com/apache/kafka/pull/5439#pullrequestreview-148141828",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0bd042dd-8f88-46da-9ecb-12455ce0a466",
        "parentId" : null,
        "authorId" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "body" : "Also, I could not figure out how often this method is called. Wondering if it might take too much CPU if there are many uncleanable partitions",
        "createdAt" : "2018-08-21T16:22:17Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3efb8ceab14c3414c7cf1d08512eb40b128515a",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +101,105 @@        \"uncleanable-bytes\",\n        new Gauge[Long] {\n          def value = {\n            inLock(lock) {\n              uncleanablePartitions.get(dir.getAbsolutePath) match {"
  },
  {
    "id" : "9f42cbd8-9742-41eb-9a48-b1cefc1edbfb",
    "prId" : 5439,
    "prUrl" : "https://github.com/apache/kafka/pull/5439#pullrequestreview-155284989",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dc686eab-ae7f-4c71-be5b-4dc85be12b47",
        "parentId" : null,
        "authorId" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "body" : "Can we take the lock explicitly here?",
        "createdAt" : "2018-09-13T22:29:13Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3efb8ceab14c3414c7cf1d08512eb40b128515a",
    "line" : 124,
    "diffHunk" : "@@ -1,1 +469,473 @@  }\n\n  private def isUncleanablePartition(log: Log, topicPartition: TopicPartition): Boolean = {\n    inLock(lock) {\n      uncleanablePartitions.get(log.dir.getParent).exists(partitions => partitions.contains(topicPartition))"
  },
  {
    "id" : "c5cdef93-9803-4550-9b43-34aace3c0f30",
    "prId" : 5439,
    "prUrl" : "https://github.com/apache/kafka/pull/5439#pullrequestreview-159033059",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9a271527-c84a-4c4b-94f6-c158861f8518",
        "parentId" : null,
        "authorId" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "body" : "Hmm, I wonder what impact taking the lock has on log cleaner. I think it depends on how frequently this is called which I am unsure of. @hachikuji thoughts?",
        "createdAt" : "2018-09-26T03:27:48Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "tags" : [
        ]
      },
      {
        "id" : "8ad0256c-f11c-46f9-b3a2-1955bc19efc6",
        "parentId" : "9a271527-c84a-4c4b-94f6-c158861f8518",
        "authorId" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "body" : "Yeah I'm also a bit concerned with this. An alternative would be to not hold the lock and risk the ConcurrentModificationException in the `Gauge`.",
        "createdAt" : "2018-09-26T14:39:36Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3efb8ceab14c3414c7cf1d08512eb40b128515a",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +91,95 @@    newGauge(\n      \"uncleanable-partitions-count\",\n      new Gauge[Int] { def value = inLock(lock) { uncleanablePartitions.get(dir.getAbsolutePath).map(_.size).getOrElse(0) } },\n      Map(\"logDirectory\" -> dir.getAbsolutePath)\n    )"
  },
  {
    "id" : "0c6f04ae-9d53-49f3-a903-6d83d8baec10",
    "prId" : 5439,
    "prUrl" : "https://github.com/apache/kafka/pull/5439#pullrequestreview-161970869",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2d2a9e4b-855e-4f37-acd0-df14f734e9e2",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "A partition can potentially be moved to a different disk through KIP-113. Should we keep this map consistent with disk movement?",
        "createdAt" : "2018-10-02T19:05:15Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "54e9791a-a008-4a13-9d2e-c12d8aa9424a",
        "parentId" : "2d2a9e4b-855e-4f37-acd0-df14f734e9e2",
        "authorId" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "body" : "Absolutely. Great catch!",
        "createdAt" : "2018-10-05T10:11:30Z",
        "updatedAt" : "2018-10-08T18:35:36Z",
        "lastEditedBy" : "df911192-d6c6-4af9-8568-f67bf2dcf926",
        "tags" : [
        ]
      }
    ],
    "commit" : "f3efb8ceab14c3414c7cf1d08512eb40b128515a",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +76,80 @@  /* the set of uncleanable partitions (partitions that have raised an unexpected error during cleaning)\n   *   for each log directory */\n  private val uncleanablePartitions = mutable.HashMap[String, mutable.Set[TopicPartition]]()\n\n  /* the set of directories marked as uncleanable and therefore offline */"
  }
]