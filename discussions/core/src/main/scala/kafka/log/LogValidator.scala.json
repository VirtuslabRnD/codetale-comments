[
  {
    "id" : "d379f64f-0835-41f3-afe8-1566461deb46",
    "prId" : 6785,
    "prUrl" : "https://github.com/apache/kafka/pull/6785#pullrequestreview-247340535",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0c239631-105a-4e80-a393-9862f186f09a",
        "parentId" : null,
        "authorId" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "body" : "Could be simplified as \r\n```\r\nif (batchIterator.hasNext && \r\n!(batch.magic < RecordBatch.MAGIC_VALUE_V2 && sourceCodec == NoCompressionCodec)) {\r\n  throw new InvalidRecordException(\"Compressed outer record has more than one batch\")\r\n} else {\r\n  batch\r\n}\r\n```\r\n",
        "createdAt" : "2019-06-04T18:20:39Z",
        "updatedAt" : "2019-06-21T01:39:59Z",
        "lastEditedBy" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "tags" : [
        ]
      },
      {
        "id" : "573441ec-db48-429a-b10c-c0dbf87785e3",
        "parentId" : "0c239631-105a-4e80-a393-9862f186f09a",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I feel it is easier to read in this way, though a bit verbose.",
        "createdAt" : "2019-06-07T23:37:21Z",
        "updatedAt" : "2019-06-21T01:39:59Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "b2877059086b62a6a36170174e0d2c924a1a6503",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +85,89 @@\n    // if the format is v2 and beyond, or if the messages are compressed, we should check there's only one batch.\n    if (batch.magic() >= RecordBatch.MAGIC_VALUE_V2 || sourceCodec != NoCompressionCodec) {\n      if (batchIterator.hasNext) {\n        throw new InvalidRecordException(\"Compressed outer record has more than one batch\")"
  },
  {
    "id" : "1e54e266-fa27-4b3a-966e-045e299ebc20",
    "prId" : 6816,
    "prUrl" : "https://github.com/apache/kafka/pull/6816#pullrequestreview-242893943",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d3597f92-7ee3-413f-b609-1c0487ee624d",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Do you think it's worth calling `hasNext()` first so that we can print a nice exception if the buffer reaches this point empty? I think we have a check for emptiness already in `analyzeAndValidateRecords`, but maybe no harm being a little defensive.",
        "createdAt" : "2019-05-28T20:23:23Z",
        "updatedAt" : "2019-05-29T04:35:12Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "7fa8c5522d00b97583dd5d8dd54b1391e209625a",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +83,87 @@    }\n\n    val batch = batchIterator.next()\n\n    if (batchIterator.hasNext) {"
  }
]