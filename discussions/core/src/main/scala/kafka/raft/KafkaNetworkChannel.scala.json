[
  {
    "id" : "b346327b-1e67-408a-a060-a89a20b7177b",
    "prId" : 9418,
    "prUrl" : "https://github.com/apache/kafka/pull/9418#pullrequestreview-517085254",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a161b782-c85c-4579-9647-adb329e61299",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "nit: maybe add a comment indicating this function is for testing only (and hence we do not care about the correlation id).",
        "createdAt" : "2020-10-21T00:07:48Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "09549f61-db0c-4a6d-92a7-cc9f28263e7e",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "This was actually a bug. The implementation was treating `correlationId` as unique across all connections, which of course was wrong. My fix was just to overwrite the `correlationId` from the header with one that could be unique, but obviously this loses traceability through the Raft layer. If it's ok with you, I'd like to address this problem more generally in a follow-up. ",
        "createdAt" : "2020-10-21T21:53:01Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "88e5da56-df38-4a09-ae10-c23a84eb8db3",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Currently, `postInboundRequest` in only used by `TestRaftRequestHandler` and `KafkaNetworkChannelTest`. Are you thinking that we will use the same or similar method when integrating with the broker code?",
        "createdAt" : "2020-10-23T18:57:32Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "c7363f73-5671-4afa-9c58-551348f9a68f",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Unrelated with this change but when reading the code. I was confused by the name `pollInboundResponses`. That function returns both pending request and responses.",
        "createdAt" : "2020-10-23T18:59:09Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "f637f415-9a0f-4fe8-b547-11e06c202354",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "> Unrelated with this change but when reading the code. I was confused by the name pollInboundResponses. That function returns both pending request and responses.\r\n\r\nI don't think that's right. It only delivers responses for outbound requests (in other words, inbound responses).\r\n\r\nIn regard to the confusion, I took an unconventional turn in the beginning by consolidating inbound and outbound requests through a single API. This was useful because it allowed inputs and outputs to be serialized, which made it easier to have deterministic simulation tests. The main defect from the perspective of Raft is that fetch requests cannot be handled concurrently. I think we are going to have to address this problem in the long term, but it is outside the scope of this PR.\r\n",
        "createdAt" : "2020-10-26T18:44:37Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "5b9539a8-e8ca-4558-8968-2823e2fc44fd",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "> I don't think that's right. It only delivers responses for outbound requests (in other words, inbound responses).\r\n\r\nHmm. I misspoke a bit. I should have said that `pollInboundResponses` returns both inbound requests and responses. These are my observations:\r\n\r\n`postInboundRequest` puts requests in `undelivered`:\r\nhttps://github.com/apache/kafka/pull/9418/files#diff-c9b2a05e69be1d2391d91a33f408eab4fde1245d4ea9cf9f52305c8cb89208ceR224\r\n\r\n`pollInboundResponses` returns everything in `undelivered`:\r\nhttps://github.com/apache/kafka/pull/9418/files#diff-c9b2a05e69be1d2391d91a33f408eab4fde1245d4ea9cf9f52305c8cb89208ceR201-R202\r\n\r\nThe raft client gets all of the inbound messages (requests and reponses) by calling `receive` which in term calls `pollInboundResponses`:\r\nhttps://github.com/apache/kafka/pull/9418/files#diff-1da15c51e641ea46ea5c86201ab8f21cfee9e7c575102a39c7bae0d5ffd7de39L1596",
        "createdAt" : "2020-10-26T18:54:43Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "5568fa6f-d821-4165-a005-7aa9472d2151",
        "parentId" : "a161b782-c85c-4579-9647-adb329e61299",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "My mistake. This _was_ being used for both inbound requests and responses. Let me change the name and add some docs.",
        "createdAt" : "2020-10-26T18:56:56Z",
        "updatedAt" : "2020-10-27T03:04:10Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "fac5c0a9507f9f40f99dac017242d12500a97d5d",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +225,229 @@  }\n\n  def postInboundRequest(request: AbstractRequest, onResponseReceived: ResponseHandler): Unit = {\n    val data = requestData(request)\n    val correlationId = newCorrelationId()"
  },
  {
    "id" : "a2304a70-5050-4dd0-a921-693e361ebbfa",
    "prId" : 9732,
    "prUrl" : "https://github.com/apache/kafka/pull/9732#pullrequestreview-552721559",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "38c83bb7-0be2-462f-8bc2-bbce973306e2",
        "parentId" : null,
        "authorId" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "body" : "style nit/question: I think we have a mixture of argument indentation for Scala classes/methods. Do we have an established style convention for this? Normally I follow the opening paren when breaking out arguments into their own line (though I'm not sure that's correct)",
        "createdAt" : "2020-12-15T17:16:24Z",
        "updatedAt" : "2020-12-21T20:43:49Z",
        "lastEditedBy" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "tags" : [
        ]
      },
      {
        "id" : "dca461c5-16f8-439d-8c6d-962d62fcd533",
        "parentId" : "38c83bb7-0be2-462f-8bc2-bbce973306e2",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Not really as far as I know. This is my favored style of late because it results in consistent alignment of parameters. I get really annoyed when I see stuff like this:\r\n```\r\ndef someMethodWithAnArguablyOverVerboseName(foo: String,\r\n                                            bar: Option[List[Int]]): (Option[String], List[String)\r\n\r\ndef concicseMethod(foo: String,\r\n                   bar: String): Unit = {\r\n```\r\nNo matter how you look at it, it seems hideous.",
        "createdAt" : "2020-12-15T17:55:59Z",
        "updatedAt" : "2020-12-21T20:43:49Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "c31ba33f2ffb1144e0acbe975ddf45cc5d4065bc",
    "line" : 58,
    "diffHunk" : "@@ -1,1 +55,59 @@}\n\nprivate[raft] class RaftSendThread(\n  name: String,\n  networkClient: KafkaClient,"
  }
]