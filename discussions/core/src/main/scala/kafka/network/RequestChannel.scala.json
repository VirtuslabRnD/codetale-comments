[
  {
    "id" : "80c248c8-1b41-40fc-8a84-dc39e12c6b2d",
    "prId" : 4871,
    "prUrl" : "https://github.com/apache/kafka/pull/4871#pullrequestreview-124633755",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0e2e61bd-d482-4965-b962-e404dbd62f8e",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "It seems more appropriate to treat this as a `ResponseAction` instead of a `Response` itself, especially given the new throttling behavior.",
        "createdAt" : "2018-05-30T23:50:14Z",
        "updatedAt" : "2018-05-30T23:57:50Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "b25d7bbb-b448-49a5-a14f-8060a14138a6",
        "parentId" : "0e2e61bd-d482-4965-b962-e404dbd62f8e",
        "authorId" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "body" : "I will consider taking this up in a follow-on patch.",
        "createdAt" : "2018-05-30T23:58:32Z",
        "updatedAt" : "2018-05-30T23:58:32Z",
        "lastEditedBy" : "93b1c273-8917-4547-bd53-5101f22161c0",
        "tags" : [
        ]
      }
    ],
    "commit" : "2e35d5c438607b8a1f09b973598cac8bc007a931",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +224,228 @@  }\n\n  abstract class Response(val request: Request) {\n    locally {\n      val nowNs = Time.SYSTEM.nanoseconds"
  },
  {
    "id" : "ce54d745-7f5b-4beb-a11b-2f94620e23f0",
    "prId" : 9103,
    "prUrl" : "https://github.com/apache/kafka/pull/9103#pullrequestreview-514037726",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "232ca1de-9acb-43ce-b7b6-fcf5b9dcac90",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "nit: can we move this back to where the request parsing logic is. Otherwise it becomes a bit hidden.",
        "createdAt" : "2020-10-21T18:09:44Z",
        "updatedAt" : "2020-11-04T19:19:59Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "f9844c4dc13337a68b89d6e1acf772af9246e221",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +102,106 @@    def sizeOfBodyInBytes: Int = bodyAndSize.size\n\n    // most request types are parsed entirely into objects at this point. for those we can release the underlying buffer.\n    // some (like produce, or any time the schema contains fields of types BYTES or NULLABLE_BYTES) retain a reference\n    // to the buffer. for those requests we cannot release the buffer early, but only when request processing is done."
  },
  {
    "id" : "a4fdc669-1c5c-401a-afff-0fb56cbaa7e3",
    "prId" : 9912,
    "prUrl" : "https://github.com/apache/kafka/pull/9912#pullrequestreview-575058513",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "82a077c9-0c6e-4f55-9bee-92d90ee4fa04",
        "parentId" : null,
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "I wonder if this should be `Send => Unit` instead. It doesn't seem like there is much value in the `Option` here. A function that does nothing is equivalent to `None`. I know this is an existing issue, so ok if you prefer not to address now.",
        "createdAt" : "2021-01-20T14:45:38Z",
        "updatedAt" : "2021-02-23T00:11:08Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      },
      {
        "id" : "8dd52d0d-7d8e-4075-8cd2-d9d070212f37",
        "parentId" : "82a077c9-0c6e-4f55-9bee-92d90ee4fa04",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "That's fair. I will check the scope of this change.",
        "createdAt" : "2021-01-20T18:16:08Z",
        "updatedAt" : "2021-02-23T00:11:08Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "f0d67de9-f373-45cc-864f-72f45e97c2f9",
        "parentId" : "82a077c9-0c6e-4f55-9bee-92d90ee4fa04",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "I decided not to do this here. I didn't like replacing `None` with `_ => {}` in uses, and neither did I like making the argument optional. The alternative is to introduce a constant \"no-op\" function, but I found this also a little awkward. If you think of a nice way to do it, I can review. I do think it is better having a simpler type.",
        "createdAt" : "2021-01-21T00:14:45Z",
        "updatedAt" : "2021-02-23T00:11:08Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "9cdebfc2-276f-4fcf-b7f1-a5c58db26351",
        "parentId" : "82a077c9-0c6e-4f55-9bee-92d90ee4fa04",
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "Sounds good.",
        "createdAt" : "2021-01-25T04:23:45Z",
        "updatedAt" : "2021-02-23T00:11:08Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      }
    ],
    "commit" : "d0b4eafff1d14d5d14025cd22eb4f28131371150",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +387,391 @@    request: RequestChannel.Request,\n    response: AbstractResponse,\n    onComplete: Option[Send => Unit]\n  ): Unit = {\n    updateErrorMetrics(request.header.apiKey, response.errorCounts.asScala)"
  },
  {
    "id" : "78f9d292-31a9-4df4-b702-5a88c8ab8e0e",
    "prId" : 10794,
    "prUrl" : "https://github.com/apache/kafka/pull/10794#pullrequestreview-701435276",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cf473c7a-ba91-49e7-8dc1-8ce6ff637ccf",
        "parentId" : null,
        "authorId" : "d520dc4e-6bae-4b0b-90d6-4c0a1cabb518",
        "body" : "fix 2: Make the envelope response return `NotControllerException` if the controller response has `NotControllerException`. So that we can catch the `NotControllerException` on envelopeResponse to update the active controller.",
        "createdAt" : "2021-06-19T07:51:03Z",
        "updatedAt" : "2021-06-19T07:51:03Z",
        "lastEditedBy" : "d520dc4e-6bae-4b0b-90d6-4c0a1cabb518",
        "tags" : [
        ]
      },
      {
        "id" : "5eb08ac3-41fe-4540-8b7a-eb12bacae710",
        "parentId" : "cf473c7a-ba91-49e7-8dc1-8ce6ff637ccf",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Ok, I think this makes sense. Basically we were missing the same logic we have in `KafkaApis.handleEnvelope` to verify the controller status. Instead, we just send the request into the controller thread. Do I have that right? I guess another way we could do it is to send the full envelope into the controller and let it set the NOT_CONTROLLER error at the right level, but that might take some refactoring and this solution seems reasonable as well.",
        "createdAt" : "2021-07-07T20:49:44Z",
        "updatedAt" : "2021-07-07T20:55:26Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "d1f678d48406901bba078cf403af52ac253b29cd",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +129,133 @@            // to notify the requester (i.e. BrokerToControllerRequestThread) to update active controller\n            new EnvelopeResponse(new EnvelopeResponseData()\n              .setErrorCode(Errors.NOT_CONTROLLER.code()))\n          } else {\n            val responseBytes = context.buildResponseEnvelopePayload(abstractResponse)"
  }
]