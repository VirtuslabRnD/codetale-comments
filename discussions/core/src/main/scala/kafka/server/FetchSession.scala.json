[
  {
    "id" : "6cbcf9f8-8852-499c-8bb2-572ed7952f0f",
    "prId" : 6832,
    "prUrl" : "https://github.com/apache/kafka/pull/6832#pullrequestreview-255347220",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3a084b53-7e10-403b-a876-a261987c7c56",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "If the preferred read replica is the leader, do we need to respond immediately?",
        "createdAt" : "2019-06-24T17:46:06Z",
        "updatedAt" : "2019-07-04T02:59:14Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "d79ee42a-4253-49ae-ac63-9abe1289714e",
        "parentId" : "3a084b53-7e10-403b-a876-a261987c7c56",
        "authorId" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "body" : "Is that what this does? I thought `mustRespond` just made sure to include that partition in the response.",
        "createdAt" : "2019-06-25T17:10:25Z",
        "updatedAt" : "2019-07-04T02:59:14Z",
        "lastEditedBy" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "tags" : [
        ]
      },
      {
        "id" : "6eb1d489-48ac-4499-9dda-522c25d6ab89",
        "parentId" : "3a084b53-7e10-403b-a876-a261987c7c56",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "I think you're right, but that just changes the question. If the preferred read replica is the leader, do we need to include it in the response? Wouldn't that imply that we always have to include the partition in the response?",
        "createdAt" : "2019-06-25T19:55:05Z",
        "updatedAt" : "2019-07-04T02:59:14Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "a478e5dc-c58e-49f6-bb2a-1140c980e89f",
        "parentId" : "3a084b53-7e10-403b-a876-a261987c7c56",
        "authorId" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "body" : "If the leader picks itself as the preferred read replica, we could exclude it from the response (return none from ReplicaSelector). This actually makes sense b/c we are treating the presence of a preferred read replica ID as a signal to \"go somewhere else\" to the client and parts of the broker response logic. WDYT?",
        "createdAt" : "2019-06-27T15:35:15Z",
        "updatedAt" : "2019-07-04T02:59:14Z",
        "lastEditedBy" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "tags" : [
        ]
      },
      {
        "id" : "454079eb-24dc-4ad1-ad85-f6e3f0a7d7a2",
        "parentId" : "3a084b53-7e10-403b-a876-a261987c7c56",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Yes, that makes sense. So the preferred read replica is only set in the fetch response if it is a node other than the leader.",
        "createdAt" : "2019-06-27T16:38:57Z",
        "updatedAt" : "2019-07-04T02:59:14Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "4649c14a969cd8c88d06cad68f65d39a0cfdd905",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +145,149 @@        localLogStartOffset = respData.logStartOffset\n    }\n    if (respData.preferredReadReplica.isPresent) {\n      // If the broker computed a preferred read replica, we need to include it in the response\n      mustRespond = true"
  }
]