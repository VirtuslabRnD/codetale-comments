[
  {
    "id" : "f68f3ea9-299a-48e3-b61f-6bd078c73045",
    "prId" : 4544,
    "prUrl" : "https://github.com/apache/kafka/pull/4544#pullrequestreview-99500042",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "58f6d2c2-4722-4105-b5f0-3cdbb91e1841",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I am not sure why we need this? Should the unsubscribe/subscribe change not fix the issue? What is the scenario that is not covered by unsubscribe/subscribe that is fixed with `taskClosed` flag?",
        "createdAt" : "2018-02-26T18:31:44Z",
        "updatedAt" : "2018-02-26T22:53:32Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "97ac9805-c2e4-4a6a-b4c2-b3e1a78867c2",
        "parentId" : "58f6d2c2-4722-4105-b5f0-3cdbb91e1841",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Strictly speaking this change is not required for this particular fix itself, but I just want to add some more safety net on the code in case there are other unknown issues. After second thought, what I can do is to change the thrown exception to `IllegalStateException` to let it fail immediately than trying to cover any unknown issues. WDYT?",
        "createdAt" : "2018-02-26T22:41:48Z",
        "updatedAt" : "2018-02-26T22:53:32Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "69b10f34-87ba-4ca8-b497-32cb590b89b2",
        "parentId" : "58f6d2c2-4722-4105-b5f0-3cdbb91e1841",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Not sure. Both approaches have advantages and disadvantages.\r\n\r\nThe proposed change make the code more robust and thus might result in better user experience. However, we might not learn about issues as user might never recognize this log entry and thus never report. (Maybe we should log this as an ERROR and explain in the message that Streams will auto-recover from this, but people should please report that this happened? -- This would at least increase the likelihood to get a report.)\r\n\r\nFor `IllegalStateException` it would be the other way round... Guess it depends on the likelihood of a bug hitting this? If it's rare, failing might be better?\r\n\r\nBut not sure. \\cc @bbejeck @dguy ",
        "createdAt" : "2018-02-26T22:52:13Z",
        "updatedAt" : "2018-02-26T22:53:32Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "6066f434-dde9-4ed6-8c50-3077c6c3a0d0",
        "parentId" : "58f6d2c2-4722-4105-b5f0-3cdbb91e1841",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I kept the migration exception while bumping the log to WARN indicating this is not expected to happen in the new commit.",
        "createdAt" : "2018-02-26T22:54:11Z",
        "updatedAt" : "2018-02-26T22:54:12Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "c08097b3c0a5a569bf05b1872460a6f282786a12",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +146,150 @@        }\n\n        taskClosed = true;\n    }\n"
  },
  {
    "id" : "658efbee-e64f-448e-ab44-fc06ca8e2e77",
    "prId" : 5428,
    "prUrl" : "https://github.com/apache/kafka/pull/5428#pullrequestreview-153565808",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "46bc9003-5efb-46a8-953d-7c8bf86782c8",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Not sure if I understand this. Why is a commit only required if we did not restore all records that were passed in? Don't we need to commit if we did a restore and updated `lastOffset` ?",
        "createdAt" : "2018-09-06T17:52:03Z",
        "updatedAt" : "2018-09-11T21:32:12Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "1015fa72-e448-42a9-a382-bd79255f347b",
        "parentId" : "46bc9003-5efb-46a8-953d-7c8bf86782c8",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "`!restoreRecords.isEmpty()` means we have non-empty records that are applied inside `stateMgr.updateStandbyStates` call, note it does not remove records that are applied after the call.",
        "createdAt" : "2018-09-07T17:54:27Z",
        "updatedAt" : "2018-09-11T21:32:12Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "ac1b69ee-49a6-4765-8545-c83ad0232e6d",
        "parentId" : "46bc9003-5efb-46a8-953d-7c8bf86782c8",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Ack. I confused it with `remainingRecords`. All good :)",
        "createdAt" : "2018-09-08T21:53:28Z",
        "updatedAt" : "2018-09-11T21:32:12Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      }
    ],
    "commit" : "71b2b16d0b0f37a05af3df60ae9b5ff88649a7a4",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +191,195 @@        if (!restoreRecords.isEmpty()) {\n            commitNeeded = true;\n        }\n\n        return remainingRecords;"
  }
]