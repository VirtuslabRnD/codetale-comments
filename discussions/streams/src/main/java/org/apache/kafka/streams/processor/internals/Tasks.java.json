[
  {
    "id" : "ef847765-b9ff-46f8-b5fd-210d2fdf8baf",
    "prId" : 9835,
    "prUrl" : "https://github.com/apache/kafka/pull/9835#pullrequestreview-562937778",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "21896880-eb33-46a2-8522-0d4c9376dc3c",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "We replace the old `Map<TaskId, Task>` with redundant data structures and read-only views. This will allow us to improve type safety later. We also don't need code to extract the views on demand, but the collections will be kept in sync automatically for us.\r\n\r\nTo keep this PR small, I did not implement the changes to get actual type safety yet.",
        "createdAt" : "2021-01-06T18:19:13Z",
        "updatedAt" : "2021-01-13T00:47:09Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      }
    ],
    "commit" : "57b39fa61a5ae5f0c81c51ab80d864d644abef2d",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +39,43 @@    private final StreamsMetricsImpl streamsMetrics;\n\n    private final Map<TaskId, Task> allTasksPerId = new TreeMap<>();\n    private final Map<TaskId, Task> readOnlyTasksPerId = Collections.unmodifiableMap(allTasksPerId);\n    private final Collection<Task> readOnlyTasks = Collections.unmodifiableCollection(allTasksPerId.values());"
  },
  {
    "id" : "fc931094-44c1-479b-8480-e7a66448aa9f",
    "prId" : 9835,
    "prUrl" : "https://github.com/apache/kafka/pull/9835#pullrequestreview-572695916",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "03f99738-c019-47fa-91e3-f829edd34d09",
        "parentId" : null,
        "authorId" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "body" : "@mjsax this seems to be throwing a ConcurrentModificationException",
        "createdAt" : "2021-01-20T22:11:38Z",
        "updatedAt" : "2021-01-20T22:11:38Z",
        "lastEditedBy" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "tags" : [
        ]
      },
      {
        "id" : "cd3c8e76-1fcf-4359-a2b9-0236f9474c3e",
        "parentId" : "03f99738-c019-47fa-91e3-f829edd34d09",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Yes... https://github.com/apache/kafka/pull/9940",
        "createdAt" : "2021-01-20T22:15:40Z",
        "updatedAt" : "2021-01-20T22:15:41Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      }
    ],
    "commit" : "57b39fa61a5ae5f0c81c51ab80d864d644abef2d",
    "line" : 133,
    "diffHunk" : "@@ -1,1 +131,135 @@        activeTasksPerPartition.entrySet().stream()\n            .filter(e -> e.getValue().id().equals(activeTask.id()))\n            .forEach(e -> activeTasksPerPartition.remove(e.getKey()));\n\n        cleanUpTaskProducerAndRemoveTask(activeTask.id(), taskCloseExceptions);"
  }
]