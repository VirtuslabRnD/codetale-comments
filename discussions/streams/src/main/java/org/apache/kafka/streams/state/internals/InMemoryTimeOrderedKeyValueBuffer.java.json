[
  {
    "id" : "2045aa4f-92f9-466c-908d-92e1f73b664d",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-165332087",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "36f5d4cc-b4f3-4a94-9080-5e4091882303",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Avoid recording metrics if they haven't changed.",
        "createdAt" : "2018-10-16T19:36:41Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 88,
    "diffHunk" : "@@ -1,1 +318,322 @@        if (evictions > 0) {\n            updateBufferMetrics();\n        }\n    }\n"
  },
  {
    "id" : "3f018106-0262-420a-aec4-204707b63e8e",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-175606934",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b3e2ba85-b3dd-4e40-b953-edca1f990db0",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Should we call this in `init()` and/or `close()`, too?",
        "createdAt" : "2018-11-06T22:12:19Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "8b09c19f-dd54-4d79-ac85-8542de0d69d8",
        "parentId" : "b3e2ba85-b3dd-4e40-b953-edca1f990db0",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "sure; I don't think they're strictly necessary, but it doesn't hurt, and it'll make the system more resilient to future changes.",
        "createdAt" : "2018-11-15T23:41:37Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 105,
    "diffHunk" : "@@ -1,1 +376,380 @@    }\n\n    private void updateBufferMetrics() {\n        bufferSizeSensor.record(memBufferSize);\n        bufferCountSensor.record(index.size());"
  },
  {
    "id" : "7eded430-e9b8-47a1-aa95-795ca8664505",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-175668977",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "In the wiki there is another metric for `suppression-mem-buffer-evict`, is that not in the scope of this PR?",
        "createdAt" : "2018-11-15T02:04:14Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "59cafbaf-d4d3-445f-bbb1-ebcf0a3048dc",
        "parentId" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Ah, now that you mention it, when I originally created this PR, I noticed there were some shortcomings with the metrics I proposed in the KIP, so I wanted to get the reviewers' feedback on the form it has taken in this PR before proposing an update to the KIP.\r\n\r\nIn particular, I proposed an asymmetric pair of metrics where the processor node would measure the number of incoming events (`intermediate-result-suppression`), but the buffer would measure the outgoing (emitted==evicted) events. It seemed better to offer a symmetric pair of in/out metrics on either the processor or the buffer. In this PR, I chose to put them both on the node.\r\n\r\nIn other words, I'm proposing to replace `suppression-mem-buffer-evict` with `suppression-emit`.\r\n\r\nOf course, in this same review, you have proposed to drop `intermediate-result-suppression` in favor of the existing `process-rate` and `process-total` node-level metrics. This reduces the argument, but I *think* it still makes sense to make this a node metric instead of a buffer metric, since (IMHO) it more closely matches the intent of using a suppression *node* to control the emission rate.",
        "createdAt" : "2018-11-15T23:53:51Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "68347e15-a1e7-42f3-8428-e75a48f7119b",
        "parentId" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Thanks for the clarification, that sounds good to me.",
        "createdAt" : "2018-11-16T06:14:44Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +61,65 @@    private RecordCollector collector;\n    private String changelogTopic;\n    private Sensor bufferSizeSensor;\n    private Sensor bufferCountSensor;\n"
  },
  {
    "id" : "9bd8f468-6b3d-4df5-ba03-5946190f429c",
    "prId" : 5819,
    "prUrl" : "https://github.com/apache/kafka/pull/5819#pullrequestreview-166797510",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "parentId" : null,
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Should we log a warning here and below?",
        "createdAt" : "2018-10-19T23:02:56Z",
        "updatedAt" : "2018-10-20T21:25:17Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      },
      {
        "id" : "9aba22eb-8b71-4b05-b321-09c21703b047",
        "parentId" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I'm not sure I agree with a warning.\r\n\r\nI think it's fine to just ignore the call, since the buffer will behave correctly whether you call these methods or not. In fact, I originally had them no-op, and changed it to throw upon review.\r\n\r\nThere's no publicly facing API to register a buffer, so there's no way that a user could call these methods right now. In fact, the buffer itself is an `internal` class. Therefore, the only way these methods get called are via Streams itself.\r\n\r\nMy thought is that it would be confusing to see warnings that actually indicate nothing is wrong and about which you can do nothing.\r\n\r\nWould you be satisfied with a javadoc explaining the decision?",
        "createdAt" : "2018-10-20T19:59:51Z",
        "updatedAt" : "2018-10-20T21:25:17Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "5e306dd1-1c72-40b9-aa23-02f0e3b596eb",
        "parentId" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Yeah, my intent was just some sort of notification to users these methods are ignored, javadoc is fine with me.",
        "createdAt" : "2018-10-21T19:23:50Z",
        "updatedAt" : "2018-10-21T19:23:50Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "e6c42b021c4e4181b8cca7c9296f92e0bbdd2107",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +79,83 @@        @Override\n        public StoreBuilder<StateStore> withCachingEnabled() {\n            return this;\n        }\n"
  },
  {
    "id" : "ced42005-a85f-4772-a03c-f452ac9cba09",
    "prId" : 6536,
    "prUrl" : "https://github.com/apache/kafka/pull/6536#pullrequestreview-226935859",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "15e46f92-b90e-4d7a-9548-5713dc426a0d",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Why do we need this check?",
        "createdAt" : "2019-04-12T17:36:52Z",
        "updatedAt" : "2019-04-19T21:52:28Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "18d337a0-13f7-487e-9ee6-45c843d4cfc4",
        "parentId" : "15e46f92-b90e-4d7a-9548-5713dc426a0d",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "This is one of the bugs that this PR fixes. The correct operation of this class depends on maintaining `minTimestamp` on every mutation. If a future code change breaks that contract, it would re-introduce a variant of our bug, and it would be just as subtle as it was this time. This check safeguards against that eventuality, by checking on our invariant at the spot we depend on it.",
        "createdAt" : "2019-04-15T20:09:56Z",
        "updatedAt" : "2019-04-19T21:52:28Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "ea57c444-27ec-48b6-97f9-0c81db4f3584",
        "parentId" : "15e46f92-b90e-4d7a-9548-5713dc426a0d",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Ack. So we don't need it, but we want it :) ",
        "createdAt" : "2019-04-16T00:15:52Z",
        "updatedAt" : "2019-04-19T21:52:28Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5bd0999c3376588b891016efbec78274a3714ec",
    "line" : 217,
    "diffHunk" : "@@ -1,1 +372,376 @@            // predicate being true means we read one record, call the callback, and then remove it\n            while (next != null && predicate.get()) {\n                if (next.getKey().time != minTimestamp) {\n                    throw new IllegalStateException(\n                        \"minTimestamp [\" + minTimestamp + \"] did not match the actual min timestamp [\" +"
  },
  {
    "id" : "a66793e0-ad5e-41b4-a1aa-0f3ecad6b932",
    "prId" : 6602,
    "prUrl" : "https://github.com/apache/kafka/pull/6602#pullrequestreview-228364218",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "716226ad-ee61-4694-9e15-cca4c77d4dfa",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I added the `Eviction` class so we can pack up all three pieces (key, value, context) to give to the callback. We can't use ContextualRecord anymore, since it's a post-serialization container for the value.",
        "createdAt" : "2019-04-18T15:51:15Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "7414ed063c920aa5c2f4bb29c81664fecb851b9b",
    "line" : 98,
    "diffHunk" : "@@ -1,1 +379,383 @@    @Override\n    public void evictWhile(final Supplier<Boolean> predicate,\n                           final Consumer<Eviction<K, V>> callback) {\n        final Iterator<Map.Entry<BufferKey, ContextualRecord>> delegate = sortedMap.entrySet().iterator();\n        int evictions = 0;"
  },
  {
    "id" : "6c03d16e-2d80-4cff-b317-ae7bb2205238",
    "prId" : 6602,
    "prUrl" : "https://github.com/apache/kafka/pull/6602#pullrequestreview-230282088",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "17060727-3f6e-41f8-a455-0dedc3a212a3",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Just clarifying: are all the non-testing callers passing in the serdes, hence it would not be null in practice?",
        "createdAt" : "2019-04-22T17:51:44Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "b79d303a-a613-4166-a9dd-222ce41d8165",
        "parentId" : "17060727-3f6e-41f8-a455-0dedc3a212a3",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "hmm. Yes, although I think there's a problem with the logic. \r\n\r\nThe KTableImpl does:\r\n```java\r\n            new InMemoryTimeOrderedKeyValueBuffer.Builder<>(storeName, keySerde, new FullChangeSerde<>(valSerde))\r\n```\r\n\r\nbut `valSerde` might be null, and `FullChangeSerde` forbids null for this argument. So I think the default serde case doesn't work properly here.\r\n\r\nI'll add a test for this and fix the code if I'm right.",
        "createdAt" : "2019-04-23T22:14:48Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "30ea38e6-7201-450c-8b6d-64bbaaf19602",
        "parentId" : "17060727-3f6e-41f8-a455-0dedc3a212a3",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Ok, now the answer is \"no\". The only non-test caller is `KTableImpl`, and it will set its own serdes, but those might be `null` if they are not known.",
        "createdAt" : "2019-04-24T18:25:42Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "7414ed063c920aa5c2f4bb29c81664fecb851b9b",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +85,89 @@        private boolean loggingEnabled = true;\n\n        public Builder(final String storeName, final Serde<K> keySerde, final Serde<V> valSerde) {\n            this.storeName = storeName;\n            this.keySerde = keySerde;"
  },
  {
    "id" : "d69a544b-3d70-48ec-9178-6bb466ff7a38",
    "prId" : 6602,
    "prUrl" : "https://github.com/apache/kafka/pull/6602#pullrequestreview-230769623",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2508c0b5-3937-400c-a1bb-7b3f8a1dfe07",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Nice catch!",
        "createdAt" : "2019-04-24T23:25:05Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "db000b0d-5a1a-4d31-b3cf-11774d84bb46",
        "parentId" : "2508c0b5-3937-400c-a1bb-7b3f8a1dfe07",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Thanks! I was chasing down an unchecked cast and was pleasantly surprised that it was totally unnecessary!",
        "createdAt" : "2019-04-25T16:57:53Z",
        "updatedAt" : "2019-04-26T13:35:41Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "7414ed063c920aa5c2f4bb29c81664fecb851b9b",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +127,131 @@\n        @Override\n        public InMemoryTimeOrderedKeyValueBuffer<K, V> build() {\n            return new InMemoryTimeOrderedKeyValueBuffer<>(storeName, loggingEnabled, keySerde, valSerde);\n        }"
  },
  {
    "id" : "f391e3a7-8a9d-4037-88bb-1c10f06a0ab8",
    "prId" : 6781,
    "prUrl" : "https://github.com/apache/kafka/pull/6781#pullrequestreview-240925701",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f72e6929-c145-43c5-bde0-9aa866eb8597",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "just cleanup",
        "createdAt" : "2019-05-21T20:16:22Z",
        "updatedAt" : "2019-05-30T14:57:19Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "8272875e-de7e-4239-9b40-5b0797184a45",
        "parentId" : "f72e6929-c145-43c5-bde0-9aa866eb8597",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Nice cleanup!",
        "createdAt" : "2019-05-29T04:57:51Z",
        "updatedAt" : "2019-05-30T14:57:19Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "daf890e855d0949687a6d4e35c7ed15b473c1a71",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +84,88 @@    private int partition;\n\n    public static class Builder<K, V> implements StoreBuilder<InMemoryTimeOrderedKeyValueBuffer<K, V>> {\n\n        private final String storeName;"
  },
  {
    "id" : "1cf938bc-ee3a-4de0-bd78-4d7bd8e84e2f",
    "prId" : 7373,
    "prUrl" : "https://github.com/apache/kafka/pull/7373#pullrequestreview-292471532",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Why do we add a timestamp now? Seem, we ignore it on restore anyway?",
        "createdAt" : "2019-09-20T01:19:16Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "0b6011c4-35e7-40f2-8d40-7d2ab0dfb74c",
        "parentId" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Two reasons, maybe neither of them good. We used to set it this way, and it messes up the tests to let the producer set them. I can take another look at the restore to see if I missed something from the revert.",
        "createdAt" : "2019-09-20T07:58:21Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "f369f5a3-c4a4-4278-a653-5bc06a239bd0",
        "parentId" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "What I am wondering is, why we removed it though via https://github.com/apache/kafka/commit/a193f370c0cd43d056dd913e97e457e636dbf76d#diff-6f5b9383b8acde07a74d681de2da66d2R256 (ie, we don't set the timestamp in `2.2`, `2.3`, `trunk` either).",
        "createdAt" : "2019-09-20T18:27:15Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "a86a2443-79af-4abf-a533-1a143816af42",
        "parentId" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Actually, we do use it on restore, unless I've overlooked something.\r\n\r\nIIRC, in the fixed versions (`2.2.1+`), we are serializing the entire record context, including the timestamp, in the value. There's no need to go the extra mile and also set the timestamp on the changelog record's timestamp field as well, so I just left it null and let the producer set it. I.e., the fix \"moves\" it into the value, not \"copies\" it.\r\n\r\nHere, though, we do need to preserve the timestamp so we can at least restore that much information.",
        "createdAt" : "2019-09-20T19:11:40Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "31ab4ecc-9618-405b-b159-db0132a2c4d8",
        "parentId" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "So it's an additional fix for 2.1?",
        "createdAt" : "2019-09-24T03:47:40Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "5941d56d-12e8-4205-ad10-52c25610c7c8",
        "parentId" : "a2f6220f-7837-4acc-877f-374d9fed857b",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "No, I think this PR is all we need, unless I've missed something. We store it in the timestamp field and then extract it again on restore. We'll never be able to store it in the value in 2.1 the way we do in 2.2.1+, so this should be the \"final result\" :)",
        "createdAt" : "2019-09-24T14:36:55Z",
        "updatedAt" : "2019-09-26T23:27:16Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "c590d88e863d61b969ea3bcc05e7ce52b1e2db10",
    "line" : 62,
    "diffHunk" : "@@ -1,1 +271,275 @@            null,\n            partition,\n            value.recordContext().timestamp(),\n            KEY_SERIALIZER,\n            VALUE_SERIALIZER"
  },
  {
    "id" : "ffd17f7b-cde8-407b-8b48-def5f19e5c82",
    "prId" : 7584,
    "prUrl" : "https://github.com/apache/kafka/pull/7584#pullrequestreview-306560456",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "917c5053-4f28-48ef-8db7-024c35e6f580",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I had to add this metric scope (a.k.a. store type) for the metrics tags. Now the tags would \r\n```\r\ntype=stream-state-metrics,\r\nthread-id=[threadId],\r\ntask-id=[taskId],\r\nin-memory-suppression-state-id=[storeName]\r\n```",
        "createdAt" : "2019-10-23T12:13:09Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "726c17be-c1af-4752-a3b8-0b6b2a111808",
        "parentId" : "917c5053-4f28-48ef-8db7-024c35e6f580",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "What's the tags look like before?",
        "createdAt" : "2019-10-23T18:05:25Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "153643e9-3d7d-4640-a9e2-44883eb94390",
        "parentId" : "917c5053-4f28-48ef-8db7-024c35e6f580",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "Before it was:\r\n```\r\ntype=stream-buffer-metrics,\r\nclient-id=[threadId]\r\ntask-id=[taskId]\r\nbuffer-id=[storeName]\r\n```",
        "createdAt" : "2019-10-24T13:11:10Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "e5cd569c4b66c0af071eaf7b914f5e1413c34ca8",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +63,67 @@    private static final RecordHeaders V_2_CHANGELOG_HEADERS =\n        new RecordHeaders(new Header[] {new RecordHeader(\"v\", new byte[] {(byte) 2})});\n    private static final String METRIC_SCOPE = \"in-memory-suppression\";\n\n    private final Map<Bytes, BufferKey> index = new HashMap<>();"
  },
  {
    "id" : "36c1ee16-9b26-4c6d-87a7-29b807fde7ba",
    "prId" : 7584,
    "prUrl" : "https://github.com/apache/kafka/pull/7584#pullrequestreview-309250105",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "da6f311b-5730-4932-af62-e4e5f531c86d",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "Metrics for suppression buffers are fetched in this way now.",
        "createdAt" : "2019-10-23T12:20:24Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "eb3e0a0d-14ab-4ac2-9a6e-5608e9df2b8c",
        "parentId" : "da6f311b-5730-4932-af62-e4e5f531c86d",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Sounds good, I think not relying on context but passing in parameters explicitly is fine (if that's what you mean has changed here).",
        "createdAt" : "2019-10-23T18:10:15Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "95f9168d-f01a-42f2-9434-4d1fda6e3381",
        "parentId" : "da6f311b-5730-4932-af62-e4e5f531c86d",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I wanted just to highlight the most important parts of the PR.\r\n\r\nActually, I would prefer to add the thread ID to the context and use the context for the metrics. I have already tried to do it, but I ran into a `ClassCastException` because we cast `ProcessorContext` to `InternalProcessorContext` (which IMO should be changed in future if possible). Using the context instead of explicit parameters makes the signature of the methods more robust. This is rather minor issue atm. ",
        "createdAt" : "2019-10-24T13:22:08Z",
        "updatedAt" : "2019-10-29T13:41:57Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "42de04ea-5066-4179-9e7e-b3491aee1d7c",
        "parentId" : "da6f311b-5730-4932-af62-e4e5f531c86d",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "+1 for adding the thread ID to the context",
        "createdAt" : "2019-10-30T14:33:19Z",
        "updatedAt" : "2019-10-30T15:47:04Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "e5cd569c4b66c0af071eaf7b914f5e1413c34ca8",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +205,209 @@            storeName,\n            streamsMetrics\n        );\n\n        context.register(root, (RecordBatchingStateRestoreCallback) this::restoreBatch);"
  },
  {
    "id" : "4ec294f9-e146-4931-b0b3-36fa9ba44be3",
    "prId" : 8248,
    "prUrl" : "https://github.com/apache/kafka/pull/8248#pullrequestreview-421009611",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f391d6f1-c115-4e4a-8984-c27801b71254",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "One high-level concern I've developed during this review is whether there's any possibility that something like this could leak into the public API. I.e., is it possible that a Processor, Transformer, or StateStore could have cached some reference from the context that would become invalid when the context gets recycled, similar to the way this recordCollector (which is not public, I know) did.\r\n\r\nWhat's your take on that, @ableegoldman ?",
        "createdAt" : "2020-05-28T20:54:50Z",
        "updatedAt" : "2020-05-28T23:49:30Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "92593759-2127-4cf7-91ba-1269048ad5a0",
        "parentId" : "f391d6f1-c115-4e4a-8984-c27801b71254",
        "authorId" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "body" : "Well, only active tasks have a topology, and we don't initialize the topology until everything has been cleanly recycled. So by the time `init` is being called and the context is being used, it should be all up-to-date with the active task references.\r\n\r\nOf course that only applies to the Processor/Transformer half of the question. With StateStores we're obviously still calling `init` for standby tasks, and more. But nothing in the public `ProcessorContext` interface gets recycled. Only the cache, record collector, and StreamTask have to be updated, so this should all be totally transparent (unless they're doing something they shouldn't be)",
        "createdAt" : "2020-05-29T00:10:37Z",
        "updatedAt" : "2020-05-29T00:10:37Z",
        "lastEditedBy" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "tags" : [
        ]
      },
      {
        "id" : "2a254a2a-4cf4-4936-90a5-b485abcb647f",
        "parentId" : "f391d6f1-c115-4e4a-8984-c27801b71254",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Ok. Thanks.",
        "createdAt" : "2020-05-29T14:30:26Z",
        "updatedAt" : "2020-05-29T14:30:27Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "30ac7b3ccd47063497c17ac148d90f9b29683e82",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +260,264 @@        buffer.putLong(bufferKey.time());\n\n        ((RecordCollector.Supplier) context).recordCollector().send(\n                changelogTopic,\n                key,"
  },
  {
    "id" : "4128f4e0-e585-4a66-bc21-62e9c8be9a19",
    "prId" : 8905,
    "prUrl" : "https://github.com/apache/kafka/pull/8905#pullrequestreview-434363525",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8f3236c1-e63b-4ea9-8f32-2169a596f46e",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "On the side, I realized we can consolidate this check and perform it first, rather than after we're already written bad data into the buffer.",
        "createdAt" : "2020-06-19T22:14:54Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5cc0b72f12cb3ee2efb207913240539b1ec1d61",
    "line" : 93,
    "diffHunk" : "@@ -1,1 +302,306 @@                    )\n                );\n            }\n            final Bytes key = Bytes.wrap(record.key());\n            if (record.value() == null) {"
  },
  {
    "id" : "ebd01e0b-1b75-4a9a-968b-df8f88880255",
    "prId" : 8905,
    "prUrl" : "https://github.com/apache/kafka/pull/8905#pullrequestreview-438406189",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "90a4d23e-ee43-48d2-9449-cccb1622db04",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "We don't need to store the whole RecordHeaders for the old versions, just the actual version flag.",
        "createdAt" : "2020-06-26T15:52:36Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5cc0b72f12cb3ee2efb207913240539b1ec1d61",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +69,73 @@    private static final byte[] V_3_CHANGELOG_HEADER_VALUE = {(byte) 3};\n    static final RecordHeaders CHANGELOG_HEADERS =\n        new RecordHeaders(new Header[] {new RecordHeader(\"v\", V_3_CHANGELOG_HEADER_VALUE)});\n    private static final String METRIC_SCOPE = \"in-memory-suppression\";\n"
  },
  {
    "id" : "b53d8cbd-ee9c-4505-9519-1942fd3dc92c",
    "prId" : 8905,
    "prUrl" : "https://github.com/apache/kafka/pull/8905#pullrequestreview-438406189",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c4789e3e-e6ad-4d7a-ac88-56aec09caf79",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "If you look a few lines up, you'll see that we just serialized the \"old value\", so we don't need to serialize it again here.",
        "createdAt" : "2020-06-26T15:58:09Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5cc0b72f12cb3ee2efb207913240539b1ec1d61",
    "line" : 244,
    "diffHunk" : "@@ -1,1 +469,473 @@        final byte[] serializedPriorValue;\n        if (buffered == null) {\n            serializedPriorValue = serialChange.oldValue;\n        } else {\n            serializedPriorValue = buffered.priorValue();"
  },
  {
    "id" : "727baacc-1022-4c53-b211-4123a5333bd0",
    "prId" : 8905,
    "prUrl" : "https://github.com/apache/kafka/pull/8905#pullrequestreview-438406189",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f8324d2b-0a8c-454d-b8fb-2afd1c7b59b8",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "This is the version bump we should have done in 2.4.0. I'll backport this fix to the 2.4 branch.",
        "createdAt" : "2020-06-26T16:08:05Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5cc0b72f12cb3ee2efb207913240539b1ec1d61",
    "line" : 182,
    "diffHunk" : "@@ -1,1 +329,333 @@                    final DeserializationResult deserializationResult = deserializeV0(record, key, previousBufferedValue);\n                    cleanPut(deserializationResult.time(), deserializationResult.key(), deserializationResult.bufferValue());\n                } else if (Arrays.equals(versionHeader.value(), V_3_CHANGELOG_HEADER_VALUE)) {\n                    // Version 3:\n                    // value:"
  },
  {
    "id" : "8ac516e5-b27c-4d25-9d35-99ed2956425e",
    "prId" : 8905,
    "prUrl" : "https://github.com/apache/kafka/pull/8905#pullrequestreview-438655868",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f1a382ad-6b08-4b35-b6e4-12543c777179",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I'm just thinking, maybe we should encode headers to tombstones too in case in the future we changed the semantics of tombstones?",
        "createdAt" : "2020-06-26T18:31:59Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "af16dbe3-d657-44aa-9d4a-407cd1508f9f",
        "parentId" : "f1a382ad-6b08-4b35-b6e4-12543c777179",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I remember considering this when I added the first version header. The reason I didn't is that, since the initial version didn't have any headers, even if we change the tombstone format in the future, we'll always have to interpret a \"no header, null value\" record as being a \"legacy format\" tombstone, just like we have to interpret a \"no header, non-null value\" as being a \"legacy format\" data record.\r\n\r\nYou can think of \"no header\" as indicating \"version 0\". Since we haven't changed the format of tombstones _yet_, there's no value in adding a \"version 1\" flag. We should just wait until we do need to make such a change (if ever).",
        "createdAt" : "2020-06-26T19:17:37Z",
        "updatedAt" : "2020-06-26T23:56:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "2cd685a2-fdb6-4d39-ae08-aca264144d48",
        "parentId" : "f1a382ad-6b08-4b35-b6e4-12543c777179",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "SG",
        "createdAt" : "2020-06-27T00:37:25Z",
        "updatedAt" : "2020-06-27T00:37:26Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "f5cc0b72f12cb3ee2efb207913240539b1ec1d61",
    "line" : 75,
    "diffHunk" : "@@ -1,1 +284,288 @@            key,\n            null,\n            null,\n            partition,\n            null,"
  },
  {
    "id" : "febb0889-55d2-4f1c-9770-8d0f2adc8379",
    "prId" : 9388,
    "prUrl" : "https://github.com/apache/kafka/pull/9388#pullrequestreview-504410548",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "60d72341-da19-4586-9ca5-03fecea89246",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Why not import static the function directly like in other classes?",
        "createdAt" : "2020-10-07T21:32:50Z",
        "updatedAt" : "2020-10-07T22:44:44Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "bdee0754-661a-47d4-954b-65d13710f5f4",
        "parentId" : "60d72341-da19-4586-9ca5-03fecea89246",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Oh, probably just overlooked it.",
        "createdAt" : "2020-10-08T03:51:58Z",
        "updatedAt" : "2020-10-08T03:51:58Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "ab093bc0610dfee1ccfa7199de59e1b2c417a3d0",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +32,36 @@import org.apache.kafka.streams.processor.StateStoreContext;\nimport org.apache.kafka.streams.processor.internals.InternalProcessorContext;\nimport org.apache.kafka.streams.processor.internals.ProcessorContextUtils;\nimport org.apache.kafka.streams.processor.internals.ProcessorRecordContext;\nimport org.apache.kafka.streams.processor.internals.ProcessorStateManager;"
  }
]