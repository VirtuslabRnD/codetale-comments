[
  {
    "id" : "2045aa4f-92f9-466c-908d-92e1f73b664d",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-165332087",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "36f5d4cc-b4f3-4a94-9080-5e4091882303",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Avoid recording metrics if they haven't changed.",
        "createdAt" : "2018-10-16T19:36:41Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 88,
    "diffHunk" : "@@ -1,1 +318,322 @@        if (evictions > 0) {\n            updateBufferMetrics();\n        }\n    }\n"
  },
  {
    "id" : "3f018106-0262-420a-aec4-204707b63e8e",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-175606934",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b3e2ba85-b3dd-4e40-b953-edca1f990db0",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Should we call this in `init()` and/or `close()`, too?",
        "createdAt" : "2018-11-06T22:12:19Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "8b09c19f-dd54-4d79-ac85-8542de0d69d8",
        "parentId" : "b3e2ba85-b3dd-4e40-b953-edca1f990db0",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "sure; I don't think they're strictly necessary, but it doesn't hurt, and it'll make the system more resilient to future changes.",
        "createdAt" : "2018-11-15T23:41:37Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 105,
    "diffHunk" : "@@ -1,1 +376,380 @@    }\n\n    private void updateBufferMetrics() {\n        bufferSizeSensor.record(memBufferSize);\n        bufferCountSensor.record(index.size());"
  },
  {
    "id" : "7eded430-e9b8-47a1-aa95-795ca8664505",
    "prId" : 5795,
    "prUrl" : "https://github.com/apache/kafka/pull/5795#pullrequestreview-175668977",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "In the wiki there is another metric for `suppression-mem-buffer-evict`, is that not in the scope of this PR?",
        "createdAt" : "2018-11-15T02:04:14Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "59cafbaf-d4d3-445f-bbb1-ebcf0a3048dc",
        "parentId" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Ah, now that you mention it, when I originally created this PR, I noticed there were some shortcomings with the metrics I proposed in the KIP, so I wanted to get the reviewers' feedback on the form it has taken in this PR before proposing an update to the KIP.\r\n\r\nIn particular, I proposed an asymmetric pair of metrics where the processor node would measure the number of incoming events (`intermediate-result-suppression`), but the buffer would measure the outgoing (emitted==evicted) events. It seemed better to offer a symmetric pair of in/out metrics on either the processor or the buffer. In this PR, I chose to put them both on the node.\r\n\r\nIn other words, I'm proposing to replace `suppression-mem-buffer-evict` with `suppression-emit`.\r\n\r\nOf course, in this same review, you have proposed to drop `intermediate-result-suppression` in favor of the existing `process-rate` and `process-total` node-level metrics. This reduces the argument, but I *think* it still makes sense to make this a node metric instead of a buffer metric, since (IMHO) it more closely matches the intent of using a suppression *node* to control the emission rate.",
        "createdAt" : "2018-11-15T23:53:51Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "68347e15-a1e7-42f3-8428-e75a48f7119b",
        "parentId" : "633494ce-bfbf-4aff-8f75-466ad9d80bfa",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Thanks for the clarification, that sounds good to me.",
        "createdAt" : "2018-11-16T06:14:44Z",
        "updatedAt" : "2018-11-27T01:22:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "bd8806c91d24ee933ce6e1ab8972e725bf42ef12",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +61,65 @@    private RecordCollector collector;\n    private String changelogTopic;\n    private Sensor bufferSizeSensor;\n    private Sensor bufferCountSensor;\n"
  },
  {
    "id" : "9bd8f468-6b3d-4df5-ba03-5946190f429c",
    "prId" : 5819,
    "prUrl" : "https://github.com/apache/kafka/pull/5819#pullrequestreview-166797510",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "parentId" : null,
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Should we log a warning here and below?",
        "createdAt" : "2018-10-19T23:02:56Z",
        "updatedAt" : "2018-10-20T21:25:17Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      },
      {
        "id" : "9aba22eb-8b71-4b05-b321-09c21703b047",
        "parentId" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I'm not sure I agree with a warning.\r\n\r\nI think it's fine to just ignore the call, since the buffer will behave correctly whether you call these methods or not. In fact, I originally had them no-op, and changed it to throw upon review.\r\n\r\nThere's no publicly facing API to register a buffer, so there's no way that a user could call these methods right now. In fact, the buffer itself is an `internal` class. Therefore, the only way these methods get called are via Streams itself.\r\n\r\nMy thought is that it would be confusing to see warnings that actually indicate nothing is wrong and about which you can do nothing.\r\n\r\nWould you be satisfied with a javadoc explaining the decision?",
        "createdAt" : "2018-10-20T19:59:51Z",
        "updatedAt" : "2018-10-20T21:25:17Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "5e306dd1-1c72-40b9-aa23-02f0e3b596eb",
        "parentId" : "f58cb471-059b-460b-8b3b-52c90ba1da7d",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Yeah, my intent was just some sort of notification to users these methods are ignored, javadoc is fine with me.",
        "createdAt" : "2018-10-21T19:23:50Z",
        "updatedAt" : "2018-10-21T19:23:50Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "e6c42b021c4e4181b8cca7c9296f92e0bbdd2107",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +79,83 @@        @Override\n        public StoreBuilder<StateStore> withCachingEnabled() {\n            return this;\n        }\n"
  }
]