[
  {
    "id" : "8eab6c09-b965-4b8a-8b04-d25839a174a1",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-142992215",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "These changes are a bit tangential, but while looking at the metrics, I realized we were jumping through quite a few hoops to do something simple, so I simplified these latency measurements.",
        "createdAt" : "2018-08-02T18:25:01Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "0bbc6931-1a17-4f5f-8265-3ca012a53dfa",
        "parentId" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I kinda see you point, however, I am wondering if there would be any runtime difference? Should the compiler be smart enough to inline the code and avoid the method calls?",
        "createdAt" : "2018-08-02T20:17:27Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "3d1a0835-6e57-42d8-9ead-539737417539",
        "parentId" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I'm not sure; it's not just a method call, but also a call to an anonymous Runnable instance we created. And one of those referenced (key/value) fields on ProcessorNode (which we put there just to pass to the Runnable). \r\n\r\nThe runtime performance is certainly not slower, but I'd have to profile it to see if it's faster. I'm interested in doing this not so much for the performance gain (which I'd hope is minimal) as for the readability/simplicity, which is significantly improved.",
        "createdAt" : "2018-08-02T21:56:28Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +91,95 @@                processor.init(context);\n            }\n            nodeMetrics.nodeCreationSensor.record(time.nanoseconds() - startNs);\n        } catch (final Exception e) {\n            throw new StreamsException(String.format(\"failed to initialize processor %s\", name), e);"
  },
  {
    "id" : "435f096e-4b68-4086-a70c-2848cd990d55",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-143252165",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "The last two parameters name are confusing: should they just be `allTagMap` and `tagMap`?",
        "createdAt" : "2018-08-02T22:24:44Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "58856efc-10d3-40e4-be93-7917e5b22069",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Note that although processor-level metrics parent with \"task=[taskName], processor-node-id=all\" is actually the same for task-level `task=[taskName]`, today we still record them as two sensors (I have a proposal for cleaning up them in the future).",
        "createdAt" : "2018-08-02T22:28:18Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "0c1bc00e-885c-44af-b0a7-179861d5d336",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I chose those names to match the method name: `createTaskAndNodeLatencyAndThroughputSensors`. Since we are creating \"task\" and \"node\" sensors, we pass in \"task\" and \"node tags.\r\n\r\nI felt that `allTagMap` and `tagMap` weren't self-expanatory enough in this interface.\r\n\r\nNote that previously, we constructed maps with those names in a more generic context, where we didn't know, for example, that the child sensor was actually a \"node\" sensor, so the more generic names made more sense in that context.\r\n\r\nIf you're proposing to remove the `processor-node-id=all` tag for the rollup metric in the future, I would support that.",
        "createdAt" : "2018-08-03T15:01:50Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "84bbbdc0-48d1-4ac7-be5a-cab48978fa8d",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Yes I do propose it, but it would require a KIP, and I'd want to keep this PR small :)",
        "createdAt" : "2018-08-03T16:36:02Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 223,
    "diffHunk" : "@@ -1,1 +235,239 @@                                                                           final String taskName,\n                                                                           final String processorNodeName,\n                                                                           final Map<String, String> taskTags,\n                                                                           final Map<String, String> nodeTags) {\n            final Sensor parent = metrics.taskLevelSensor(taskName, operation, Sensor.RecordingLevel.DEBUG);"
  },
  {
    "id" : "ed5b70a6-2e31-4f22-a212-c115d5c75b4d",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-143249054",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "047fded3-4102-44b6-8b21-09ae0515d596",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I've added the destruction sensor back with this note to future-us.",
        "createdAt" : "2018-08-03T16:25:42Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 173,
    "diffHunk" : "@@ -1,1 +201,205 @@            );\n\n            // note: this metric can be removed in the future, as it is only recorded before being immediately removed\n            nodeDestructionSensor = createTaskAndNodeLatencyAndThroughputSensors(\n                \"destroy\","
  },
  {
    "id" : "eca4e8cd-fc71-4853-a546-9abf0c1ff893",
    "prId" : 7615,
    "prUrl" : "https://github.com/apache/kafka/pull/7615#pullrequestreview-309108665",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d0d7c7ce-c581-483a-8baf-47b8cdf80b47",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "Measurement of latency is consolidated where possible.",
        "createdAt" : "2019-10-30T10:51:34Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "1bbee5afd4d93346c5bac0afe2c5962365ad431e",
    "line" : 77,
    "diffHunk" : "@@ -1,1 +100,104 @@                time,\n                createSensor\n            );\n        } catch (final Exception e) {\n            throw new StreamsException(String.format(\"failed to initialize processor %s\", name), e);"
  },
  {
    "id" : "794dfc94-e576-4dac-8078-894656d3ab6c",
    "prId" : 7615,
    "prUrl" : "https://github.com/apache/kafka/pull/7615#pullrequestreview-311140178",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d273eb00-843b-468c-9841-6c8389f6bd1b",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Hmm, I'm wondering for empty sensor, are we incurring unnecessary overhead calling its `record` function?",
        "createdAt" : "2019-11-01T23:50:32Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "8fa9bd6a-2777-499c-833c-39e7a6fc7112",
        "parentId" : "d273eb00-843b-468c-9841-6c8389f6bd1b",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "For create / destroy maybe that's okay, but `process` is at the very critical path so we have to be careful not to incur any overhead.",
        "createdAt" : "2019-11-01T23:54:43Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "10d0f74e-4691-41ec-ad97-7d8f0bd056c5",
        "parentId" : "d273eb00-843b-468c-9841-6c8389f6bd1b",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I changed the code to only measure latency if the built-in metrics version is `0.100-2.4`. Nevertheless, out of curiosity I would like to measure the overhead of calling record on an empty sensor.",
        "createdAt" : "2019-11-04T15:36:33Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "1bbee5afd4d93346c5bac0afe2c5962365ad431e",
    "line" : 76,
    "diffHunk" : "@@ -1,1 +99,103 @@                },\n                time,\n                createSensor\n            );\n        } catch (final Exception e) {"
  },
  {
    "id" : "f812a0ce-972a-400d-bee7-641a1f2d577a",
    "prId" : 7615,
    "prUrl" : "https://github.com/apache/kafka/pull/7615#pullrequestreview-316921301",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "69baeead-bac0-428c-9648-b131be5dd3a6",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "See my other comment: in `maybeMeasureLatency`, should we also check if the sensor is an empty sensor as well?",
        "createdAt" : "2019-11-02T00:13:30Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "776e5788-da2c-4a15-9792-06d4e1f7f47f",
        "parentId" : "69baeead-bac0-428c-9648-b131be5dd3a6",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I haven't found a way to check if a sensor is empty or not.",
        "createdAt" : "2019-11-04T15:38:52Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "1d86e2d1-a08f-41c8-aadf-1f036c2db8b1",
        "parentId" : "69baeead-bac0-428c-9648-b131be5dd3a6",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "How about this: in `Sensor` we expose a public function `hasStats` which checks if its `stats` is empty or not. If it is empty then it means no `sensor.add` has ever triggered yet (e.g. all the `emptySensor` would be the case), in which case we can skip measuring at all. By doing this we can also remove the extra check on the caller for the config value --- i.e. we consolidate the logic to be independent of the config, but only relying on the sensor's `stats` map.",
        "createdAt" : "2019-11-06T02:04:22Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "8410a75d-18ff-4208-b468-f4d3c66e4673",
        "parentId" : "69baeead-bac0-428c-9648-b131be5dd3a6",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "Good idea! I opened PR #7692 for the new method on `Sensor`. Could you have a look at it?",
        "createdAt" : "2019-11-14T12:38:40Z",
        "updatedAt" : "2019-11-15T12:01:14Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "1bbee5afd4d93346c5bac0afe2c5962365ad431e",
    "line" : 140,
    "diffHunk" : "@@ -1,1 +159,163 @@\n    public void punctuate(final long timestamp, final Punctuator punctuator) {\n        maybeMeasureLatency(() -> punctuator.punctuate(timestamp), time, punctuateSensor);\n    }\n"
  },
  {
    "id" : "42c3d259-2093-4a78-a033-f6174bfa7efd",
    "prId" : 9083,
    "prUrl" : "https://github.com/apache/kafka/pull/9083#pullrequestreview-489236241",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "33054957-aaf7-4182-9407-5d3b982d2c49",
        "parentId" : null,
        "authorId" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "body" : "Should we `throwIfClosed()` at the beginning of `close()` too?",
        "createdAt" : "2020-09-16T02:55:01Z",
        "updatedAt" : "2020-09-23T21:32:12Z",
        "lastEditedBy" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "tags" : [
        ]
      }
    ],
    "commit" : "e2ca04a7452c3aa18a4995e8a8c8a65d3a5354ed",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +158,162 @@                name\n            );\n        } catch (final Exception e) {\n            throw new StreamsException(String.format(\"failed to close processor %s\", name), e);\n        }"
  },
  {
    "id" : "bfce628e-18ca-4ef2-bf0b-0bbbc7e61ec8",
    "prId" : 9083,
    "prUrl" : "https://github.com/apache/kafka/pull/9083#pullrequestreview-492169914",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c1a44658-7162-466b-bc7d-3606acf2e150",
        "parentId" : null,
        "authorId" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "body" : "Should we assert that it's in `closed` when `init` is called?",
        "createdAt" : "2020-09-16T02:58:08Z",
        "updatedAt" : "2020-09-23T21:32:12Z",
        "lastEditedBy" : "d97f50bf-60f9-45b3-81a0-a24a5f42f740",
        "tags" : [
        ]
      },
      {
        "id" : "a24f73b2-8718-41ea-bda0-b1fd08525952",
        "parentId" : "c1a44658-7162-466b-bc7d-3606acf2e150",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "SG.",
        "createdAt" : "2020-09-20T03:42:48Z",
        "updatedAt" : "2020-09-23T21:32:12Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "e2ca04a7452c3aa18a4995e8a8c8a65d3a5354ed",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +127,131 @@        // revived tasks could re-initialize the topology,\n        // in which case we should reset the flag\n        closed = false;\n    }\n"
  }
]