[
  {
    "id" : "8eab6c09-b965-4b8a-8b04-d25839a174a1",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-142992215",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "These changes are a bit tangential, but while looking at the metrics, I realized we were jumping through quite a few hoops to do something simple, so I simplified these latency measurements.",
        "createdAt" : "2018-08-02T18:25:01Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "0bbc6931-1a17-4f5f-8265-3ca012a53dfa",
        "parentId" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I kinda see you point, however, I am wondering if there would be any runtime difference? Should the compiler be smart enough to inline the code and avoid the method calls?",
        "createdAt" : "2018-08-02T20:17:27Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "3d1a0835-6e57-42d8-9ead-539737417539",
        "parentId" : "dcbd3f7a-bbf5-4f79-a764-f9e1bd488b8e",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I'm not sure; it's not just a method call, but also a call to an anonymous Runnable instance we created. And one of those referenced (key/value) fields on ProcessorNode (which we put there just to pass to the Runnable). \r\n\r\nThe runtime performance is certainly not slower, but I'd have to profile it to see if it's faster. I'm interested in doing this not so much for the performance gain (which I'd hope is minimal) as for the readability/simplicity, which is significantly improved.",
        "createdAt" : "2018-08-02T21:56:28Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +91,95 @@                processor.init(context);\n            }\n            nodeMetrics.nodeCreationSensor.record(time.nanoseconds() - startNs);\n        } catch (final Exception e) {\n            throw new StreamsException(String.format(\"failed to initialize processor %s\", name), e);"
  },
  {
    "id" : "435f096e-4b68-4086-a70c-2848cd990d55",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-143252165",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "The last two parameters name are confusing: should they just be `allTagMap` and `tagMap`?",
        "createdAt" : "2018-08-02T22:24:44Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "58856efc-10d3-40e4-be93-7917e5b22069",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Note that although processor-level metrics parent with \"task=[taskName], processor-node-id=all\" is actually the same for task-level `task=[taskName]`, today we still record them as two sensors (I have a proposal for cleaning up them in the future).",
        "createdAt" : "2018-08-02T22:28:18Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "0c1bc00e-885c-44af-b0a7-179861d5d336",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I chose those names to match the method name: `createTaskAndNodeLatencyAndThroughputSensors`. Since we are creating \"task\" and \"node\" sensors, we pass in \"task\" and \"node tags.\r\n\r\nI felt that `allTagMap` and `tagMap` weren't self-expanatory enough in this interface.\r\n\r\nNote that previously, we constructed maps with those names in a more generic context, where we didn't know, for example, that the child sensor was actually a \"node\" sensor, so the more generic names made more sense in that context.\r\n\r\nIf you're proposing to remove the `processor-node-id=all` tag for the rollup metric in the future, I would support that.",
        "createdAt" : "2018-08-03T15:01:50Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "84bbbdc0-48d1-4ac7-be5a-cab48978fa8d",
        "parentId" : "ca848cc5-4048-49c2-9fa6-775141c836b2",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Yes I do propose it, but it would require a KIP, and I'd want to keep this PR small :)",
        "createdAt" : "2018-08-03T16:36:02Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 223,
    "diffHunk" : "@@ -1,1 +235,239 @@                                                                           final String taskName,\n                                                                           final String processorNodeName,\n                                                                           final Map<String, String> taskTags,\n                                                                           final Map<String, String> nodeTags) {\n            final Sensor parent = metrics.taskLevelSensor(taskName, operation, Sensor.RecordingLevel.DEBUG);"
  },
  {
    "id" : "ed5b70a6-2e31-4f22-a212-c115d5c75b4d",
    "prId" : 5450,
    "prUrl" : "https://github.com/apache/kafka/pull/5450#pullrequestreview-143249054",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "047fded3-4102-44b6-8b21-09ae0515d596",
        "parentId" : null,
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I've added the destruction sensor back with this note to future-us.",
        "createdAt" : "2018-08-03T16:25:42Z",
        "updatedAt" : "2018-08-03T22:17:02Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "b590af4726d2e4fc3bf1186676f6f9015388cd3e",
    "line" : 173,
    "diffHunk" : "@@ -1,1 +201,205 @@            );\n\n            // note: this metric can be removed in the future, as it is only recorded before being immediately removed\n            nodeDestructionSensor = createTaskAndNodeLatencyAndThroughputSensors(\n                \"destroy\","
  }
]