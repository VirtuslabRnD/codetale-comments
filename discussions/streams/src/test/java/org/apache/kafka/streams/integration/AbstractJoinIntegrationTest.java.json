[
  {
    "id" : "2b090a30-daa1-4cae-b9b9-c3cbe9d0490d",
    "prId" : 5418,
    "prUrl" : "https://github.com/apache/kafka/pull/5418#pullrequestreview-140035396",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Can you elaborate why this fixed the test?",
        "createdAt" : "2018-07-24T01:47:00Z",
        "updatedAt" : "2018-07-24T01:48:00Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "ce57fd53-6d88-41a3-a1d4-69a98de11a92",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I'm not 100 percent sure what's the race condition here, and why it fixes the test.",
        "createdAt" : "2018-07-24T15:43:07Z",
        "updatedAt" : "2018-07-24T15:43:07Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "69836852-8a9b-4934-8760-b70dbde62076",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "To be frank, I am not sure about the root-cause. Parameterized StreamStreamJoinIntegrationTest tests are passing for `cacheEnabled=true`  and intermittently failing for parameter `cacheEnabled=false`.\r\n\r\nI thought we may not be cleaning some intermediate topics/change-log/? topics between parameterized runs. So I tried deleting all topics including offsets topics. With this I am not able to reproduce the failures.\r\n\r\nI may be totally wrong.  I'll spend some more time to understand the tests and debug the issue.",
        "createdAt" : "2018-07-24T15:53:00Z",
        "updatedAt" : "2018-07-24T15:53:00Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "4b00bd3b-9fd4-4d6e-9b42-a3040027d747",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "@omkreddy Were you be able to reproduce the issue locally before this PR?",
        "createdAt" : "2018-07-24T16:19:33Z",
        "updatedAt" : "2018-07-24T16:19:33Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "ba33fa44-419a-41b7-b179-623a6a1d87ad",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "Yes, I am able to reproduce the failures on my machine. ",
        "createdAt" : "2018-07-24T16:25:31Z",
        "updatedAt" : "2018-07-24T16:25:32Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "7fd97059-16a5-4993-9d4e-688def056e98",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "It seems we are using the same application id twice in `StreamStreamJoinIntegartionTest`\r\n```\r\nSTREAMS_CONFIG.put(StreamsConfig.APPLICATION_ID_CONFIG, appID + \"-outer\");\r\n```\r\nThis might be the root case -- deleting all topics would solve the issue, too, as it prevent to start with a corrupted state.",
        "createdAt" : "2018-07-24T18:12:36Z",
        "updatedAt" : "2018-07-24T18:12:37Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "c0a2bd82-00e5-4b0a-82e5-bf29232e1a95",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I seems that `TableTableJoinIntegrationTest` has a similar issue...",
        "createdAt" : "2018-07-24T18:13:57Z",
        "updatedAt" : "2018-07-24T18:13:57Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "07d3e77c-01e7-4e04-b891-bfdc8ca5900a",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "Ok..  Yes,  I have observed failures with TableTableJoinIntegrationTest too. Shall I update the  appId? ",
        "createdAt" : "2018-07-24T18:18:38Z",
        "updatedAt" : "2018-07-24T18:26:19Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "967e30fa-9b12-4033-9981-45ab03426b99",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "One thing I can think of is that the changelog topic of the joining streams's materialized stores were not deleted, and hence upon starting on the next test case, the store would be pre-populated and hence cause join result to be wrong (note that the state dir is a `@Rule` which means it will get cleaned up on each test case, and in the next run it will not be the same directory path).\r\n\r\nAnd the reason that it does not always fail is that we have to hit it that the two tests (with and without caching) consecutively.\r\n\r\nSo think with your fix in `2.0` and `trunk`, it is Okay to leave the appID as is for now. ",
        "createdAt" : "2018-07-24T19:02:42Z",
        "updatedAt" : "2018-07-24T19:02:42Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "7f143f7c-dfa2-4338-887d-67ac7beb425b",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Just ran some more tests locally to confirm my suspicion. ",
        "createdAt" : "2018-07-24T19:03:02Z",
        "updatedAt" : "2018-07-24T19:03:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "b1db38f66f02a63fc756050ffa2a8c8ac2212d94",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +164,168 @@    @After\n    public void cleanup() throws InterruptedException {\n        CLUSTER.deleteAllTopicsAndWait(120000);\n    }\n"
  },
  {
    "id" : "9b7da143-08a0-4214-b525-ab1141aed55d",
    "prId" : 7722,
    "prUrl" : "https://github.com/apache/kafka/pull/7722#pullrequestreview-320187229",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a2712b6f-245d-493f-a3d7-15cc6aea3116",
        "parentId" : null,
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Added these two methods for the initial conversion of `StreamTableJoinIntegrationTest`.  As the other tests are converted over the other methods in this class needed for running the tests with the embedded broker will be removed.",
        "createdAt" : "2019-11-20T18:38:39Z",
        "updatedAt" : "2019-11-20T18:40:20Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "38190f78928a95f68fb11bcce968bd3b2c7e7e55",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +196,200 @@\n\n    void runTestWithDriver(final List<List<TestRecord<Long, String>>> expectedResult) {\n        runTestWithDriver(expectedResult, null);\n    }"
  },
  {
    "id" : "9c039933-d451-42d4-ab3b-f2be322b3c80",
    "prId" : 7722,
    "prUrl" : "https://github.com/apache/kafka/pull/7722#pullrequestreview-320187229",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "86fc5e60-9a8c-46f8-bb42-dd8b2268b331",
        "parentId" : null,
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "The idea here is to use the existing test logic and simply use the TTD vs. the embedded broker.  No test logic was changed.",
        "createdAt" : "2019-11-20T18:39:27Z",
        "updatedAt" : "2019-11-20T18:40:20Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "38190f78928a95f68fb11bcce968bd3b2c7e7e55",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +201,205 @@\n    void runTestWithDriver(final List<List<TestRecord<Long, String>>> expectedResult, final String storeName) {\n        try (final TopologyTestDriver driver = new TopologyTestDriver(builder.build(STREAMS_CONFIG), STREAMS_CONFIG)) {\n            final TestInputTopic<Long, String> right = driver.createInputTopic(INPUT_TOPIC_RIGHT, new LongSerializer(), new StringSerializer());\n            final TestInputTopic<Long, String> left = driver.createInputTopic(INPUT_TOPIC_LEFT, new LongSerializer(), new StringSerializer());"
  },
  {
    "id" : "4b39c6b9-b29a-4582-892e-0262fe83902f",
    "prId" : 7777,
    "prUrl" : "https://github.com/apache/kafka/pull/7777#pullrequestreview-327669144",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a6a71273-2eed-4e96-9fe7-475336f38ccc",
        "parentId" : null,
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "This is still needed.  We have a couple of tests (non-processing) that start a Kafka Streams application and need the topics to exist, hence we delete them here.",
        "createdAt" : "2019-12-04T16:02:14Z",
        "updatedAt" : "2019-12-05T17:34:22Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      },
      {
        "id" : "eda62749-674c-4236-b2aa-b01ecad07ee5",
        "parentId" : "a6a71273-2eed-4e96-9fe7-475336f38ccc",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "Q: Does this mean, we still start an embedded Kafka before each test? Is it possible to start an embedded Kafka only in the tests that need it? ",
        "createdAt" : "2019-12-04T17:18:47Z",
        "updatedAt" : "2019-12-05T17:34:22Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "a87406cd-ca38-459e-b843-4b6d93a7a0c8",
        "parentId" : "a6a71273-2eed-4e96-9fe7-475336f38ccc",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "+1",
        "createdAt" : "2019-12-04T18:30:59Z",
        "updatedAt" : "2019-12-05T17:34:22Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "ff3b6203-dc93-46d4-a4ae-629fc8be1ea2",
        "parentId" : "a6a71273-2eed-4e96-9fe7-475336f38ccc",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "I attempted to do that initially, but the logic for using the embedded broker is scattered throughout the base class.  There are only two single test methods from all the sub-classes requiring the embedded broker, and these tests don't perform joins.  My preference is to merge this PR as is and do a follow-up PR https://issues.apache.org/jira/browse/KAFKA-9273 to refactor the single test methods requiring an embedded broker into a separate class. \r\n\r\nWDYT?",
        "createdAt" : "2019-12-05T16:10:17Z",
        "updatedAt" : "2019-12-05T17:34:39Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "502526b2f42780b8b8be01b29bac623fbec8d471",
    "line" : 107,
    "diffHunk" : "@@ -1,1 +144,148 @@    @After\n    public void cleanup() throws InterruptedException {\n        CLUSTER.deleteAllTopicsAndWait(120000);\n    }\n"
  },
  {
    "id" : "ab3eb8de-fc1e-4f9e-b1da-935683b5f42d",
    "prId" : 7777,
    "prUrl" : "https://github.com/apache/kafka/pull/7777#pullrequestreview-327669144",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5bbca39d-6ec9-4831-b2f1-d913a018aace",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "prop: Would it make sense to also have an overload with just a flat list, i.e.,\r\n```\r\nvoid runTestWithDriver(final List<TestRecord<Long, String>> expectedResult)\r\n```\r\nMaybe it would simplify the code of some of the tests. Hopefully, you can share some of the code in the overloads.",
        "createdAt" : "2019-12-04T17:01:12Z",
        "updatedAt" : "2019-12-05T17:34:22Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      },
      {
        "id" : "4f5bb1a8-04a9-4603-9060-d68e06b305d7",
        "parentId" : "5bbca39d-6ec9-4831-b2f1-d913a018aace",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "Maybe, but as the `List<List<..>>` represents the expected results from a join without caching enabled (multiple results) I think that will require a refactoring of the entire test(s). This logic was pre-existing from the original test.  Giving that this PR is to convert from using the embedded broker to the TTD to perform the joins, I'd prefer to do the refactoring in a separate PR. ",
        "createdAt" : "2019-12-05T16:16:26Z",
        "updatedAt" : "2019-12-05T17:34:39Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      }
    ],
    "commit" : "502526b2f42780b8b8be01b29bac623fbec8d471",
    "line" : 129,
    "diffHunk" : "@@ -1,1 +147,151 @@    }\n\n    void runTestWithDriver(final List<List<TestRecord<Long, String>>> expectedResult) {\n        runTestWithDriver(expectedResult, null);\n    }"
  },
  {
    "id" : "344bc01f-69f1-4fda-9677-e97a9b54bf5d",
    "prId" : 7777,
    "prUrl" : "https://github.com/apache/kafka/pull/7777#pullrequestreview-327850874",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9bd1d7c1-4187-4b88-a059-3fb4b5637889",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "This is not introduced in this PR but in the existing `runTestWithDriver` we never use the passed in storeName it seems, and also the local `expectedFinalResult` are not used. Is that intentional?",
        "createdAt" : "2019-12-04T18:34:09Z",
        "updatedAt" : "2019-12-05T17:34:22Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "c405c9ee-327a-4b9e-89e2-141ddaabf7b6",
        "parentId" : "9bd1d7c1-4187-4b88-a059-3fb4b5637889",
        "authorId" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "body" : "The `TableTableJoinIntegrationTest` passes in the store name as a parameter and it's used on line 218.\r\n The test uses the `expectedFinalResult ` parameter on lines 205-210.  Having said that, this test could use an overall refactoring (cf https://issues.apache.org/jira/browse/KAFKA-9273), but I'd prefer to do so in a follow-up PR.\r\nWDYT?",
        "createdAt" : "2019-12-05T16:26:39Z",
        "updatedAt" : "2019-12-05T17:34:40Z",
        "lastEditedBy" : "4c968502-bb3d-46ee-8719-0c0bdbc6242f",
        "tags" : [
        ]
      },
      {
        "id" : "d5d544d0-7844-4ad9-a59f-76d36ec31a17",
        "parentId" : "9bd1d7c1-4187-4b88-a059-3fb4b5637889",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Okay, sounds fine.",
        "createdAt" : "2019-12-05T21:03:19Z",
        "updatedAt" : "2019-12-05T21:03:19Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "502526b2f42780b8b8be01b29bac623fbec8d471",
    "line" : 210,
    "diffHunk" : "@@ -1,1 +188,192 @@    }\n\n    void runTestWithDriver(final TestRecord<Long, String> expectedFinalResult, final String storeName) throws InterruptedException {\n        try (final TopologyTestDriver driver = new TopologyTestDriver(builder.build(STREAMS_CONFIG), STREAMS_CONFIG)) {\n            final TestInputTopic<Long, String> right = driver.createInputTopic(INPUT_TOPIC_RIGHT, new LongSerializer(), new StringSerializer());"
  }
]