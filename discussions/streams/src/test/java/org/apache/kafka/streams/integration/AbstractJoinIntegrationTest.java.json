[
  {
    "id" : "2b090a30-daa1-4cae-b9b9-c3cbe9d0490d",
    "prId" : 5418,
    "prUrl" : "https://github.com/apache/kafka/pull/5418#pullrequestreview-140035396",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Can you elaborate why this fixed the test?",
        "createdAt" : "2018-07-24T01:47:00Z",
        "updatedAt" : "2018-07-24T01:48:00Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "ce57fd53-6d88-41a3-a1d4-69a98de11a92",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I'm not 100 percent sure what's the race condition here, and why it fixes the test.",
        "createdAt" : "2018-07-24T15:43:07Z",
        "updatedAt" : "2018-07-24T15:43:07Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "69836852-8a9b-4934-8760-b70dbde62076",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "To be frank, I am not sure about the root-cause. Parameterized StreamStreamJoinIntegrationTest tests are passing for `cacheEnabled=true`  and intermittently failing for parameter `cacheEnabled=false`.\r\n\r\nI thought we may not be cleaning some intermediate topics/change-log/? topics between parameterized runs. So I tried deleting all topics including offsets topics. With this I am not able to reproduce the failures.\r\n\r\nI may be totally wrong.  I'll spend some more time to understand the tests and debug the issue.",
        "createdAt" : "2018-07-24T15:53:00Z",
        "updatedAt" : "2018-07-24T15:53:00Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "4b00bd3b-9fd4-4d6e-9b42-a3040027d747",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "@omkreddy Were you be able to reproduce the issue locally before this PR?",
        "createdAt" : "2018-07-24T16:19:33Z",
        "updatedAt" : "2018-07-24T16:19:33Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "ba33fa44-419a-41b7-b179-623a6a1d87ad",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "Yes, I am able to reproduce the failures on my machine. ",
        "createdAt" : "2018-07-24T16:25:31Z",
        "updatedAt" : "2018-07-24T16:25:32Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "7fd97059-16a5-4993-9d4e-688def056e98",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "It seems we are using the same application id twice in `StreamStreamJoinIntegartionTest`\r\n```\r\nSTREAMS_CONFIG.put(StreamsConfig.APPLICATION_ID_CONFIG, appID + \"-outer\");\r\n```\r\nThis might be the root case -- deleting all topics would solve the issue, too, as it prevent to start with a corrupted state.",
        "createdAt" : "2018-07-24T18:12:36Z",
        "updatedAt" : "2018-07-24T18:12:37Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "c0a2bd82-00e5-4b0a-82e5-bf29232e1a95",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I seems that `TableTableJoinIntegrationTest` has a similar issue...",
        "createdAt" : "2018-07-24T18:13:57Z",
        "updatedAt" : "2018-07-24T18:13:57Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "07d3e77c-01e7-4e04-b891-bfdc8ca5900a",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "915b2f67-05e6-4824-939a-398e7be58870",
        "body" : "Ok..  Yes,  I have observed failures with TableTableJoinIntegrationTest too. Shall I update the  appId? ",
        "createdAt" : "2018-07-24T18:18:38Z",
        "updatedAt" : "2018-07-24T18:26:19Z",
        "lastEditedBy" : "915b2f67-05e6-4824-939a-398e7be58870",
        "tags" : [
        ]
      },
      {
        "id" : "967e30fa-9b12-4033-9981-45ab03426b99",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "One thing I can think of is that the changelog topic of the joining streams's materialized stores were not deleted, and hence upon starting on the next test case, the store would be pre-populated and hence cause join result to be wrong (note that the state dir is a `@Rule` which means it will get cleaned up on each test case, and in the next run it will not be the same directory path).\r\n\r\nAnd the reason that it does not always fail is that we have to hit it that the two tests (with and without caching) consecutively.\r\n\r\nSo think with your fix in `2.0` and `trunk`, it is Okay to leave the appID as is for now. ",
        "createdAt" : "2018-07-24T19:02:42Z",
        "updatedAt" : "2018-07-24T19:02:42Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "7f143f7c-dfa2-4338-887d-67ac7beb425b",
        "parentId" : "8f738b55-fe2f-45c8-8bfb-afdff7c93de7",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Just ran some more tests locally to confirm my suspicion. ",
        "createdAt" : "2018-07-24T19:03:02Z",
        "updatedAt" : "2018-07-24T19:03:02Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "b1db38f66f02a63fc756050ffa2a8c8ac2212d94",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +164,168 @@    @After\n    public void cleanup() throws InterruptedException {\n        CLUSTER.deleteAllTopicsAndWait(120000);\n    }\n"
  }
]