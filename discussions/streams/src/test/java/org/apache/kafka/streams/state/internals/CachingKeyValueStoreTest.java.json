[
  {
    "id" : "b03c5bd7-a041-4f6e-aed3-5c003075a5d8",
    "prId" : 6191,
    "prUrl" : "https://github.com/apache/kafka/pull/6191#pullrequestreview-198402550",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e96958dc-5d77-4a5d-bb14-46928c4c65f5",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "The augmented unit tests here and below are for 1) demonstrating the optimization, 2) demonstrating the bug fix as well.",
        "createdAt" : "2019-01-31T02:37:14Z",
        "updatedAt" : "2019-02-13T06:01:27Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "8fef77ba1a948117f4218a8ae8b96a8cd924e8e7",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +183,187 @@        store.put(bytesKey(\"1\"), bytesValue(\"a\"));\n        store.flush();\n        assertEquals(\"a\", cacheFlushListener.forwarded.get(\"1\").newValue);\n        assertNull(cacheFlushListener.forwarded.get(\"1\").oldValue);\n        store.put(bytesKey(\"1\"), bytesValue(\"b\"));"
  },
  {
    "id" : "5a4b8b99-3153-4ec6-aaf1-fb10910064fb",
    "prId" : 6191,
    "prUrl" : "https://github.com/apache/kafka/pull/6191#pullrequestreview-202849795",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a06b729-b7eb-4cb6-ab01-5e49b6a86a65",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I think we should do a third put `store.put(bytesKey(\"1\"), bytesValue(\"c\"));` here and test if old value is `a` and new value is `c` to make sure we return the correct old value -- with 2 puts, it's unclear it it's correct. (If would be incorrect if oldValue would be `b`)",
        "createdAt" : "2019-02-12T01:29:59Z",
        "updatedAt" : "2019-02-13T06:01:27Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "2704072c-5a04-4894-b485-2ef8f17b88ed",
        "parentId" : "0a06b729-b7eb-4cb6-ab01-5e49b6a86a65",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "Ack.",
        "createdAt" : "2019-02-12T19:01:18Z",
        "updatedAt" : "2019-02-13T06:01:27Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "8fef77ba1a948117f4218a8ae8b96a8cd924e8e7",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +185,189 @@        assertEquals(\"a\", cacheFlushListener.forwarded.get(\"1\").newValue);\n        assertNull(cacheFlushListener.forwarded.get(\"1\").oldValue);\n        store.put(bytesKey(\"1\"), bytesValue(\"b\"));\n        store.put(bytesKey(\"1\"), bytesValue(\"c\"));\n        store.flush();"
  },
  {
    "id" : "a4530759-e4cb-4efd-bb96-efdd823eee80",
    "prId" : 8368,
    "prUrl" : "https://github.com/apache/kafka/pull/8368#pullrequestreview-383268570",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "299c1ade-7c76-459f-98df-ad3fe3ba1e76",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Why not throw a general `RuntimeException` but a NPE?",
        "createdAt" : "2020-03-27T23:16:27Z",
        "updatedAt" : "2020-03-28T01:19:57Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "4addac51-2390-4f78-8cfe-ceb6a88e37b3",
        "parentId" : "299c1ade-7c76-459f-98df-ad3fe3ba1e76",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "This was Bruno's test; I just left them alone.",
        "createdAt" : "2020-03-27T23:20:56Z",
        "updatedAt" : "2020-03-28T01:19:57Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "e8efbd89-79e6-4ad5-9831-50418b5c76cc",
        "parentId" : "299c1ade-7c76-459f-98df-ad3fe3ba1e76",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "This was poorly stated, what I meant was that I was reluctant to change parts of the PR that had already been approved.",
        "createdAt" : "2020-03-28T01:11:52Z",
        "updatedAt" : "2020-03-28T01:19:57Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "9d67f1a9b39ab41874c2c702eb4cce011afc2560",
    "line" : 43,
    "diffHunk" : "@@ -1,1 +126,130 @@        setUpCloseTests();\n        cache.flush(CACHE_NAMESPACE);\n        EasyMock.expectLastCall().andThrow(new NullPointerException(\"Simulating an error on flush\"));\n        EasyMock.replay(cache);\n        EasyMock.reset(underlyingStore);"
  },
  {
    "id" : "fa6d33fe-862a-46da-b85e-46bbf4ede41f",
    "prId" : 8368,
    "prUrl" : "https://github.com/apache/kafka/pull/8368#pullrequestreview-383248155",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "84155adb-cdca-41e7-9602-60b320da8acb",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "Why not use `assertThrows` ?",
        "createdAt" : "2020-03-27T23:17:13Z",
        "updatedAt" : "2020-03-28T01:19:57Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      }
    ],
    "commit" : "9d67f1a9b39ab41874c2c702eb4cce011afc2560",
    "line" : 50,
    "diffHunk" : "@@ -1,1 +133,137 @@\n        try {\n            store.close();\n        } catch (final RuntimeException exception) {\n            EasyMock.verify(underlyingStore);"
  },
  {
    "id" : "bcf077f4-2a14-4ac5-8ebe-f30c2d72e58e",
    "prId" : 8368,
    "prUrl" : "https://github.com/apache/kafka/pull/8368#pullrequestreview-383655047",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b86928b8-1435-4ee7-9f3e-c3c4a5b9e55b",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "What do we actually test here? Closing the underlying store is the last thing we do, so it does not affect the happy path of flushing/closing the cache (what we verify at the end). Not sure what the value of this test is?",
        "createdAt" : "2020-03-27T23:21:54Z",
        "updatedAt" : "2020-03-28T01:19:57Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "ce279344-f12d-4ac7-86c2-e17645f0fa18",
        "parentId" : "b86928b8-1435-4ee7-9f3e-c3c4a5b9e55b",
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I see what you mean. IMO we should test also this, because tests are also here to make refactoring safe. Let's assume somebody changes the order of the closes, we would still have a check. ",
        "createdAt" : "2020-03-30T08:58:18Z",
        "updatedAt" : "2020-03-30T08:58:19Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "9d67f1a9b39ab41874c2c702eb4cce011afc2560",
    "line" : 84,
    "diffHunk" : "@@ -1,1 +158,162 @@\n    @Test\n    public void shouldCloseCacheAfterErrorDuringStateStoreClose() {\n        setUpCloseTests();\n        EasyMock.reset(cache);"
  },
  {
    "id" : "33c06c9e-c3ec-46dd-b968-2f434ae2a0d5",
    "prId" : 8386,
    "prUrl" : "https://github.com/apache/kafka/pull/8386#pullrequestreview-383798419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b22eaa31-42ef-45ad-8b7e-3e8e5d4d4a47",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I added the check for the exception.",
        "createdAt" : "2020-03-30T12:22:20Z",
        "updatedAt" : "2020-03-30T12:23:40Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "15157c0c05f0d883e6db1791936d8f0db17fa7a5",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +134,138 @@        EasyMock.replay(underlyingStore);\n\n        assertThrows(RuntimeException.class, store::close);\n        EasyMock.verify(cache, underlyingStore);\n    }"
  },
  {
    "id" : "92c69c0f-35a2-497d-985b-8ea32763c3f8",
    "prId" : 8386,
    "prUrl" : "https://github.com/apache/kafka/pull/8386#pullrequestreview-383798419",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c99032b6-63c4-4524-b7f2-35f58a88cd31",
        "parentId" : null,
        "authorId" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "body" : "I added the verification for the call to `close()` of underlying store and cache. ",
        "createdAt" : "2020-03-30T12:23:17Z",
        "updatedAt" : "2020-03-30T12:23:40Z",
        "lastEditedBy" : "b7cbfdaf-f3e2-4130-8254-501ace9562ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "15157c0c05f0d883e6db1791936d8f0db17fa7a5",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +135,139 @@\n        assertThrows(RuntimeException.class, store::close);\n        EasyMock.verify(cache, underlyingStore);\n    }\n"
  }
]