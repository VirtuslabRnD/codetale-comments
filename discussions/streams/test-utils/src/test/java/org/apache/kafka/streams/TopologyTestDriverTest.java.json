[
  {
    "id" : "8ec45d22-362b-4f71-b270-30afacb16e17",
    "prId" : 4655,
    "prUrl" : "https://github.com/apache/kafka/pull/4655#pullrequestreview-102116431",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f1332af0-3e57-4d38-b65b-be317c83179a",
        "parentId" : null,
        "authorId" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "body" : "I think we can simplify this test. We only want to make sure the application directory gets deleted. Thus, we can create it manually, create the driver with corresponding config (passing in a empty Topology), call `close()` and check if the directory was deleted.",
        "createdAt" : "2018-03-07T21:47:59Z",
        "updatedAt" : "2018-03-07T22:17:53Z",
        "lastEditedBy" : "9baadc38-cd41-4762-be0c-791258ced78c",
        "tags" : [
        ]
      },
      {
        "id" : "861879d8-4b38-45e0-9f6f-9022e14a35e7",
        "parentId" : "f1332af0-3e57-4d38-b65b-be317c83179a",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "Yeah, that makes sense, unless you think it might be possible to introduce some other bug later that breaks this behavior via a different mechanism.",
        "createdAt" : "2018-03-07T21:51:58Z",
        "updatedAt" : "2018-03-07T22:17:53Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "12c579c3-818f-4bfa-84b8-70bdb7a6a154",
        "parentId" : "f1332af0-3e57-4d38-b65b-be317c83179a",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "So, if I read the StateDirectory code right, any subdir of stateDirectory that is parseable as a TaskId and not currently \"locked\" by a running task gets deleted on `cleanRemovedTasks`.\r\n\r\nI could make use of this fact to implement the test as you say, but then this test, which is supposed to be verifying some behavior of the TopologyTestDriver actually becomes coupled to the internal implementation of StateDirectory, which feels wrong to me.\r\n\r\nI agree that we don't need a simulation as complete as what I wrote, but it seems like the test should be interacting only with the driver.",
        "createdAt" : "2018-03-07T22:05:55Z",
        "updatedAt" : "2018-03-07T22:17:53Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      },
      {
        "id" : "8bc51ba7-ed08-4d84-a672-fc336bd14a6a",
        "parentId" : "f1332af0-3e57-4d38-b65b-be317c83179a",
        "authorId" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "body" : "I'll update the code with what I'm thinking, and you can let me know if you think it's still too silly.",
        "createdAt" : "2018-03-07T22:06:55Z",
        "updatedAt" : "2018-03-07T22:17:53Z",
        "lastEditedBy" : "f84c555e-0e5d-4773-b994-4121b6b8dada",
        "tags" : [
        ]
      }
    ],
    "commit" : "94a0a9a7afbf34e5809d6931f6acc27979ed80cc",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +841,845 @@\n    @Test\n    public void shouldCleanUpPersistentStateStoresOnClose() {\n        final Topology topology = new Topology();\n        topology.addSource(\"sourceProcessor\", \"input-topic\");"
  }
]