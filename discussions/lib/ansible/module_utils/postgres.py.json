[
  {
    "id" : "b843f005-f5f3-4884-9ffd-deff7d0db0d1",
    "prId" : 55514,
    "prUrl" : "https://github.com/ansible/ansible/pull/55514#pullrequestreview-228277275",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "parentId" : null,
        "authorId" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "body" : "Would it make sense to move build the `kw`s inside this function? I think we should be able to move the following section into here since we already have the module so it should be all we need to build the connection details.\r\n```python\r\n    params_map = {\r\n        \"login_host\": \"host\",\r\n        \"login_user\": \"user\",\r\n        \"login_password\": \"password\",\r\n        \"port\": \"port\",\r\n        \"db\": \"database\",\r\n        \"ssl_mode\": \"sslmode\",\r\n        \"ca_cert\": \"sslrootcert\"\r\n    }\r\n    kw = dict((params_map[k], v) for (k, v) in iteritems(module.params)\r\n              if k in params_map and v != \"\" and v is not None)\r\n    # If a login_unix_socket is specified, incorporate it here.\r\n    is_localhost = \"host\" not in kw or kw[\"host\"] == \"\" or kw[\"host\"] == \"localhost\"\r\n    if is_localhost and module.params[\"login_unix_socket\"] != \"\":\r\n        kw[\"host\"] = module.params[\"login_unix_socket\"]\r\n    if psycopg2.__version__ < '2.4.3' and sslrootcert is not None:\r\n        module.fail_json(msg='psycopg2 must be at least 2.4.3 in order to user the ca_cert parameter')\r\n```\r\nIt would reduce the duplicate code and might make it easier to manage in the future, since every module is now using the `postgres_common_argument_spec` they should have the correct params too.",
        "createdAt" : "2019-04-18T11:23:30Z",
        "updatedAt" : "2019-04-18T11:23:46Z",
        "lastEditedBy" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "tags" : [
        ]
      },
      {
        "id" : "c615f07d-c2c2-418e-9d0c-a360065b9c01",
        "parentId" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "@andytom , very good note, thank you! I should think and try",
        "createdAt" : "2019-04-18T11:46:14Z",
        "updatedAt" : "2019-04-18T11:46:14Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      },
      {
        "id" : "8fd57dc0-33ee-49e9-b6c5-58fbdc3e6316",
        "parentId" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "@andytom , I think it's necessary to keep kw because we return kw that contains connection params as well.",
        "createdAt" : "2019-04-18T11:59:34Z",
        "updatedAt" : "2019-04-18T11:59:34Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      },
      {
        "id" : "fa155cba-b1aa-44fe-bc6c-565948b9709f",
        "parentId" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "I suggest to merge this PR and after that we can think about optimizations.",
        "createdAt" : "2019-04-18T12:00:28Z",
        "updatedAt" : "2019-04-18T12:00:28Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      },
      {
        "id" : "362120ba-fc44-4566-83a4-ea082a23f01c",
        "parentId" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "@andytom , I made a short note in [#PostgreSQL](https://github.com/ansible/community/wiki/PostgreSQL).\r\nThe first aim of this PR is to move connection_to_db and get_pg_version to module_utils (as gundalow and I wanted). However your suggestion is very interesting, so after merge this one we should think how to implement it safely",
        "createdAt" : "2019-04-18T12:17:21Z",
        "updatedAt" : "2019-04-18T12:17:21Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      },
      {
        "id" : "68cce5c7-4910-4a15-b307-0d2082b338f0",
        "parentId" : "ee5e0f4e-0c5d-407a-9fa1-c21559d073d5",
        "authorId" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "body" : "@andytom Good suggestion thanks. Let's get this merged and backported then we can look at further improvements.",
        "createdAt" : "2019-04-18T13:15:03Z",
        "updatedAt" : "2019-04-18T13:15:44Z",
        "lastEditedBy" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "tags" : [
        ]
      }
    ],
    "commit" : "664fe35709319b0c56bdf8b83f3ba686699ac4dd",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +64,68 @@\n\ndef connect_to_db(module, kw, autocommit=False):\n    try:\n        db_connection = psycopg2.connect(**kw)"
  },
  {
    "id" : "1837d80c-ff4e-4923-909a-bfff55f998f5",
    "prId" : 55549,
    "prUrl" : "https://github.com/ansible/ansible/pull/55549#pullrequestreview-230592541",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b883cd7d-f1b6-45b2-8a1b-c126e44bc40c",
        "parentId" : null,
        "authorId" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "body" : "Do we need a default case for this, e.g what happens if there is no `db`, `database` or `login_db` set, should we fail? Something like\r\n\r\n```suggestion\r\n        else:\r\n            module.fail_json(msg=\"No database parameter set, need one of 'db', 'database' or 'login_db'\")\r\n\r\n```",
        "createdAt" : "2019-04-24T17:26:29Z",
        "updatedAt" : "2019-04-25T05:50:50Z",
        "lastEditedBy" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "tags" : [
        ]
      },
      {
        "id" : "0a897567-3ea0-4bda-b609-431d63caa5c1",
        "parentId" : "b883cd7d-f1b6-45b2-8a1b-c126e44bc40c",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "@andytom , nps, thank you much for reviewing!\r\nVery interesting point about the default value.\r\nHowever db/database/etc param is not necessary to be not None/'' for many of the modules, like postgresql_user, _idx, etc.\r\nAs we know in this case psycopg will use default db like a name of a user who's trying to connect.\r\nYour suggestion gave me an idea to change it to module.warn, see my last commit.\r\nI added warn_db_default arg for modules that work with global objects (user, settings, info).\r\nI think it will be very useful if a dba forget to pass db name and we warn him about that he's working with a default database that is usually quite strange ;)\r\nWhat do you think about it ?",
        "createdAt" : "2019-04-25T06:03:13Z",
        "updatedAt" : "2019-04-25T06:03:13Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      },
      {
        "id" : "3f2c6445-ea1f-4ded-8d08-73440db971a8",
        "parentId" : "b883cd7d-f1b6-45b2-8a1b-c126e44bc40c",
        "authorId" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "body" : "That makes perfect sense to me.",
        "createdAt" : "2019-04-25T10:11:00Z",
        "updatedAt" : "2019-04-25T10:11:00Z",
        "lastEditedBy" : "ff63c3eb-7034-4bd1-a5dc-9d0674949d07",
        "tags" : [
        ]
      },
      {
        "id" : "82cbe5e3-d9ee-4cbf-a488-561584af9603",
        "parentId" : "b883cd7d-f1b6-45b2-8a1b-c126e44bc40c",
        "authorId" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "body" : "@andytom , thank you for reviewing! Not having another channel to communicate with you, I sent a message to you in LinkedIn (if you like you can answer by mail to aaklychkov at mail dot ru, it I can't check LinkedIn before 20.00 UTC) ",
        "createdAt" : "2019-04-25T11:29:55Z",
        "updatedAt" : "2019-04-25T11:35:20Z",
        "lastEditedBy" : "d2d80496-0795-4618-ba72-36ae6c5b52ef",
        "tags" : [
        ]
      }
    ],
    "commit" : "48c3385712bb2f3ea3b4c78d121b217eaac9e1ba",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +94,98 @@            module.warn('Database name has not been passed, '\n                        'used default database to connect to.')\n\n    kw = dict((params_map[k], v) for (k, v) in iteritems(module.params)\n              if k in params_map and v != '' and v is not None)"
  }
]