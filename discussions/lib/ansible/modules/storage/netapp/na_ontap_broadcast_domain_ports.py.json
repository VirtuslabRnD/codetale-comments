[
  {
    "id" : "8adb4e52-960e-44bd-b984-b569f70bfaa6",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-123114902",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "737f9132-d0e9-4de1-91ff-07215289044d",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "no sample for what an ipspace should look like",
        "createdAt" : "2018-05-22T18:34:02Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "7d57226f-ed3c-4d71-b85a-900b8315630e",
        "parentId" : "737f9132-d0e9-4de1-91ff-07215289044d",
        "authorId" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "body" : "We removed this example because the parser didn't like the semi colon in the name",
        "createdAt" : "2018-05-23T21:07:15Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "tags" : [
        ]
      },
      {
        "id" : "3ac1d9f3-db95-4a97-a276-218194ea729a",
        "parentId" : "737f9132-d0e9-4de1-91ff-07215289044d",
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "All the more reason to not use key=value format in the samples; works fine with YAML\r\n",
        "createdAt" : "2018-05-24T18:21:34Z",
        "updatedAt" : "2018-05-24T18:21:34Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 65,
    "diffHunk" : "@@ -1,1 +63,67 @@        broadcast_domain=123kevin\n        ports=khutton-vsim1:e0d-13\n\"\"\"\n\nRETURN = \"\"\""
  },
  {
    "id" : "7c60eee2-ed58-4d6e-a278-33eefc942daa",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-123116027",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4c862ef3-4179-4901-a189-bae80cdfba94",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "I'm not familiar with the underlying API behavior- will this replace the entire list of ports with the specified ones for the named broadcast domain, or would any previously assigned ports remain? Typically, people want the ability to do both, (eg, \"make the broadcast domain have exactly these ports, regardless of what it had before\" and \"ensure these ports exist in the broadcast domain, leaving any others alone\"). It's not clear how this module behaves, but it's clear that it can't do both. It's OK if you're going to leave it that way, but the documentation needs to be very clear about which way it works.",
        "createdAt" : "2018-05-22T18:36:52Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "69500daa-7d6d-47f3-840c-840fd5c87b09",
        "parentId" : "4c862ef3-4179-4901-a189-bae80cdfba94",
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "I'm also making the rash assumption that the underlying API is itself idempotent (eg that it will succeed if you ask it to set a state that it's already in)- if not, this is a much bigger problem. ",
        "createdAt" : "2018-05-22T20:20:12Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "911deb13-814d-4265-b7b0-777a8c778c29",
        "parentId" : "4c862ef3-4179-4901-a189-bae80cdfba94",
        "authorId" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "body" : "Some API are some are not. In this case it is not.\r\n\r\nSo what we've done lower down in the function is have a try/except, if it passes without an error return true (which is the changed state). if we get an exception with error code 18605, then we know the port is already being used so we returned False for the change state.\r\n\r\n        try:\r\n            self.server.invoke_successfully(domain_obj, True)\r\n            return True\r\n        except netapp_utils.zapi.NaApiError as error:\r\n            # Error 18605 denotes port already being used.\r\n            if to_native(error.code) == \"18605\":\r\n                return False",
        "createdAt" : "2018-05-22T20:39:57Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "tags" : [
        ]
      },
      {
        "id" : "2f50a814-c0be-4331-b053-024af3e244c4",
        "parentId" : "4c862ef3-4179-4901-a189-bae80cdfba94",
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "I think this is a big usability problem that users will be upset about, as it's inconsistent with pretty much every other Ansible module (and not very usable in a declarative system), but it's your module. Very difficult to change that behavior later without a separate mode switch or breaking change.",
        "createdAt" : "2018-05-24T18:24:33Z",
        "updatedAt" : "2018-05-24T18:24:33Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 149,
    "diffHunk" : "@@ -1,1 +147,151 @@        Creates new broadcast domain ports\n        \"\"\"\n        domain_obj = netapp_utils.zapi.NaElement('net-port-broadcast-domain-add-ports')\n        domain_obj.add_new_child(\"broadcast-domain\", self.broadcast_domain)\n        if self.ipspace:"
  },
  {
    "id" : "fe924944-9aec-4cfc-a05c-af86b78efe87",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-123116460",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "574610f7-7622-4dac-9a66-2282f465b1e2",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "This is also not properly idempotent- you're not comparing to the existing port list, so always returning \"changed: True\" even if it's already in the right state.",
        "createdAt" : "2018-05-22T18:37:53Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "267ed74f-170a-4d32-b5cd-777f442d5d64",
        "parentId" : "574610f7-7622-4dac-9a66-2282f465b1e2",
        "authorId" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "body" : "If the port given is already in use our zapi will fail with error 18605, so we return false in that case. \r\n        except netapp_utils.zapi.NaApiError as error:\r\n            # Error 18605 denotes port already being used.\r\n            if to_native(error.code) == \"18605\":\r\n                return False",
        "createdAt" : "2018-05-22T20:41:17Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "tags" : [
        ]
      },
      {
        "id" : "8df443bb-445b-4bb0-bdf1-8941a1867acf",
        "parentId" : "574610f7-7622-4dac-9a66-2282f465b1e2",
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "Is that error \"the port is in use by something\" or \"port is already in the state you asked for\"? If it's the former (as I suspect), it's arguably incorrect to silently succeed (as the port will not be in the requested state since it's a member of the wrong broadcast domain).",
        "createdAt" : "2018-05-24T18:25:45Z",
        "updatedAt" : "2018-05-24T18:30:19Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 160,
    "diffHunk" : "@@ -1,1 +158,162 @@        try:\n            self.server.invoke_successfully(domain_obj, True)\n            return True\n        except netapp_utils.zapi.NaApiError as error:\n            # Error 18605 denotes port already being used."
  },
  {
    "id" : "24ff39c6-85d0-4c95-aae0-2edff77ea30f",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-122344596",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "45adb126-f0ed-42b8-b254-b59228deab08",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "idempotence again",
        "createdAt" : "2018-05-22T18:38:09Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "8de796af-d71d-444b-8a42-303ebb8121b7",
        "parentId" : "45adb126-f0ed-42b8-b254-b59228deab08",
        "authorId" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "body" : "same thing here if we delete a port that isn't being used the except will get called. ",
        "createdAt" : "2018-05-22T20:42:21Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 160,
    "diffHunk" : "@@ -1,1 +183,187 @@        try:\n            self.server.invoke_successfully(domain_obj, True)\n            return True\n        except netapp_utils.zapi.NaApiError as error:\n            # Error 13001 denotes port already not being used."
  },
  {
    "id" : "3bde0b14-4e46-4958-88ab-1aae19619389",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-122769459",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "699855fd-9046-4140-a71d-fa4a7c7f73ef",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "Looks like there's no way to just nuke a broadcast domain by name? Won't this have the possibility of leaving dangling parents and/or ports hanging out there?",
        "createdAt" : "2018-05-22T18:39:06Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      },
      {
        "id" : "b7695e6d-f696-4d8f-a814-04c496f1d1a1",
        "parentId" : "699855fd-9046-4140-a71d-fa4a7c7f73ef",
        "authorId" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "body" : "This module is just for adding and removing ports, and not domain. There is another module for managing the broadcast domain",
        "createdAt" : "2018-05-23T21:13:22Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "b450c8e7-2428-44f4-bcfd-b15a657813e0",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 157,
    "diffHunk" : "@@ -1,1 +180,184 @@            domain_obj.add_child_elem(ports_obj)\n            for port in self.ports:\n                ports_obj.add_new_child('net-qualified-port-name', port)\n        try:\n            self.server.invoke_successfully(domain_obj, True)"
  },
  {
    "id" : "f66fbeba-abf6-4643-a512-850b86ccf9d1",
    "prId" : 40486,
    "prUrl" : "https://github.com/ansible/ansible/pull/40486#pullrequestreview-122294454",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b414b5b0-4d75-49de-b9cc-737707115b88",
        "parentId" : null,
        "authorId" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "body" : "You're correctly using `type='list'` in the arg_spec, so probably better if at least one example used the native YAML format and showed multiple values as list elements. The arg validator will properly handle coercion of a single value to a list (as the current examples show).",
        "createdAt" : "2018-05-22T18:53:39Z",
        "updatedAt" : "2018-05-23T21:16:32Z",
        "lastEditedBy" : "311820dd-fcb9-46df-a201-9c0e7d6fac58",
        "tags" : [
        ]
      }
    ],
    "commit" : "c2cfd6b49b2edb5dafc7d70db62e27b65472e764",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +53,57 @@        hostname={{ netapp_hostname }}\n        broadcast_domain=123kevin\n        ports=khutton-vsim1:e0d-13\n    - name: delete broadcast domain ports\n      na_ontap_broadcast_domain_ports:"
  }
]