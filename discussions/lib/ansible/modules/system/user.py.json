[
  {
    "id" : "9ad29c64-9085-4e2d-8dcd-2527b34b9237",
    "prId" : 30472,
    "prUrl" : "https://github.com/ansible/ansible/pull/30472#pullrequestreview-63235167",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b1672c41-a82c-48dd-bdc3-bde5c0ff9b65",
        "parentId" : null,
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "make note of the version this changes",
        "createdAt" : "2017-09-17T19:39:24Z",
        "updatedAt" : "2017-09-17T21:18:58Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      }
    ],
    "commit" : "3a0d5803012c977599d6b257d7f26b2c88e8765d",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +105,109 @@            - Unless set to C(no), a home directory will be made for the user\n              when the account is created or if the home directory does not\n              exist.\n            - Changed from C(createhome) to C(create_home) in version 2.5.\n        default: yes"
  },
  {
    "id" : "96b3834a-83ea-430a-a045-60771d6c8b2e",
    "prId" : 37962,
    "prUrl" : "https://github.com/ansible/ansible/pull/37962#pullrequestreview-112401345",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f359ada7-808f-493f-9bfa-80438022a596",
        "parentId" : null,
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "this does not default to no/false, the 'default' default is `None`, but it is actually what we want, so correct the docs and code as i mentioned above",
        "createdAt" : "2018-04-13T20:19:07Z",
        "updatedAt" : "2018-04-18T10:27:48Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      },
      {
        "id" : "3b82462d-35bc-4f4d-927d-7bf6fefb89ea",
        "parentId" : "f359ada7-808f-493f-9bfa-80438022a596",
        "authorId" : "915e875a-9cd9-43bf-990c-bcb2bb1eb71f",
        "body" : "I've made the changes for all of your comments ! ",
        "createdAt" : "2018-04-16T12:58:14Z",
        "updatedAt" : "2018-04-18T10:27:48Z",
        "lastEditedBy" : "915e875a-9cd9-43bf-990c-bcb2bb1eb71f",
        "tags" : [
        ]
      }
    ],
    "commit" : "18850085d9de226189a2d04add27fb873000d5e0",
    "line" : 81,
    "diffHunk" : "@@ -1,1 +2195,2199 @@            update_password=dict(type='str', default='always', choices=['always', 'on_create']),\n            expires=dict(type='float'),\n            password_lock=dict(type='bool'),\n            local=dict(type='bool'),\n        ),"
  },
  {
    "id" : "9050a7ea-97d4-4d06-b243-5fd2a83f515f",
    "prId" : 40339,
    "prUrl" : "https://github.com/ansible/ansible/pull/40339#pullrequestreview-151427659",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2f217dac-221a-4b8f-a704-7d52d3eb1f82",
        "parentId" : null,
        "authorId" : "b984c6cf-8edf-4441-ae79-e26925f9a897",
        "body" : "Hi,\r\njust small comment on this. In function `def modify_user_usermod(self):` there is the same code which also should be surround with `try, except` clause:\r\n```python\r\n                     for line in open(self.SHADOWFILE, 'rb').readlines():\r\n                         line = to_native(line, errors='surrogate_or_strict')\r\n                         fields = line.strip().split(':')\r\n                         if not fields[0] == self.name:\r\n                             lines.append(line)\r\n                             continue\r\n                         fields[1] = self.password\r\n                         fields[2] = str(int(time.time() // 86400))\r\n                         if minweeks:\r\n                             fields[3] = str(int(minweeks) * 7)\r\n                         if maxweeks:\r\n                             fields[4] = str(int(maxweeks) * 7)\r\n                         if warnweeks:\r\n                             fields[5] = str(int(warnweeks) * 7)\r\n                         line = ':'.join(fields)\r\n                         lines.append('%s\\n' % line)\r\n```\r\n\r\n@bengerman13 can you add this change there as well, please?",
        "createdAt" : "2018-08-31T14:48:12Z",
        "updatedAt" : "2018-08-31T14:48:12Z",
        "lastEditedBy" : "b984c6cf-8edf-4441-ae79-e26925f9a897",
        "tags" : [
        ]
      }
    ],
    "commit" : "5a826e205c25fac2734ce2bf7b01764890566023",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +1459,1463 @@                            except ValueError:\n                                # mirror solaris, which allows for any value in this field, and ignores anything that is not an int.\n                                pass\n                        line = ':'.join(fields)\n                        lines.append('%s\\n' % line)"
  },
  {
    "id" : "4991dda5-54c1-4591-9b3f-e03a5cf9c635",
    "prId" : 44174,
    "prUrl" : "https://github.com/ansible/ansible/pull/44174#pullrequestreview-146980687",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b38d9804-3687-4c43-a88f-1d060b624b17",
        "parentId" : null,
        "authorId" : "5fa99a5d-707d-4290-a461-dd1ccf572443",
        "body" : "Wouldn't this result no value for `-e`, i.e. `useradd -e USERNAME`, which is invalid? (I haven't tested it).",
        "createdAt" : "2018-08-16T07:44:10Z",
        "updatedAt" : "2018-08-16T19:00:57Z",
        "lastEditedBy" : "5fa99a5d-707d-4290-a461-dd1ccf572443",
        "tags" : [
        ]
      },
      {
        "id" : "8cec21fe-98fb-4379-ae0b-54e70e26ee01",
        "parentId" : "b38d9804-3687-4c43-a88f-1d060b624b17",
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "It is valid to pass an empty string to the `-e` param.\r\n\r\n```\r\n[root@lab-centos7 ~]# useradd testuser2 -e ''\r\n[root@lab-centos7 ~]# ll /home\r\ntotal 0\r\ndrwx------. 2 bob               users              62 Jun 27 19:00 bob\r\ndrwx------. 2 oracle            oinstall           62 Jun 26 00:15 oracle\r\ndrwx------. 2 testuser          testuser           62 Aug 15 16:07 testuser\r\ndrwx------. 2 testuser2         testuser2          62 Aug 16 20:57 testuser2\r\n[root@lab-centos7 ~]# getent passwd testuser2\r\ntestuser2:x:1009:1011::/home/testuser2:/bin/bash\r\n[root@lab-centos7 ~]# getent shadow testuser2\r\ntestuser2:!!:17759:0:99999:7:::\r\n[root@lab-centos7 ~]# chage -l testuser2\r\nLast password change\t\t\t\t\t: Aug 16, 2018\r\nPassword expires\t\t\t\t\t: never\r\nPassword inactive\t\t\t\t\t: never\r\nAccount expires\t\t\t\t\t\t: never\r\nMinimum number of days between password change\t\t: 0\r\nMaximum number of days between password change\t\t: 99999\r\nNumber of days of warning before password expires\t: 7\r\n```",
        "createdAt" : "2018-08-16T18:59:36Z",
        "updatedAt" : "2018-08-16T19:00:57Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      }
    ],
    "commit" : "28875bba8ce74f51c75eb0ec8e3f321ac8fea577",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +555,559 @@            cmd.append('-e')\n            if self.expires < time.gmtime(0):\n                cmd.append('')\n            else:\n                cmd.append(time.strftime(self.DATE_FORMAT, self.expires))"
  },
  {
    "id" : "9b53f7d7-a6b1-4a78-b9b4-6c9a79d76eb0",
    "prId" : 49262,
    "prUrl" : "https://github.com/ansible/ansible/pull/49262#pullrequestreview-180094338",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "034498de-d1b0-4f33-9537-1c25f9c18780",
        "parentId" : null,
        "authorId" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "body" : "We should only fetch user information with state `present`, there is no need to fetch user info if we are deleting a user.",
        "createdAt" : "2018-11-28T21:04:31Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "tags" : [
        ]
      },
      {
        "id" : "0f91965f-1e54-43a5-a3b6-ac1b73c58bef",
        "parentId" : "034498de-d1b0-4f33-9537-1c25f9c18780",
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "If `user.state == 'absent'` the user account will be removed, which means `user.user_exists()` will be `False`. No need for the additional condition.",
        "createdAt" : "2018-11-29T16:39:29Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      },
      {
        "id" : "149dcda4-e943-4ced-ac4e-835d95d2b86f",
        "parentId" : "034498de-d1b0-4f33-9537-1c25f9c18780",
        "authorId" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "body" : "But it doesn't hurt to have this check, because we had an issue because of it. We had local users on our hosts and then we added those hosts into a FreeIPA domain. The FreeIPA domain had the same exact users that were created locally before, so when we deleted our local users using this module, what happened was that this condition returned `true` that the user did exist (because it found a user on the FreeIPA domain) and then it created that user's home dir.\r\n\r\nFor example if there is a `kustodian` local user and the `kustodian` user exists on the FreeIPA domain (or any central user management system), when you run:\r\n\r\n```\r\n- user:\r\n    name: kustodian\r\n    state: absent\r\n```\r\nThis would delete the local `kustodian` user and then it would create the remote `kustodian` user home dir, which in our case was `/home/ipa.lan/kustodian`. Which is not what you expect from the `user` module to do when it deletes a user. Also it created the home dirs with `755`, which we also don't want (`useradd` creates them with 700). I know this is an edge case, but its something that can happen (it happened to us) and this additional condition solves the problem.",
        "createdAt" : "2018-11-29T20:01:01Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "tags" : [
        ]
      },
      {
        "id" : "593eca85-c88e-4359-be26-6098e869e69c",
        "parentId" : "034498de-d1b0-4f33-9537-1c25f9c18780",
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "I see. Thank you for that great explanation. Since it doesn’t hurt to have it plus fixes the scenario you describe, we should keep it. ",
        "createdAt" : "2018-11-30T01:48:23Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      }
    ],
    "commit" : "8cb40f5485e434685b432f36f374127bb75f535a",
    "line" : 230,
    "diffHunk" : "@@ -1,1 +2658,2662 @@        result['stderr'] = err\n\n    if user.user_exists() and user.state == 'present':\n        info = user.user_info()\n        if info is False:"
  },
  {
    "id" : "3d46e9bc-2ef0-41d8-ab70-245c5f72f0b4",
    "prId" : 49262,
    "prUrl" : "https://github.com/ansible/ansible/pull/49262#pullrequestreview-179871707",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "87509438-fc93-4d37-befe-1b85bd5a77b0",
        "parentId" : null,
        "authorId" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "body" : "This was an indentation bug, because it doesn't make sense to create the home dir, if it already exists, and it also doesn't make sense not to create it if `/etc/skell` doesn't exists, which was the case before.",
        "createdAt" : "2018-11-28T21:09:30Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "bb5f3442-a604-42a4-a77a-2008548cc43d",
        "tags" : [
        ]
      },
      {
        "id" : "d4565917-f135-44e2-b7be-4fa8f102d3af",
        "parentId" : "87509438-fc93-4d37-befe-1b85bd5a77b0",
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "Good catch.",
        "createdAt" : "2018-11-29T15:58:06Z",
        "updatedAt" : "2018-12-18T20:31:37Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      }
    ],
    "commit" : "8cb40f5485e434685b432f36f374127bb75f535a",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +1007,1011 @@                    os.makedirs(path)\n                except OSError as e:\n                    self.module.exit_json(failed=True, msg=\"%s\" % to_native(e))\n            # get umask from /etc/login.defs and set correct home mode\n            if os.path.exists(self.LOGIN_DEFS):"
  },
  {
    "id" : "7866baca-52ee-4770-989c-6d953af13087",
    "prId" : 52276,
    "prUrl" : "https://github.com/ansible/ansible/pull/52276#pullrequestreview-204414576",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "02fe317f-e24a-40c2-a682-eb29bd2aa99d",
        "parentId" : null,
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "Use `to_native` rather than `str()`:\r\n```suggestion\r\n                cmd.append(to_native(calendar.timegm(self.expires)))\r\n```",
        "createdAt" : "2019-02-15T19:30:37Z",
        "updatedAt" : "2019-02-15T19:32:06Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      },
      {
        "id" : "d7e4599e-edd0-4605-9ac8-18883c2683d4",
        "parentId" : "02fe317f-e24a-40c2-a682-eb29bd2aa99d",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "There is no need to call `to_native` on an `int` since it ultimately uses `str()` on the value anyways. If anything the use of `str()` could be removed since it's also converted later:\r\n\r\nhttps://github.com/ansible/ansible/blob/6ac22416af987b4cd3e4cadf0f1d01352daf203c/lib/ansible/modules/system/user.py#L548",
        "createdAt" : "2019-02-15T19:57:00Z",
        "updatedAt" : "2019-02-15T19:57:00Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      }
    ],
    "commit" : "80adca6a7a99172fb3014a1976b870d427119757",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +1152,1156 @@                cmd.append('0')\n            else:\n                cmd.append(str(calendar.timegm(self.expires)))\n\n        # system cannot be handled currently - should we error if its requested?"
  },
  {
    "id" : "3775f73e-4d1a-4f9f-a17d-a4400ca9dcf4",
    "prId" : 52276,
    "prUrl" : "https://github.com/ansible/ansible/pull/52276#pullrequestreview-204403376",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8121fbb3-776b-4ff1-8003-26ad19b6dbe4",
        "parentId" : null,
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "Same here: \r\n```suggestion\r\n                    cmd.append(to_native(calendar.timegm(self.expires)))\r\n```",
        "createdAt" : "2019-02-15T19:30:52Z",
        "updatedAt" : "2019-02-15T19:32:06Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      }
    ],
    "commit" : "80adca6a7a99172fb3014a1976b870d427119757",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +1270,1274 @@                if current_expires <= 0 or current_expire_date[:3] != self.expires[:3]:\n                    cmd.append('-e')\n                    cmd.append(str(calendar.timegm(self.expires)))\n\n        # modify the user if cmd will do anything"
  }
]