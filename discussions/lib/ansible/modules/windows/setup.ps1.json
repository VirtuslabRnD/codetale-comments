[
  {
    "id" : "dbea8a40-b72d-40ab-aa6c-b3182733d66a",
    "prId" : 49611,
    "prUrl" : "https://github.com/ansible/ansible/pull/49611#pullrequestreview-183972624",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c36590f4-b397-4c6c-812a-c68c369a7f63",
        "parentId" : null,
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "Up to you, if you add the new facts in a separate PR you can backport the rounding fix to stable-2.7. We won't be able to accept new facts on older releases.",
        "createdAt" : "2018-12-12T00:51:29Z",
        "updatedAt" : "2018-12-12T11:50:14Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "149d72049744119526bf06b26a1b366b17103c70",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +303,307 @@        ansible_swaptotal_mb = ([math]::round($win32_os.TotalSwapSpaceSize / 1024))\n        ansible_memtotal = $win32_cs.TotalPhysicalMemory\n        ansible_swap_min = $win32_pf.InitialSize * 1024 * 1024\n        ansible_swap_max = $win32_pf.MaximumSize * 1024 * 1024\n    }"
  },
  {
    "id" : "3a54dcf9-e31e-4582-b0b8-7193c4db9608",
    "prId" : 56279,
    "prUrl" : "https://github.com/ansible/ansible/pull/56279#pullrequestreview-247869529",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "38d9f0ee-f153-4e66-98dd-5b0f61dbbaaf",
        "parentId" : null,
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "We still have the same issue here, the value will be `.domain.com` when it should be `domain.com`.",
        "createdAt" : "2019-06-10T21:57:00Z",
        "updatedAt" : "2019-06-11T10:28:13Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      },
      {
        "id" : "0a86ad0e-4d01-40ff-b41c-ac62a44a5f6f",
        "parentId" : "38d9f0ee-f153-4e66-98dd-5b0f61dbbaaf",
        "authorId" : "36bff90a-e429-4cb4-8593-f59950bc4761",
        "body" : "my brain is a pudding, sec",
        "createdAt" : "2019-06-10T22:07:02Z",
        "updatedAt" : "2019-06-11T10:28:13Z",
        "lastEditedBy" : "36bff90a-e429-4cb4-8593-f59950bc4761",
        "tags" : [
        ]
      }
    ],
    "commit" : "6d3d2cd9f2ee11a99e385bd1b27db33059e1965a",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +325,329 @@    $ansible_facts += @{\n        ansible_architecture = $win32_os.OSArchitecture\n        ansible_domain = $domain_suffix\n        ansible_fqdn = $fqdn\n        ansible_hostname = $win32_cs.DNSHostname"
  },
  {
    "id" : "a13c2478-0e54-4b35-9806-b7607886f8c7",
    "prId" : 56279,
    "prUrl" : "https://github.com/ansible/ansible/pull/56279#pullrequestreview-247872976",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b52da6c4-a552-443a-8287-59fb0e2a847a",
        "parentId" : null,
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "Now `ansible_domain` will fail in a workgroup because `$domain_suffix` is an empty string and `.Substring(1)` will fail. What I suggest you do is;\r\n\r\n```suggestion\r\n    $domain = $win32_cs.Domain.Substring($win32_cs.Workgroup.length)\r\n    $fqdn = $win32_cs.DNSHostname\r\n    if ($domain -ne \"\") {\r\n        $fqdn += \".$domain\"\r\n    }\r\n    \r\n    try {\r\n        $ansible_reboot_pending = Get-PendingRebootStatus\r\n    } catch {\r\n        # fails for non-admin users, set to null in this case\r\n        $ansible_reboot_pending = $null\r\n    }\r\n\r\n    $ansible_facts += @{\r\n        ansible_architecture = $win32_os.OSArchitecture\r\n        ansible_domain = $domain\r\n        ansible_fqdn = $fqdn\r\n        ansible_hostname = $win32_cs.DNSHostname\r\n        ansible_netbios_name = $win32_cs.Name\r\n        ansible_kernel = $osversion.Version.ToString()\r\n        ansible_nodename = $fqdn\r\n```\r\n\r\nWhat this means is;\r\n\r\n* `ansible_domain`: Is the value returned from `$win32_cs.Domain.Substring($win32_cs.Workgroup.length)` which in a domain environment is the domain part and a workgroup is an empty string\r\n* `ansible_fqdn`: Is just the DNS hostname in a workgroup, if a domain is present it is the DNS hostname with `.$domain` appended\r\n* `ansible_nodename`: Is the same as fqdn\r\n\r\nThis solves the issue where `ansible_domain` is an empty string for a workgroup and contains the domain part without the leading `.` for an actual domain environment. Also the fqdn will not contain the `.` suffix in a workgroup as we only add that if the domain value is not an empty string.\r\n\r\n_Note; I'm not sure how well GitHub suggestions work for multiple lines, you may need to manually apply this, or modify it how you like._",
        "createdAt" : "2019-06-10T22:17:50Z",
        "updatedAt" : "2019-06-11T10:28:13Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "6d3d2cd9f2ee11a99e385bd1b27db33059e1965a",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +308,312 @@    $win32_cs = Get-LazyCimInstance Win32_ComputerSystem\n    $win32_os = Get-LazyCimInstance Win32_OperatingSystem\n    $domain_suffix = $win32_cs.Domain.Substring($win32_cs.Workgroup.length)\n    $fqdn = $win32_cs.DNSHostname\n"
  }
]