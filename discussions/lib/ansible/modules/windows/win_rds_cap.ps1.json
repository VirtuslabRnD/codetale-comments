[
  {
    "id" : "0230ed39-e289-45d6-aac0-0883cb0dec37",
    "prId" : 43406,
    "prUrl" : "https://github.com/ansible/ansible/pull/43406#pullrequestreview-150199619",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b71806e1-20ea-4a9e-bbf7-46a0d53ba52c",
        "parentId" : null,
        "authorId" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "body" : "I don't think you need to provide a $resultobj to Fail-Json if the content is going to be empty anyway.\r\n\r\n*(Same for the other modules)*",
        "createdAt" : "2018-08-28T11:56:39Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "tags" : [
        ]
      },
      {
        "id" : "f26a81c2-43ca-4aa2-a1af-8c31408c9d02",
        "parentId" : "b71806e1-20ea-4a9e-bbf7-46a0d53ba52c",
        "authorId" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "body" : "I think it costs nothing to leave it. If a future change add something to $result before this line, we will not need to remember that we have to change this line",
        "createdAt" : "2018-08-28T15:59:36Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "tags" : [
        ]
      },
      {
        "id" : "7fb20132-ef28-4a12-af5a-c68186eccaed",
        "parentId" : "b71806e1-20ea-4a9e-bbf7-46a0d53ba52c",
        "authorId" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "body" : "True.",
        "createdAt" : "2018-08-28T16:05:21Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "tags" : [
        ]
      }
    ],
    "commit" : "1dce76054d50ae4cbed7386eba6eeee90523b48f",
    "line" : 93,
    "diffHunk" : "@@ -1,1 +91,95 @@        Set-Item -Path \"$cap_path\\$property\" -Value $value -ErrorAction Stop\n    } catch {\n        Fail-Json -obj $resultobj -message \"Failed to set property $property of CAP ${name}: $($_.Exception.Message)\"\n    }\n}"
  },
  {
    "id" : "8bbc2b3f-b005-4780-be26-72e663fd944b",
    "prId" : 43406,
    "prUrl" : "https://github.com/ansible/ansible/pull/43406#pullrequestreview-160112209",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bab17191-43f7-4d2b-a8e8-e98f43a3af6f",
        "parentId" : null,
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "This will actually call `Fail-Json` if it is unable to resolve the SID. Did you come across a situation where this didn't happen?",
        "createdAt" : "2018-09-27T02:25:21Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      },
      {
        "id" : "d777d2c9-af48-4c2c-9013-34ee5651d479",
        "parentId" : "bab17191-43f7-4d2b-a8e8-e98f43a3af6f",
        "authorId" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "body" : "No I didn't, it's just a bad copy/paste from other modules, like [win_owner#L25-L28](https://github.com/ansible/ansible/blob/277bb3066c7ae8506a8201f5285b77d51b422267/lib/ansible/modules/windows/win_owner.ps1#L25-L28) and [win_share#L26-L29](https://github.com/ansible/ansible/blob/277bb3066c7ae8506a8201f5285b77d51b422267/lib/ansible/modules/windows/win_share.ps1#L26-L29), where I took inspiration.\r\nAlso [the error message verified in the tests](https://github.com/ansible/ansible/blob/77753a2b18d9b7f96f393e0d0c0b0ad4687dbd61/test/integration/targets/win_rds_cap/tasks/tests.yml#L254) is the one from the cmdlet, and not the one in the module.\r\n\r\nThat said, I think it might be a little better to leave the `Fail-Json` call in the module side in this case, to let the calling code throw the error with a more specific message, depending on the context. Currently the message will be `account_name [...] is not a valid account`, while we are actually dealing with groups. The message `[...] is not a valid computer group [...]` is a little bit more precise here.\r\nThat's not a big deal, but maybe we should add a silent flag to `Convert-ToSID` to allow the calling code to handle errors (or even ignore it), or reword the embedded error message, or something else... ?",
        "createdAt" : "2018-09-29T22:40:58Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "tags" : [
        ]
      },
      {
        "id" : "ab64ebeb-fbfe-4cbd-99f2-aecf93bfe97b",
        "parentId" : "bab17191-43f7-4d2b-a8e8-e98f43a3af6f",
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "Interesting it must be throwing the error earlier than what is being caught in the cmdlet. I agree we should move it out or just have the module until throw and exception instead for finer control in the module.",
        "createdAt" : "2018-09-29T23:39:57Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      },
      {
        "id" : "45bcbd67-6993-4c27-97cd-f8eb2afc43df",
        "parentId" : "bab17191-43f7-4d2b-a8e8-e98f43a3af6f",
        "authorId" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "body" : "I just saw that there is also one place where the call to Convert-ToSID is surrounded by a try/catch block:\r\nhttps://github.com/ansible/ansible/blob/277bb3066c7ae8506a8201f5285b77d51b422267/lib/ansible/modules/windows/win_audit_rule.ps1#L60-L66\r\nI don't think there is an unhandled error in the cmdlet that would need to be caught in the calling code.\r\n\r\nI suggest that we simply replace the call to `Fail-Json` in `Convert-ToSID` by `return $null`, to let the calling code test for `$null` and throw an error if needed:\r\n```diff\r\n@@ -79,13 +79,13 @@ Function Convert-ToSID {\r\n     try {\r\n         $account_sid = $account.Translate([System.Security.Principal.SecurityIdentifier])\r\n     } catch {\r\n-        Fail-Json @{} \"account_name $account_name is not a valid account, cannot get SID: $($_.Exception.Message)\"\r\n+        return $null\r\n     }\r\n\r\n     return $account_sid.Value\r\n }\r\n```\r\nDo you agree with that?",
        "createdAt" : "2018-09-30T11:14:35Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "fba84db2-df80-4604-97b3-f0b22b8bf898",
        "tags" : [
        ]
      },
      {
        "id" : "8a0bee19-4739-497a-87c3-c728a53e7463",
        "parentId" : "bab17191-43f7-4d2b-a8e8-e98f43a3af6f",
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "I would investigate this in another issue/pr. My original comment was merely an observation and donâ€™t wish to make a change to a module_util that could affect other modules.",
        "createdAt" : "2018-09-30T11:46:39Z",
        "updatedAt" : "2018-12-08T22:37:47Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "1dce76054d50ae4cbed7386eba6eeee90523b48f",
    "line" : 116,
    "diffHunk" : "@@ -1,1 +114,118 @@        $group = $_\n        # Test that the group is resolvable on the local machine\n        $sid = Convert-ToSID -account_name $group\n        if (!$sid) {\n            Fail-Json -obj $result -message \"$group is not a valid user group on the host machine or domain\""
  }
]