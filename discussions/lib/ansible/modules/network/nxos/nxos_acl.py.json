[
  {
    "id" : "d796a0b7-d604-4497-ab40-6497dbf367e6",
    "prId" : 38283,
    "prUrl" : "https://github.com/ansible/ansible/pull/38283#pullrequestreview-109946819",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2b99463b-1f46-4ad4-ac46-0afa25790342",
        "parentId" : null,
        "authorId" : "284bb4ad-6403-4762-bb03-b2a921d26492",
        "body" : "Wondering why check the other way around? Is this for idempotence?",
        "createdAt" : "2018-04-05T05:16:14Z",
        "updatedAt" : "2018-04-05T05:16:15Z",
        "lastEditedBy" : "284bb4ad-6403-4762-bb03-b2a921d26492",
        "tags" : [
        ]
      },
      {
        "id" : "ecf389bb-3dae-4d09-94de-63f382ec454b",
        "parentId" : "2b99463b-1f46-4ad4-ac46-0afa25790342",
        "authorId" : "fa79aa34-d606-4908-acc5-6efdccee3b48",
        "body" : "It is not just for idempotence. There are 2 ways the existing acl can be changed.\r\n1. we can add 1 or more parameters to the existing acl\r\n2. we can remove 1 or more parameters from the existing acl\r\n\r\nThe current code is only taking care of the first change. The 2nd one is being ignored and so if user wants to remove some parameters, there is no way, the playbook run does not even throw an error, it does not change anything and silently exits. The problem exists for both core and options.\r\n\r\nHere is an example:\r\n```\r\n>>> proposed_options = {'c' : 'd'}\r\n\r\n>>> existing_options = {'a' : 'b', 'c' : 'd'}\r\n\r\n>>> dict(set(proposed_options.items()).difference(existing_options.items()))\r\n{}\r\n\r\n>>> dict(set(existing_options.items()).difference(proposed_options.items()))\r\n{'a': 'b'}\r\n```\r\n\r\nSo as you can see, the 2nd statement detects if the difference is in the removing part. \r\nSince this is intended behavior, this is a bug. \r\nYou can check the documentation:\r\nhttps://github.com/ansible/ansible/blob/cdd21e2170b9a47d84624c8c2f792a66f2b0fe57/lib/ansible/modules/network/nxos/nxos_acl.py#L44-L45\r\n",
        "createdAt" : "2018-04-05T18:04:04Z",
        "updatedAt" : "2018-04-05T18:04:05Z",
        "lastEditedBy" : "fa79aa34-d606-4908-acc5-6efdccee3b48",
        "tags" : [
        ]
      },
      {
        "id" : "a7a4b82c-d9e5-446c-94e0-8210c398baca",
        "parentId" : "2b99463b-1f46-4ad4-ac46-0afa25790342",
        "authorId" : "284bb4ad-6403-4762-bb03-b2a921d26492",
        "body" : "Thanks. Makes sense.",
        "createdAt" : "2018-04-06T04:56:59Z",
        "updatedAt" : "2018-04-06T04:57:00Z",
        "lastEditedBy" : "284bb4ad-6403-4762-bb03-b2a921d26492",
        "tags" : [
        ]
      }
    ],
    "commit" : "d38ce8ef60e3c6aebf08811ef7ac6acc5665f7c1",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +467,471 @@            # check the diff in the other way just in case\n            dcore = dict(\n                set(existing_core.items()).difference(\n                    proposed_core.items())\n            )"
  }
]