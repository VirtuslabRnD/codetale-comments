[
  {
    "id" : "89e795e2-d144-4698-806a-10437d9b58e9",
    "prId" : 19727,
    "prUrl" : "https://github.com/ansible/ansible/pull/19727#pullrequestreview-14826333",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "99e2bc29-5755-47ff-bde7-05ed8564e9a9",
        "parentId" : null,
        "authorId" : "06ab4cf8-4a18-478e-93ee-69929f4bffc6",
        "body" : "It looks like you're double-nesting `ansible_facts` dictionary, on line 406/409/412 you have the facts being saved in `result = { 'ansible_facts': { 'cloudfront':...` but then here you pass to exit_json under `ansible_facts` so your output looks like:\r\n\r\n```\r\nlocalhost | SUCCESS => {                                                                                                          [479/1550]\r\n    \"ansible_facts\": {\r\n        \"ansible_facts\": {\r\n            \"cloudfront\": {\r\n                \"E22CS9R7XQ0CWU\": {\r\n                    \"distribution\": {\r\n....\r\n```\r\nTo fix this you can instead do `module.exit_json(msg=\"Retrieved cloudfront facts.\", **result)` or stop nesting the `cloudfront` key under `ansible_facts` on 402/405/408/411. ",
        "createdAt" : "2016-12-30T15:14:56Z",
        "updatedAt" : "2017-01-05T09:14:18Z",
        "lastEditedBy" : "06ab4cf8-4a18-478e-93ee-69929f4bffc6",
        "tags" : [
        ]
      },
      {
        "id" : "562684cd-c6d3-4000-949e-08f07d7cee5e",
        "parentId" : "99e2bc29-5755-47ff-bde7-05ed8564e9a9",
        "authorId" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "body" : "Thanks for the feedback @ryansb! All good suggestions. I'll set the default to list_distributions, fix the double-nesting and version number and list both distribution_id and CNAME where possible.",
        "createdAt" : "2016-12-30T19:36:08Z",
        "updatedAt" : "2017-01-05T09:14:18Z",
        "lastEditedBy" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "tags" : [
        ]
      },
      {
        "id" : "14d7769b-fa46-4957-9147-1d51b278dd3a",
        "parentId" : "99e2bc29-5755-47ff-bde7-05ed8564e9a9",
        "authorId" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "body" : "Thanks again for the feedback - I've implemented all the suggestions. \r\n\r\nFor listing by both distribution_id and alias, if the distribution_id had been set (not necessarily as a parameter), it queries list_distributions for the aliases and lists by these as well. If only domain_name_alias is specified, this make it 3 calls on the boto3 api (1 to get distribution_id, 1 to get aliases and 1 for the actual request) making it a bit 'chatty' but still a reasonable response time imho. The alternative was to use only the domain_name_alias parameter but this may have missed other aliases of the distribution.\r\n\r\nAlso, the alias listing has only been done for distribution and distribution_config but distribution_id is used for other options as well (eg. invalidation, streaming_distribution and streaming_distribution_config) and so the aliases for these could also be used if required. ",
        "createdAt" : "2017-01-01T13:47:53Z",
        "updatedAt" : "2017-01-05T09:14:18Z",
        "lastEditedBy" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "tags" : [
        ]
      },
      {
        "id" : "24bd83bd-8a4c-4e40-bf21-4eb9e15707a8",
        "parentId" : "99e2bc29-5755-47ff-bde7-05ed8564e9a9",
        "authorId" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "body" : "Hi, I found a few bugs in my code which I have since fixed:\r\n- default to list_distributions logic was incorrect - check on if list_distributions is specified\r\n- list_distributions_by_web_acl wasn't passing web_acl_id and wasn't specifying WebAclId for boto3 kwargs\r\n- list_invalidations - wasn't specifying DistributionId for kwargs to boto3",
        "createdAt" : "2017-01-02T08:23:59Z",
        "updatedAt" : "2017-01-05T09:14:18Z",
        "lastEditedBy" : "4b241267-f137-4c1d-ad18-6495d90001e3",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a34e55e0e08aaed1bf8e25e8d0fb8859a463dab",
    "line" : null,
    "diffHunk" : "@@ -1,1 +515,519 @@\n    result['changed'] = False\n    module.exit_json(msg=\"Retrieved cloudfront facts.\", ansible_facts=result)\n\nif __name__ == '__main__':"
  },
  {
    "id" : "67caa60e-a73b-46a5-a060-3beb62a71e0d",
    "prId" : 49061,
    "prUrl" : "https://github.com/ansible/ansible/pull/49061#pullrequestreview-184349580",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dc4689a8-2097-4ac9-9266-538eb9c214be",
        "parentId" : null,
        "authorId" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "body" : "This needs adding to `RETURN` so people know it exists,\r\nCould you please another block like https://github.com/ansible/ansible/blob/b20c04361d17b28c0a1ef3e61b95ab4446365961/lib/ansible/modules/cloud/amazon/cloudfront_facts.py#L193-L198 for `DistributionId`\r\n\r\nAlso I note that the other variables seem to be lower case with `_`, so to be consistent should this be \r\n\r\n```suggestion\r\n    facts['result']['distribution_id'] = distribution_id\r\n```",
        "createdAt" : "2018-11-29T09:30:13Z",
        "updatedAt" : "2019-05-01T20:50:31Z",
        "lastEditedBy" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "tags" : [
        ]
      },
      {
        "id" : "43264dcc-0175-4e87-a6e7-fb177020acc5",
        "parentId" : "dc4689a8-2097-4ac9-9266-538eb9c214be",
        "authorId" : "3d9711e3-e56b-431c-8bd2-6352f88aa4b0",
        "body" : "Probably the docs are wrong (or not matching the code) here. In fact all returned AWS values are camel case in this module, hence I kept the pattern for now. \r\n\r\nNot sure what's the best strategy here, change the code to be more conventional (snake case) and break backwards compatibility or just update the docs to be in sync with the code.\r\n\r\nPreferably the whole return structure should be changed to list of snake cased dicts instead of a camel cased dict (with my workarround to access the result without knowing the dict keys which is the ID you are mostly looking for). With a list you could also just iterate over multiple results and pick out the infos you need without guessing IDs first (and a lot of coding in yaml). Also it would then behave like almost all other facts modules.",
        "createdAt" : "2018-11-30T12:36:39Z",
        "updatedAt" : "2019-05-01T20:50:31Z",
        "lastEditedBy" : "3d9711e3-e56b-431c-8bd2-6352f88aa4b0",
        "tags" : [
        ]
      },
      {
        "id" : "baf8affd-c6c8-4455-9c67-436f97dd0d04",
        "parentId" : "dc4689a8-2097-4ac9-9266-538eb9c214be",
        "authorId" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "body" : "Oh, good spot.\r\nI wonder if returning both formats (though only documenting the \"correct\" format would be a way forward) though that may look confusing when people use register/debug",
        "createdAt" : "2018-12-04T12:40:15Z",
        "updatedAt" : "2019-05-01T20:50:31Z",
        "lastEditedBy" : "d7d8721c-7ad0-4834-9a3d-b53ca8656789",
        "tags" : [
        ]
      },
      {
        "id" : "3cb24337-c248-422f-8653-bd714be1a4f8",
        "parentId" : "dc4689a8-2097-4ac9-9266-538eb9c214be",
        "authorId" : "3d9711e3-e56b-431c-8bd2-6352f88aa4b0",
        "body" : "Maybe in this case it would even be appropriate the just deprecate the module and write a fresh one. This was done in the past already for some AWS modules, AFAIK. Although that's for the maintaincers to decide of course.",
        "createdAt" : "2018-12-12T19:15:59Z",
        "updatedAt" : "2019-05-01T20:50:31Z",
        "lastEditedBy" : "3d9711e3-e56b-431c-8bd2-6352f88aa4b0",
        "tags" : [
        ]
      }
    ],
    "commit" : "db99efa0eff9a188b6e16ee2e07b24ea2f204bb9",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +540,544 @@    # also have a fixed key for accessing results/details returned\n    facts['result'] = details\n    facts['result']['DistributionId'] = distribution_id\n\n    for alias in aliases:"
  }
]