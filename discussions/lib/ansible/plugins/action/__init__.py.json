[
  {
    "id" : "b827838b-1adb-4b74-b6d8-d2fe4fd00294",
    "prId" : 14490,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "59391467-9b4e-42e8-a230-7100aba988ca",
        "parentId" : null,
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "Since we aren't sending the errormsg to an exception, we want to use to_unicode rather than to_bytes.  to_bytes won't cause any problems with the code here in python2 but it will fail in python3 (because the string literals will be of the text type and so it won't match with errormsg as bytes then.)\n",
        "createdAt" : "2016-02-17T08:24:20Z",
        "updatedAt" : "2016-02-18T09:41:57Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      }
    ],
    "commit" : "2b5fffa751c0a6ec364e66cc648f456d28b3a8a7",
    "line" : null,
    "diffHunk" : "@@ -1,1 +336,340 @@                x = \"2\" # cannot read file\n            elif errormsg.endswith('MODULE FAILURE'):\n                x = \"4\" # python not found or module uncaught exception\n        finally:\n            return x"
  },
  {
    "id" : "6341b94b-d02c-4f66-a444-4eb4fbde98d4",
    "prId" : 20192,
    "prUrl" : "https://github.com/ansible/ansible/pull/20192#pullrequestreview-16496196",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "78a4167b-7296-47a5-8dd1-6e71459d8846",
        "parentId" : null,
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "I heard you didn't like the ``` list(data.keys())``` idiom.  Since you're really filtering a list here, you can do it with a list comprehension instead:\r\n``` python\r\nfor key in  [k for k in data.keys() if key.startswith('_ansible_') or key in C.INTERNAL_RESULT_KEYS ]:\r\n    display.warning([...])\r\n    del data[key]\r\n```\r\nWith such a long conditional, I like to break the filtering over one or more statements like these examples:\r\n\r\n``` python\r\nbadkeys = [k for k in data.keys() if key.startswith('_ansible_') or key in C.INTERNAL_RESULT_KEYS ]\r\nfor key in badkeys:\r\n    [...]\r\n\r\n# Generator expression so we don't create an extra list (sometimes slower but always uses less memory)\r\nbadkeys = (k for k in data.keys() if key.startswith('_ansible_'))\r\n# list comprehension so that we don't delete keys from the dict while a generator is still looping through them\r\nbadkeys = [k for k in badkeys if key in C.INTERNAL_RESULT_KEYS]\r\nfor key in badkeys:\r\n    [...]\r\n```\r\n\r\nChoose whichever idiom is the most readable to you.",
        "createdAt" : "2017-01-12T21:40:24Z",
        "updatedAt" : "2017-01-12T21:40:24Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      },
      {
        "id" : "ac635627-26ce-4268-bcf0-4d8c5747d20f",
        "parentId" : "78a4167b-7296-47a5-8dd1-6e71459d8846",
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "at this point `list(dict.keys())` seems the least evil",
        "createdAt" : "2017-01-13T01:48:23Z",
        "updatedAt" : "2017-01-13T01:48:44Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      }
    ],
    "commit" : "1a03061b431a943eb366ba3fc25c8595bd2a4663",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +683,687 @@    def _remove_internal_keys(self, data):\n        for key in list(data.keys()):\n            if key.startswith('_ansible_') or key in C.INTERNAL_RESULT_KEYS:\n                display.warning(\"Removed unexpected internal key in module return: %s = %s\" % (key, data[key]))\n                del data[key]"
  },
  {
    "id" : "1f830fc0-0293-46ae-8746-1afc136fcf7d",
    "prId" : 22790,
    "prUrl" : "https://github.com/ansible/ansible/pull/22790#pullrequestreview-28202115",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5595e3b3-576c-4ba6-bcca-40edb1013f0d",
        "parentId" : null,
        "authorId" : "fa0144fc-7424-474a-9ab5-059de28814b7",
        "body" : "Seems reasonable for a 2.3 targeted fix.\r\n\r\nLong term (after 2.3) may be useful to add a constant for the keys that are whitelisted ( ie something like `and key not in C.INTERNAL_RESULT_KEYS_WHITELIST` )\r\n\r\n",
        "createdAt" : "2017-03-21T14:27:58Z",
        "updatedAt" : "2017-03-22T01:48:17Z",
        "lastEditedBy" : "fa0144fc-7424-474a-9ab5-059de28814b7",
        "tags" : [
        ]
      },
      {
        "id" : "bb4bf3d0-4286-4f68-8f99-952f823d8186",
        "parentId" : "5595e3b3-576c-4ba6-bcca-40edb1013f0d",
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "well, parsed should be only key needed at this point, anything else should be consumed inside the previous code or generated afterwards",
        "createdAt" : "2017-03-21T18:41:58Z",
        "updatedAt" : "2017-03-22T01:48:17Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      }
    ],
    "commit" : "2da278a6736d788f128bc2ff1ffe31a36ae4ae81",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +767,771 @@    def _remove_internal_keys(self, data):\n        for key in list(data.keys()):\n            if key.startswith('_ansible_') and key != '_ansible_parsed' or key in C.INTERNAL_RESULT_KEYS:\n                display.warning(\"Removed unexpected internal key in module return: %s = %s\" % (key, data[key]))\n                del data[key]"
  },
  {
    "id" : "e4249b2c-8dbe-44c3-946e-9e4ac0acfbc3",
    "prId" : 22845,
    "prUrl" : "https://github.com/ansible/ansible/pull/22845#pullrequestreview-28251345",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "253e98c3-a1f5-49ad-a9c2-2019cca52f78",
        "parentId" : null,
        "authorId" : "91c63cfe-0504-4f72-afa0-80b301c25eca",
        "body" : "I know, right? But if `data['stdout']=False`, then `data.get('stdout', u'')` returns `False`. That's why I added a comment- it isn't intuitive.\r\n\r\nThe next line is `txt.splitlines()`, which doesn't work on `False`.\r\n\r\nI think this would also fail for `None`. It took some REPL work to make sure I understood what was happening.",
        "createdAt" : "2017-03-21T22:02:03Z",
        "updatedAt" : "2017-03-21T22:02:03Z",
        "lastEditedBy" : "91c63cfe-0504-4f72-afa0-80b301c25eca",
        "tags" : [
        ]
      },
      {
        "id" : "49a9c990-6eaa-423c-b0c0-aef4f3bee2a7",
        "parentId" : "253e98c3-a1f5-49ad-a9c2-2019cca52f78",
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "just realized same ... really hate how stupid this corner case is",
        "createdAt" : "2017-03-21T22:05:29Z",
        "updatedAt" : "2017-03-21T22:05:29Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      }
    ],
    "commit" : "e62d8166cc9e380ad0d5744e7f2cec585bd63a67",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +756,760 @@        if 'stdout' in data and 'stdout_lines' not in data:\n            # if the value is 'False', a default won't catch it.\n            txt = data.get('stdout', None) or u''\n            data['stdout_lines'] = txt.splitlines()\n        if 'stderr' in data and 'stderr_lines' not in data:"
  },
  {
    "id" : "f936653c-e723-483d-acf5-f1681e59b790",
    "prId" : 23664,
    "prUrl" : "https://github.com/ansible/ansible/pull/23664#pullrequestreview-36048033",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "58f63149-b61c-42c1-931c-8c6e64238cd1",
        "parentId" : null,
        "authorId" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "body" : "unrelated fix, but NICE!",
        "createdAt" : "2017-05-03T15:09:04Z",
        "updatedAt" : "2017-05-03T15:35:06Z",
        "lastEditedBy" : "30fc1801-f8f1-4cc4-9690-e31e203f4f6d",
        "tags" : [
        ]
      }
    ],
    "commit" : "d2a831fceaae53c9ed600a756de72abcfe59cd99",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +538,542 @@                x = \"4\"  # python not found or module uncaught exception\n            elif 'json' in errormsg or 'simplejson' in errormsg:\n                x = \"5\" # json or simplejson modules needed\n        finally:\n            return x"
  },
  {
    "id" : "c60b17f8-f3d9-45ed-89ba-b9276d5c0e5b",
    "prId" : 29839,
    "prUrl" : "https://github.com/ansible/ansible/pull/29839#pullrequestreview-62013476",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cdf2843e-28b5-435e-8676-ccbe6b8aa73a",
        "parentId" : null,
        "authorId" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "body" : "Does this one needs to set the default value for raw_environment_out?  (it stood out when I was just scanning the changes but looking at the code, I think it may be purely used for side effects so perhaps it is okay to leave it as None.",
        "createdAt" : "2017-09-12T03:35:36Z",
        "updatedAt" : "2017-09-12T03:41:24Z",
        "lastEditedBy" : "838eb58c-0fa8-4742-994f-a407c7183e57",
        "tags" : [
        ]
      },
      {
        "id" : "ab1c15a3-a18d-4729-8b3a-a146520eef2d",
        "parentId" : "cdf2843e-28b5-435e-8676-ccbe6b8aa73a",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "Since the only access to this is protected by the `if isinstance(raw_environment_out, dict):` conditional, it's fine to leave it as `None`.",
        "createdAt" : "2017-09-12T03:40:27Z",
        "updatedAt" : "2017-09-12T03:41:24Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      }
    ],
    "commit" : "9a7c86b88d416d1d7ac2f275977a814d17113f51",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +170,174 @@        '''\n        Builds the environment string to be used when executing the remote task.\n        '''\n\n        final_environment = dict()"
  }
]