[
  {
    "id" : "4b5c0f5e-2bbb-49f3-84ab-abb16a5a80e4",
    "prId" : 10393,
    "prUrl" : "https://github.com/apache/kafka/pull/10393#pullrequestreview-627129796",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cce73e26-0927-4f86-bf49-4786c175a94d",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Might be worth a comment about the behavior when `candidateId` is equal to `localId`. Although the candidate votes for itself, this vote is implicit and not \"granted.\" ",
        "createdAt" : "2021-04-02T17:16:53Z",
        "updatedAt" : "2021-04-03T01:10:48Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "a6652c81004815e35e7e635a3442e81c77e1c517",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +242,246 @@\n    @Override\n    public boolean canGrantVote(int candidateId, boolean isLogUpToDate) {\n        // Still reject vote request even candidateId = localId, Although the candidate votes for\n        // itself, this vote is implicit and not \"granted\"."
  },
  {
    "id" : "89ba15dd-b0aa-4de2-b2e3-c0a23a07a6ee",
    "prId" : 10393,
    "prUrl" : "https://github.com/apache/kafka/pull/10393#pullrequestreview-629536869",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "64459583-a0f4-4e67-9d37-247041c117a6",
        "parentId" : null,
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "As a general rule, methods like this should not log IMO. The calling method should log instead. That is, good to avoid the side effect from the \"check\" operation. It seems like it was like that before this PR. What was the motivation for changing it?",
        "createdAt" : "2021-04-05T17:56:20Z",
        "updatedAt" : "2021-04-05T17:56:20Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      },
      {
        "id" : "39370978-9590-425b-baca-2c1237c97e82",
        "parentId" : "64459583-a0f4-4e67-9d37-247041c117a6",
        "authorId" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "body" : "@ijuma , we logged both vote result and the reject reason in `KafkaRaftClient` before this PR, but different `EpochState` have different reject reason, to reduce the cyclomatic complexity we moved the if-else out of `KafkaRaftClient`.",
        "createdAt" : "2021-04-06T01:40:27Z",
        "updatedAt" : "2021-04-06T01:40:27Z",
        "lastEditedBy" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "tags" : [
        ]
      },
      {
        "id" : "a44a3745-7031-4e60-8142-0193961bff97",
        "parentId" : "64459583-a0f4-4e67-9d37-247041c117a6",
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "I think it's a misguided goal to reduce cyclomatic complexity if it results in surprising code. Generally, predicate type methods (`isX` or `canX`) should be callable multiple types without undesired behavior like several log lines. Maybe you can address this in a subsequent PR?",
        "createdAt" : "2021-04-06T22:04:10Z",
        "updatedAt" : "2021-04-06T22:04:11Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      },
      {
        "id" : "227c34f9-db3b-4158-b51c-dc430793a45a",
        "parentId" : "64459583-a0f4-4e67-9d37-247041c117a6",
        "authorId" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "body" : "Thank you for reminding me of this principle, maybe a better way to fix this is to return `Tuple<Boolean, String>` to represent \"canGrantVote\" and \"rejectReason\", I will try to fix this later.",
        "createdAt" : "2021-04-07T01:52:01Z",
        "updatedAt" : "2021-04-07T01:52:01Z",
        "lastEditedBy" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "tags" : [
        ]
      },
      {
        "id" : "d3d31f87-5d40-4067-9353-a2db6d292c09",
        "parentId" : "64459583-a0f4-4e67-9d37-247041c117a6",
        "authorId" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "body" : "You could return Optional[String] probably where defined string would be the rejection reason. This would mean renaming the methods slightly though.",
        "createdAt" : "2021-04-07T02:02:12Z",
        "updatedAt" : "2021-04-07T02:02:33Z",
        "lastEditedBy" : "d8c7cf80-a55a-474c-a4f4-f60a9efda52c",
        "tags" : [
        ]
      }
    ],
    "commit" : "a6652c81004815e35e7e635a3442e81c77e1c517",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +246,250 @@        // itself, this vote is implicit and not \"granted\".\n        log.debug(\"Rejecting vote request from candidate {} since we are already candidate in epoch {}\",\n            candidateId, epoch);\n        return false;\n    }"
  }
]