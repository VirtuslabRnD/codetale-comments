[
  {
    "id" : "7ef80beb-1e35-4bf6-b2fd-2d84daac288a",
    "prId" : 5841,
    "prUrl" : "https://github.com/apache/airflow/pull/5841#pullrequestreview-278432994",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1773a46c-1872-40f9-9a53-dd915854ad12",
        "parentId" : null,
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "I'm not sure this change actually tests the change though",
        "createdAt" : "2019-08-21T12:31:06Z",
        "updatedAt" : "2019-08-23T23:12:45Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      },
      {
        "id" : "dd1d3e0e-f436-490a-86de-74f1c12eb60d",
        "parentId" : "1773a46c-1872-40f9-9a53-dd915854ad12",
        "authorId" : "8d8cfe56-ebff-478a-8f59-7153cb2393cf",
        "body" : "Once I had tried a few things, I ended up with this test-driven development path:\r\n\r\n1. Make the change above in `tests/hooks/test_postgres_hook.py` - note that the subclass was copied from further down in the file, but I didn't an elegant way to reuse that code, since it was for a different test case\r\n2. Run the entire test suite and get this error (also in the PR description):\r\n```python\r\nAttributeError: 'UnitTestPostgresHook' object has no attribute 'postgres_conn_id'\r\n```\r\n3. Make the change to `airflow/hooks/postgres_hook.py` to call the `conn_name_attr` rather than directly calling `postgres_conn_id`\r\n4. See the tests pass\r\n\r\nI think I what you called out sounds right-on: there is a `conn_name_attr` used for connecting to any database using the `DbApiHook`, which is partly why we went ahead and change this attribute when we sub-classed `PostgresHook`.\r\n\r\nAnything else you all would need to see to make this change?\r\n\r\nThanks for considering!",
        "createdAt" : "2019-08-21T19:43:15Z",
        "updatedAt" : "2019-08-23T23:12:45Z",
        "lastEditedBy" : "8d8cfe56-ebff-478a-8f59-7153cb2393cf",
        "tags" : [
        ]
      },
      {
        "id" : "55d7993a-3158-45a1-a9f3-4136871eeed6",
        "parentId" : "1773a46c-1872-40f9-9a53-dd915854ad12",
        "authorId" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "body" : "Something like this:\r\n\r\n```python\r\n    @mock.patch('airflow.hooks.postgres_hook.psycopg2.connect')\r\n    def test_get_conn_non_default_id(self, mock_connect):\r\n        self.db_hook.test_conn_id = \"non_default\"\r\n        self.db_hook.get_conn()\r\n        mock_connect.assert_called_once_with(user='login', password='password', host='host',\r\n                                             dbname='schema', port=None)\r\n        self.db_hook.get_connection.assert_called_once_with(\"non_default\")\r\n```\r\n\r\nThat way it is a little bit more explicit (and easier to track down if it breaks).",
        "createdAt" : "2019-08-22T13:50:47Z",
        "updatedAt" : "2019-08-23T23:12:45Z",
        "lastEditedBy" : "f73f66ab-2657-4a50-be7a-2ca3ca98c202",
        "tags" : [
        ]
      }
    ],
    "commit" : "d75880c4c9c3d5e1ef938d064ed74dbe66da21e3",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +41,45 @@\n        class UnitTestPostgresHook(PostgresHook):\n            conn_name_attr = 'test_conn_id'\n\n        self.db_hook = UnitTestPostgresHook()"
  }
]