[
  {
    "id" : "7758c07c-0b70-4741-936e-fc85a350d353",
    "prId" : 8000,
    "prUrl" : "https://github.com/apache/kafka/pull/8000#pullrequestreview-347656840",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4d519b54-c1ef-43ff-9cfb-5954a66bc580",
        "parentId" : null,
        "authorId" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "body" : "During the test, I realized one scenario which is pretty dangerous. If we have a hard failure and the txn offsets get sticky on the broker side, for next consumer it could take over one minute to back-off and wait for the clearance, thus timing out on the fetch. Shrinking to 10 seconds here is just a remediation, but we should pay attention to general usage as well.",
        "createdAt" : "2020-01-23T22:40:17Z",
        "updatedAt" : "2020-02-11T21:07:09Z",
        "lastEditedBy" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "tags" : [
        ]
      }
    ],
    "commit" : "17b1ebb275d0bef7744a0215fc2392c4c97285cc",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +48,52 @@        self.num_seed_messages = 100000\n        self.transaction_size = 750\n        self.transaction_timeout = 10000\n        self.consumer_group = \"transactions-test-consumer-group\"\n"
  },
  {
    "id" : "1fde1361-db41-4054-8e84-1555a87b6bec",
    "prId" : 8000,
    "prUrl" : "https://github.com/apache/kafka/pull/8000#pullrequestreview-351700812",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "50069b50-d1aa-4c62-a81a-c2746094f7a4",
        "parentId" : null,
        "authorId" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "body" : "The changes in transactions_test are mainly for compatibility. Nothing should be behaving differently",
        "createdAt" : "2020-01-31T18:43:51Z",
        "updatedAt" : "2020-02-11T21:07:09Z",
        "lastEditedBy" : "3dfe0270-df82-43af-827f-0681ce1c6ad9",
        "tags" : [
        ]
      }
    ],
    "commit" : "17b1ebb275d0bef7744a0215fc2392c4c97285cc",
    "line" : 106,
    "diffHunk" : "@@ -1,1 +227,231 @@            bounce_target=[\"brokers\", \"clients\"],\n            check_order=[True, False],\n            use_group_metadata=[True, False])\n    def test_transactions(self, failure_mode, bounce_target, check_order, use_group_metadata):\n        security_protocol = 'PLAINTEXT'"
  },
  {
    "id" : "f04e9ad6-c4f1-444e-a5ed-a9501df90ef6",
    "prId" : 8981,
    "prUrl" : "https://github.com/apache/kafka/pull/8981#pullrequestreview-445215744",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e766e6a2-fcfe-44ca-9bab-4e2f19f3843a",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Hmm, still not sure about this. In a hard bounce, the broker failure will be detected after ZK session expiration, with a default of 18 sec. After that, new leaders will be elected and the client should recover. So, the transactional producer should be unblocked after 18 secs, even with a 40 sec transaction_timeout?",
        "createdAt" : "2020-07-07T22:27:57Z",
        "updatedAt" : "2020-07-09T00:34:38Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "63cc41d2-beb7-4d50-9437-3a70ea130e04",
        "parentId" : "e766e6a2-fcfe-44ca-9bab-4e2f19f3843a",
        "authorId" : "0f776378-bb23-4193-9bb0-1db5973f3781",
        "body" : "> the broker failure will be detected after ZK session expiration\r\n\r\nIt is unrelate to broker. The root cause is client (TransactionMessageCopier) is ungracefully closed in hard_bounce mode. The transactional message sent by client is not correctly completed so there are pending transaction (unstable offset) stored by broker. When the client is restarting, it fails to get offsets of partition due to unstable offset (TransactionMessageCopier needs to get position of partition to calculate remaining messages after restarting).\r\n\r\nThe timeout of transaction is higher than the timeout of verification so this test fails if any transaction is not correctly abort.",
        "createdAt" : "2020-07-08T00:41:49Z",
        "updatedAt" : "2020-07-09T00:34:38Z",
        "lastEditedBy" : "0f776378-bb23-4193-9bb0-1db5973f3781",
        "tags" : [
        ]
      },
      {
        "id" : "aba90142-5071-4d2d-be42-97f081a747c9",
        "parentId" : "e766e6a2-fcfe-44ca-9bab-4e2f19f3843a",
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "@chia7712 : Thanks for the reply. That makes sense. Perhaps we can adjust the comment to make it clear that the hard bounce is for the client.",
        "createdAt" : "2020-07-08T01:04:29Z",
        "updatedAt" : "2020-07-09T00:34:38Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "485346a0-af2e-43e3-b975-1a5c341b9f3c",
        "parentId" : "e766e6a2-fcfe-44ca-9bab-4e2f19f3843a",
        "authorId" : "0f776378-bb23-4193-9bb0-1db5973f3781",
        "body" : "> we can adjust the comment to make it clear that the hard bounce is for the client.\r\n\r\ndone",
        "createdAt" : "2020-07-09T00:35:11Z",
        "updatedAt" : "2020-07-09T00:35:12Z",
        "lastEditedBy" : "0f776378-bb23-4193-9bb0-1db5973f3781",
        "tags" : [
        ]
      }
    ],
    "commit" : "6df6979ff5fe7197c4718a9becb72ed579c297b2",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +52,56 @@        # broker obstructs TransactionMessageCopier from getting offset of partition which is used to calculate\n        # remaining messages after restarting.\n        self.transaction_timeout = 5000\n        self.consumer_group = \"transactions-test-consumer-group\"\n"
  }
]