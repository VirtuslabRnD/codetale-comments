[
  {
    "id" : "e2ae4cde-8638-4c7e-b301-9f036192d2c8",
    "prId" : 13310,
    "prUrl" : "https://github.com/apache/airflow/pull/13310#pullrequestreview-558810843",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a8b52106-8b80-4da4-b5c8-959cda313ce8",
        "parentId" : null,
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "maybe invalid question: `self.es_task_handler` is also used in other test cases, and default/initial value of `json_format` is `False` here. So should it be changed back to `False` in the end (or in `tearDown`) to avoid potential effect on other test cases (especially the order of test case execution is not guaranteed if I'm not wrong)?\r\n\r\nthe same quesiton applys to `test_set_context_w_json_format_and_write_stdout ` above.",
        "createdAt" : "2020-12-25T10:11:47Z",
        "updatedAt" : "2020-12-25T10:11:56Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      },
      {
        "id" : "64d0ee52-8c5f-4a0d-ad82-141adf4edd77",
        "parentId" : "a8b52106-8b80-4da4-b5c8-959cda313ce8",
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "I don't think that is needed since we already set it back to False in `setUp` before any tests using `self.es_task_handler` is run : \r\n\r\nhttps://github.com/apache/airflow/blob/69d6d0239f470ac75e23160bac63408350c1835a/tests/providers/elasticsearch/log/test_es_task_handler.py#L48-L55",
        "createdAt" : "2020-12-25T12:11:24Z",
        "updatedAt" : "2020-12-25T12:11:25Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      },
      {
        "id" : "85027c13-9e73-4798-8de4-d3dfb99595fa",
        "parentId" : "a8b52106-8b80-4da4-b5c8-959cda313ce8",
        "authorId" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "body" : "Yep, you are right. I asked a silly question",
        "createdAt" : "2020-12-25T12:12:55Z",
        "updatedAt" : "2020-12-25T12:12:55Z",
        "lastEditedBy" : "59d531be-9d1e-478d-99a0-6e20963d3e21",
        "tags" : [
        ]
      }
    ],
    "commit" : "5ea5d445c9bfdcda4c68aa4bd76320e235731f58",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +256,260 @@        formatter = logging.Formatter('[%(asctime)s] {%(filename)s:%(lineno)d} %(levelname)s - %(message)s')\n        self.es_task_handler.formatter = formatter\n        self.es_task_handler.json_format = True\n\n        self.body = {"
  },
  {
    "id" : "67031596-3631-4678-bb73-10f2d9be8798",
    "prId" : 15163,
    "prUrl" : "https://github.com/apache/airflow/pull/15163#pullrequestreview-632954935",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5b668c33-046d-439a-9d95-6b9066b1d2a0",
        "parentId" : null,
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "This test passes without the changes in airflow/providers/elasticsearch/log/es_task_handler.py\r\n\r\nideally the test should fail without the actual fix in the PR",
        "createdAt" : "2021-04-09T22:47:57Z",
        "updatedAt" : "2021-04-09T22:47:57Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      },
      {
        "id" : "2ab2233b-4284-49c5-84a1-a201f7bc9fc2",
        "parentId" : "5b668c33-046d-439a-9d95-6b9066b1d2a0",
        "authorId" : "40565530-4cdc-4a72-bfb7-c93a49a7e5e6",
        "body" : "It failed for me without these fixes:\r\n\r\n```\r\ntests/providers/elasticsearch/log/test_es_task_handler.py:253 (TestElasticsearchTaskHandler.test_read_with_json_format)\r\n[2020-12-24 19:25:00,962] {taskinstance.py:851} INFO - some random stuff -  != some random stuff\r\n\r\nExpected :some random stuff\r\nActual   :[2020-12-24 19:25:00,962] {taskinstance.py:851} INFO - some random stuff - \r\n<Click to see difference>\r\n\r\nself = <tests.providers.elasticsearch.log.test_es_task_handler.TestElasticsearchTaskHandler testMethod=test_read_with_json_format>\r\n\r\n    def test_read_with_json_format(self):\r\n        ts = pendulum.now()\r\n        formatter = logging.Formatter(\r\n            '[%(asctime)s] {%(filename)s:%(lineno)d} %(levelname)s - %(message)s - %(exc_text)s'\r\n        )\r\n        self.es_task_handler.formatter = formatter\r\n        self.es_task_handler.json_format = True\r\n    \r\n        self.body = {\r\n            'message': self.test_message,\r\n            'log_id': f'{self.DAG_ID}-{self.TASK_ID}-2016_01_01T00_00_00_000000-1',\r\n            'offset': 1,\r\n            'asctime': '2020-12-24 19:25:00,962',\r\n            'filename': 'taskinstance.py',\r\n            'lineno': 851,\r\n            'levelname': 'INFO',\r\n        }\r\n        self.es_task_handler.set_context(self.ti)\r\n        self.es.index(index=self.index_name, doc_type=self.doc_type, body=self.body, id=id)\r\n    \r\n        logs, _ = self.es_task_handler.read(\r\n            self.ti, 1, {'offset': 0, 'last_log_timestamp': str(ts), 'end_of_log': False}\r\n        )\r\n>       assert \"[2020-12-24 19:25:00,962] {taskinstance.py:851} INFO - some random stuff - \" == logs[0][0][1]\r\nE       AssertionError: assert '[2020-12-24 19:25:00,962] {taskinstance.py:851} INFO - some random stuff - ' == 'some random stuff'\r\n\r\nlog/test_es_task_handler.py:277: AssertionError\r\n```",
        "createdAt" : "2021-04-10T11:47:25Z",
        "updatedAt" : "2021-04-10T11:47:25Z",
        "lastEditedBy" : "40565530-4cdc-4a72-bfb7-c93a49a7e5e6",
        "tags" : [
        ]
      },
      {
        "id" : "dfba986a-6793-460b-bcfa-4ade50879491",
        "parentId" : "5b668c33-046d-439a-9d95-6b9066b1d2a0",
        "authorId" : "c25957e2-1132-4c48-a536-3824307fd862",
        "body" : "Oh yeah -- it failed for me now -- I might have missed something before",
        "createdAt" : "2021-04-10T21:40:14Z",
        "updatedAt" : "2021-04-10T21:40:14Z",
        "lastEditedBy" : "c25957e2-1132-4c48-a536-3824307fd862",
        "tags" : [
        ]
      }
    ],
    "commit" : "2b5c63fba96a9b25c21f614efffe5c22c131fbd3",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +256,260 @@        formatter = logging.Formatter(\n            '[%(asctime)s] {%(filename)s:%(lineno)d} %(levelname)s - %(message)s - %(exc_text)s'\n        )\n        self.es_task_handler.formatter = formatter\n        self.es_task_handler.json_format = True"
  }
]