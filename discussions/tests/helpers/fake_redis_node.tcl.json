[
  {
    "id" : "63b0355d-8432-430d-848c-ea6257c9e955",
    "prId" : 8930,
    "prUrl" : "https://github.com/redis/redis/pull/8930#pullrequestreview-668965647",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ff2da372-2e3f-4c88-9785-c0b48c448f4e",
        "parentId" : null,
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "@zuiderkwast i truly admire the resourcefulness, but i'm not sure we wanna go down that road.\r\nmocking redis would only be useful to test redis tooling (such as redis-cli), and i think would have several disadvantages:\r\n- if the mock is wrong, and behaves incorrectly (e.g. a typo such as AKS instead of ASK), or any problem with the protocol, the test will pass and we won't realize the code is bad (e.g. this PR fixes a character case issue)\r\n- may go outdated if redis is changed and the tests will still pass.\r\n\r\nI see two other possibilities if we wanna test it (p.s. i'm also ok with not testing it).\r\n1. add some test suite infra (maybe in server.tcl) that let's us bring up a single redis server that's part of an imaginary cluster. i.e. create a server that behaves as a cluster node (thinks it's part of a cluster), but without actually creating a cluster.\r\n2. i see the cluster tests (`./tests/cluster/*`) do interact with redis-cli, so i suppose we can add a cli-test in that folder using the framework to create clusters.",
        "createdAt" : "2021-05-26T05:43:23Z",
        "updatedAt" : "2021-05-26T05:43:33Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "ceceef93-f25d-4790-9c2b-cf4fa92f500b",
        "parentId" : "ff2da372-2e3f-4c88-9785-c0b48c448f4e",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "@oranagra Thanks ;-)\r\n\r\nHow do you consistently provoke an ASK redirect in an \"imaginary cluster\" or a real cluster?\r\n\r\nAFAICT, the reason the ASK bug is there is that there was no way to test it, so not testing it at all would definitely be sub optimal.\r\n\r\nOf course the mocked Redis can be wrong. That's why it needs to be minimal and with as little logic as possible. We can test the mocked Redis by checking that it's consistent with real Redis for some regular commands. We can use redis-cli to do that in a test case. How about that?\r\n\r\nMocked Redis is used to test ASK redirects in client libs. It's the only way to test it that I've found actually. To consistently provoke it in real redis would require injecting some sleep/pause in the cluster migration.",
        "createdAt" : "2021-05-26T09:54:51Z",
        "updatedAt" : "2021-05-26T09:54:51Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      },
      {
        "id" : "a8fc390d-86da-4bbd-9466-bd07a5f20c6f",
        "parentId" : "ff2da372-2e3f-4c88-9785-c0b48c448f4e",
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "we have `DEBUG AOF-FLUSH-SLEEP` and `CONFIG SET key-load-delay`.\r\nso maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli).",
        "createdAt" : "2021-05-26T12:26:22Z",
        "updatedAt" : "2021-05-26T12:26:22Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "12470671-e2a8-4af2-a650-916e8cdafbc3",
        "parentId" : "ff2da372-2e3f-4c88-9785-c0b48c448f4e",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "> maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli)\r\n\r\nThere is no real test for Redis sending ASK redirects correctly. That can be added with such a mechanism.",
        "createdAt" : "2021-05-26T12:40:30Z",
        "updatedAt" : "2021-05-26T12:40:30Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      }
    ],
    "commit" : "f03f5586e8d57e8cf324d6aefd4ffd5370337507",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +4,8 @@#\n# Commands are given as space-separated strings, e.g. \"GET foo\", and replies as\n# RESP-encoded replies minus the trailing \\r\\n, e.g. \"+OK\".\n\nset port [lindex $argv 0];"
  },
  {
    "id" : "3b09fcc4-3073-4bf6-9a49-5ce65044454c",
    "prId" : 8930,
    "prUrl" : "https://github.com/redis/redis/pull/8930#pullrequestreview-668965647",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5581b77e-8873-4413-b9dc-e38790f4a712",
        "parentId" : null,
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "@zuiderkwast i truly admire the resourcefulness, but i'm not sure we wanna go down that road.\r\nmocking redis would only be useful to test redis tooling (such as redis-cli), and i think would have several disadvantages:\r\n- if the mock is wrong, and behaves incorrectly (e.g. a typo such as AKS instead of ASK), or any problem with the protocol, the test will pass and we won't realize the code is bad (e.g. this PR fixes a character case issue)\r\n- may go outdated if redis is changed and the tests will still pass.\r\n\r\nI see two other possibilities if we wanna test it (p.s. i'm also ok with not testing it).\r\n1. add some test suite infra (maybe in server.tcl) that let's us bring up a single redis server that's part of an imaginary cluster. i.e. create a server that behaves as a cluster node (thinks it's part of a cluster), but without actually creating a cluster.\r\n2. i see the cluster tests (`./tests/cluster/*`) do interact with redis-cli, so i suppose we can add a cli-test in that folder using the framework to create clusters.",
        "createdAt" : "2021-05-26T05:43:23Z",
        "updatedAt" : "2021-05-26T05:43:33Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "7cc2ea0b-b73e-4568-8909-5d83bc11d03a",
        "parentId" : "5581b77e-8873-4413-b9dc-e38790f4a712",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "@oranagra Thanks ;-)\r\n\r\nHow do you consistently provoke an ASK redirect in an \"imaginary cluster\" or a real cluster?\r\n\r\nAFAICT, the reason the ASK bug is there is that there was no way to test it, so not testing it at all would definitely be sub optimal.\r\n\r\nOf course the mocked Redis can be wrong. That's why it needs to be minimal and with as little logic as possible. We can test the mocked Redis by checking that it's consistent with real Redis for some regular commands. We can use redis-cli to do that in a test case. How about that?\r\n\r\nMocked Redis is used to test ASK redirects in client libs. It's the only way to test it that I've found actually. To consistently provoke it in real redis would require injecting some sleep/pause in the cluster migration.",
        "createdAt" : "2021-05-26T09:54:51Z",
        "updatedAt" : "2021-05-26T09:54:51Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      },
      {
        "id" : "2671b0c4-6b67-4ff4-83d7-aca5c90e8ffd",
        "parentId" : "5581b77e-8873-4413-b9dc-e38790f4a712",
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "we have `DEBUG AOF-FLUSH-SLEEP` and `CONFIG SET key-load-delay`.\r\nso maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli).",
        "createdAt" : "2021-05-26T12:26:22Z",
        "updatedAt" : "2021-05-26T12:26:22Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "f8346d8b-051a-40a1-9fd0-bae2ac21ff21",
        "parentId" : "5581b77e-8873-4413-b9dc-e38790f4a712",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "> maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli)\r\n\r\nThere is no real test for Redis sending ASK redirects correctly. That can be added with such a mechanism.",
        "createdAt" : "2021-05-26T12:40:30Z",
        "updatedAt" : "2021-05-26T12:40:30Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      }
    ],
    "commit" : "f03f5586e8d57e8cf324d6aefd4ffd5370337507",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +4,8 @@#\n# Commands are given as space-separated strings, e.g. \"GET foo\", and replies as\n# RESP-encoded replies minus the trailing \\r\\n, e.g. \"+OK\".\n\nset port [lindex $argv 0];"
  },
  {
    "id" : "dd4bf093-d101-4377-94fe-5b56d0608016",
    "prId" : 8930,
    "prUrl" : "https://github.com/redis/redis/pull/8930#pullrequestreview-668965647",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6eb06125-26fa-4cab-b410-c4fff58e762f",
        "parentId" : null,
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "@zuiderkwast i truly admire the resourcefulness, but i'm not sure we wanna go down that road.\r\nmocking redis would only be useful to test redis tooling (such as redis-cli), and i think would have several disadvantages:\r\n- if the mock is wrong, and behaves incorrectly (e.g. a typo such as AKS instead of ASK), or any problem with the protocol, the test will pass and we won't realize the code is bad (e.g. this PR fixes a character case issue)\r\n- may go outdated if redis is changed and the tests will still pass.\r\n\r\nI see two other possibilities if we wanna test it (p.s. i'm also ok with not testing it).\r\n1. add some test suite infra (maybe in server.tcl) that let's us bring up a single redis server that's part of an imaginary cluster. i.e. create a server that behaves as a cluster node (thinks it's part of a cluster), but without actually creating a cluster.\r\n2. i see the cluster tests (`./tests/cluster/*`) do interact with redis-cli, so i suppose we can add a cli-test in that folder using the framework to create clusters.",
        "createdAt" : "2021-05-26T05:43:23Z",
        "updatedAt" : "2021-05-26T05:43:33Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "20b5d769-4b3e-4753-8e35-ec44f7d51efb",
        "parentId" : "6eb06125-26fa-4cab-b410-c4fff58e762f",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "@oranagra Thanks ;-)\r\n\r\nHow do you consistently provoke an ASK redirect in an \"imaginary cluster\" or a real cluster?\r\n\r\nAFAICT, the reason the ASK bug is there is that there was no way to test it, so not testing it at all would definitely be sub optimal.\r\n\r\nOf course the mocked Redis can be wrong. That's why it needs to be minimal and with as little logic as possible. We can test the mocked Redis by checking that it's consistent with real Redis for some regular commands. We can use redis-cli to do that in a test case. How about that?\r\n\r\nMocked Redis is used to test ASK redirects in client libs. It's the only way to test it that I've found actually. To consistently provoke it in real redis would require injecting some sleep/pause in the cluster migration.",
        "createdAt" : "2021-05-26T09:54:51Z",
        "updatedAt" : "2021-05-26T09:54:51Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      },
      {
        "id" : "abe7ab1c-65df-4324-aeb6-1be6db16d10f",
        "parentId" : "6eb06125-26fa-4cab-b410-c4fff58e762f",
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "we have `DEBUG AOF-FLUSH-SLEEP` and `CONFIG SET key-load-delay`.\r\nso maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli).",
        "createdAt" : "2021-05-26T12:26:22Z",
        "updatedAt" : "2021-05-26T12:26:22Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "c1ad3258-8514-4086-8c31-100c2afbec39",
        "parentId" : "6eb06125-26fa-4cab-b410-c4fff58e762f",
        "authorId" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "body" : "> maybe it's time to add something similar to be able to consistently debug ASK (may help other tests, not just redis-cli)\r\n\r\nThere is no real test for Redis sending ASK redirects correctly. That can be added with such a mechanism.",
        "createdAt" : "2021-05-26T12:40:30Z",
        "updatedAt" : "2021-05-26T12:40:30Z",
        "lastEditedBy" : "c6fac63b-ee5a-4181-b121-48bfacc74a59",
        "tags" : [
        ]
      }
    ],
    "commit" : "f03f5586e8d57e8cf324d6aefd4ffd5370337507",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +4,8 @@#\n# Commands are given as space-separated strings, e.g. \"GET foo\", and replies as\n# RESP-encoded replies minus the trailing \\r\\n, e.g. \"+OK\".\n\nset port [lindex $argv 0];"
  }
]