[
  {
    "id" : "3306c21d-de1e-4575-898e-61eb05ab6ada",
    "prId" : 1899,
    "prUrl" : "https://github.com/scalameta/scalameta/pull/1899#pullrequestreview-280378507",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "41d74d24-e890-4f50-93d9-6d10ed4f850f",
        "parentId" : null,
        "authorId" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "body" : "I'm not sure if the expected behavior here is `endsWith(\"hello/\")` or `endsWith(\"hello\")`. I don't mind either way however, as long as `toURI` doesn't crash.",
        "createdAt" : "2019-08-26T01:19:53Z",
        "updatedAt" : "2019-08-26T01:19:54Z",
        "lastEditedBy" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "tags" : [
        ]
      },
      {
        "id" : "65c8af93-e3a1-4d9a-9a76-432ec63015df",
        "parentId" : "41d74d24-e890-4f50-93d9-6d10ed4f850f",
        "authorId" : "63b51283-567f-4539-99e1-a4113af6fbc8",
        "body" : "Given the comments over [here](https://github.com/scalameta/scalameta/blob/47a08dd299d33aa6574f1eaef83c06df6d193d1a/scalameta/io/shared/src/main/scala/scala/meta/io/AbsolutePath.scala#L21-L32) about URI.resolve behavior pivoting on existence of a trailing slash, it seems that we'd prefer `hello/`.  If the slash is not there, then there's a risk that subsequent attempts to resolve within `hello` actually return something that's outside of it. Something like `hello.resolve(\"goodbye\")` right here might demonstrate the issue (assuming it's not some quirk of a particular JVM version or filesystem).\r\n\r\nI can take a closer look tomorrow.",
        "createdAt" : "2019-08-26T15:24:55Z",
        "updatedAt" : "2019-08-26T15:24:55Z",
        "lastEditedBy" : "63b51283-567f-4539-99e1-a4113af6fbc8",
        "tags" : [
        ]
      },
      {
        "id" : "cd03b5a7-e5c3-48be-9233-a37948c3f6b0",
        "parentId" : "41d74d24-e890-4f50-93d9-6d10ed4f850f",
        "authorId" : "63b51283-567f-4539-99e1-a4113af6fbc8",
        "body" : "Experimenting more this AM, resolving URIs relative to a `jar:` behaves... surprisingly.\r\n\r\n```\r\n// jar: prefix seems to prevent meaningful relative resolve() ...\r\nscala> URI.create(\"jar:file:///tmp/foo.jar!/hello\").resolve(\"foo\")\r\nres19: java.net.URI = foo\r\n\r\n// Trailing slash does not help.\r\nscala> URI.create(\"jar:file:///tmp/foo.jar!/hello/\").resolve(\"foo\")\r\nres20: java.net.URI = foo\r\n\r\n// If we drop the jar: prefix we're back to meaningful relative resolve() ...\r\nscala> URI.create(\"file:///tmp/foo.jar!/hello/\").resolve(\"foo\")\r\nres21: java.net.URI = file:/tmp/foo.jar!/hello/foo\r\n\r\n// ... but trailing slash still required for \"resolve relative to a directory\"\r\nscala> URI.create(\"file:///tmp/foo.jar!/hello\").resolve(\"foo\")\r\nres22: java.net.URI = file:/tmp/foo.jar!/foo\r\n```\r\n\r\nNot sure what, if anything, to do w/ this. Still feels marginally more consistent to return a trailing slash from `toURI(isDirectory = true)`, but actual impact downstream in the case of a JAR FS is unclear to me.",
        "createdAt" : "2019-08-27T14:16:25Z",
        "updatedAt" : "2019-08-27T14:16:26Z",
        "lastEditedBy" : "63b51283-567f-4539-99e1-a4113af6fbc8",
        "tags" : [
        ]
      },
      {
        "id" : "7a39e8a0-7c67-46f2-bc7f-03a1eaf0f31e",
        "parentId" : "41d74d24-e890-4f50-93d9-6d10ed4f850f",
        "authorId" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "body" : "I agree, it's not clear to me exactly how URIs inside jars should behave. I don't think we currently use them for anything meaningful, my primary motivation for this PR was just to at least avoid the exception.",
        "createdAt" : "2019-08-27T18:07:08Z",
        "updatedAt" : "2019-08-27T18:07:08Z",
        "lastEditedBy" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "tags" : [
        ]
      },
      {
        "id" : "858ec7fc-8d59-40b3-b9ed-7327ddcf6c55",
        "parentId" : "41d74d24-e890-4f50-93d9-6d10ed4f850f",
        "authorId" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "body" : "I agree that `hello/` would be more suitable but I wouldn't worry about it since directory entries inside jar files are not used for any application that I'm aware of. I hit on this issue only while experimenting with something and I did a `println(path.toURI)`",
        "createdAt" : "2019-08-27T18:09:35Z",
        "updatedAt" : "2019-08-27T18:09:36Z",
        "lastEditedBy" : "bd90d0d4-3cfe-485f-b03d-29764e6b2eae",
        "tags" : [
        ]
      }
    ],
    "commit" : "1040556d62af3352f9f9a164d95f9395c356be4f",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +96,100 @@        val hello = root.resolve(\"hello\")\n        Files.createDirectories(hello.toNIO)\n        assert(hello.toURI.toString.endsWith(\"hello\"))\n      }\n    }"
  }
]