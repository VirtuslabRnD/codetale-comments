[
  {
    "id" : "fcfc310a-f959-44b0-b378-e436ca696591",
    "prId" : 7443,
    "prUrl" : "https://github.com/apache/kafka/pull/7443#pullrequestreview-301512065",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d8bb3938-8242-4651-a69c-eeeb1157e3ea",
        "parentId" : null,
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "I'd suggest we make one step further, to just make the `sessionPartitions` a local variable only: this is because in later handling logic after the response is sent back, we only need `sessionPartitions.keySet / size` only, which we could maintain separately as a member field which is populated after the build() call. WDYT?",
        "createdAt" : "2019-10-14T20:02:35Z",
        "updatedAt" : "2019-10-15T22:47:30Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      },
      {
        "id" : "ba9503d5-334e-4c58-8f31-399998c9587c",
        "parentId" : "d8bb3938-8242-4651-a69c-eeeb1157e3ea",
        "authorId" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "body" : "NVM I realized now you also need the `sessionPartitions` for saving one fetch state copying as well.",
        "createdAt" : "2019-10-14T20:07:06Z",
        "updatedAt" : "2019-10-15T22:47:30Z",
        "lastEditedBy" : "eba565e8-e1d5-4749-9c9a-5d117de6c96c",
        "tags" : [
        ]
      }
    ],
    "commit" : "1aa07f40ac1c69349f51604ba85e44344e1644d2",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +186,190 @@         * incremental fetch requests (see below).\n         */\n        private LinkedHashMap<TopicPartition, PartitionData> next;\n        private final boolean copySessionPartitions;\n"
  },
  {
    "id" : "731db868-45a1-4ecc-8823-ff7a27cba11c",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-585901065",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f47d8fdf-a304-4e9c-8d24-360a736a11b5",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Is there a reason to use 0 instead of the default capacity for the hashmap?",
        "createdAt" : "2021-02-03T23:41:13Z",
        "updatedAt" : "2021-05-05T20:29:40Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "fe151ffa-e2f4-45ea-ae79-ac7ee131aa55",
        "parentId" : "f47d8fdf-a304-4e9c-8d24-360a736a11b5",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "I think I was just matching `sessionPartitions` above",
        "createdAt" : "2021-02-08T20:37:24Z",
        "updatedAt" : "2021-05-05T20:29:40Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 24,
    "diffHunk" : "@@ -1,1 +80,84 @@     * All of the topic ids mapped to topic names for topics which exist in the fetch request session.\n     */\n    private Map<String, Uuid> sessionTopicIds = new HashMap<>(0);\n\n    /**"
  },
  {
    "id" : "76753d55-763a-4e1e-ae3f-c7e18953bb4f",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-589010876",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1bec2551-a9f7-44d5-8dc9-6e02945b1174",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "We could probably just get rid of session since it's part of the session object. Ditto below.",
        "createdAt" : "2021-02-03T23:45:03Z",
        "updatedAt" : "2021-05-05T20:29:40Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "387a7740-8e90-4603-a3f0-30077f6456c6",
        "parentId" : "1bec2551-a9f7-44d5-8dc9-6e02945b1174",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "Get rid of the word session in the variable name? I was following sessionPartitions as above. \r\nOr get rid of this altogether?",
        "createdAt" : "2021-02-11T21:42:38Z",
        "updatedAt" : "2021-05-05T20:29:40Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +85,89 @@     * All of the topic names mapped to topic ids for topics which exist in the fetch request session.\n     */\n    private Map<Uuid, String> sessionTopicNames = new HashMap<>(0);\n\n    public Map<Uuid, String> sessionTopicNames() {"
  },
  {
    "id" : "0699d261-db7b-4f11-86f6-307dfc858848",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-580765332",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "47800b77-581e-4cfd-a968-b4fbf0277e73",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Now that the constructor code is a bit more now, perhaps we could just forward `Builder()` to `Builder(int initialSize, boolean copySessionPartitions) `?",
        "createdAt" : "2021-02-03T23:48:16Z",
        "updatedAt" : "2021-05-05T20:29:40Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 157,
    "diffHunk" : "@@ -1,1 +257,261 @@        Builder() {\n            this.next = new LinkedHashMap<>();\n            this.topicIds = new HashMap<>();\n            this.copySessionPartitions = true;\n        }"
  },
  {
    "id" : "bbb0528e-bbe8-47db-a4fd-56e85b4d2ad3",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-653562033",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4f14dc2b-7bcc-4894-8ad2-4225970a84a2",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Do the new fields need to be included in toString()?",
        "createdAt" : "2021-05-05T21:57:30Z",
        "updatedAt" : "2021-05-06T01:32:08Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "05cceef5-5699-4c1a-a338-9ec20e7e0527",
        "parentId" : "4f14dc2b-7bcc-4894-8ad2-4225970a84a2",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "I wasn't sure on this, but I can add them. Maybe it makes sense just to add topicIds though? (not both maps)",
        "createdAt" : "2021-05-06T15:26:58Z",
        "updatedAt" : "2021-05-06T15:26:59Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 86,
    "diffHunk" : "@@ -1,1 +166,170 @@\n        public Map<String, Uuid> topicIds() {\n            return topicIds;\n        }\n"
  },
  {
    "id" : "c7928807-4900-4f29-9c66-0db9f24a8607",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-653559903",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2daa3d5a-9c3f-4eae-bac1-97b77fa4dc8c",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Could we build the full toSendTopicIds and toSendTopicNames once and reuse in both full and incremental?",
        "createdAt" : "2021-05-05T22:09:42Z",
        "updatedAt" : "2021-05-06T01:32:08Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "d8d75d79-aff5-4832-b444-5889e36ccc7f",
        "parentId" : "2daa3d5a-9c3f-4eae-bac1-97b77fa4dc8c",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "Would this work if we added a new topic to the session? I would think that we would need to add the new topic's info and the map is unmodifiable. Please correct me if this is not the case.",
        "createdAt" : "2021-05-06T15:25:02Z",
        "updatedAt" : "2021-05-06T15:25:03Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 209,
    "diffHunk" : "@@ -1,1 +307,311 @@                Map<String, Uuid> toSendTopicIds =\n                    Collections.unmodifiableMap(new HashMap<>(sessionTopicIds));\n                Map<Uuid, String> toSendTopicNames =\n                    Collections.unmodifiableMap(new HashMap<>(sessionTopicNames));\n                return new FetchRequestData(toSend, Collections.emptyList(), toSend, toSendTopicIds, toSendTopicNames, nextMetadata, canUseTopicIds);"
  },
  {
    "id" : "1db17155-53f8-4c03-ac79-9076105b59f9",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-650729950",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "16b7d4e7-7d9e-4fcc-9f2c-0c8a0979e448",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "The above comment needs to be changed accordingly.",
        "createdAt" : "2021-05-05T22:10:50Z",
        "updatedAt" : "2021-05-06T01:32:08Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 262,
    "diffHunk" : "@@ -1,1 +408,412 @@     * Return missing items which are expected to be in a particular set, but which are not.\n     *\n     * @param toFind    The items to look for.\n     * @param toSearch  The set of items to search.\n     * @return          null if all items were found; some of the missing ones in a set, if not."
  },
  {
    "id" : "a98453de-1483-43c2-8b39-b9c8882cf2bf",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-650729950",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "13427427-8a89-448a-92b6-5c9bf18221d6",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Perhaps extra and omitted should be extraPartition and omittedPartitions to make it clear?",
        "createdAt" : "2021-05-05T22:14:32Z",
        "updatedAt" : "2021-05-06T01:32:08Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 295,
    "diffHunk" : "@@ -1,1 +433,437 @@        StringBuilder bld = new StringBuilder();\n        Set<TopicPartition> extra =\n            findMissing(topicPartitions, sessionPartitions.keySet());\n        Set<TopicPartition> omitted =\n            findMissing(sessionPartitions.keySet(), topicPartitions);"
  },
  {
    "id" : "5921c892-0482-4370-9aeb-8bad4ad36c65",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-683470393",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8449123e-d979-42a8-aff4-2d31cc0b40e0",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Does this work with topic recreation? Will a client be stuck with the old topicId when topic is recreated?",
        "createdAt" : "2021-06-14T16:28:37Z",
        "updatedAt" : "2021-06-14T22:25:42Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "e6b16cea-b9a8-4360-928f-05b781f297fc",
        "parentId" : "8449123e-d979-42a8-aff4-2d31cc0b40e0",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "If we try to put in a new topic ID, the session should be closed. ",
        "createdAt" : "2021-06-14T23:00:22Z",
        "updatedAt" : "2021-06-14T23:00:22Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      },
      {
        "id" : "7b1f6817-3003-4244-8749-0db9c3964274",
        "parentId" : "8449123e-d979-42a8-aff4-2d31cc0b40e0",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "Ah I see what you are saying here. I think this will still close the session when we send the request. The other option is to set a boolean similar to `missingTopicId` (maybe just change to `inconsistentTopicId` that signals to close the session earlier (upon build)",
        "createdAt" : "2021-06-14T23:02:23Z",
        "updatedAt" : "2021-06-14T23:02:23Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      },
      {
        "id" : "c470a9a2-7354-4867-832b-c3933c533373",
        "parentId" : "8449123e-d979-42a8-aff4-2d31cc0b40e0",
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Got it.  We can keep the code as it is then.",
        "createdAt" : "2021-06-15T15:59:07Z",
        "updatedAt" : "2021-06-15T16:19:32Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 175,
    "diffHunk" : "@@ -1,1 +274,278 @@            // topicIds should not change between adding partitions and building, so we can use putIfAbsent\n            if (!topicId.equals(Uuid.ZERO_UUID)) {\n                topicIds.putIfAbsent(topicPartition.topic(), topicId);\n            } else {\n                partitionsWithoutTopicIds++;"
  },
  {
    "id" : "f14ec596-3bef-4c52-bbd6-319847c9ce4f",
    "prId" : 9944,
    "prUrl" : "https://github.com/apache/kafka/pull/9944#pullrequestreview-683422938",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "68de7c36-73ca-42cf-bce8-252b2a6d5f99",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Should we set sessionTopicIds and sessionTopicNames to empty map if canUseTopicIds is false?",
        "createdAt" : "2021-06-14T17:04:08Z",
        "updatedAt" : "2021-06-14T22:25:42Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "e9ba141d-894a-454b-a17e-718a5ba6270d",
        "parentId" : "68de7c36-73ca-42cf-bce8-252b2a6d5f99",
        "authorId" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "body" : "That makes sense to me.",
        "createdAt" : "2021-06-14T23:02:46Z",
        "updatedAt" : "2021-06-14T23:02:46Z",
        "lastEditedBy" : "a31dcef8-b459-4b48-bb49-44e910fa9f34",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a47290d9a46db70b9ed3273ddafedbc8827e8da",
    "line" : 195,
    "diffHunk" : "@@ -1,1 +294,298 @@                next = null;\n                // Only add topic IDs to the session if we are using topic IDs.\n                if (canUseTopicIds) {\n                    sessionTopicIds = topicIds;\n                    sessionTopicNames = new HashMap<>(topicIds.size());"
  }
]