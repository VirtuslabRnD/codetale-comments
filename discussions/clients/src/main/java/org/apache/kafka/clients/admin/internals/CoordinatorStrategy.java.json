[
  {
    "id" : "2a110583-22a0-4d6a-81bf-5704aef1b91c",
    "prId" : 10483,
    "prUrl" : "https://github.com/apache/kafka/pull/10483#pullrequestreview-629165745",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "20105068-93e2-4ae7-b86d-f2276851e258",
        "parentId" : null,
        "authorId" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "body" : "Will we support batching lookups in the future?",
        "createdAt" : "2021-04-06T06:50:10Z",
        "updatedAt" : "2021-04-22T01:32:58Z",
        "lastEditedBy" : "12f98c82-b9ef-4668-aa6f-5a62bf3439bb",
        "tags" : [
        ]
      },
      {
        "id" : "0df2ad5f-9b13-472a-926d-198ab1018637",
        "parentId" : "20105068-93e2-4ae7-b86d-f2276851e258",
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "Yes, a future version of FindCoordinator could implement that. Then we'll just have to decide how to propagate the version to the lookup strategy. I don't think it would be too difficult.",
        "createdAt" : "2021-04-06T16:18:05Z",
        "updatedAt" : "2021-04-22T01:32:58Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      }
    ],
    "commit" : "05155a22d065e9e7e6f165d40555269902e6abec",
    "line" : 45,
    "diffHunk" : "@@ -1,1 +43,47 @@        // The `FindCoordinator` API does not support batched lookups, so we use a\n        // separate lookup context for each coordinator key we need to lookup\n        return new LookupRequestScope(key);\n    }\n"
  },
  {
    "id" : "5b4c3745-a302-4e73-b8dd-7dd25b2c43a7",
    "prId" : 10483,
    "prUrl" : "https://github.com/apache/kafka/pull/10483#pullrequestreview-632351224",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "25265a88-0073-47e6-972d-c78c22a4cdcf",
        "parentId" : null,
        "authorId" : "59ca7821-b29c-4f24-a9d5-cbd394145686",
        "body" : "I would mention the error in the message here as well.",
        "createdAt" : "2021-04-09T12:46:23Z",
        "updatedAt" : "2021-04-22T01:32:58Z",
        "lastEditedBy" : "59ca7821-b29c-4f24-a9d5-cbd394145686",
        "tags" : [
        ]
      }
    ],
    "commit" : "05155a22d065e9e7e6f165d40555269902e6abec",
    "line" : 87,
    "diffHunk" : "@@ -1,1 +85,89 @@            default:\n                return LookupResult.failed(key, error.exception(\"FindCoordinator request for key \" +\n                    \"`\" + key + \"` failed due to an unexpected error\"));\n        }\n    }"
  },
  {
    "id" : "3e3b5d27-bf90-4d97-acb2-2dbb6f248005",
    "prId" : 10743,
    "prUrl" : "https://github.com/apache/kafka/pull/10743#pullrequestreview-688105050",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "32c7fc1b-15b0-4809-8dd4-8742bea0968d",
        "parentId" : null,
        "authorId" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "body" : "Would we consider something like `COORDINATOR_NOT_AVAILABLE` a transient exception that we should retry on? I'm a bit confused since we don't log anything or do a `break` on this case. In either case, I think we should log + put it in the `failedKeys` map if we think that that kind of exception should be considered a failure, or let it be if we think it should be a more transient error.",
        "createdAt" : "2021-06-17T01:29:07Z",
        "updatedAt" : "2021-06-17T02:31:19Z",
        "lastEditedBy" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "tags" : [
        ]
      },
      {
        "id" : "3d8175aa-fd35-4c66-98a2-42b44b4d4688",
        "parentId" : "32c7fc1b-15b0-4809-8dd4-8742bea0968d",
        "authorId" : "d31db46e-de6d-4fea-8dc5-6f7b17b636be",
        "body" : "This is the current behaviour, when hitting these errors, we retry the find coordinator request. The way to signal we want to retry is to omit the key in the return value of `handleResponse()`, see https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/admin/internals/AdminApiLookupStrategy.java#L71-L74\r\n\r\nSo I think we want to keep it as it is.",
        "createdAt" : "2021-06-17T15:26:43Z",
        "updatedAt" : "2021-06-17T15:28:31Z",
        "lastEditedBy" : "d31db46e-de6d-4fea-8dc5-6f7b17b636be",
        "tags" : [
        ]
      },
      {
        "id" : "c7c24a29-3d3a-4c94-aa50-b81ad73c3bec",
        "parentId" : "32c7fc1b-15b0-4809-8dd4-8742bea0968d",
        "authorId" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "body" : "@mimaison Gotcha, makes sense. Can we still we can still log at `DEBUG` level? In case we need to debug, we have evidence of this in the logs.",
        "createdAt" : "2021-06-21T07:23:18Z",
        "updatedAt" : "2021-06-21T07:26:27Z",
        "lastEditedBy" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae09d742171c8a3a7d60587ce0502dce35945f73",
    "line" : 150,
    "diffHunk" : "@@ -1,1 +151,155 @@                mappedKeys.put(key, nodeId);\n                break;\n            case COORDINATOR_NOT_AVAILABLE:\n            case COORDINATOR_LOAD_IN_PROGRESS:\n                log.debug(\"FindCoordinator request for key {} returned topic-level error {}. Will retry\","
  },
  {
    "id" : "84fb816f-8e20-4b62-a0da-c2e3c6120cab",
    "prId" : 10743,
    "prUrl" : "https://github.com/apache/kafka/pull/10743#pullrequestreview-686379008",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e9d7a8fd-fac3-4042-a4e9-4511fa0ec431",
        "parentId" : null,
        "authorId" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "body" : "Just for my understanding, we are reverting to the old request format here in case the broker is an older version than the `AdminClient` right?",
        "createdAt" : "2021-06-17T01:42:50Z",
        "updatedAt" : "2021-06-17T02:31:19Z",
        "lastEditedBy" : "0437327f-f1bc-4c4a-b258-4c8dd6851ac9",
        "tags" : [
        ]
      },
      {
        "id" : "12fea00f-d31c-4022-bd03-51e837cf96e9",
        "parentId" : "e9d7a8fd-fac3-4042-a4e9-4511fa0ec431",
        "authorId" : "d31db46e-de6d-4fea-8dc5-6f7b17b636be",
        "body" : "Yes that's right, this is for request version < 4",
        "createdAt" : "2021-06-17T14:24:17Z",
        "updatedAt" : "2021-06-17T14:24:17Z",
        "lastEditedBy" : "d31db46e-de6d-4fea-8dc5-6f7b17b636be",
        "tags" : [
        ]
      }
    ],
    "commit" : "ae09d742171c8a3a7d60587ce0502dce35945f73",
    "line" : 76,
    "diffHunk" : "@@ -1,1 +81,85 @@                new FindCoordinatorRequestData()\n                    .setKey(key.idValue)\n                    .setKeyType(key.type.id())\n            );\n        }"
  }
]