[
  {
    "id" : "435eb181-6b57-4ddf-818b-4cf37385a956",
    "prId" : 16992,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1d42f3c2-d0e5-4347-ad8c-4840795acf3f",
        "parentId" : null,
        "authorId" : "aefa6d0d-0ad0-4062-966c-ddc56e70652b",
        "body" : "I see the loop has been changed to avoid copying `wildports[i]` into `entry`. I'm not sure how/why this fixes the problem that you've identified because in the code (a) `entry` is copied into `mapping` via `append`, and; (b) we don't reference `wildports` after the loop completes.\n",
        "createdAt" : "2015-11-09T18:24:29Z",
        "updatedAt" : "2015-11-11T20:28:41Z",
        "lastEditedBy" : "aefa6d0d-0ad0-4062-966c-ddc56e70652b",
        "tags" : [
        ]
      },
      {
        "id" : "b11bfcef-7e84-492e-95d3-44b3438f21ea",
        "parentId" : "1d42f3c2-d0e5-4347-ad8c-4840795acf3f",
        "authorId" : "4be57fbb-0697-4123-9503-46e35adbceee",
        "body" : "see https://github.com/mesosphere/kubernetes-mesos/issues/614 and the new unit test case.\nin https://github.com/kubernetes/kubernetes/blob/17defc7383914c1f52d30ab4a46e0992cbfc2bae/contrib/mesos/pkg/scheduler/podtask/port_mapping.go#L110 , the copy of the map value is being updated and in above line, it is expecting to hold that value in next outer loop iteration.\n",
        "createdAt" : "2015-11-09T19:40:07Z",
        "updatedAt" : "2015-11-11T20:28:41Z",
        "lastEditedBy" : "4be57fbb-0697-4123-9503-46e35adbceee",
        "tags" : [
        ]
      },
      {
        "id" : "3dfdf449-f9ea-486b-8776-73655996b304",
        "parentId" : "1d42f3c2-d0e5-4347-ad8c-4840795acf3f",
        "authorId" : "aefa6d0d-0ad0-4062-966c-ddc56e70652b",
        "body" : "I forgot to review foreachRange. That's why this change is important. The\nchange must be made to `wildports`, not a copy `entry`.\n\nOn Mon, Nov 9, 2015 at 2:40 PM, ravilr notifications@github.com wrote:\n\n> In contrib/mesos/pkg/scheduler/podtask/port_mapping.go\n> https://github.com/kubernetes/kubernetes/pull/16992#discussion_r44320308\n> :\n> \n> > @@ -99,16 +99,16 @@ func wildcardHostPortMapping(t *T, offer *mesos.Offer) ([]HostPortMapping, error\n> >     remaining := len(wildports)\n> >     foreachRange(offer, \"ports\", func(bp, ep uint64) {\n> >         log.V(3).Infof(\"Searching for wildcard port in range {%d:%d}\", bp, ep)\n> > -       for _, entry := range wildports {\n> > -           if entry.OfferPort != 0 {\n> > -       for i := range wildports {\n> > -           if wildports[i].OfferPort != 0 {\n> \n> see mesosphere/kubernetes-mesos#614\n> https://github.com/mesosphere/kubernetes-mesos/issues/614 and the new\n> unit test case.\n> in\n> https://github.com/kubernetes/kubernetes/blob/17defc7383914c1f52d30ab4a46e0992cbfc2bae/contrib/mesos/pkg/scheduler/podtask/port_mapping.go#L110\n> , the copy of the map value is being updated and in above line, it is\n> expecting to hold that value in next outer loop iteration.\n> \n> â€”\n> Reply to this email directly or view it on GitHub\n> https://github.com/kubernetes/kubernetes/pull/16992/files#r44320308.\n",
        "createdAt" : "2015-11-09T19:51:16Z",
        "updatedAt" : "2015-11-11T20:28:41Z",
        "lastEditedBy" : "aefa6d0d-0ad0-4062-966c-ddc56e70652b",
        "tags" : [
        ]
      }
    ],
    "commit" : "fe8658b0414b90b6c02a071d87cf6965c34c2b49",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +101,105 @@\t\tlog.V(3).Infof(\"Searching for wildcard port in range {%d:%d}\", bp, ep)\n\t\tfor i := range wildports {\n\t\t\tif wildports[i].OfferPort != 0 {\n\t\t\t\tcontinue\n\t\t\t}"
  }
]