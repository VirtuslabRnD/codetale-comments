[
  {
    "id" : "4c6eb1e3-c098-453c-b6af-f8764397b1b7",
    "prId" : 4876,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "472a15b9-3744-49b4-a5a7-25e6908540f0",
        "parentId" : null,
        "authorId" : "7766e039-aa4c-4476-9091-5cc8763fa8d6",
        "body" : "Is there any reason you used \"sudo bash\" instead of the \"sudo sh\" from the examples in the documentation?\n",
        "createdAt" : "2015-02-26T23:10:34Z",
        "updatedAt" : "2015-02-26T23:18:32Z",
        "lastEditedBy" : "7766e039-aa4c-4476-9091-5cc8763fa8d6",
        "tags" : [
        ]
      },
      {
        "id" : "8932eef4-4a84-469a-8d6f-51308bf94369",
        "parentId" : "472a15b9-3744-49b4-a5a7-25e6908540f0",
        "authorId" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "body" : "I think it now needs to be `bash` -- is that right @mr-salty ?\nThe script fails with `sh`\n",
        "createdAt" : "2015-02-26T23:17:40Z",
        "updatedAt" : "2015-02-26T23:24:01Z",
        "lastEditedBy" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "tags" : [
        ]
      },
      {
        "id" : "208dc79f-f611-489b-b1f9-fdad1da32f64",
        "parentId" : "472a15b9-3744-49b4-a5a7-25e6908540f0",
        "authorId" : "320994b1-dcea-439e-bdae-ff479bd76d54",
        "body" : "Yes, the it does actually require bash now, it will not work with sh as you noted.  it uses [[ as well as shell functions.\n",
        "createdAt" : "2015-02-27T00:07:34Z",
        "updatedAt" : "2015-02-27T00:11:29Z",
        "lastEditedBy" : "320994b1-dcea-439e-bdae-ff479bd76d54",
        "tags" : [
        ]
      }
    ],
    "commit" : "16f49f6d09b7bdc9b6674d9ca3885625b303b0ca",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +17,21 @@    apt-get -y install curl && \\\n    apt-get clean && \\\n    curl -s https://storage.googleapis.com/signals-agents/logging/google-fluentd-install.sh | sudo bash\n\n# Copy the Fluentd configuration file for logging Docker container logs."
  },
  {
    "id" : "b011d699-282f-4f49-82b3-2d9d5c4afa20",
    "prId" : 2217,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bd801a1a-bea8-4551-b262-4479cebc8ac8",
        "parentId" : null,
        "authorId" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "body" : "We lost the comment about why fluentd needs to run as root.\n\nAlso, could we avoid running fluentd as root by changing the group of the docker logs?  Maybe ask on a docker forum?\n",
        "createdAt" : "2014-11-11T15:07:36Z",
        "updatedAt" : "2014-11-11T17:22:08Z",
        "lastEditedBy" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "tags" : [
        ]
      },
      {
        "id" : "7432f731-c140-486e-833a-353d1b9f7af8",
        "parentId" : "bd801a1a-bea8-4551-b262-4479cebc8ac8",
        "authorId" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "body" : "Sorry, I've added that line back. Personally, I think it is fine to run the log gathering agent as root. That's exactly what would have happened if we had invoked the Signals Fluentd install by gs://signals/.... | sh\nIt also seems quite idiomatic to run td-agent / google-fluentd as root based on what I have seen of other configurations. If we made Docker produce log files with some other user and group -- what would it be? We could use td-agent or google-fluentd as the user and group but perhaps that would not suit the needs of other programs that need to also access the log files. Perhaps keeping the log files with root permissions is the least worst common denominator choice.\n",
        "createdAt" : "2014-11-11T17:34:10Z",
        "updatedAt" : "2014-11-11T17:34:10Z",
        "lastEditedBy" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "tags" : [
        ]
      },
      {
        "id" : "41e1e616-fc48-4293-8802-c93dbc386994",
        "parentId" : "bd801a1a-bea8-4551-b262-4479cebc8ac8",
        "authorId" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "body" : "Ok.\n",
        "createdAt" : "2014-11-11T22:57:57Z",
        "updatedAt" : "2014-11-11T22:57:57Z",
        "lastEditedBy" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "tags" : [
        ]
      }
    ],
    "commit" : "cb496a365e35b7eb4b56ef757dae00620c08120f",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +24,28 @@ADD agent.conf /etc/google-fluentd/google-fluentd.conf\nCOPY catch-all-inputs.tar.gz /tmp/catch-all-inputs.tar.gz \nRUN tar -C /etc/google-fluentd -zxf /tmp/catch-all-inputs.tar.gz\nRUN sed -i~ -e \"s/\\(USER\\|GROUP\\)=google-fluentd/\\1=root/;\" /etc/init.d/google-fluentd\nRUN sed -i~ -e 's/ --use-v1-config//' /etc/init.d/google-fluentd"
  },
  {
    "id" : "a16cb1ac-b654-40c3-92db-5df56cb8f629",
    "prId" : 2217,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2452c778-f5a3-493e-beab-531f7f8f5c09",
        "parentId" : null,
        "authorId" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "body" : "Is this doing something different from the old line 25, or just more \"clever\"?\n",
        "createdAt" : "2014-11-11T15:08:20Z",
        "updatedAt" : "2014-11-11T17:22:08Z",
        "lastEditedBy" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "tags" : [
        ]
      },
      {
        "id" : "8f66bc1c-e8cc-4161-9324-b2e5b7b18bc3",
        "parentId" : "2452c778-f5a3-493e-beab-531f7f8f5c09",
        "authorId" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "body" : "Some background on this CL. The previous CL was written from scratch by me. Recently, the Signals team produced a new package for installing Fluentd and the configuration required to get it logging to Cloud Logging. Rather than taking an external dependency on a gs://signals/... location in this CL I have effectively in-lined their installation package. Consequently, some of the lines have changed e.g. the previous sed line where was written by me. The new sed line comes from inlining the Signals install. I'd like to follow the inline approach because then it makes easier to track any upstream changes in the Signals distribution and fold them in. I think it is important to inline the new install to make this image self-contained and not at risk of breaking due to a changed in gs://signals/...\nI hope this makes sense.\n",
        "createdAt" : "2014-11-11T17:26:00Z",
        "updatedAt" : "2014-11-11T17:26:00Z",
        "lastEditedBy" : "9d07de69-76c2-43bd-9590-55d9aded200d",
        "tags" : [
        ]
      },
      {
        "id" : "8000b5dc-61f1-4b47-81a4-f67208f81363",
        "parentId" : "2452c778-f5a3-493e-beab-531f7f8f5c09",
        "authorId" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "body" : "ok.\n",
        "createdAt" : "2014-11-11T22:58:23Z",
        "updatedAt" : "2014-11-11T22:58:23Z",
        "lastEditedBy" : "020e031c-c298-4e7e-a533-9a04439c203c",
        "tags" : [
        ]
      }
    ],
    "commit" : "cb496a365e35b7eb4b56ef757dae00620c08120f",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +25,29 @@COPY catch-all-inputs.tar.gz /tmp/catch-all-inputs.tar.gz \nRUN tar -C /etc/google-fluentd -zxf /tmp/catch-all-inputs.tar.gz\nRUN sed -i~ -e \"s/\\(USER\\|GROUP\\)=google-fluentd/\\1=root/;\" /etc/init.d/google-fluentd\nRUN sed -i~ -e 's/ --use-v1-config//' /etc/init.d/google-fluentd\n"
  }
]