[
  {
    "id" : "3de1976f-1441-4f39-98a2-962e4ec487d1",
    "prId" : 10271,
    "prUrl" : "https://github.com/apache/kafka/pull/10271#pullrequestreview-645632896",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ba6de748-9f0b-40e2-b307-ebd819472553",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Since we just need a single instance of this class, perhaps we could have a static public method to return the singleton and make the public constructor private?",
        "createdAt" : "2021-04-26T17:16:34Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "8cd49cec-baf6-4b92-bd9b-6640f02d3e82",
        "parentId" : "ba6de748-9f0b-40e2-b307-ebd819472553",
        "authorId" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "body" : "I prefer avoiding singletons if possible. I have changed this class to be open and extensible. :) This can be useful in the future if we need to extend this for tests or other purposes. \r\n",
        "createdAt" : "2021-04-27T09:21:07Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "tags" : [
        ]
      }
    ],
    "commit" : "b39e10877ba10d6805e6ba3a9b94e636eaa1777b",
    "line" : 37,
    "diffHunk" : "@@ -1,1 +35,39 @@ * for the messages that are stored in internal remote log metadata topic.\n */\npublic class RemoteLogMetadataSerde {\n    private static final short REMOTE_LOG_SEGMENT_METADATA_API_KEY = new RemoteLogSegmentMetadataRecord().apiKey();\n    private static final short REMOTE_LOG_SEGMENT_METADATA_UPDATE_API_KEY = new RemoteLogSegmentMetadataUpdateRecord().apiKey();"
  },
  {
    "id" : "e2189d8c-7bd7-4b48-afdc-a14fa3826540",
    "prId" : 10271,
    "prUrl" : "https://github.com/apache/kafka/pull/10271#pullrequestreview-649078134",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2640891c-e07b-44fb-8043-fba142b9d53f",
        "parentId" : null,
        "authorId" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "body" : "Hmm, why not instead allow the required maps (i.e. `remoteLogStorageClassToApiKey ` and `keyToTransform`) to be injected via an overloaded version of the constructor? As it stands, it feels overkill to me to ask the user to specialize this class just to inject these.",
        "createdAt" : "2021-04-28T08:16:33Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "tags" : [
        ]
      },
      {
        "id" : "a1bee2b5-2a88-4c3b-8490-3e7ac46daa91",
        "parentId" : "2640891c-e07b-44fb-8043-fba142b9d53f",
        "authorId" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "body" : "Users need to implement `ApiMessage newApiMessage(short apiKey)` method if they want to reuse this class.  I kept other map initializers also left for extension.  I do not have a strong opinion on that, I am fine with your suggestion to inject them through the constructor but they still need to extend this class to implement `newApiMessage(short apiKey)`.",
        "createdAt" : "2021-04-29T13:48:42Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "tags" : [
        ]
      },
      {
        "id" : "bedc3d5d-ec34-476f-9a3c-c2781ea88e08",
        "parentId" : "2640891c-e07b-44fb-8043-fba142b9d53f",
        "authorId" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "body" : "Addressed with the latest commit https://github.com/apache/kafka/pull/10271/commits/46e0597f17e03ac751dc320e0401ae50213bf8e0",
        "createdAt" : "2021-04-30T10:17:20Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "tags" : [
        ]
      }
    ],
    "commit" : "b39e10877ba10d6805e6ba3a9b94e636eaa1777b",
    "line" : 47,
    "diffHunk" : "@@ -1,1 +45,49 @@\n    public RemoteLogMetadataSerde() {\n        remoteLogStorageClassToApiKey = createRemoteLogStorageClassToApiKeyMap();\n        keyToTransform = createRemoteLogMetadataTransforms();\n        bytesApiMessageSerde = new BytesApiMessageSerde() {"
  },
  {
    "id" : "297a02ed-2936-4802-a473-8942d3c9a45d",
    "prId" : 10271,
    "prUrl" : "https://github.com/apache/kafka/pull/10271#pullrequestreview-647873370",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "06de6328-06c1-440e-a514-a4a5834109b6",
        "parentId" : null,
        "authorId" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "body" : "This 2-way map lookup feels a bit complex to me. It appears here the requirement is that you need the `apiKey` corresponding to the provided `RemoteLogMetadata`. To make it simpler, why not provide a `short apiKey()` abstract method in the `RemoteLogMetadata` base class and then ask the specializing classes to implement it? You will use then use the `remoteLogMetadata.apiKey()` method to get the apiKey here. This will avoid the need to maintain 2 maps within this class, you will only need the `remoteLogMetadataTransform` map.",
        "createdAt" : "2021-04-28T08:26:33Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "tags" : [
        ]
      },
      {
        "id" : "cfd37bac-d185-4e47-aa5b-1cb9e20eda7b",
        "parentId" : "06de6328-06c1-440e-a514-a4a5834109b6",
        "authorId" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "body" : "`apiKey` is an internal serialization detail of one of the implementations. We should not leak that to public API like `RemoteLogMetadata` and its subclasses.",
        "createdAt" : "2021-04-29T06:27:51Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "403b8bdd-d152-4255-86a7-0bdb3d2b40a5",
        "tags" : [
        ]
      },
      {
        "id" : "38751493-ff42-463c-ab1b-36043b99a646",
        "parentId" : "06de6328-06c1-440e-a514-a4a5834109b6",
        "authorId" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "body" : "I guess we can continue discussion here: https://github.com/apache/kafka/pull/10271#discussion_r622786068 ?",
        "createdAt" : "2021-04-29T07:08:57Z",
        "updatedAt" : "2021-05-04T04:53:22Z",
        "lastEditedBy" : "b4f52e78-c19e-46b4-b486-6da86e32e687",
        "tags" : [
        ]
      }
    ],
    "commit" : "b39e10877ba10d6805e6ba3a9b94e636eaa1777b",
    "line" : 78,
    "diffHunk" : "@@ -1,1 +76,80 @@\n    public byte[] serialize(RemoteLogMetadata remoteLogMetadata) {\n        Short apiKey = remoteLogStorageClassToApiKey.get(remoteLogMetadata.getClass().getName());\n        if (apiKey == null) {\n            throw new IllegalArgumentException(\"ApiKey for given RemoteStorageMetadata class: \" + remoteLogMetadata.getClass()"
  }
]