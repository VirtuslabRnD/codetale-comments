[
  {
    "id" : "23e426f2-420c-40d4-b3e7-1e9be1cb2300",
    "prId" : 76821,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/76821#pullrequestreview-228815577",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3dcbf898-64c8-4c10-9e77-14566dd17fac",
        "parentId" : null,
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "This seems overly complicated form of what is typically referred to as CreateOrUpdate, I don't think it needs to be a closure at this level",
        "createdAt" : "2019-04-19T17:37:03Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "a4933f3e-8705-4553-ae2f-e32b53f17871",
        "parentId" : "3dcbf898-64c8-4c10-9e77-14566dd17fac",
        "authorId" : "67bc6085-2cd9-4674-9dbc-d2a266f478be",
        "body" : "The problem with `CreateOrUpdate` is that it involves some boilerplate that needs repeating both in reset and when joining new control plane nodes (unmarshal cluster status, mutate, marshal cluster status back). Also, the whole repeat if conflict would need to be repeated in both places.\r\n\r\n`CreateOrMutateConfigMap` and `MutateConfigMap` approach this in a different way, you just implement the mutator and `MutateConfigMap` will take care of:\r\n\r\n1. Fetch the resource\r\n2. Callback to the mutator\r\n3. Update\r\n  3.1. If conflict, go to 1\r\n\r\nThe unmarshal cluster status, call to the cluster status mutator and marshal again removes boilerplate as well, so I think all in all makes sense to have smaller `ResetClusterStatusForNode` and `UploadConfiguration` functions that don't repeat this boilerplate.\r\n\r\n[1]",
        "createdAt" : "2019-04-19T18:05:39Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "67bc6085-2cd9-4674-9dbc-d2a266f478be",
        "tags" : [
        ]
      },
      {
        "id" : "8ba0c835-9641-46c5-b775-3d94c4820d5e",
        "parentId" : "3dcbf898-64c8-4c10-9e77-14566dd17fac",
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "k, I see why you're doing it this way now.  Thanks for the explanation. \r\n",
        "createdAt" : "2019-04-19T20:24:03Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      }
    ],
    "commit" : "bc8bafd825816844b1a93af98b22b86a3f32a65e",
    "line" : 58,
    "diffHunk" : "@@ -1,1 +46,50 @@\t\tnodeName, kubeadmconstants.KubeadmConfigConfigMap, metav1.NamespaceSystem)\n\n\treturn apiclient.MutateConfigMap(client, metav1.ObjectMeta{\n\t\tName:      kubeadmconstants.KubeadmConfigConfigMap,\n\t\tNamespace: metav1.NamespaceSystem,"
  },
  {
    "id" : "dfbd3fe3-d736-45a4-b611-5af1694cc530",
    "prId" : 76821,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/76821#pullrequestreview-228784516",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "888a49d3-925a-4821-8c5a-6f6a93e4fffd",
        "parentId" : null,
        "authorId" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "body" : "CreateOrUpdate",
        "createdAt" : "2019-04-19T17:40:39Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "f81960f6-a033-4403-bebf-c8ebb484e444",
        "tags" : [
        ]
      },
      {
        "id" : "e04d3d79-5d78-4007-ab81-a527f517afbe",
        "parentId" : "888a49d3-925a-4821-8c5a-6f6a93e4fffd",
        "authorId" : "67bc6085-2cd9-4674-9dbc-d2a266f478be",
        "body" : "Same as [1]",
        "createdAt" : "2019-04-19T18:30:15Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "67bc6085-2cd9-4674-9dbc-d2a266f478be",
        "tags" : [
        ]
      }
    ],
    "commit" : "bc8bafd825816844b1a93af98b22b86a3f32a65e",
    "line" : 105,
    "diffHunk" : "@@ -1,1 +92,96 @@\t}\n\n\terr = apiclient.CreateOrMutateConfigMap(client, &v1.ConfigMap{\n\t\tObjectMeta: metav1.ObjectMeta{\n\t\t\tName:      kubeadmconstants.KubeadmConfigConfigMap,"
  },
  {
    "id" : "56b92cf2-2cd7-42f3-b023-0beada1ff76a",
    "prId" : 76821,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/76821#pullrequestreview-229091804",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d103d741-86f3-4271-bdec-02c43b39ae77",
        "parentId" : null,
        "authorId" : "cccc7bed-95f4-42a9-83ef-6ba1a4dca7ec",
        "body" : "This may need a simple test case.",
        "createdAt" : "2019-04-22T14:49:15Z",
        "updatedAt" : "2019-04-23T13:41:10Z",
        "lastEditedBy" : "cccc7bed-95f4-42a9-83ef-6ba1a4dca7ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "bc8bafd825816844b1a93af98b22b86a3f32a65e",
    "line" : 132,
    "diffHunk" : "@@ -1,1 +157,161 @@}\n\nfunc mutateClusterStatus(cm *v1.ConfigMap, mutator func(*kubeadmapi.ClusterStatus) error) error {\n\t// Obtain the existing ClusterStatus object\n\tclusterStatus, err := configutil.UnmarshalClusterStatus(cm.Data)"
  },
  {
    "id" : "44c6636d-8d7c-48ad-b763-8f349df9471d",
    "prId" : 62948,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62948#pullrequestreview-133985746",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "10d03e08-5840-411f-a8aa-bc07a568c2f1",
        "parentId" : null,
        "authorId" : "bfe6ebf1-cfa7-4758-abb1-9960fa09b194",
        "body" : "I can't make up my mind whether this is better suited here or in the bootstraptoken phase.\r\nAlso, I'd like us to talk about whether it makes sense to do different types of tokens with different privileges for joining a master vs a node.",
        "createdAt" : "2018-06-29T21:43:51Z",
        "updatedAt" : "2018-07-12T16:41:25Z",
        "lastEditedBy" : "bfe6ebf1-cfa7-4758-abb1-9960fa09b194",
        "tags" : [
        ]
      },
      {
        "id" : "ec98b8ee-e9bb-43b5-be0c-aa326e0dffa5",
        "parentId" : "10d03e08-5840-411f-a8aa-bc07a568c2f1",
        "authorId" : "8a27151d-3530-4221-90e8-48b3a85cba37",
        "body" : "I considered this as well, but currently in pkg `k8s.io/kubernetes/cmd/kubeadm/app/phases/bootstraptoken` there are only things related to the cluster-info configMap. ",
        "createdAt" : "2018-07-03T13:02:10Z",
        "updatedAt" : "2018-07-12T16:41:25Z",
        "lastEditedBy" : "8a27151d-3530-4221-90e8-48b3a85cba37",
        "tags" : [
        ]
      }
    ],
    "commit" : "f9000a3f8a9cb766b91e74a6bd0da4b1363c750c",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +77,81 @@\n\t// Ensure that the BootstrapDiscoveryClusterRole exists\n\terr = apiclient.CreateOrUpdateRole(client, &rbac.Role{\n\t\tObjectMeta: metav1.ObjectMeta{\n\t\t\tName:      BootstrapDiscoveryClusterRoleName,"
  },
  {
    "id" : "8769d8b8-fd8f-4177-b30b-922064e0e956",
    "prId" : 62948,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/62948#pullrequestreview-133986648",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1e8fdd75-4524-4bff-9a51-eba245f0897d",
        "parentId" : null,
        "authorId" : "bfe6ebf1-cfa7-4758-abb1-9960fa09b194",
        "body" : "maybe in kubeadmconstants?",
        "createdAt" : "2018-06-29T21:47:07Z",
        "updatedAt" : "2018-07-12T16:41:25Z",
        "lastEditedBy" : "bfe6ebf1-cfa7-4758-abb1-9960fa09b194",
        "tags" : [
        ]
      },
      {
        "id" : "915aad73-72df-4263-943e-929c0906196e",
        "parentId" : "1e8fdd75-4524-4bff-9a51-eba245f0897d",
        "authorId" : "8a27151d-3530-4221-90e8-48b3a85cba37",
        "body" : "This constant is used only here (e.g. similar to constants in pkg `k8s.io/kubernetes/cmd/kubeadm/app/phases/bootstraptoken`). No problem to move it",
        "createdAt" : "2018-07-03T13:04:22Z",
        "updatedAt" : "2018-07-12T16:41:25Z",
        "lastEditedBy" : "8a27151d-3530-4221-90e8-48b3a85cba37",
        "tags" : [
        ]
      }
    ],
    "commit" : "f9000a3f8a9cb766b91e74a6bd0da4b1363c750c",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +35,39 @@\t// the bootstrap tokens to access the kubeadm-config ConfigMap during the node bootstrap/discovery\n\t// phase for additional master nodes\n\tBootstrapDiscoveryClusterRoleName = \"kubeadm:bootstrap-discovery-kubeadm-config\"\n)\n"
  }
]