[
  {
    "id" : "2862d958-4c0b-4b1f-b61e-78a4475dbda6",
    "prId" : 8905,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/8905#pullrequestreview-79273397",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a96a57a5-bea6-4e0e-ae36-c4d9c3b262ef",
        "parentId" : null,
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "`busy` also receives notification?",
        "createdAt" : "2017-11-20T21:07:27Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "95c932da-6099-4315-9723-c0ab9a0168a9",
        "parentId" : "a96a57a5-bea6-4e0e-ae36-c4d9c3b262ef",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "@rafaelks the behavior was not changed",
        "createdAt" : "2017-11-22T18:17:54Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "9714f061-549e-446c-b233-9b3b74355b4a",
        "parentId" : "a96a57a5-bea6-4e0e-ae36-c4d9c3b262ef",
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "But that's a bug, when User is away it should receive notification on iOS as well.",
        "createdAt" : "2017-11-22T18:30:50Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "f0ac2149-52ed-47ab-9b6b-6c7fa494a0a4",
        "parentId" : "a96a57a5-bea6-4e0e-ae36-c4d9c3b262ef",
        "authorId" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "body" : "Its kind of confusing but there are two different status's.\r\n\r\nUsers Presence status (what they want to be perceived as) and their connection status.  \r\n\r\nTheir connection status only goes between basically 2 states.  online and away.  Offline would be that connection would not exist.\r\n\r\nSo if all connection status's are away the users status is automatically set to away which would allow them to receive push notifications to the phone.\r\n\r\nSame with if all connections are offline (aka there aren't any connection) the users status should be offline and they will again receive notifications.",
        "createdAt" : "2017-11-27T18:55:51Z",
        "updatedAt" : "2017-11-27T18:55:51Z",
        "lastEditedBy" : "beb0c9ad-a917-4bb6-948e-12669fdc6784",
        "tags" : [
        ]
      }
    ],
    "commit" : "db267106b3e3f9ba4441877d3ffb5ea76d928308",
    "line" : 100,
    "diffHunk" : "@@ -1,1 +289,293 @@\n\t\t\tif (canBeNotified(userOfMentionId, 'mobile')) {\n\t\t\t\tif (Push.enabled === true && userOfMention.statusConnection !== 'online') {\n\t\t\t\t\tRocketChat.PushNotification.send({\n\t\t\t\t\t\troomId: message.rid,"
  },
  {
    "id" : "42640761-47e4-43ff-b174-ebec32aee104",
    "prId" : 8905,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/8905#pullrequestreview-78548320",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "parentId" : null,
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "Not sure I got the logic here... the username needs to be in the `mentions` to be able to reply? 🤔 ",
        "createdAt" : "2017-11-20T21:09:21Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "9a94f025-f3b8-4bb4-a652-a70eee6fa700",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "Where did you see `mentions` @rafaelks ?",
        "createdAt" : "2017-11-22T18:15:03Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "37e0987d-db35-42c4-b90f-b159b644abc0",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "Here: https://github.com/RocketChat/Rocket.Chat/pull/8905/files#diff-819f1684d8dba4a649500c1ce5166000R144",
        "createdAt" : "2017-11-22T18:21:14Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "dc57f1fd-ab66-481b-9ebb-8545a3bb8b1c",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "@rafaelks The code is a little bit confusing, but it is the array of users that will receive the push, not the mentioned ones only.",
        "createdAt" : "2017-11-22T18:31:15Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "02b8f9c5-bc78-4aaa-915c-33fa57865f3e",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "OK... and what if the room is read only? This code isn't checking that AFAIK.",
        "createdAt" : "2017-11-22T18:42:50Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "3b832e08-a43f-4886-8470-43401ea7652a",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "actually this is the code that checks it.. readonly rooms have a list of `muted` users.. ",
        "createdAt" : "2017-11-22T18:53:56Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      },
      {
        "id" : "6d2d9d62-f7fc-4537-a91b-3ccf497d800b",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "body" : "@sampaiodiego So a `readonly` room  will have all usernames in `muted` array?",
        "createdAt" : "2017-11-22T18:55:35Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "6c9985ad-b768-4be0-bf3e-d076a90fb435",
        "tags" : [
        ]
      },
      {
        "id" : "f6edda3b-3cbf-46c4-8750-05df5c205e0f",
        "parentId" : "9b4f0bb7-232a-42f3-94aa-f429db63b751",
        "authorId" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "body" : "yep.. not a good implementation, I know, but this is how it works now :man_shrugging: ",
        "createdAt" : "2017-11-22T18:57:32Z",
        "updatedAt" : "2017-11-24T11:14:34Z",
        "lastEditedBy" : "61ddb048-36d3-4039-ab51-6db005c8c855",
        "tags" : [
        ]
      }
    ],
    "commit" : "db267106b3e3f9ba4441877d3ffb5ea76d928308",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +29,33 @@\nfunction canSendMessageToRoom(room, username) {\n\treturn !((room.muted || []).includes(username));\n}\n"
  },
  {
    "id" : "c3c10d62-9d1c-4232-af98-6ce1e9e33a9a",
    "prId" : 7285,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/7285#pullrequestreview-81921836",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8033f7a3-5195-42bd-a8ca-cd6a54db50ba",
        "parentId" : null,
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "This part is not good, we was getting only users that did change their configurations, not all users as this code does now.",
        "createdAt" : "2017-12-07T13:22:56Z",
        "updatedAt" : "2017-12-11T20:26:50Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "62549a3a-dc30-4dd3-85e5-846e37bd726a",
        "parentId" : "8033f7a3-5195-42bd-a8ca-cd6a54db50ba",
        "authorId" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "body" : "@rodrigok Actually, as I didn't touch the `userIds` list and we are using a findByIds function, I think we are getting the same users, but now returning all their preferences. Or the `fields` argument generates something like a `where` clause?",
        "createdAt" : "2017-12-07T14:48:34Z",
        "updatedAt" : "2017-12-11T20:26:50Z",
        "lastEditedBy" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "tags" : [
        ]
      },
      {
        "id" : "8c2d4c7c-7eaf-4e3c-b98a-604e04b0d06b",
        "parentId" : "8033f7a3-5195-42bd-a8ca-cd6a54db50ba",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "🤦‍♂️ You're right, was too much code to read 😄 ",
        "createdAt" : "2017-12-07T16:54:51Z",
        "updatedAt" : "2017-12-11T20:26:50Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      }
    ],
    "commit" : "ba09d6730e9db498b64cbf4201509758e675eb91",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +208,212 @@\t});\n\tconst users = {};\n\tRocketChat.models.Users.findUsersByIds(userIds, { fields: { 'settings.preferences': 1 } }).forEach((user) => {\n\t\tusers[user._id] = user;\n\t});"
  }
]