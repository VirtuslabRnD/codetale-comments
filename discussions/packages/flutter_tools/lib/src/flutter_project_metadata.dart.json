[
  {
    "id" : "bf2dd21f-b650-4960-8b07-6e9dc0e20f10",
    "prId" : 53118,
    "prUrl" : "https://github.com/flutter/flutter/pull/53118#pullrequestreview-379686358",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1f69e99a-9c46-4f74-b82f-5012205daf1b",
        "parentId" : null,
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "Oh, fancy!",
        "createdAt" : "2020-03-23T18:02:07Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      }
    ],
    "commit" : "f4c22eb454268a30181ae8223bbd2e57a427ea53",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +24,28 @@}\n\nextension FlutterProjectTypeExtension on FlutterProjectType {\n  String get name => getEnumName(this);\n}"
  },
  {
    "id" : "f52087b6-722d-4300-93f8-c74bb38e6a0c",
    "prId" : 53118,
    "prUrl" : "https://github.com/flutter/flutter/pull/53118#pullrequestreview-383243700",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "parentId" : null,
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "These used to be `throwToolExit`, what will happen now?",
        "createdAt" : "2020-03-23T18:12:25Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      },
      {
        "id" : "3121ac1b-ed0a-4f9e-ac8a-ef135f20919c",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Recreating the project with missing metadata won't work. create_tests that fail:\r\n- `Will create an app project if non-empty non-project directory exists without .metadata`\r\n- `cannot create a project if non-empty non-project directory exists with .metadata` will throw the wrong toolExit.",
        "createdAt" : "2020-03-23T19:15:46Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "31661b1a-eb26-42c3-aa3e-9cb4da598384",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "What will happen if someone corrupts their .metadata file? Will the tool throw a ToolExit or send a report to crash logging?",
        "createdAt" : "2020-03-24T19:13:59Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      },
      {
        "id" : "d75b52e2-0313-4fbe-8835-c050efc85b05",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Let me move the throws back into the create command.  We don't want it to throw when it's generating a crash report.",
        "createdAt" : "2020-03-24T19:22:40Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "aaec8d52-9fd0-4c37-ac5a-f0f3046832c7",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "#### Before this change getting the project type\r\nIf the .metadata is present but not a Yaml map:\r\n- throws \"pubspec.yaml is malformed.\" (yes, pubspec, not metadata).\r\n\r\nIf project_type isn't a String:\r\n- throws \".metadata is malformed.\"\r\n\r\n#### After this change\r\nIf .metadata is malformed, either not a Yaml map or project_type isn't a String:\r\n   - Checks for the presence of directories to tell only if it's an app.  If it's an app, carry on with template reconstruction\r\n   - If those directories are missing, throw \"'Sorry, unable to detect the type of project to recreate. Try creating a fresh project and migrating your existing code to the new project manually.\"\r\n\r\nI think the second behavior is actually better:\r\n1. It doesn't have the misleading \"pubspec\" message\r\n2. \".metadata is malformed\" is a pretty lame message and doesn't tell the user what to do.\r\n3. If it can figure out the project type, it does.\r\n4. If it can't, it gives an actually useful recovery message.\r\n\r\nWhat do you think?",
        "createdAt" : "2020-03-27T18:50:13Z",
        "updatedAt" : "2020-03-27T18:50:45Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      },
      {
        "id" : "bdb6ae99-bb44-4dba-8a44-5182046eadc6",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "That sounds good to me.",
        "createdAt" : "2020-03-27T22:41:04Z",
        "updatedAt" : "2020-03-27T22:41:04Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      },
      {
        "id" : "8f2af27e-83b9-4ff4-bef2-5dd9eb0c684d",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "body" : "Is the \"Sorry, unable to detect...\" error message in this PR, or is it pre-existing?",
        "createdAt" : "2020-03-27T22:42:06Z",
        "updatedAt" : "2020-03-27T22:42:07Z",
        "lastEditedBy" : "5acfd23a-9807-467c-8f5c-9b4c4052927b",
        "tags" : [
        ]
      },
      {
        "id" : "d3dd33ca-0f0c-4de5-8efa-90546750eacc",
        "parentId" : "74ffec01-f8a3-4894-931a-d82cbf368099",
        "authorId" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "body" : "Sorry should have noted, it's pre-existing.\r\nhttps://github.com/flutter/flutter/blob/685e9d1e47d80bd3bd22d97e1774fa264930434c/packages/flutter_tools/lib/src/commands/create.dart#L294\r\n\r\nUpdated:\r\n#### Before this change getting the project type\r\nIf the .metadata is present but not a Yaml map:\r\n- throws \"pubspec.yaml is malformed.\" (yes, pubspec, not metadata).\r\n\r\nIf project_type isn't a String:\r\n- throws \".metadata is malformed.\"\r\n\r\nIf the .metadata isn't present and the directories don't indicate it's an app:\r\n- throw \"Sorry, unable to detect the type of project to recreate. Try creating a fresh project and migrating your existing code to the new project manually.\"",
        "createdAt" : "2020-03-27T22:59:45Z",
        "updatedAt" : "2020-03-27T23:00:01Z",
        "lastEditedBy" : "7aa08a6b-0a3c-421c-b2e6-22899e9af9e4",
        "tags" : [
        ]
      }
    ],
    "commit" : "f4c22eb454268a30181ae8223bbd2e57a427ea53",
    "line" : 60,
    "diffHunk" : "@@ -1,1 +58,62 @@      return stringToProjectType(projectTypeYaml);\n    } else {\n      _logger.printTrace('.metadata project_type version is malformed.');\n      return null;\n    }"
  }
]