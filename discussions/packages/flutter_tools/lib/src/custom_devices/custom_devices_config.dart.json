[
  {
    "id" : "2ee5237c-6f86-44a5-94eb-2f1ccd070208",
    "prId" : 78113,
    "prUrl" : "https://github.com/flutter/flutter/pull/78113#pullrequestreview-624713637",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "parentId" : null,
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Can you walk me through how you are loading/locating this config ?",
        "createdAt" : "2021-03-19T16:29:21Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "c67652d8-7125-461a-b9a3-4de5a14c6277",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "Of course. Generally, it's heavily inspired `PersistentToolState`.\r\n\r\n- `CustomDevicesConfig` is just stored in the context. It's specified as part of the global context in `context_runner.dart`.\r\n- when `CustomDevicesConfig` is instantiated, it creates an internal `Config` object which on construction loads the config file from a path determined by the `Config` object (using the config name, which is `custom_devices.json`) and parses it.\r\n- that path is `%APPDATA%/.flutter_<config name>` on Windows and `$HOME/.config/flutter/<config name>` on MacOS and linux (see `Config._configPath`)\r\n\r\nHowever, now I'm not so sure my initial description about the config file being automatically created when the custom devices feature is enabled is correct. Will the context runner call all the fallback generators eagerly? Or only when they're first used?",
        "createdAt" : "2021-03-19T16:52:59Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      },
      {
        "id" : "37051edb-ef78-49bf-bb3f-a4e1009a4740",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "They're only called when it is first used - I'm not so sure about having side effects like this in the generators.\r\n\r\nHow does a user discover how to add this config?",
        "createdAt" : "2021-03-19T16:55:02Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "2bfd2701-5e43-42a7-976b-c5a19d5d0fec",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "> They're only called when it is first used - I'm not so sure about having side effects like this in the generators.\r\n\r\nYeah, I agree.\r\n\r\n> How does a user discover how to add this config?\r\n\r\nYou mean, like, how should they know where the config is located? \r\n\r\nWe could create the config when `flutter config --enable-custom-devices` is called and additionally let it output some message like `The custom devices configuration can now be edited at \"C:\\...\"` so they have a path they can edit. (So it's both no side effects in generators and discoverable)",
        "createdAt" : "2021-03-19T17:20:30Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      },
      {
        "id" : "724de679-1fea-46a8-b98e-164fa12f0f26",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Is that what you are doing for your device? WDUT about having a special command to add a device configuration?",
        "createdAt" : "2021-03-19T17:27:29Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "7dee6271-1a1a-4e4e-aed3-304b3e76216b",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "> Is that what you are doing for your device?\r\n\r\nNot sure what you mean, I think there's nothing about this that is special to my device. That single path that'd be output by `flutter config --enable-custom-devices` is the only path any custom device configuration would ever be sourced from.\r\n\r\n> WDUT about having a special command to add a device configuration?\r\n\r\nYeah we can do that. Actually, in the initial description I mentioned that a new custom devices config file, when generated, contains the schema tag and a disabled example device config. The point of the latter is so people can just copy+paste that entry in the config file to add their own device.\r\n\r\nBut yeah, I think a command would be cool as well, especially so its usable by scripts etc. (Or do IDE plugins use the daemon for that? not sure)",
        "createdAt" : "2021-03-20T17:09:09Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      },
      {
        "id" : "d6a3dad5-d7bc-4ce7-8a4b-ca918ebc5381",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "The daemon probably wouldn't support this command but it would definitely be usable from the CLI. Doesn't need to be done in this PR, but imagine something like:\r\n\r\n`flutter custom-device add /path/to/confg`\r\n`flutter custom-device list`\r\n`flutter custom-device remove name`",
        "createdAt" : "2021-03-22T21:01:38Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "b70ffd6e-2b38-475d-9d2f-38b8b4359eaf",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "Okay, but why would multiple config files be useful? Right now it's just a single, centralised config files that contain all custom devices to be configured (also mentioned that in the issue iirc)",
        "createdAt" : "2021-03-22T21:50:02Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      },
      {
        "id" : "cb8c3f3e-756f-4344-a9bd-a53aba082410",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "I would imagine those commands as add a configuration to the existing config file, instead of editing a file in the SDK right?",
        "createdAt" : "2021-03-22T21:51:41Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "ce5f2be9-c3d7-48d7-ab5e-e42165d20b02",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "Yeah I mean if you just want to add some custom device, editing the SDK config is better IMO. You've got a structure and an example config you can start with (and autocompletion bc of the JSON schema but thats of course not relevant when you're not using VS Code). If you start with a blank separate config file instead, even I would probably get some names / structures wrong and would start looking at the SDK config for guidance anyway. Especially since you'll probably configure the custom devices once and then completely forget about it, so not enough \"exposure\" to remember all the details\r\n\r\nBut if want to automate it & make it able to be used by scripts (or generally, non-interactively), then something like `flutter custom-device add <config>` is definitely useful, I'm just not sure that's the use-case you're caring about here.\r\n\r\nI think a command like this would be more useful instead:\r\n```\r\nflutter custom-device add --ssh --hostname raspberrypi --user pi --launch \"flutter-pi --observatory-host 192.168.178.43\" --no-use-port-forwarding\r\n```\r\n\r\nThat's just my POV though. We could of course also do both and your proposed config command would look like `flutter custom-device add --config /path/to/config` in that case.",
        "createdAt" : "2021-03-23T16:42:11Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      },
      {
        "id" : "fc1587a9-ebfb-4b59-8c37-ab24ecc72731",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Understood. I think the current strategy is fine for now FWIW, and we can address any usability concerns in the future.",
        "createdAt" : "2021-03-23T18:49:24Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "10183a19-a6bf-4a02-a018-915b7e5f7a8d",
        "parentId" : "7339c46c-ca76-4051-a36c-dcfa0e97d521",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "I'll resolve this for now, I'll create an issue to track this",
        "createdAt" : "2021-03-30T21:19:55Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      }
    ],
    "commit" : "fd5d484dcc1ae5571fab26ad7024431267e9311e",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +16,20 @@/// Represents the custom devices config file on disk which in turn\n/// contains a list of individual custom device configs.\nclass CustomDevicesConfig {\n  /// Load a [CustomDevicesConfig] from a (possibly non-existent) location on disk.\n  ///"
  },
  {
    "id" : "1a3e9bfc-60f1-45c6-a364-ac99a6b073bd",
    "prId" : 78113,
    "prUrl" : "https://github.com/flutter/flutter/pull/78113#pullrequestreview-618028817",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "830281bd-d073-493e-9ff2-ed4b8072652f",
        "parentId" : null,
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Make this `@visibleForTesting` if possible",
        "createdAt" : "2021-03-22T21:01:53Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "21fd0ad4-bbab-4d21-9a79-48f6978ea2de",
        "parentId" : "830281bd-d073-493e-9ff2-ed4b8072652f",
        "authorId" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "body" : "done",
        "createdAt" : "2021-03-22T22:20:48Z",
        "updatedAt" : "2021-03-31T21:34:56Z",
        "lastEditedBy" : "493e27a2-5090-4479-8c03-6c418bfad375",
        "tags" : [
        ]
      }
    ],
    "commit" : "fd5d484dcc1ae5571fab26ad7024431267e9311e",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +40,44 @@\n  @visibleForTesting\n  CustomDevicesConfig.test({\n    @required FileSystem fileSystem,\n    Directory directory,"
  }
]