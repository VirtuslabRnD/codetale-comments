[
  {
    "id" : "3f5f55ad-443a-40f0-8ec3-4fab84e852f0",
    "prId" : 7614,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/7614#pullrequestreview-58535615",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2516e03e-7939-4d26-904d-0c01a5ad6005",
        "parentId" : null,
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "What happens when a subfield is undefined? Like `customFields.name.first` and `name` is undefined?",
        "createdAt" : "2017-08-23T20:08:13Z",
        "updatedAt" : "2017-08-23T20:08:13Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "b4f8325b-0b82-4e71-a817-18deca4620f4",
        "parentId" : "2516e03e-7939-4d26-904d-0c01a5ad6005",
        "authorId" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "body" : "An exception! :$ I'll fix it.",
        "createdAt" : "2017-08-23T21:08:46Z",
        "updatedAt" : "2017-08-23T21:08:46Z",
        "lastEditedBy" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "tags" : [
        ]
      },
      {
        "id" : "963d47ab-4470-4b8b-8935-e3492ff0c4d6",
        "parentId" : "2516e03e-7939-4d26-904d-0c01a5ad6005",
        "authorId" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "body" : "@rodrigok I see you've already merged this into develop branch, but I think you were right regarding this part of the code. An exception would be thrown and it would not be properly handled. You were faster than me, I didn't have enough time to push the changes before your merge. I'd recommend replacing this:\r\n\r\n[`const userFieldValue = _.reduce(userField.split('.'), (acc, el) => acc[el], user);`](https://github.com/RocketChat/Rocket.Chat/blob/8e998c00d11a04564145346728e612e119b09824/packages/rocketchat-ldap/server/sync.js#L95)\r\n\r\nby this (or something more elegant...):\r\n\r\n```javascript\r\nlet userFieldValue;\r\n\r\ntry {\r\n\tuserFieldValue = _.reduce(userField.split('.'), (acc, el) => acc[el], user);\r\n\tif (!userFieldValue) {\r\n\t\tthrow new Error();\r\n\t}\r\n} catch (err) {\r\n\tlogger.debug(`user attribute does not exist: ${ userField }`);\r\n\treturn;\r\n}\r\n```\r\n\r\nWhat do you think @rodrigok?",
        "createdAt" : "2017-08-24T23:14:36Z",
        "updatedAt" : "2017-08-24T23:15:25Z",
        "lastEditedBy" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "tags" : [
        ]
      }
    ],
    "commit" : "5c781693b9444168bb461237e6c83fafa3ff30a2",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +93,97 @@\n\t\t\t\t\tconst tmpLdapField = RocketChat.templateVarHandler(ldapField, ldapUser.object);\n\t\t\t\t\tconst userFieldValue = _.reduce(userField.split('.'), (acc, el) => acc[el], user);\n\n\t\t\t\t\tif (tmpLdapField && userFieldValue !== tmpLdapField) {"
  },
  {
    "id" : "bf4cde18-7996-46b1-85c8-91100911fb4c",
    "prId" : 7614,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/7614#pullrequestreview-58507180",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d2f8129a-f43a-4c39-935d-32c762801f2e",
        "parentId" : null,
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "A field containing `.` will generate an exception in MongoDB",
        "createdAt" : "2017-08-23T20:09:19Z",
        "updatedAt" : "2017-08-23T20:09:19Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "eb332cef-811d-4bfe-ba76-6455bd45c383",
        "parentId" : "d2f8129a-f43a-4c39-935d-32c762801f2e",
        "authorId" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "body" : "@rodrigok Didn't get this one. Is it possible to have a field containing `.`? Wouldn't MongoDB interpret it as a nested field?",
        "createdAt" : "2017-08-23T21:05:27Z",
        "updatedAt" : "2017-08-23T21:05:28Z",
        "lastEditedBy" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "tags" : [
        ]
      },
      {
        "id" : "9621246d-8b2f-41f3-aacd-c7d61636eab1",
        "parentId" : "d2f8129a-f43a-4c39-935d-32c762801f2e",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "@goiaba Is not possible to have a field containing `.`, since you are creating an object like:\r\n```\r\n{\r\n  \"name.first\": \"Rodrigo\"\r\n}\r\n```\r\nand it should be \r\n```\r\n{\r\n  name: {\r\n    first: 'rodrigo'\r\n  }\r\n}\r\n```\r\n",
        "createdAt" : "2017-08-24T15:06:24Z",
        "updatedAt" : "2017-08-24T15:06:25Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      },
      {
        "id" : "6d0a639a-5ceb-4923-8e64-b8c971a2abba",
        "parentId" : "d2f8129a-f43a-4c39-935d-32c762801f2e",
        "authorId" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "body" : "@rodrigok \r\n\r\nIn my tests, if the variable userData contains the object `{ name: 'value1', 'customFields.secao-descricao': 'value2','customFields.secao-sigla': 'value3' }`, the object stored in the users collection, inside a user document is `\"customFields\" : { \"secao-sigla\" : \"value3\", \"secao-descricao\" : \"value2\" }`. No exceptions occur.\r\n\r\nWe have other examples in the same code (sync.js), in the line 123, for instance: `userData['services.ldap.id'] = uniqueId.value;`.\r\n\r\nMaybe I still didn't understand what you're trying to show me. :-(",
        "createdAt" : "2017-08-24T17:30:33Z",
        "updatedAt" : "2017-08-24T17:30:33Z",
        "lastEditedBy" : "82e82be2-2511-4128-8a07-faddbd4102c9",
        "tags" : [
        ]
      },
      {
        "id" : "3a190d2e-a8b8-441e-8bf3-547ceb9bb445",
        "parentId" : "d2f8129a-f43a-4c39-935d-32c762801f2e",
        "authorId" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "body" : "Sorry @goiaba , I was totally wrong ðŸ˜ž ",
        "createdAt" : "2017-08-24T20:54:02Z",
        "updatedAt" : "2017-08-24T20:54:02Z",
        "lastEditedBy" : "6b2de464-07b6-478f-bdd0-b8707d59c1c1",
        "tags" : [
        ]
      }
    ],
    "commit" : "5c781693b9444168bb461237e6c83fafa3ff30a2",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +96,100 @@\n\t\t\t\t\tif (tmpLdapField && userFieldValue !== tmpLdapField) {\n\t\t\t\t\t\tuserData[userField] = tmpLdapField;\n\t\t\t\t\t\tlogger.debug(`user.${ userField } changed to: ${ tmpLdapField }`);\n\t\t\t\t\t}"
  }
]