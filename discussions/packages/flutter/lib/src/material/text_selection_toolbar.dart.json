[
  {
    "id" : "83723b4d-ef98-44d9-9298-d7ef2fc52c8a",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-549423332",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "This assumes the last child is always wider than the overflow button right?",
        "createdAt" : "2020-12-04T06:05:37Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "c2d7bfe2-0c6c-47bb-a8f7-2be601475624",
        "parentId" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "Also when `overflows == true` but there's enough vertical space, I think the children are laid out using the wrong constraints (potentially incorrect height)?",
        "createdAt" : "2020-12-04T06:57:01Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "5d8105a6-935c-47c2-8955-73b2dcf09424",
        "parentId" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "When `overflows` is true, the children should have a consistent size (mostly because of hit-testing), except the back button.",
        "createdAt" : "2020-12-04T07:04:32Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "f99de375-93cb-45ed-8901-67e886671361",
        "parentId" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "### Last child width\r\nNo, the relative width shouldn't matter.  This is about the case where the overflow button causes the overflow, like:\r\n\r\n|--------- width ---------|\r\n[button 1] [button 2] [overflow button]\r\n\r\nIf we just get rid of the overflow button, then everything fits and we don't need an overflow button.\r\n\r\n### Wrong Constraints\r\nIn response to another comment above (https://github.com/flutter/flutter/pull/69428#discussion_r538878026), I noticed that I should be using padding to set the constraints of the menu properly.  Does that cover your concern here?\r\n\r\n### Consistent Size\r\nGood catch, I've created an issue for this: https://github.com/flutter/flutter/issues/72023.  I spent a bunch of time trying to fix this right now, but I don't think I can align the text in a TextButton.  This problem existed before this PR, so I'll come back to it in that issue later.",
        "createdAt" : "2020-12-09T22:05:38Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      },
      {
        "id" : "6eee4e5a-14d6-4e14-8bd9-165fe72fbb2e",
        "parentId" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "Sorry I wasn't clear. The overflow button is always the first child so in the case that it is extremely wide and takes up more horizontal space than button 1 and button 2 combined, we need to check more than the last child (unless we know the overflow button is always going to be narrower than the last 2 buttons combined), \r\n\r\ni.e., \r\nchildren in layout order:\r\n|--------- width ---------|\r\n[wiiiiiiiiiiiiiiiiiiiiiiiiiide overflow button][button 1] [button 2] ",
        "createdAt" : "2020-12-09T22:39:27Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "b1f0303b-fa1d-4838-af1e-c2e3fcca4d17",
        "parentId" : "46fa411b-1a9f-401a-a110-cfa0478c2dba",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "Ah that makes sense, you're right.  I'm creating a separate issue for this as well since it's not new to this PR and should be pretty unlikely: https://github.com/flutter/flutter/issues/72075",
        "createdAt" : "2020-12-10T17:14:42Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 530,
    "diffHunk" : "@@ -1,1 +528,532 @@    });\n\n    // If the last child overflows, but only because of the width of the\n    // overflow button, then just show it and hide the overflow button.\n    final RenderBox navButton = firstChild!;"
  },
  {
    "id" : "507f027c-2ac7-4378-86a7-1808f6e70a93",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-548656137",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "525e421c-82bc-4f22-a66d-a8f98567e632",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "so the overflow menu children are aligned to the left edge? Is that correct?",
        "createdAt" : "2020-12-04T07:13:00Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "35cc27ba-faf6-4c8d-a6ac-447148bd018a",
        "parentId" : "525e421c-82bc-4f22-a66d-a8f98567e632",
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "Is it possible to run out of vertical space when the `above` is true, since the overflow menu is going to be higher than the non-overflow version?",
        "createdAt" : "2020-12-04T07:18:34Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "892d3444-1f30-41ca-9019-3b92691de02d",
        "parentId" : "525e421c-82bc-4f22-a66d-a8f98567e632",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "RE the first comment, see https://github.com/flutter/flutter/issues/72023, which I mentioned above.  You're right, it's incorrect and should be fixed.\r\n\r\nFor the second question, yes it's possible, but I believe I handled it consistently with native from when I originally wrote this.  The menu will position itself as high as possible and then grow downward from there:\r\n\r\n| Closed | Open |\r\n| -- | -- |\r\n| <img width=\"479\" alt=\"Screen Shot 2020-12-09 at 2 08 40 PM\" src=\"https://user-images.githubusercontent.com/389558/101694554-22b01500-3a28-11eb-9740-1b66446ca98b.png\"> | <img width=\"457\" alt=\"Screen Shot 2020-12-09 at 2 08 46 PM\" src=\"https://user-images.githubusercontent.com/389558/101694562-2479d880-3a28-11eb-85e7-cfd5085a88f6.png\"> |",
        "createdAt" : "2020-12-09T22:11:20Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 593,
    "diffHunk" : "@@ -1,1 +591,595 @@        );\n      } else {\n        childParentData.offset = Offset(0.0, overflowHeight);\n        overflowHeight += child.size.height;\n        nextSize = Size("
  },
  {
    "id" : "b9b00fd4-5107-4240-a221-bdb103eb4caf",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-548662151",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a32f0de6-951c-4d03-ae44-52e39854cca6",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "Should this be `-=` when isAbove is true?",
        "createdAt" : "2020-12-04T07:17:21Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "5c4be150-3d0a-44b0-a180-3780202c3252",
        "parentId" : "a32f0de6-951c-4d03-ae44-52e39854cca6",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "Are you thinking that the order of the menu items in the overflow menu is reversed when it's above/below the anchor?  You're right that this code will not reverse the order.  I just tried to check this on native Android but I couldn't find a case where there was more than 1 button overflowing.  I can dig into it if that's what you mean.",
        "createdAt" : "2020-12-09T22:20:55Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 594,
    "diffHunk" : "@@ -1,1 +592,596 @@      } else {\n        childParentData.offset = Offset(0.0, overflowHeight);\n        overflowHeight += child.size.height;\n        nextSize = Size(\n          math.max(child.size.width, nextSize.width),"
  },
  {
    "id" : "fc3aafed-50c7-4693-bca7-9b18e5e5c726",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-548673429",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "508c5bd3-0c26-4e0f-9034-b440da0391ce",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "It seems we won't be able to determine whether the menu `fitsAbove` because overflow menus can be higher than `_kToolbarHeight`.",
        "createdAt" : "2020-12-04T07:44:35Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "db2edf17-dc6c-4c13-b196-bfea57386d7f",
        "parentId" : "508c5bd3-0c26-4e0f-9034-b440da0391ce",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "See my earlier comment https://github.com/flutter/flutter/pull/69428#discussion_r539686089",
        "createdAt" : "2020-12-09T22:39:10Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 87,
    "diffHunk" : "@@ -1,1 +85,89 @@        + _kToolbarScreenPadding;\n    final double availableHeight = anchorAbove.dy - paddingTop;\n    final bool fitsAbove = _kToolbarHeight <= availableHeight;\n    final Offset anchor = fitsAbove ? anchorAbove : anchorBelow;\n    final Offset localAnchor = Offset("
  },
  {
    "id" : "92068ebb-24d3-4ebf-8b69-6292578e9ce1",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-549541768",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8beef882-de78-4b7b-ad91-29872b75e5f3",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "nit: per https://github.com/flutter/flutter/blob/02a3e50bd92162a50dcce2ebe31704ff0794af34/packages/flutter/lib/src/material/text_selection_toolbar.dart#L501-L508 the overflow menu won't be shown if it's empty right?",
        "createdAt" : "2020-12-04T07:53:53Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "93413701-d325-4442-adaa-0ab8e79b127f",
        "parentId" : "8beef882-de78-4b7b-ad91-29872b75e5f3",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "Good catch, I've reworded it.\r\n\r\nSo this comment in `_reset` is dealing with a situation where the children change such that they were overflowing (and the overflow menu was open) before the change, and afterwards the children all fit in the normal menu without overflow.\r\n\r\nIt's true that the logic in the code you linked would show all of the children, not an empty menu.  However, without resetting _overflowOpen to false, other things would be broken and in a half open / half closed state.  I think the menu items might render vertically for example.\r\n\r\nAnyway, I've removed the logical error that says the overflow menu would be empty and replaced it with a more specific description of what's going on.",
        "createdAt" : "2020-12-10T19:41:51Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 223,
    "diffHunk" : "@@ -1,1 +221,225 @@    // from animating the size change.\n    _containerKey = UniqueKey();\n    // If the menu items change, make sure the overflow menu is closed. This\n    // prevents getting into a broken state where _overflowOpen is true when\n    // there are not enough children to cause overflow."
  },
  {
    "id" : "17abfbd0-c9f1-4dec-a08b-b26c8a6c50dd",
    "prId" : 69428,
    "prUrl" : "https://github.com/flutter/flutter/pull/69428#pullrequestreview-551799600",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c156a464-4e55-414a-af66-530e39c7d0cd",
        "parentId" : null,
        "authorId" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "body" : "If this is empty, the toolbar doesn't show, is that correct?",
        "createdAt" : "2020-12-11T20:55:57Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "a28d4bf0-9b21-4633-a08e-c383b294a037",
        "tags" : [
        ]
      },
      {
        "id" : "64634e4b-ec24-44d4-8b9d-f3eb3122be25",
        "parentId" : "c156a464-4e55-414a-af66-530e39c7d0cd",
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "There is an assertion in this file that `children.length > 0`, and in text_selection.dart's buildToolbar method there is a check that won't even build TextSelectionToolbar if there are no children.\r\n\r\nI'll add another assertion to the top level TextSelectionToolbar and also note this in the docs.",
        "createdAt" : "2020-12-14T18:57:45Z",
        "updatedAt" : "2020-12-14T22:39:03Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "257bda79a0c008ce1198251b50a8a9e9a7ac7c17",
    "line" : 67,
    "diffHunk" : "@@ -1,1 +65,69 @@  ///   * [TextSelectionToolbarTextButton], which builds a default Material-\n  ///     style text selection toolbar text button.\n  final List<Widget> children;\n\n  /// Builds the toolbar container."
  },
  {
    "id" : "6ef72e1c-7593-476a-b19f-52b3e74adeb2",
    "prId" : 73578,
    "prUrl" : "https://github.com/flutter/flutter/pull/73578#pullrequestreview-564501548",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0650cc55-bc60-446e-a41c-8e1cdb601d9d",
        "parentId" : null,
        "authorId" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "body" : "Trying to make things look the same as in the Cupertino version.",
        "createdAt" : "2021-01-08T18:51:46Z",
        "updatedAt" : "2021-01-12T22:04:20Z",
        "lastEditedBy" : "0474385d-5aae-4093-b7fc-7f38665f8960",
        "tags" : [
        ]
      }
    ],
    "commit" : "1a149ce7d2c5efd5532e0f7b00f443e1221f8c03",
    "line" : 78,
    "diffHunk" : "@@ -1,1 +103,107 @@    final double availableHeight = anchorAbove.dy - paddingAbove;\n    final bool fitsAbove = _kToolbarHeight <= availableHeight;\n    final Offset localAdjustment = Offset(_kToolbarScreenPadding, paddingAbove);\n\n    return Padding("
  }
]