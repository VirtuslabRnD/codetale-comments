[
  {
    "id" : "10ba6d7f-6d19-4cc5-b0f6-1945e38dd146",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-257602321",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9cc908c6-8f61-480c-b24c-9bee16bc163e",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "`@immutable`",
        "createdAt" : "2019-07-02T21:48:30Z",
        "updatedAt" : "2019-09-18T14:39:23Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "000f12b8-1e02-42a4-8206-4767dab85678",
        "parentId" : "9cc908c6-8f61-480c-b24c-9bee16bc163e",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Done",
        "createdAt" : "2019-07-03T16:22:15Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 218,
    "diffHunk" : "@@ -1,1 +212,216 @@\n@immutable\nclass _DownloadRequest {\n  const _DownloadRequest(this.sendPort, this.uri, this.headers, this.httpClientProvider) :\n      assert(sendPort != null), assert(uri != null);"
  },
  {
    "id" : "4bd3b115-96fc-4f76-bb9c-c4c693167cb0",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-257581517",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "aa781382-f5b3-4819-a1c8-a3bfcaaa0eaf",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "assert that ` _pendingLoadRequests.isEmpty` and return?",
        "createdAt" : "2019-07-02T23:10:33Z",
        "updatedAt" : "2019-09-18T14:39:23Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "622bab83-6792-483a-9a5b-ae2424cf3390",
        "parentId" : "aa781382-f5b3-4819-a1c8-a3bfcaaa0eaf",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Done",
        "createdAt" : "2019-07-03T15:47:36Z",
        "updatedAt" : "2019-09-18T14:39:23Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 172,
    "diffHunk" : "@@ -1,1 +167,171 @@      if (sendPort == null) {\n        assert(_pendingLoadRequests.isEmpty);\n        _pendingLoader = null;\n        _pendingLoadRequests = null;\n        _loaderErrorHandler.close();"
  },
  {
    "id" : "ac63bea8-e047-4aaf-b05b-68c6dcee2008",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-259630838",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4fb38aaf-1ff9-4154-bb8b-60086d219028",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Set `_pendingLoadRequests` to null too. (especially if you add the assert above per my review comment ðŸ™‚ )\r\n\r\n```dart\r\nassert(_pendingLoadRequests.isEmpty);\r\n_pendingLoader = null;\r\n_pendingLoadRequests = null;\r\n```",
        "createdAt" : "2019-07-08T21:19:55Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "4c6f8d80-bb5d-421c-a1f1-5cf73bbb88cb",
        "parentId" : "4fb38aaf-1ff9-4154-bb8b-60086d219028",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Done",
        "createdAt" : "2019-07-09T16:49:23Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 176,
    "diffHunk" : "@@ -1,1 +171,175 @@        _loaderErrorHandler.close();\n        _loaderErrorHandler = null;\n        return;\n      }\n"
  },
  {
    "id" : "4f4b3285-7024-4354-b452-c238efef3eec",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-259182426",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f498a2ac-05bc-44ee-adbb-0a95d311e4df",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Don't we need to `kill()` the isolate here?  Or are we making it a candidate for GC, and it'll automatically be killed?",
        "createdAt" : "2019-07-08T21:23:52Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "90399c26-fed2-444c-9f24-c381d11c353d",
        "parentId" : "f498a2ac-05bc-44ee-adbb-0a95d311e4df",
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Discussed offline",
        "createdAt" : "2019-07-08T22:12:12Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 176,
    "diffHunk" : "@@ -1,1 +171,175 @@        _loaderErrorHandler.close();\n        _loaderErrorHandler = null;\n        return;\n      }\n"
  },
  {
    "id" : "a6af64f1-090c-485f-bfeb-93c4abc0354d",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-259182426",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4959e13f-280c-4f8e-8c3f-db7c39b29ae3",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Don't we need to `kill()` the isolate here?  The case I'm thinking of is when the isolate was successfully set-up, but then we get notified here via our `addErrorListener()` registration.",
        "createdAt" : "2019-07-08T21:25:45Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "c01468b2-c5f2-4bf3-9aa0-8168d898cbb1",
        "parentId" : "4959e13f-280c-4f8e-8c3f-db7c39b29ae3",
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Discussed offline",
        "createdAt" : "2019-07-08T22:11:59Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 153,
    "diffHunk" : "@@ -1,1 +148,152 @@  }\n\n  void _cleanupDueToError(dynamic error) {\n    for (_DownloadRequest request in _pendingLoadRequests) {\n      request.handleError(error);"
  },
  {
    "id" : "2527f626-0d0b-4b08-ab60-a96e0beb76bf",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-261333135",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ba5cc638-d655-44ff-ba1f-47e113540d68",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "It's possible for the completer to have already completed with an error here, as would be the case if an uncaught error happened in our worker isolate, triggering our error listener, which would send an error message over this port.\r\n\r\nI think you can add a check for `isCompleted` here:\r\n\r\n```dart\r\nif (bytesCompleter.isCompleted) {\r\n  // If an uncaught error occurred in the worker isolate, we'll have\r\n  // already completed our bytes completer.\r\n  return;\r\n}\r\n```\r\n",
        "createdAt" : "2019-07-08T21:55:44Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "77d8b52f-d9fd-4c31-9fc1-c493028fdf94",
        "parentId" : "ba5cc638-d655-44ff-ba1f-47e113540d68",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Done",
        "createdAt" : "2019-07-09T16:49:21Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      },
      {
        "id" : "6a7af743-e437-47e1-96b7-a0e6c62f4004",
        "parentId" : "ba5cc638-d655-44ff-ba1f-47e113540d68",
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Now that I see it written out, I think it looks slightly cleaner to phrase it as:\r\n\r\n```dart\r\nif (!bytesCompleter.isCompleted) {\r\n  // If an uncaught error occurred in the worker isolate, we'll have\r\n  // already completed our bytes completer.\r\n  bytesCompleter.complete(response.bytes);\r\n}\r\n```\r\n\r\nwdyt?",
        "createdAt" : "2019-07-11T01:53:25Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "85c81437-1a6c-4693-987f-520d35c2b8a4",
        "parentId" : "ba5cc638-d655-44ff-ba1f-47e113540d68",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Um, not sure. Any reason why this would be preferable?",
        "createdAt" : "2019-07-12T15:38:40Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 72,
    "diffHunk" : "@@ -1,1 +79,83 @@      final Completer<TransferableTypedData> bytesCompleter = Completer<TransferableTypedData>();\n      downloadResponseHandler = RawReceivePort((_DownloadResponse response) {\n        if (response.bytes != null) {\n          if (bytesCompleter.isCompleted) {\n            // If an uncaught error occurred in the worker isolate, we'll have"
  },
  {
    "id" : "a9edbcf0-25d8-486d-aa28-6f4362a5cc90",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-281235949",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f1450aff-9b83-4fb7-86f7-1b802eb1d71c",
        "parentId" : null,
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "Why not declare and assign this in the same line?",
        "createdAt" : "2019-08-27T16:32:33Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "601cf899-b5ec-4520-b223-eeaed8b74a9f",
        "parentId" : "f1450aff-9b83-4fb7-86f7-1b802eb1d71c",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "I guess the intent is to capture exceptions that might happen when you try to initialize this `downloadResponseHandler`.",
        "createdAt" : "2019-08-29T06:09:03Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +71,75 @@    StreamController<ImageChunkEvent> chunkEvents,\n  ) async {\n    RawReceivePort downloadResponseHandler;\n    try {\n      assert(key == this);"
  },
  {
    "id" : "334aff37-e196-4688-96b6-dd7c53c9bcb2",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-281247368",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "439cf335-975f-4b63-93d8-0ffc6eb934ad",
        "parentId" : null,
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "This method is very long and dense. Wondering if everything that's in this if could be refactored into a separate method `_createIsolate`.",
        "createdAt" : "2019-08-27T16:37:59Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "cd30c60c-72d2-41c0-99b3-fc015ce56a3e",
        "parentId" : "439cf335-975f-4b63-93d8-0ffc6eb934ad",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "We had some code extracted into `_setupIsolate` before, so I renamed that method into `_spawnIsolate` and moved this code into `_spawnAndSetupIsolate`",
        "createdAt" : "2019-08-29T06:43:44Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 117,
    "diffHunk" : "@@ -1,1 +112,116 @@      } else {\n        if (_pendingLoader == null) {\n          // If worker isolate creation was not started, start creation now.\n          _spawnAndSetupIsolate();\n        }"
  },
  {
    "id" : "93f1989a-cd0a-465b-925d-3e97b775d189",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-287688964",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5c13e541-b43c-422e-9f5a-7ccb667e1faf",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Add `assert(_pendingLoader == null)`",
        "createdAt" : "2019-09-11T19:34:10Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      },
      {
        "id" : "47533cae-4fba-4cbd-a790-6ebe78421138",
        "parentId" : "5c13e541-b43c-422e-9f5a-7ccb667e1faf",
        "authorId" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "body" : "Done",
        "createdAt" : "2019-09-12T20:35:18Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "324f8243-b35a-40e4-a3a7-2939450eef90",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 138,
    "diffHunk" : "@@ -1,1 +133,137 @@\n  void _spawnAndSetupIsolate() {\n    assert(_pendingLoadRequests == null);\n    assert(_loaderErrorHandler == null);\n    assert(_pendingLoader == null);"
  },
  {
    "id" : "7b11f88a-7c45-4154-b221-6410108e6a98",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-286949833",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb398581-72d9-4c47-8a82-c25a4168a26d",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "Shouldn't this be `.then()`, not `..then()`?  i.e. don't you want `pendingLoader` to complete only once the isolate is resumed?",
        "createdAt" : "2019-09-11T19:37:37Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 142,
    "diffHunk" : "@@ -1,1 +137,141 @@    assert(_pendingLoader == null);\n    _pendingLoadRequests = <_DownloadRequest>[];\n    _pendingLoader = _spawnIsolate()..then((Isolate isolate) {\n      _loaderErrorHandler = RawReceivePort((List<dynamic> errorAndStackTrace) {\n        _cleanupDueToError(errorAndStackTrace[0]);"
  },
  {
    "id" : "eaae510d-4c96-416c-b3fa-a51c211cef11",
    "prId" : 34188,
    "prUrl" : "https://github.com/flutter/flutter/pull/34188#pullrequestreview-286949833",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6cd38dab-450e-4add-80fb-a18ebe099489",
        "parentId" : null,
        "authorId" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "body" : "@goderbauer you were talking about how this PR breaks the ability to use [HttpOverrides](https://api.dartlang.org/stable/2.5.0/dart-io/HttpOverrides-class.html), but callers should be able to use `debugNetworkImageHttpClientProvider` to hook into an overridden HTTP client, no?",
        "createdAt" : "2019-09-11T21:03:47Z",
        "updatedAt" : "2019-09-18T14:39:24Z",
        "lastEditedBy" : "1dc608b7-5634-49db-a2de-36dd357356e8",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b85a4bc99355dad3de9fc5484028f4bf3412c2c",
    "line" : 102,
    "diffHunk" : "@@ -1,1 +98,102 @@      // out of release builds.\n      HttpClientProvider httpClientProvider;\n      assert(() { httpClientProvider = debugNetworkImageHttpClientProvider; return true; }());\n\n      final _DownloadRequest downloadRequest = _DownloadRequest("
  }
]