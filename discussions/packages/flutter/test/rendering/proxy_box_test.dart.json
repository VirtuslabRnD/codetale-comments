[
  {
    "id" : "cc673ee0-9882-40be-b651-13cd352e512c",
    "prId" : 48985,
    "prUrl" : "https://github.com/flutter/flutter/pull/48985#pullrequestreview-344801974",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "parentId" : null,
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "Might be worthwhile to also add an actual semantics test to the FractionalTranslation widget that verifies that the generated semantics actually changed as expected when the translation is changed.",
        "createdAt" : "2020-01-16T22:04:36Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "d7be2166-d931-451d-882c-0b7a3bbdb424",
        "parentId" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "authorId" : "6cff55ea-5671-4703-a864-79795e21a275",
        "body" : "I am having trouble writing such a test. I have:\r\n\r\n```\r\n    testWidgets('semantics bounds are updated', (WidgetTester tester) async {\r\n      final GlobalKey fractionalTranslationKey = GlobalKey();\r\n      final GlobalKey sizedBoxKey = GlobalKey();\r\n      Offset offset = const Offset(0.4, 0.4);\r\n\r\n      await tester.pumpWidget(\r\n        StatefulBuilder(\r\n          builder: (BuildContext context, StateSetter setState) {\r\n            return Center(\r\n              child: FractionalTranslation(\r\n                key: fractionalTranslationKey,\r\n                translation: offset,\r\n                transformHitTests: true,\r\n                child: Listener(\r\n                  onPointerDown: (PointerDownEvent event) {\r\n                    setState(() {\r\n                      offset = const Offset(0.8, 0.8);\r\n                    });\r\n                  },\r\n                  child: SizedBox(\r\n                    key: sizedBoxKey,\r\n                    width: 100.0,\r\n                    height: 100.0,\r\n                    child: Container(\r\n                      color: const Color(0xFF0000FF)\r\n                    ),\r\n                  ),\r\n                ),\r\n              ),\r\n            );\r\n          },\r\n        )\r\n      );\r\n      expect(tester.getSemantics(find.byKey(fractionalTranslationKey)), matchesSemantics(\r\n        rect: Rect.fromPoints(Offset.zero, Offset.zero), // failing on purpose, should probably be 40, 40 ?\r\n      ));\r\n```\r\n\r\nwhich fails with:\r\n\r\n```\r\nThe following TestFailure object was thrown running a test:\r\n  Expected: has semantics with actions: [] with flags: [] with rect: Rect.fromLTRB(0.0, 0.0, 0.0,\r\n0.0)\r\n  Actual: SemanticsNode:<SemanticsNode#0(Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0))>\r\n   Which: rect was: Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0)\r\n```\r\n\r\nNo matter what the translation is set to, the bounds are always (0.0, 0.0, 2400.0, 1800.0) for both the FractionalTranslation and the SizedBox inside",
        "createdAt" : "2020-01-17T15:25:49Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "6cff55ea-5671-4703-a864-79795e21a275",
        "tags" : [
        ]
      },
      {
        "id" : "53ccd0e8-3fe6-405d-8c2e-2f4e9940f4c5",
        "parentId" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "After the pump can you call `debugDumpSemanticsTree` and post the output? That would make it easier to debug this.\r\n\r\nMy guess is that the the semantics of the FractionalTranslation get pulled up all the way into the root node and that's why you're seeing this. If you throw in a `Semantics(explicitChildNodes: true, child: ...)` around the FractionalTranslation or the Center widget it may work. Looking at the semantics tree dump would tell us for sure.",
        "createdAt" : "2020-01-17T17:45:40Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "f0020059-fd09-4997-94e4-e0f36a9550f6",
        "parentId" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "authorId" : "6cff55ea-5671-4703-a864-79795e21a275",
        "body" : "output of `debugDumpSemanticsTree` is the same with or without the `Semantics(explicitChildNodes: true)` wrapper:\r\n\r\n```\r\nSemanticsNode#0\r\n   Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0)\r\n```",
        "createdAt" : "2020-01-17T19:28:08Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "6cff55ea-5671-4703-a864-79795e21a275",
        "tags" : [
        ]
      },
      {
        "id" : "938c0f42-3e77-43fe-9b9d-95cdd5aca99c",
        "parentId" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "That's the only node that gets created? \r\n\r\nOh, it's probably because no child of FractionalTranslation has any real semantics to contribute. Try giving the container a `Text('foo')` child.",
        "createdAt" : "2020-01-17T19:30:51Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "8de7ba39-ea17-4b2a-ac07-34af2ccefdca",
        "parentId" : "1cebae74-c85c-4b6b-8f1a-7e8182922845",
        "authorId" : "6cff55ea-5671-4703-a864-79795e21a275",
        "body" : "If the child of SizedBox is a Text('foo'):\r\n```\r\nSemanticsNode#0\r\n │ Rect.fromLTRB(0.0, 0.0, 2400.0, 1800.0)\r\n │\r\n └─SemanticsNode#1\r\n     Rect.fromLTRB(0.0, 0.0, 100.0, 100.0) with transform\r\n     [3.0,0.0,0.0,1170.0; 0.0,3.0,0.0,870.0; 0.0,0.0,1.0,0.0;\r\n     0.0,0.0,0.0,1.0]\r\n     label: \"foo\"\r\n     textDirection: ltr\r\n```\r\n\r\nLet me see if I can write a test around this transform changing",
        "createdAt" : "2020-01-17T19:43:38Z",
        "updatedAt" : "2020-01-17T21:41:18Z",
        "lastEditedBy" : "6cff55ea-5671-4703-a864-79795e21a275",
        "tags" : [
        ]
      }
    ],
    "commit" : "2adda16a5cea6ef2f1bbe7cda78b346e569bc7a3",
    "line" : 129,
    "diffHunk" : "@@ -1,1 +456,460 @@  });\n\n  test('RenderFractionalTranslation updates its semantics after its translation value is set', () {\n    final _TestSemanticsUpdateRenderFractionalTranslation box = _TestSemanticsUpdateRenderFractionalTranslation(\n      translation: const Offset(0.5, 0.5),"
  }
]