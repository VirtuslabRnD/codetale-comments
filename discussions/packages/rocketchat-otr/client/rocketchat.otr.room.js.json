[
  {
    "id" : "7f13de97-9f3b-4b7a-9e53-cd30c02f4b15",
    "prId" : 2476,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0488779c-693b-4a84-9f44-84554f06f18c",
        "parentId" : null,
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "Shouldn't `hexStringToUint8Array` conversion already be done by EJSON?\n",
        "createdAt" : "2016-03-11T19:35:56Z",
        "updatedAt" : "2016-03-11T19:35:56Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      }
    ],
    "commit" : "f018846dae6f6818a1cf915b75756eb5c250e0c6",
    "line" : 194,
    "diffHunk" : "@@ -1,1 +92,96 @@\n\timportPublicKey(publicKey) {\n\t\treturn window.crypto.subtle.importKey('spki', this.hexStringToUint8Array(publicKey), {\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256'"
  },
  {
    "id" : "dc7b8345-0b9b-4924-b2b0-3d0eb39605f9",
    "prId" : 2476,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "df5a84ea-2da0-4dd9-9b61-dc1dbb0ee1f4",
        "parentId" : null,
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "This will not go well. It will work only for 255 messages. :-)\n",
        "createdAt" : "2016-03-12T02:21:19Z",
        "updatedAt" : "2016-03-12T02:21:19Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      },
      {
        "id" : "740a876e-99b1-4164-814a-74d004c9d50e",
        "parentId" : "df5a84ea-2da0-4dd9-9b61-dc1dbb0ee1f4",
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "Serial has to be an array.\n\nYou can use something like the following to have serial inside an array:\n\n``` javascript\n  function enlargeArray(array, newLength) {\n  var newArray = new Uint8Array(newLength);\n  newArray.set(array, newLength - array.length);\n  return newArray;\n}\n\nfunction increment(array) {\n  for (var i = array.length - 1; i >= 0; i--) {\n    array[i]++;\n    // Overflow happened, we have to carry over.\n    if (array[i] === 0) {\n      continue;\n    }\n    else {\n      // We are done.\n      return array;\n    }\n  }\n\n  // We have to enlarge the array and carry over.\n  array = enlargeArray(array, array.length + 1);\n  array[0] = 1;\n  return array;\n}\n```\n",
        "createdAt" : "2016-03-12T02:22:32Z",
        "updatedAt" : "2016-03-12T02:22:57Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      },
      {
        "id" : "107e68fd-d84a-44f2-8606-7e3a71d4d0e5",
        "parentId" : "df5a84ea-2da0-4dd9-9b61-dc1dbb0ee1f4",
        "authorId" : "04e96216-90aa-4b11-aeaf-cc10e5f37182",
        "body" : "Why do you think serial has to be an array? I later check if serial is one larger, and I add to that check if serial was 255... \n\n```\nvar checkSerial = serial - this.peerSerial;\nif (checkSerial !== 1 && checkSerial !== -255) {\n    throw new Error(\"Invalid serial.\");\n}\n```\n",
        "createdAt" : "2016-03-13T16:10:22Z",
        "updatedAt" : "2016-03-13T16:10:22Z",
        "lastEditedBy" : "04e96216-90aa-4b11-aeaf-cc10e5f37182",
        "tags" : [
        ]
      },
      {
        "id" : "ba1ef1f8-b9de-44c0-b947-8a108ae50733",
        "parentId" : "df5a84ea-2da0-4dd9-9b61-dc1dbb0ee1f4",
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "Because this is an 8-bit array.\n",
        "createdAt" : "2016-03-13T22:02:23Z",
        "updatedAt" : "2016-03-13T22:02:23Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      }
    ],
    "commit" : "f018846dae6f6818a1cf915b75756eb5c250e0c6",
    "line" : 245,
    "diffHunk" : "@@ -1,1 +123,127 @@\t\tthis.serial++;\n\t\tvar data = new Uint8Array(1 + 1 + userId.length + clearText.length);\n\t\tdata[0] = this.serial;\n\t\tdata[1] = userId.length;\n\t\tdata.set(userId, 2);"
  },
  {
    "id" : "f9a0952e-6e36-4f8e-849a-3158e115c42a",
    "prId" : 2476,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a9dc1d43-cc6e-4cc6-926e-128096c92ab3",
        "parentId" : null,
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "Of course, you have to handle errors better. ;-)\n",
        "createdAt" : "2016-03-12T02:24:08Z",
        "updatedAt" : "2016-03-12T02:24:08Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      }
    ],
    "commit" : "f018846dae6f6818a1cf915b75756eb5c250e0c6",
    "line" : 279,
    "diffHunk" : "@@ -1,1 +140,144 @@\t\t\treturn this.bytesToHexString(output);\n\t\t}).catch((e) => {\n\t\t\tconsole.log(e);\n\t\t\treturn \"\";\n\t\t});"
  },
  {
    "id" : "030099a6-f442-47c2-b639-9729bce27ad9",
    "prId" : 2476,
    "prUrl" : null,
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "15f0d759-f1c4-4a11-949a-66bf433fc24c",
        "parentId" : null,
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "See, you can have your own format, like we have now. Where you have (length, data) tuples concatenated. Or, you could have `var data = new TextEncoder(\"UTF-8\").encode(EJSON.stringify({serial: serial, clearText: clearText}))`. It would not be so compact, but it would be potentially more future proof. So easier to have various versions of the protocol communicate with each other.\n",
        "createdAt" : "2016-03-12T02:26:14Z",
        "updatedAt" : "2016-03-12T06:04:49Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      },
      {
        "id" : "34dfadfe-a595-4484-9dac-b1d72e9a1fcb",
        "parentId" : "15f0d759-f1c4-4a11-949a-66bf433fc24c",
        "authorId" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "body" : "(Imagine various version of mobile apps of Rocket.Chat talking to each other.)\n",
        "createdAt" : "2016-03-12T02:26:33Z",
        "updatedAt" : "2016-03-12T02:26:33Z",
        "lastEditedBy" : "adf4969a-4fbb-4872-99ed-1f1d46b22677",
        "tags" : [
        ]
      }
    ],
    "commit" : "f018846dae6f6818a1cf915b75756eb5c250e0c6",
    "line" : 244,
    "diffHunk" : "@@ -1,1 +122,126 @@\t\tvar userId = new TextEncoder(\"UTF-8\").encode(this.userId);\n\t\tthis.serial++;\n\t\tvar data = new Uint8Array(1 + 1 + userId.length + clearText.length);\n\t\tdata[0] = this.serial;\n\t\tdata[1] = userId.length;"
  }
]