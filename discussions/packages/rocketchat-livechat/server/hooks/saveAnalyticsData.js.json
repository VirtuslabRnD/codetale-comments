[
  {
    "id" : "3decea3b-5034-4241-8b9c-50bb6412eda6",
    "prId" : 11238,
    "prUrl" : "https://github.com/RocketChat/Rocket.Chat/pull/11238#pullrequestreview-148331631",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "140eb3af-0043-4427-8bb7-ecb044f6bd1e",
        "parentId" : null,
        "authorId" : "409df6ab-3b03-4605-a9f9-90ba7bb0018e",
        "body" : "Let's improve this code...  you can add something like this above the `Meteor.defer()`:\r\n\r\n```\r\nif (message.token) {\r\n    return message;\r\n}\r\n```\r\n\r\nThis change will improve the readability of the rest of the code as well.",
        "createdAt" : "2018-08-22T02:30:15Z",
        "updatedAt" : "2018-09-20T20:13:23Z",
        "lastEditedBy" : "409df6ab-3b03-4605-a9f9-90ba7bb0018e",
        "tags" : [
        ]
      },
      {
        "id" : "b6025bfe-e761-46f7-b2c1-9e57714700da",
        "parentId" : "140eb3af-0043-4427-8bb7-ecb044f6bd1e",
        "authorId" : "e6cb547d-0d46-4cb8-8ba9-b026ee06135b",
        "body" : "I guess it has to be this way, because even if `message.token` is `true`, we still call the method `saveAnalyticsDataByRoomId` to update message timestamps (since we have merged other method into one).",
        "createdAt" : "2018-08-22T04:49:56Z",
        "updatedAt" : "2018-09-20T20:13:23Z",
        "lastEditedBy" : "e6cb547d-0d46-4cb8-8ba9-b026ee06135b",
        "tags" : [
        ]
      }
    ],
    "commit" : "085758466b9111549693c1a8f4e55538a41241da",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +15,19 @@\n\t\t// if the message has a token, it was sent by the visitor\n\t\tif (!message.token) {\n\t\t\tconst visitorLastQuery = (room.metrics && room.metrics.v) ? room.metrics.v.lq : room.ts;\n\t\t\tconst agentLastReply = (room.metrics && room.metrics.servedBy) ? room.metrics.servedBy.lr : room.ts;"
  }
]