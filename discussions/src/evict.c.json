[
  {
    "id" : "ba34acfb-ccbe-4144-a7d4-2ea9ceb25570",
    "prId" : 9031,
    "prUrl" : "https://github.com/redis/redis/pull/9031#pullrequestreview-699938380",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4d0faf08-bf09-4065-b0a6-a17eef58c022",
        "parentId" : null,
        "authorId" : "473bc8a0-7ca7-405b-9794-3e9f874fb547",
        "body" : "@oranagra I wander whether line 513 is needed.",
        "createdAt" : "2021-07-06T12:20:32Z",
        "updatedAt" : "2021-07-06T12:20:32Z",
        "lastEditedBy" : "473bc8a0-7ca7-405b-9794-3e9f874fb547",
        "tags" : [
        ]
      },
      {
        "id" : "0341502b-963d-41c3-8ca8-aa85d7da7714",
        "parentId" : "4d0faf08-bf09-4065-b0a6-a17eef58c022",
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "what do you mean by \"needed\"? are you suggesting to delete it? or saying that in that early return we don't need to update the metrics?\r\n\r\nif that's the second case, then i think you're right. that early return is as if we didn't call this function.\r\nbut better add some comment there that says that we don't go to `update_metrics` on purpose because it's as if we didn't call this function. (it's a fake EVICT_OK).\r\n\r\np.s. that exact line used to be implemented in a wrapper function in the past 8-)",
        "createdAt" : "2021-07-06T13:10:57Z",
        "updatedAt" : "2021-07-06T13:10:57Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      },
      {
        "id" : "b4a8f3f3-c372-4f5a-9d2d-4b904a5327d8",
        "parentId" : "4d0faf08-bf09-4065-b0a6-a17eef58c022",
        "authorId" : "473bc8a0-7ca7-405b-9794-3e9f874fb547",
        "body" : "I mean second case. At replica, if we change `server.repl_slave_ignore_maxmemory`, then maybe these metrics can't be updated forever. But this is rarely.",
        "createdAt" : "2021-07-06T13:15:16Z",
        "updatedAt" : "2021-07-06T13:15:16Z",
        "lastEditedBy" : "473bc8a0-7ca7-405b-9794-3e9f874fb547",
        "tags" : [
        ]
      }
    ],
    "commit" : "8d86ef22562042681bd80e3adb010e367d799d59",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +523,527 @@    int result = EVICT_FAIL;\n\n    if (getMaxmemoryState(&mem_reported,NULL,&mem_tofree,NULL) == C_OK) {\n        result = EVICT_OK;\n        goto update_metrics;"
  },
  {
    "id" : "a72f0a75-7de6-471d-a3ec-b4a3ac7d0eae",
    "prId" : 7954,
    "prUrl" : "https://github.com/redis/redis/pull/7954#pullrequestreview-544277855",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "20d973bc-945f-4343-afc7-5dabd33eed08",
        "parentId" : null,
        "authorId" : "b80d1b62-d71e-412b-8ac1-75ca11c2ea56",
        "body" : "It seems odd to put this in `evict.c` (as it has nothing to do with eviction).  However I realize that a lot of `evict.c` is actually about memory management.  This might be the most expedient location.",
        "createdAt" : "2020-12-03T18:01:46Z",
        "updatedAt" : "2020-12-06T09:33:53Z",
        "lastEditedBy" : "b80d1b62-d71e-412b-8ac1-75ca11c2ea56",
        "tags" : [
        ]
      },
      {
        "id" : "6dd39865-4638-46f8-8b6e-3d1294e2461c",
        "parentId" : "20d973bc-945f-4343-afc7-5dabd33eed08",
        "authorId" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "body" : "right. we have a few other methods that interact with `maxmemory` here which are not strictly eviction. i think it's ok.",
        "createdAt" : "2020-12-03T18:55:47Z",
        "updatedAt" : "2020-12-06T09:33:53Z",
        "lastEditedBy" : "02e243fa-aeed-4b15-9e9e-405ca1702d7e",
        "tags" : [
        ]
      }
    ],
    "commit" : "20d8a8e678e802cd8f14a4bd44e8540531bd46f7",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +416,420 @@ * return 0 if not. Redis may reject user's requests or evict some keys if used\n * memory exceeds maxmemory, especially, when we allocate huge memory at once. */\nint overMaxmemoryAfterAlloc(size_t moremem) {\n    if (!server.maxmemory) return  0; /* No limit. */\n"
  }
]