[
  {
    "id" : "2b916049-f99c-43c3-a02b-57497ae1ac98",
    "prId" : 72096,
    "prUrl" : "https://github.com/ansible/ansible/pull/72096#pullrequestreview-502299771",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "76003aed-82b7-4e2f-88a1-d3118dc97a75",
        "parentId" : null,
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "Should this also have a copyright string on top or is it different for tests?",
        "createdAt" : "2020-10-05T18:09:14Z",
        "updatedAt" : "2020-10-05T20:54:34Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      }
    ],
    "commit" : "011224265703a26751ca4861a9e23c3bd243f8e7",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +3,7 @@#\n#\n# Ansible is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or"
  },
  {
    "id" : "ae3fefb6-7935-4684-bc5b-cabd6f80821f",
    "prId" : 72096,
    "prUrl" : "https://github.com/ansible/ansible/pull/72096#pullrequestreview-502420538",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6d9c1f6e-eb0b-4e1f-972b-d8bc3ad80af5",
        "parentId" : null,
        "authorId" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "body" : "I guess more of the preparation activities could be moved outside making the tests cleaner:\r\n```suggestion\r\nDOCKER_IMAGES_CALLS = [\r\n    call(\r\n        '',\r\n        ['images', 'quay.io/ansible/centos7-test-container', '--format', '{{json .}}'],\r\n        capture=True,\r\n        always=True),\r\n    call(\r\n        '',\r\n        ['images', 'quay.io/ansible/centos7-test-container', '--format', 'json'],\r\n        capture=True,\r\n        always=True),\r\n]\r\n\r\n@pytest.fixture\r\ndef docker_command_patch_kwargs(docker_images, mocker, request):\r\n    patch_kwargs = request.param\r\n    if not patch_kwargs:\r\n        return\r\n    mocker.patch(\r\n        'ansible_test._internal.docker_util.docker_command',\r\n        **patch_kwargs\r\n    )\r\n\r\n\r\n@pytest.mark.parametrize(\r\n    ('returned_items_count', 'patched_dc_stdout', dc_calls_num),\r\n    (\r\n        (3, {'return_value': (DOCKER_OUTPUT_MULTIPLE, '')}),\r\n        (2, {'return_value': (PODMAN_OUTPUT, '')}),\r\n        (0, {'return_value': ('', '')}),\r\n    ),\r\n    indirect=('ansible_module_args', ),\r\n    ids=('docker JSONL', 'podman JSON sequence', 'empty output'),\r\n)\r\n@pytest.mark.usefixtures('docker_command_patch_kwargs')\r\ndef test_docker_images(returned_items_count, patched_dc_stdout, dc_calls_num, ansible_test):\r\n    ret = docker_images('', 'quay.io/ansible/centos7-test-container')\r\n\r\n    assert len(ret) == returned_items_count\r\n\r\n    ansible_test._internal.docker_util.docker_command.assert_has_calls(\r\n        DOCKER_IMAGES_CALLS[:1],\r\n    )\r\n\r\n\r\ndef test_podman_fallback(ansible_test, docker_images, subprocess_error, mocker):\r\n    '''Test podman >2 && <2.2 fallback'''\r\n\r\n    cmd = ['docker', 'images', 'quay.io/ansible/centos7-test-container', '--format', '{{json .}}']\r\n    docker_command_results = [\r\n        subprocess_error(cmd, status=1, stderr='function \"json\" not defined'),\r\n        (PODMAN_OUTPUT, ''),\r\n    ]\r\n    mocker.patch(\r\n        'ansible_test._internal.docker_util.docker_command',\r\n        side_effect=docker_command_results)\r\n\r\n    ret = docker_images('', 'quay.io/ansible/centos7-test-container')\r\n    ansible_test._internal.docker_util.docker_command.assert_has_calls(DOCKER_IMAGES_CALLS)\r\n    assert len(ret) == 2\r\n```",
        "createdAt" : "2020-10-05T21:05:58Z",
        "updatedAt" : "2020-10-05T21:06:01Z",
        "lastEditedBy" : "4ffac6b8-d7eb-449a-8c43-463d9fd5587a",
        "tags" : [
        ]
      }
    ],
    "commit" : "011224265703a26751ca4861a9e23c3bd243f8e7",
    "line" : 119,
    "diffHunk" : "@@ -1,1 +117,121 @@    ]\n    ansible_test._internal.docker_util.docker_command.assert_has_calls(calls)\n    assert len(ret) == 2\n\n"
  }
]