[
  {
    "id" : "908075f0-a178-4992-a008-173ce7bd842c",
    "prId" : 102050,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102050#pullrequestreview-675290584",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c3fd2b28-bfd8-4b30-b7c0-64ae8f24c509",
        "parentId" : null,
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "is not a bit weird to have `requested` here? if the caller knows he is not going to request info why he calls the function anyway?\r\nI see that it simplifies the code in `NewMetricsGrabber` constructor but is it worth it? ",
        "createdAt" : "2021-06-03T13:25:14Z",
        "updatedAt" : "2021-06-03T13:25:14Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      },
      {
        "id" : "ced42615-cbfb-4814-ae80-51b4f87e96d3",
        "parentId" : "c3fd2b28-bfd8-4b30-b7c0-64ae8f24c509",
        "authorId" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "body" : "> I see that it simplifies the code in NewMetricsGrabber constructor but is it worth it?\r\n\r\nThis is an internal helper function. It's whole purpose is to make the constructor simpler and not have any repeated code there (like this if check), so I think it's worth it.",
        "createdAt" : "2021-06-03T13:31:49Z",
        "updatedAt" : "2021-06-03T13:31:49Z",
        "lastEditedBy" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "tags" : [
        ]
      },
      {
        "id" : "138829e3-b276-43a4-80e2-85e38edc8f64",
        "parentId" : "c3fd2b28-bfd8-4b30-b7c0-64ae8f24c509",
        "authorId" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "body" : "> if the caller knows he is not going to request info why he calls the function anyway?\r\n\r\nThe caller is the constructor and it doesn't know whether metrics for a component got requested. It's repeating that if check in the constructor that gets avoided by moving it into a parameter.\r\n",
        "createdAt" : "2021-06-03T13:40:15Z",
        "updatedAt" : "2021-06-03T13:40:15Z",
        "lastEditedBy" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "tags" : [
        ]
      }
    ],
    "commit" : "c91496dda04bdb3d685fffa4747d12a763f3ad37",
    "line" : 115,
    "diffHunk" : "@@ -1,1 +144,148 @@}\n\nfunc checkPodDebugHandlers(c clientset.Interface, requested bool, component, podName string) bool {\n\tif !requested {\n\t\treturn false"
  },
  {
    "id" : "ad15c65d-599d-407f-8f96-3c618b68fc5f",
    "prId" : 102050,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/102050#pullrequestreview-675286495",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6c252085-37e0-4628-852d-930960725e07",
        "parentId" : null,
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "is there any possible race here that the pod is listed, handlers are available but we fail to get the logs?\r\nis there an specific error we can match against?",
        "createdAt" : "2021-06-03T13:28:20Z",
        "updatedAt" : "2021-06-03T13:28:20Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      },
      {
        "id" : "e7dc5f41-6b13-455e-86a3-a83d719acbe9",
        "parentId" : "6c252085-37e0-4628-852d-930960725e07",
        "authorId" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "body" : "This could fail because the containers aren't running yet (IMHO unlikely, because this is now getting called after the e2e.test binary has already ensured that the cluster is up) or simply because of load.\r\n\r\nThere is some error text about debug handlers that we could check for and we could retry for other errors. I decided against it because its more complex, unlikely to happen (admittedly a bit subjective) and the impact of incorrectly disabling metrics grabbing is low. Run a job often enough and most of the time it should execute the tests.\r\n",
        "createdAt" : "2021-06-03T13:36:25Z",
        "updatedAt" : "2021-06-03T13:36:25Z",
        "lastEditedBy" : "ba0b9c6e-ec4c-4d1b-832e-751e6109bf38",
        "tags" : [
        ]
      }
    ],
    "commit" : "c91496dda04bdb3d685fffa4747d12a763f3ad37",
    "line" : 127,
    "diffHunk" : "@@ -1,1 +156,160 @@\t// We can check that indirectly by trying to retrieve log output.\n\tlimit := int64(1)\n\tif _, err := c.CoreV1().Pods(metav1.NamespaceSystem).GetLogs(podName, &v1.PodLogOptions{LimitBytes: &limit}).DoRaw(context.TODO()); err != nil {\n\t\tklog.Warningf(\"Can't retrieve log output of %s (%q). Debug handlers might be disabled in kubelet. Grabbing metrics from %s is disabled.\",\n\t\t\tpodName, err, component)"
  },
  {
    "id" : "3c3ffa35-fda0-4ff9-b6eb-e33083be7586",
    "prId" : 96299,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96299#pullrequestreview-582640743",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "27b836b2-6ed2-44c5-8367-5821ffa288c0",
        "parentId" : null,
        "authorId" : "87d7d25e-5586-44fd-93fa-024da6e91035",
        "body" : "While I understand this replicates the behavior of other controllers, it seems it will shadow errors. In the case where \"snapshotController\" is \"true\", should this just fail instead?",
        "createdAt" : "2021-01-31T22:27:46Z",
        "updatedAt" : "2021-05-11T18:40:08Z",
        "lastEditedBy" : "87d7d25e-5586-44fd-93fa-024da6e91035",
        "tags" : [
        ]
      },
      {
        "id" : "3e09d763-8afb-4091-8883-72f473730da2",
        "parentId" : "27b836b2-6ed2-44c5-8367-5821ffa288c0",
        "authorId" : "69dfcdb2-87bb-418a-81a7-28e458332cdd",
        "body" : "This is used by a lot of other test suites, so I think failing here would causes issues.",
        "createdAt" : "2021-02-03T17:51:30Z",
        "updatedAt" : "2021-05-11T18:40:08Z",
        "lastEditedBy" : "69dfcdb2-87bb-418a-81a7-28e458332cdd",
        "tags" : [
        ]
      }
    ],
    "commit" : "564e531aa72f48afde659e5ce464d0c35d608889",
    "line" : 84,
    "diffHunk" : "@@ -1,1 +113,117 @@\tif snapshotControllerManager == \"\" {\n\t\tsnapshotController = false\n\t\tklog.Warningf(\"Can't find snapshot-controller pod. Grabbing metrics from snapshot-controller is disabled.\")\n\t}\n\tif ec == nil {"
  },
  {
    "id" : "e8b403f9-a7cd-44e0-8637-bf775bcaf489",
    "prId" : 96299,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/96299#pullrequestreview-581941857",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e46b9f68-4085-412a-b4fd-c4d098f43c6f",
        "parentId" : null,
        "authorId" : "87d7d25e-5586-44fd-93fa-024da6e91035",
        "body" : "IMO, this bool list suggesting whether a specific component should be considered have grown to a point which worth warping them as a config. :) ",
        "createdAt" : "2021-01-31T22:49:59Z",
        "updatedAt" : "2021-05-11T18:40:08Z",
        "lastEditedBy" : "87d7d25e-5586-44fd-93fa-024da6e91035",
        "tags" : [
        ]
      },
      {
        "id" : "f0f28527-2917-4e03-a292-4db2d3fa6a9c",
        "parentId" : "e46b9f68-4085-412a-b4fd-c4d098f43c6f",
        "authorId" : "69dfcdb2-87bb-418a-81a7-28e458332cdd",
        "body" : "Agreed, but I didn't want to introduce too many changes to other packages for this PR",
        "createdAt" : "2021-02-03T01:53:48Z",
        "updatedAt" : "2021-05-11T18:40:08Z",
        "lastEditedBy" : "69dfcdb2-87bb-418a-81a7-28e458332cdd",
        "tags" : [
        ]
      }
    ],
    "commit" : "564e531aa72f48afde659e5ce464d0c35d608889",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +72,76 @@\n// NewMetricsGrabber returns new metrics which are initialized.\nfunc NewMetricsGrabber(c clientset.Interface, ec clientset.Interface, kubelets bool, scheduler bool, controllers bool, apiServer bool, clusterAutoscaler bool, snapshotController bool) (*Grabber, error) {\n\n\tkubeScheduler := \"\""
  },
  {
    "id" : "f61a18e7-619e-4ca8-a971-9fa2efac1eb0",
    "prId" : 92485,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/92485#pullrequestreview-437591541",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7b1d9753-61f5-4a7d-8c87-11fdede2186a",
        "parentId" : null,
        "authorId" : "2ce2b44c-9841-49e7-983e-fb7696974908",
        "body" : "i remembered a discussion around the fact that this is not a reliable way to determine if the namespace has the components in question, because someone might have decided to name them differently in their custom deployment.\r\n\r\nbut i'd argue that it's much better compared to using the deprecated \"master\" function and we are not going to return errors for them, but just skip the metrics gathering.\r\n",
        "createdAt" : "2020-06-25T15:09:00Z",
        "updatedAt" : "2020-06-25T23:08:47Z",
        "lastEditedBy" : "2ce2b44c-9841-49e7-983e-fb7696974908",
        "tags" : [
        ]
      }
    ],
    "commit" : "176c8e219f4c7b4c15d34b92c50bfa5ba02b3aba",
    "line" : 37,
    "diffHunk" : "@@ -1,1 +74,78 @@\n\tregKubeScheduler := regexp.MustCompile(\"kube-scheduler-.*\")\n\tregKubeControllerManager := regexp.MustCompile(\"kube-controller-manager-.*\")\n\n\tpodList, err := c.CoreV1().Pods(metav1.NamespaceSystem).List(context.TODO(), metav1.ListOptions{})"
  },
  {
    "id" : "ad345943-8e2b-4193-80c7-cb90fa5032c2",
    "prId" : 89192,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89192#pullrequestreview-376432765",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "051c9755-f7bc-4790-920f-aa4db688afdb",
        "parentId" : null,
        "authorId" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "body" : "can't use constants in `test/e2e/framework/ports.go` due to cyclical imports to `test/e2e/framework` :( ",
        "createdAt" : "2020-03-17T21:48:11Z",
        "updatedAt" : "2020-03-17T21:48:15Z",
        "lastEditedBy" : "6dd71efb-88b1-4bb0-b30a-0df658362f14",
        "tags" : [
        ]
      },
      {
        "id" : "ab3787c7-6ca8-4cd1-b157-6079005af0d7",
        "parentId" : "051c9755-f7bc-4790-920f-aa4db688afdb",
        "authorId" : "2ce2b44c-9841-49e7-983e-fb7696974908",
        "body" : "ack, i was hoping that one day the component ports and similar constants can be exported to a repository somewhere.\r\n",
        "createdAt" : "2020-03-17T21:54:43Z",
        "updatedAt" : "2020-03-17T21:54:43Z",
        "lastEditedBy" : "2ce2b44c-9841-49e7-983e-fb7696974908",
        "tags" : [
        ]
      }
    ],
    "commit" : "f0f6c6fc810e6b3f182ce2974a58da5122d84d71",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +37,41 @@\t// May be overridden by a flag at startup.\n\t// Deprecated: use the secure KubeSchedulerPort instead.\n\tinsecureSchedulerPort = 10251\n\t// insecureKubeControllerManagerPort is the default port for the controller manager status server.\n\t// May be overridden by a flag at startup."
  },
  {
    "id" : "d86e8ecd-2d89-41b6-a464-b4b47ca5fa0e",
    "prId" : 89123,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/89123#pullrequestreview-374715452",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9d9e41fe-9ec4-4ad0-9049-ed1f86324e53",
        "parentId" : null,
        "authorId" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "body" : "This is the best method I could find, please check if is the right one or are there better ones ",
        "createdAt" : "2020-03-14T11:20:58Z",
        "updatedAt" : "2020-03-14T11:20:58Z",
        "lastEditedBy" : "203dfb85-d185-4057-88b3-a1b4f09fd1fd",
        "tags" : [
        ]
      }
    ],
    "commit" : "2a095f434ba556fea7602feda8de374efdd23196",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +170,174 @@\tpodName := fmt.Sprintf(\"%v-%v\", \"kube-controller-manager\", g.masterName)\n\tg.waitForControllerManagerReadyOnce.Do(func() {\n\t\tif readyErr := e2epod.WaitForPodsReady(g.client, metav1.NamespaceSystem, podName, 0); readyErr != nil {\n\t\t\terr = fmt.Errorf(\"error waiting for controller manager pod to be ready: %w\", readyErr)\n\t\t\treturn"
  }
]