[
  {
    "id" : "73df43db-2630-4c57-a9e2-2b8f6cfb6353",
    "prId" : 93475,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/93475#pullrequestreview-458585566",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6594988d-d93d-44b5-a0dc-e20071bbb86d",
        "parentId" : null,
        "authorId" : "98986d5f-c846-4478-8363-8a016e3d6b89",
        "body" : "As an extra layer of verification in the test, can you please check that the Windows pod security context does not have any of the SE Linux details using `f.TestContainerOutput`? Some examples of this verification up above in this file as well as in  https://github.com/kubernetes/kubernetes/blob/master/test/e2e/node/security_context.go",
        "createdAt" : "2020-07-30T06:57:44Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "98986d5f-c846-4478-8363-8a016e3d6b89",
        "tags" : [
        ]
      },
      {
        "id" : "bbb9e979-53d0-41e0-8f5e-4afcb2edce68",
        "parentId" : "6594988d-d93d-44b5-a0dc-e20071bbb86d",
        "authorId" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "body" : "I thought about it if you're talking about looking at the pod fields if SELinux options are stripped, it may not be possible as since we are stripping the SELinux info in the kubelet and we're not making any apiserver call to update the pod spec, that information will not be available in the apiserver, so the pod.Spec will still have information related to SELinux, just that we ignore them on the kubelet side.\r\n\r\nHaving said that, IIUC, without this change the pod was not coming to running state, now if it comes, it means we should be good and the output of the container logs doesn't matter?",
        "createdAt" : "2020-07-30T14:21:29Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "tags" : [
        ]
      },
      {
        "id" : "a989c664-10cb-44e8-9846-2e8b465e4cff",
        "parentId" : "6594988d-d93d-44b5-a0dc-e20071bbb86d",
        "authorId" : "98986d5f-c846-4478-8363-8a016e3d6b89",
        "body" : "Makes sense that the apiserver will not be able to reflect the adjustments done in the kubelet. Thanks for pointing that out! The pod coming up would indeed be the only verification we can perform in the e2e. If you can add this fact as a comment in the test somewhere, that would be great.",
        "createdAt" : "2020-07-30T16:37:04Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "98986d5f-c846-4478-8363-8a016e3d6b89",
        "tags" : [
        ]
      },
      {
        "id" : "7ecb0acf-b686-4d52-9468-e7e6726e5e34",
        "parentId" : "6594988d-d93d-44b5-a0dc-e20071bbb86d",
        "authorId" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "body" : "Added the comment.",
        "createdAt" : "2020-07-30T16:54:29Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "tags" : [
        ]
      }
    ],
    "commit" : "cd8686bc57fe2a1e5fcf4b1c0bb82419125ab4d1",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +92,96 @@\t\tframework.ExpectNoError(err)\n\t\tframework.Logf(\"Created pod %v\", windowsPodWithSELinux)\n\t\tframework.ExpectNoError(e2epod.WaitForPodNameRunningInNamespace(f.ClientSet, windowsPodWithSELinux.Name,\n\t\t\tf.Namespace.Name), \"failed to wait for pod %s to be running\", windowsPodWithSELinux.Name)\n\t})"
  },
  {
    "id" : "cfaf6f11-b1c7-4911-bf74-705182da62fa",
    "prId" : 93475,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/93475#pullrequestreview-461048555",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a638cea4-29ae-43f5-8d12-de93f1e32307",
        "parentId" : null,
        "authorId" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "body" : "Just a note that it is a requirement to taint the nodes before running the windows tests. We didn't want to change the specs for all the tests to add the labels so this would be why it this wasn't there initially. I think because this tests is windows only and this pod has windows specific setting it ok to add here. ",
        "createdAt" : "2020-07-30T21:50:17Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "tags" : [
        ]
      },
      {
        "id" : "fd039944-6719-4d2a-b954-e4d1a5c0971d",
        "parentId" : "a638cea4-29ae-43f5-8d12-de93f1e32307",
        "authorId" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "body" : "We have mixed nodes(both linux+windows) in OpenShift cluster, so it became necessary to run e2es.",
        "createdAt" : "2020-07-31T04:57:14Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "tags" : [
        ]
      },
      {
        "id" : "7dc6d969-f4ed-41ee-ba22-0f8c27d95896",
        "parentId" : "a638cea4-29ae-43f5-8d12-de93f1e32307",
        "authorId" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "body" : "make sense, for running tests on testgrid we taint the linux nodes (in this case it's only the control nodes): \r\n\r\nhttps://github.com/kubernetes-sigs/windows-testing/blob/ee418e4b7c5d6ce74cc90cf74e0b48754ce0463b/extensions/master_extension/v1/win-e2e-master-extension.sh#L52\r\nhttps://github.com/kubernetes-sigs/windows-testing/blob/ee418e4b7c5d6ce74cc90cf74e0b48754ce0463b/gce/run-e2e.sh#L15\r\n\r\nAdding the node selector here isn't a problem due to the fact this is in the `sig-windows` folder and only applicable to windows nodes. ",
        "createdAt" : "2020-08-04T18:05:25Z",
        "updatedAt" : "2020-08-04T18:05:25Z",
        "lastEditedBy" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "tags" : [
        ]
      }
    ],
    "commit" : "cd8686bc57fe2a1e5fcf4b1c0bb82419125ab4d1",
    "line" : 43,
    "diffHunk" : "@@ -1,1 +104,108 @@\t\t},\n\t\tSpec: v1.PodSpec{\n\t\t\tNodeSelector: map[string]string{\"kubernetes.io/os\": \"windows\"},\n\t\t\tContainers: []v1.Container{\n\t\t\t\t{"
  },
  {
    "id" : "392e23ab-a17a-48db-b126-a8fa548944ad",
    "prId" : 93475,
    "prUrl" : "https://github.com/kubernetes/kubernetes/pull/93475#pullrequestreview-482812815",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f96c2b16-b980-4b33-a81a-1bb45e769951",
        "parentId" : null,
        "authorId" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "body" : "I think it would make sense to add linux options to the container level as well to ensure it gets cleared as well when set there",
        "createdAt" : "2020-07-30T21:56:56Z",
        "updatedAt" : "2020-08-04T03:44:06Z",
        "lastEditedBy" : "df90aa6f-4328-4d27-92eb-8f98c90bd8b0",
        "tags" : [
        ]
      },
      {
        "id" : "ddb8db07-28fb-4b97-b2f2-aca6db004801",
        "parentId" : "f96c2b16-b980-4b33-a81a-1bb45e769951",
        "authorId" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "body" : "Added",
        "createdAt" : "2020-09-04T16:51:13Z",
        "updatedAt" : "2020-09-04T16:51:13Z",
        "lastEditedBy" : "38ca4f80-c365-4775-8981-1e56b713b07b",
        "tags" : [
        ]
      }
    ],
    "commit" : "cd8686bc57fe2a1e5fcf4b1c0bb82419125ab4d1",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +84,88 @@\t\tcontainerUserName := \"ContainerAdministrator\"\n\t\twindowsPodWithSELinux.Spec.SecurityContext.SELinuxOptions = &v1.SELinuxOptions{Level: \"s0:c24,c9\"}\n\t\twindowsPodWithSELinux.Spec.Containers[0].SecurityContext = &v1.SecurityContext{\n\t\t\tSELinuxOptions: &v1.SELinuxOptions{Level: \"s0:c24,c9\"},\n\t\t\tWindowsOptions: &v1.WindowsSecurityContextOptions{RunAsUserName: &containerUserName}}"
  }
]