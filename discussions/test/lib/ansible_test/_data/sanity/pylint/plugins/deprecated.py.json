[
  {
    "id" : "a30d3d05-8c47-4afd-9b69-a0dded80bbbb",
    "prId" : 68177,
    "prUrl" : "https://github.com/ansible/ansible/pull/68177#pullrequestreview-418695750",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "parentId" : null,
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "I'm not sure if we can actually have this sanity check enabled just by checking the date. I unfortunately don't have a good alternative but this will be problematic for a few reasons.\r\n\r\n* The dep by date is meant to enforce that deprecations will have a minimum of 2 years before they are removed, it's not to say that this will be removed at exactly 2 years time\r\n* To remove a feature we would typically need to increase the major version of the collection, doing this at random times just because a dep period has been reached won't paint the best picture of stability of the collection\r\n\r\nIn short having a sanity test fail when we don't have any immediate plans to actually remove the feature means either we need to ignore the error and defeat the purpose of the check or just live with the error, making CI failures harder to diagnose.\r\n\r\nAn example scenario of this problem would be the maintenance releases of a certified collection. These collections are currently set to have a rolling release and a 24 month maintenance release. The latter is a bug fix only release with no features being added or removed so it could potentially have a deprecated feature 6 months into it's lifecycle and we need to ignore this sanity check for that branch entirely.\r\n\r\nAnother scenario is for the rolling release, say we have 2 dep by dates set\r\n\r\n1. module x has a `removed_at_date: 2020-06-01`\r\n2. module y has a `removed_at_date: 2020-08-01`\r\n\r\nIn this scenario we would effectively have to remove the feature at the start of June **and** August to silence the ansible-test sanity checks and in the meantime we either release 2 major bumps in that timeframe or wait the 2 months before doing the next release.\r\n\r\nMaybe the best option here is to have this as a manual check, i.e. it's run before creating the release to ensure that all deprecations that can be removed are removed rather than something done in CI.",
        "createdAt" : "2020-05-26T20:15:50Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      },
      {
        "id" : "88c766a0-003d-4e5c-85f5-fba1f8cff712",
        "parentId" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "authorId" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "body" : "This test is part of the optional tests, i.e. you explicitly have to run `ansible-test sanity` with `--enable-optional-errors` for it to be a (reported) error. So it will only have an impact if people explicitly request this. (This might change in the future to a non-failing warning, but the result will still be the same: this won't make tests fail from a date on until these tests are explicitly requested. This definitely won't happen for 2.10 though.)",
        "createdAt" : "2020-05-26T21:20:59Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "tags" : [
        ]
      },
      {
        "id" : "9e9300a4-ce29-436e-9aa7-8ed2b31c1023",
        "parentId" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "authorId" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "body" : "(Optional errors were introduced in #66920, though not used there yet. This would be the first use of that feature.)",
        "createdAt" : "2020-05-26T21:21:42Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "tags" : [
        ]
      },
      {
        "id" : "fce93b29-8ddd-443c-8c3f-0ee2ccb1131e",
        "parentId" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "Ah that's fantastic, solves this problem quite nicely. Having a quick skim of #66920 it seems like `--enable-optional-errors` is a true/false switch so by setting it you would enable all the optional errors. Is it mean to work in conjuction with the test name like `ansible-test sanity --test ansible-deprecated-date --enable-optional-errors` or is that not possible right now?",
        "createdAt" : "2020-05-26T21:28:04Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      },
      {
        "id" : "8bdbb322-81aa-42a4-9bed-d7d2d5d48277",
        "parentId" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "authorId" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "body" : "`--test` only works with tests like `validate-modules` or `pylint`, not with explicit error codes returned by one of the tests. So you can only enable all of them, or none. @mattclay and me were discussing about that last week, I think the plan is to improve the interface eventually, but not for 2.10. Since it would probably be the only optional error for 2.10 it should be ok for now :)",
        "createdAt" : "2020-05-26T21:32:03Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "tags" : [
        ]
      },
      {
        "id" : "ac0d13b8-1ae9-45b1-9091-1e42e451e619",
        "parentId" : "da7d3aeb-13a1-4d59-a290-8082da4a7550",
        "authorId" : "7c547162-2334-4e33-a627-e146840da9ec",
        "body" : "Fair enough.",
        "createdAt" : "2020-05-26T21:34:21Z",
        "updatedAt" : "2020-05-26T22:29:03Z",
        "lastEditedBy" : "7c547162-2334-4e33-a627-e146840da9ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "2f19ea507906a4f5985dfb13d2fda90452e2f49b",
    "line" : 133,
    "diffHunk" : "@@ -1,1 +187,191 @@                    try:\n                        if parse_isodate(date) < datetime.date.today():\n                            self.add_message('ansible-deprecated-date', node=node, args=(date,))\n                    except ValueError:\n                        self.add_message('ansible-invalid-deprecated-date', node=node, args=(date,))"
  },
  {
    "id" : "37e1f2dd-4869-44e7-8269-7bec8d744aa7",
    "prId" : 68177,
    "prUrl" : "https://github.com/ansible/ansible/pull/68177#pullrequestreview-418873371",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f86e2bcf-25d2-4e4b-b267-ef1f7fd723ed",
        "parentId" : null,
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "This logic appears to be redundant. The exception handler below should catch the same cases the regex does and return the same exception.",
        "createdAt" : "2020-05-27T00:02:18Z",
        "updatedAt" : "2020-05-27T00:02:19Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "013e82f4-dfc5-4067-8c23-e339b86e3923",
        "parentId" : "f86e2bcf-25d2-4e4b-b267-ef1f7fd723ed",
        "authorId" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "body" : "The code below also accepts `2020-1-1`, which is not ISO 8601. It does catch invalid dates such as `2019-02-29` though, which this regex won't catch.",
        "createdAt" : "2020-05-27T05:48:19Z",
        "updatedAt" : "2020-05-27T05:48:20Z",
        "lastEditedBy" : "d10c46ef-3d4c-4766-bd09-d27ec4674a84",
        "tags" : [
        ]
      }
    ],
    "commit" : "2f19ea507906a4f5985dfb13d2fda90452e2f49b",
    "line" : 66,
    "diffHunk" : "@@ -1,1 +93,97 @@    # we have to do things manually.\n    if not re.match('^[0-9]{4}-[0-9]{2}-[0-9]{2}$', value):\n        raise ValueError(msg)\n    try:\n        return datetime.datetime.strptime(value, '%Y-%m-%d').date()"
  }
]