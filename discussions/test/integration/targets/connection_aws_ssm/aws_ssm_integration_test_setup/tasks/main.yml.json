[
  {
    "id" : "991d5a0a-9cb8-4573-9be0-14dcbc14b69f",
    "prId" : 49652,
    "prUrl" : "https://github.com/ansible/ansible/pull/49652#pullrequestreview-234564144",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "94336975-1038-43f7-a7b7-da7b63225892",
        "parentId" : null,
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "Is there a way for the tests to work with more limited access than what is provided by this policy?",
        "createdAt" : "2019-03-21T18:41:28Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "f338d682-2128-4878-a5e9-2723a70027e2",
        "parentId" : "94336975-1038-43f7-a7b7-da7b63225892",
        "authorId" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "body" : "Would this be restrictive enough?\r\n```json\r\n{\r\n    \"Version\": \"2012-10-17\",\r\n    \"Statement\": [\r\n        {\r\n            \"Effect\": \"Allow\",\r\n            \"Action\": [\r\n                \"ssm:DescribeAssociation\",\r\n                \"ssm:GetDeployablePatchSnapshotForInstance\",\r\n                \"ssm:GetDocument\",\r\n                \"ssm:DescribeDocument\",\r\n                \"ssm:GetManifest\",\r\n                \"ssm:GetParameters\",\r\n                \"ssm:ListAssociations\",\r\n                \"ssm:ListInstanceAssociations\",\r\n                \"ssm:PutInventory\",\r\n                \"ssm:PutComplianceItems\",\r\n                \"ssm:PutConfigurePackageResult\",\r\n                \"ssm:UpdateAssociationStatus\",\r\n                \"ssm:UpdateInstanceAssociationStatus\",\r\n                \"ssm:UpdateInstanceInformation\"\r\n            ],\r\n            \"Resource\": \"*\"\r\n        },\r\n        {\r\n            \"Effect\": \"Allow\",\r\n            \"Action\": [\r\n                \"ssmmessages:CreateControlChannel\",\r\n                \"ssmmessages:CreateDataChannel\",\r\n                \"ssmmessages:OpenControlChannel\",\r\n                \"ssmmessages:OpenDataChannel\"\r\n            ],\r\n            \"Resource\": \"*\"\r\n        },\r\n        {\r\n            \"Effect\": \"Allow\",\r\n            \"Action\": [\r\n                \"ec2messages:AcknowledgeMessage\",\r\n                \"ec2messages:DeleteMessage\",\r\n                \"ec2messages:FailMessage\",\r\n                \"ec2messages:GetEndpoint\",\r\n                \"ec2messages:GetMessages\",\r\n                \"ec2messages:SendReply\"\r\n            ],\r\n            \"Resource\": \"*\"\r\n        },\r\n        {\r\n            \"Effect\": \"Allow\",\r\n            \"Action\": [\r\n                \"ec2:DescribeInstanceStatus\"\r\n            ],\r\n            \"Resource\": \"*\"\r\n        }\r\n    ]\r\n}\r\n```",
        "createdAt" : "2019-03-21T22:09:54Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "tags" : [
        ]
      },
      {
        "id" : "80b524b9-a95a-4f97-896c-a05a40e7ae71",
        "parentId" : "94336975-1038-43f7-a7b7-da7b63225892",
        "authorId" : "fe0f950e-9d07-48fa-88fc-e412b594af2c",
        "body" : "Thanks for pulling the policy permissions. The permissions here are the minimals ones for the instance thats being managed to communicate with the ssm service. Their effectively locked down, since the instance is being managed by the service, not that the instance is managing the service. From a cleanup perspective with the CI terminator, the only associated resource that remains visible within the console describes is the instance within the ssm service as a managed instance which is automatically garbage collected as soon as the service detects the instance is deleted.",
        "createdAt" : "2019-05-07T14:47:23Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "fe0f950e-9d07-48fa-88fc-e412b594af2c",
        "tags" : [
        ]
      }
    ],
    "commit" : "d46de147f9df0030f3bdc882194645343b037b78",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +62,66 @@        create_instance_profile: yes\n        managed_policy:\n        - AmazonEC2RoleforSSM\n        <<: *aws_connection_info\n      register: role_output"
  },
  {
    "id" : "c5d649b3-3b45-4d3b-9bd6-8acf09754430",
    "prId" : 49652,
    "prUrl" : "https://github.com/ansible/ansible/pull/49652#pullrequestreview-341182721",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f0934cbc-2b20-455e-a13a-b233679545c5",
        "parentId" : null,
        "authorId" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "body" : "If none of the expected distributions are matched this should probably end early below this task rather than trying to proceed without the session manager plugin.",
        "createdAt" : "2020-01-09T22:34:48Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "tags" : [
        ]
      },
      {
        "id" : "5544c33a-e336-4e27-ae4e-f5946d68ce41",
        "parentId" : "f0934cbc-2b20-455e-a13a-b233679545c5",
        "authorId" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "body" : "A check for this was added:\r\nhttps://github.com/ansible/ansible/blob/c84d89a2cf3f1bdb67dc6cbb7c511348f366ce03/test/integration/targets/connection_aws_ssm/aws_ssm_integration_test_setup/tasks/main.yml#L42-L47",
        "createdAt" : "2020-01-10T14:07:39Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "tags" : [
        ]
      }
    ],
    "commit" : "d46de147f9df0030f3bdc882194645343b037b78",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +37,41 @@    - name: Install Session Manager Plugin for RedHat/Amazon\n      include_tasks: redhat.yml\n      when: ansible_distribution == \"CentOS\" or ansible_distribution == \"RedHat\" or ansible_distribution == \"Amazon\"\n      register: install_plugin_redhat\n"
  },
  {
    "id" : "4ea8eb0d-548b-4471-942e-fd299c1c8449",
    "prId" : 49652,
    "prUrl" : "https://github.com/ansible/ansible/pull/49652#pullrequestreview-341183328",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3f177e8d-6642-4bd4-87f9-244cf0f12280",
        "parentId" : null,
        "authorId" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "body" : "Typically Ansible tests install things from pip in a virtual environment so the changes can be cleaned up at the end of the test. It also allows non-privileged users to run the tests (since just installing with pip install <package> may fail, indicating that the --user flag needs to be used). This is fine as it is, but the `needs/root` alias should be added.",
        "createdAt" : "2020-01-09T23:03:46Z",
        "updatedAt" : "2020-01-10T14:08:21Z",
        "lastEditedBy" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "tags" : [
        ]
      },
      {
        "id" : "66abde35-9983-4a07-92be-50aab5bf1664",
        "parentId" : "3f177e8d-6642-4bd4-87f9-244cf0f12280",
        "authorId" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "body" : "`needs/root` was added:\r\nhttps://github.com/ansible/ansible/blob/c84d89a2cf3f1bdb67dc6cbb7c511348f366ce03/test/integration/targets/connection_aws_ssm/aliases#L5",
        "createdAt" : "2020-01-10T14:08:42Z",
        "updatedAt" : "2020-01-10T14:08:43Z",
        "lastEditedBy" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "tags" : [
        ]
      }
    ],
    "commit" : "d46de147f9df0030f3bdc882194645343b037b78",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +47,51 @@        - install_plugin_redhat is skipped\n\n    - name: Install Boto3\n      pip:\n        name: boto3"
  }
]