[
  {
    "id" : "7bbacf21-8357-47db-970d-745364109948",
    "prId" : 23382,
    "prUrl" : "https://github.com/ansible/ansible/pull/23382#pullrequestreview-293842008",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d340526c-96e5-426e-9073-1c3f0318c989",
        "parentId" : null,
        "authorId" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "body" : "It'd be good to add some assertions here, additionally you can cross-check that the user_id returned from iam_user matches the user_id returned by iam_user_info (just in case the search was doing something screwy)",
        "createdAt" : "2019-09-25T07:24:12Z",
        "updatedAt" : "2019-09-26T16:06:33Z",
        "lastEditedBy" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "tags" : [
        ]
      },
      {
        "id" : "b77d44d4-c30d-4547-848b-a09dcb4bbe62",
        "parentId" : "d340526c-96e5-426e-9073-1c3f0318c989",
        "authorId" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "body" : "https://github.com/ansible/ansible/pull/23382/commits/518e1f4cb5c43ce481747a143ebd103d01796cec has updates so the values returned can be validated against the user created directly.",
        "createdAt" : "2019-09-26T16:13:20Z",
        "updatedAt" : "2019-09-26T16:13:20Z",
        "lastEditedBy" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "tags" : [
        ]
      }
    ],
    "commit" : "518e1f4cb5c43ce481747a143ebd103d01796cec",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +52,56 @@        - '\"path\" in iam_user_info.msg'\n\n  - name: ensure ansible user exists\n    iam_user:\n      name: '{{ test_user }}'"
  },
  {
    "id" : "b99b6ce5-9883-4eb1-8e33-26d43e73ecb2",
    "prId" : 23382,
    "prUrl" : "https://github.com/ansible/ansible/pull/23382#pullrequestreview-293330185",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "141f5efd-f170-44a0-a824-da93f3d186cd",
        "parentId" : null,
        "authorId" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "body" : "Might be good to add some additional tests adding a second user and making sure that\r\n\r\n1. it doesn't show up when not added to the group\r\n2. it does show up when added to the group\r\n3. iam_user_info behaves properly when returning multiple values\r\n\r\n(you'd be surprised at some of the dumb bugs I've seen over the years)",
        "createdAt" : "2019-09-25T07:29:02Z",
        "updatedAt" : "2019-09-26T16:06:33Z",
        "lastEditedBy" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "tags" : [
        ]
      },
      {
        "id" : "7696e01a-390f-4dbf-815a-9f9f5092e4f4",
        "parentId" : "141f5efd-f170-44a0-a824-da93f3d186cd",
        "authorId" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "body" : "https://github.com/ansible/ansible/pull/23382/commits/9e3eda56d319ccd6dcbbc1d7b513405cd1301e10 adds some test cases.",
        "createdAt" : "2019-09-25T20:03:44Z",
        "updatedAt" : "2019-09-26T16:06:33Z",
        "lastEditedBy" : "fef17745-9ee3-4210-b65b-10fa07b5692e",
        "tags" : [
        ]
      }
    ],
    "commit" : "518e1f4cb5c43ce481747a143ebd103d01796cec",
    "line" : 115,
    "diffHunk" : "@@ -1,1 +113,117 @@    register: iam_group\n\n  - name: get info on IAM user(s) in group\n    iam_user_info:\n      group: '{{ test_group }}'"
  },
  {
    "id" : "dcab7c50-9569-487e-a199-443bf9af92bd",
    "prId" : 23382,
    "prUrl" : "https://github.com/ansible/ansible/pull/23382#pullrequestreview-294171646",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cce09717-e52d-466e-a1d1-16ad4719691a",
        "parentId" : null,
        "authorId" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "body" : "Since these are also tests for iam_user we should at least run a basic test here:\r\n\r\n```suggestion\r\n      that:\r\n        - 'iam_user is changed'\r\n```\r\n\r\nSince your PR isn't for iam_user I don't think it's worth holding it up on thorough testing of iam_user, especially with an iam_user boto3 PR in flight.",
        "createdAt" : "2019-09-27T08:09:47Z",
        "updatedAt" : "2019-09-27T08:09:49Z",
        "lastEditedBy" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "tags" : [
        ]
      }
    ],
    "commit" : "518e1f4cb5c43ce481747a143ebd103d01796cec",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +62,66 @@        test_iam_user: '{{ iam_user.iam_user.user }}'\n  - assert:\n      that:\n        - 'test_iam_user.arn.startswith(\"arn:aws:iam\")'\n        - 'test_iam_user.arn.endswith(\"user/\" + test_user )'"
  },
  {
    "id" : "f0a38127-150f-4d99-bdbb-c3a2b18cd297",
    "prId" : 63768,
    "prUrl" : "https://github.com/ansible/ansible/pull/63768#pullrequestreview-308877752",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bb58822c-65b4-4522-a3f4-89710d01b499",
        "parentId" : null,
        "authorId" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "body" : "Because removing users with policies has been buggy, we should probably remove the managed policies before removing the user, otherwise regressions / testing the old buggy version will leave things behind",
        "createdAt" : "2019-10-25T12:38:48Z",
        "updatedAt" : "2019-10-29T23:43:40Z",
        "lastEditedBy" : "7243ee41-f7f6-470f-8b39-aec91451b808",
        "tags" : [
        ]
      },
      {
        "id" : "a528857d-7a65-4aad-9320-3c07c89e638d",
        "parentId" : "bb58822c-65b4-4522-a3f4-89710d01b499",
        "authorId" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "body" : "This is an `iam_group` task, is that where you intended to comment? The iam_user module should be fixed for removing users with policies by f0cadb9843dc2103e7f223052812eed993257653 and we definitely want tests for any of those new code paths possible. And it's better to have thorough tests and make the terminator work a little bit and know something is wrong if there's a bug rather than structuring our tests to cooperate with buggy code.\r\n\r\nOh - with @jillr's comment below I see what you were saying @tremble (I'm sorry for not getting it). If there was a standalone module that would make sense since this is in the `always`. I think this should be okay though. When it's enabled for CI (from looking briefly, this test suite looks like it can have a restrictive enough policy to safely run in CI) we'll definitely want to make sure the IamUser terminator class will also remove attached policies etc before trying to delete the user.",
        "createdAt" : "2019-10-29T22:06:12Z",
        "updatedAt" : "2019-10-29T23:43:40Z",
        "lastEditedBy" : "6b7e4265-ae86-4269-9bd7-f8ffa9085df6",
        "tags" : [
        ]
      },
      {
        "id" : "9ed08038-bd3b-418f-989e-bb4b2116a814",
        "parentId" : "bb58822c-65b4-4522-a3f4-89710d01b499",
        "authorId" : "87bf94e6-6a9f-420a-b644-aac039f6409f",
        "body" : "Additionally, afaict we don't actually have any module that can detach a managed policy as a stand-alone task.  I'd have to do:\r\n```\r\niam_user:\r\n  name: '{{ item }}'\r\n  state: present\r\n  purge_policy: yes\r\nwith_items: \"{{ test_users }}\"\r\n```\r\nIf the user removal test currently at ln423 has not failed, this is going to re-create the user.",
        "createdAt" : "2019-10-29T22:41:47Z",
        "updatedAt" : "2019-10-29T23:43:40Z",
        "lastEditedBy" : "87bf94e6-6a9f-420a-b644-aac039f6409f",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a7ced94166157f4c525f3c6661951cd59afbde3",
    "line" : 302,
    "diffHunk" : "@@ -1,1 +472,476 @@      state: absent\n    ignore_errors: yes\n\n  - name: remove ansible users\n    iam_user:"
  }
]