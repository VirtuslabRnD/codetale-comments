[
  {
    "id" : "702105ee-f929-4be6-a7bd-36d30dca4e89",
    "prId" : 59126,
    "prUrl" : "https://github.com/ansible/ansible/pull/59126#pullrequestreview-266708630",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3714b956-79fd-498a-bdb2-930efd9b7f98",
        "parentId" : null,
        "authorId" : "1c9ec37a-2f71-44e7-8b02-5bff03b1111d",
        "body" : "confused... you got a `before` snapshot of the config in the setup play, then `deleted` the config above.\r\nShouldn't the telemetry config now be removed?",
        "createdAt" : "2019-07-22T14:12:28Z",
        "updatedAt" : "2019-08-01T16:41:39Z",
        "lastEditedBy" : "1c9ec37a-2f71-44e7-8b02-5bff03b1111d",
        "tags" : [
        ]
      },
      {
        "id" : "0efdd2e9-3cb2-4304-93c0-ec33990dbc01",
        "parentId" : "3714b956-79fd-498a-bdb2-930efd9b7f98",
        "authorId" : "590c0c9f-420c-41b0-8f5d-dc6889d70e93",
        "body" : "Here is the order of events.\r\n\r\n1) The setup step applies the telemetry config.\r\n2) We gather the telemetry facts (gets saved into `ansible_facts.network_resoures.telemetry`)\r\n3) We delete the telemetry config and register the result into `result` which stores both the `before` delete and `after` delete picture.\r\n4) Now, the first assert compares facts gathered before delete to the picture in result before the delete.\r\n5) The second assert compares facts gathered after delete to the picture in result after the delete.",
        "createdAt" : "2019-07-25T19:39:09Z",
        "updatedAt" : "2019-08-01T16:41:39Z",
        "lastEditedBy" : "590c0c9f-420c-41b0-8f5d-dc6889d70e93",
        "tags" : [
        ]
      },
      {
        "id" : "8675afb8-15a2-40e7-954b-616fce24c218",
        "parentId" : "3714b956-79fd-498a-bdb2-930efd9b7f98",
        "authorId" : "590c0c9f-420c-41b0-8f5d-dc6889d70e93",
        "body" : "For reference, here is the entire structure that the module stores for the `Telemetry - deleted` step.  Note the `before` and `after` sections\r\n\r\n```python\r\nchanged: [n9k.example.com] => {\r\n    \"after\": {}, \r\n    \"before\": {\r\n        \"certificate\": {\r\n            \"hostname\": \"localhost\", \r\n            \"key\": \"/bootflash/server.key\"\r\n        }, \r\n        \"compression\": \"gzip\", \r\n        \"destination_groups\": [\r\n            {\r\n                \"destination\": {\r\n                    \"encoding\": \"gpb\", \r\n                    \"ip\": \"192.168.0.1\", \r\n                    \"port\": \"50001\", \r\n                    \"protocol\": \"grpc\"\r\n                }, \r\n                \"id\": \"2\"\r\n            }, \r\n            {\r\n                \"destination\": {\r\n                    \"encoding\": \"gpb\", \r\n                    \"ip\": \"192.168.0.2\", \r\n                    \"port\": \"60001\", \r\n                    \"protocol\": \"grpc\"\r\n                }, \r\n                \"id\": \"2\"\r\n            }, \r\n            {\r\n                \"destination\": {\r\n                    \"encoding\": \"gpb\", \r\n                    \"ip\": \"192.168.0.1\", \r\n                    \"port\": \"50001\", \r\n                    \"protocol\": \"grpc\"\r\n                }, \r\n                \"id\": \"10\"\r\n            }, \r\n            {\r\n                \"destination\": {\r\n                    \"encoding\": \"gpb\", \r\n                    \"ip\": \"192.168.0.2\", \r\n                    \"port\": \"60001\", \r\n                    \"protocol\": \"grpc\"\r\n                }, \r\n                \"id\": \"10\"\r\n            }\r\n        ], \r\n        \"sensor_groups\": [\r\n            {\r\n                \"data_source\": \"NX-API\", \r\n                \"id\": \"2\"\r\n            }, \r\n            {\r\n                \"id\": \"2\", \r\n                \"path\": {\r\n                    \"depth\": \"unbounded\", \r\n                    \"filter_condition\": \"foo\", \r\n                    \"name\": \"sys/bgp/inst\", \r\n                    \"query_condition\": \"foo\"\r\n                }\r\n            }, \r\n            {\r\n                \"data_source\": \"NX-API\", \r\n                \"id\": \"8\"\r\n            }, \r\n            {\r\n                \"id\": \"8\", \r\n                \"path\": {\r\n                    \"depth\": \"0\", \r\n                    \"filter_condition\": \"foo\", \r\n                    \"name\": \"sys/bgp\", \r\n                    \"query_condition\": \"foo\"\r\n                }\r\n            }, \r\n            {\r\n                \"data_source\": \"DME\", \r\n                \"id\": \"55\"\r\n            }, \r\n            {\r\n                \"id\": \"55\", \r\n                \"path\": {\r\n                    \"depth\": \"0\", \r\n                    \"filter_condition\": \"foo\", \r\n                    \"name\": \"sys/bgp/inst/dom-default/peer-[10.10.10.11]/ent-[10.10.10.11]\", \r\n                    \"query_condition\": \"foo\"\r\n                }\r\n            }, \r\n            {\r\n                \"id\": \"55\", \r\n                \"path\": {\r\n                    \"depth\": \"0\", \r\n                    \"filter_condition\": \"or(eq(ethpmPhysIf.operSt,\\\"down\\\"),eq(ethpmPhysIf.operSt,\\\"up\\\"))\", \r\n                    \"name\": \"sys/ospf\", \r\n                    \"query_condition\": \"foo\"\r\n                }\r\n            }\r\n        ], \r\n        \"source_interface\": \"loopback55\", \r\n        \"subscriptions\": [\r\n            {\r\n                \"destination_group\": 2, \r\n                \"id\": \"44\"\r\n            }, \r\n            {\r\n                \"destination_group\": 10, \r\n                \"id\": \"44\"\r\n            }, \r\n            {\r\n                \"id\": \"44\", \r\n                \"sensor_group\": {\r\n                    \"id\": \"2\", \r\n                    \"sample_interval\": \"2000\"\r\n                }\r\n            }, \r\n            {\r\n                \"id\": \"44\", \r\n                \"sensor_group\": {\r\n                    \"id\": \"8\", \r\n                    \"sample_interval\": \"2000\"\r\n                }\r\n            }, \r\n            {\r\n                \"destination_group\": 10, \r\n                \"id\": \"55\"\r\n            }, \r\n            {\r\n                \"id\": \"55\", \r\n                \"sensor_group\": {\r\n                    \"id\": \"55\", \r\n                    \"sample_interval\": \"2000\"\r\n                }\r\n            }\r\n        ], \r\n        \"vrf\": \"management\"\r\n    }, \r\n    \"changed\": true, \r\n    \"commands\": [\r\n        \"telemetry\", \r\n        \"no certificate /bootflash/server.key localhost\", \r\n        \"destination-profile\", \r\n        \"no use-compression gzip\", \r\n        \"no source-interface loopback55\", \r\n        \"no use-vrf management\", \r\n        \"no subscription 44\", \r\n        \"no subscription 55\", \r\n        \"no destination-group 2\", \r\n        \"no destination-group 10\", \r\n        \"no sensor-group 8\", \r\n        \"no sensor-group 2\", \r\n        \"no sensor-group 55\"\r\n    ], \r\n    \"invocation\": {\r\n        \"module_args\": {\r\n            \"config\": {\r\n                \"subscriptions\": [\r\n                    {\r\n                        \"destination_group\": 10, \r\n                        \"id\": 55, \r\n                        \"sensor_group\": {\r\n                            \"id\": \"55\", \r\n                            \"sample_interval\": \"2000\"\r\n                        }\r\n                    }\r\n                ]\r\n            }, \r\n            \"state\": \"deleted\"\r\n        }\r\n    }\r\n}\r\n```",
        "createdAt" : "2019-07-25T19:42:09Z",
        "updatedAt" : "2019-08-01T16:41:39Z",
        "lastEditedBy" : "590c0c9f-420c-41b0-8f5d-dc6889d70e93",
        "tags" : [
        ]
      }
    ],
    "commit" : "0ffd6a793c2a6717c5a353bbfddfd9f03e630912",
    "line" : 70,
    "diffHunk" : "@@ -1,1 +68,72 @@  - assert:\n      that:\n        - \"(ansible_facts.network_resources.telemetry|dict2items)|symmetric_difference(result.before|dict2items)|length == 0\"\n\n  - name: Gather Telemetry Facts After Changes"
  }
]