[
  {
    "id" : "2d5e6350-8026-45a5-88f6-c0f46c80c76e",
    "prId" : 49197,
    "prUrl" : "https://github.com/ansible/ansible/pull/49197#pullrequestreview-179573022",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "parentId" : null,
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "Instead of ignoring errors here, I'd do a feature check for `ssl.create_default_context`. That will solve the issue of trying to use TLS when it's not available. It will also avoid accidentally skipping the TLS tests if the pip install fails due to network issues.",
        "createdAt" : "2018-11-28T20:30:32Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "37bb2425-1818-469b-a90e-f54c2e6f6641",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "body" : "Well, if the pip install fails, we can't do TLS testing anyway. So it's still the right thing to do.",
        "createdAt" : "2018-11-28T20:34:12Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "tags" : [
        ]
      },
      {
        "id" : "cf07d1a3-a11b-4261-b9cb-7bb34e49a63c",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "That's true of dependencies for any test. Unless we have no other way to detect conditions which would prevent the installation, we shouldn't ignore the errors. Detect the condition(s) which we care about and skip the relevant portions of the test.\r\n\r\nIn this case relying on the pip install failure doesn't give us what we need (detecting lack of support for `create_default_context`). It also will cause the SSL tests to be skipped due to network failures, which we shouldn't be doing.",
        "createdAt" : "2018-11-28T20:40:37Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "39d2710d-d5fb-4238-b404-0706ff2b902a",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "body" : "The pip installation could fail because smtpd-tls is not supporting python 2.6, which is why I have that test and which is why I was ignoring the error. But even if it fails because of network-issues and it continues without TLS tests it is better than what we had before.\r\n\r\nIf you would like to improve it beyond this, feel free to do so.",
        "createdAt" : "2018-11-28T20:47:16Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "tags" : [
        ]
      },
      {
        "id" : "4f1b3830-85a5-44cc-b04c-7e90cdf13143",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "The pip install fails on Python 2.6 because it isn't supported. It succeeds on Python 2.7.6, which is also not supported. We need some way to skip testing with TLS in that case.\r\n\r\nMake the pip install conditional on the availability of `ssl.create_default_context` and the tests will use TLS when it's available and skip the pip install when it isn't.\r\n\r\nThat will also eliminate the need for `ignore_errors: yes` on the install.",
        "createdAt" : "2018-11-28T21:03:54Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      },
      {
        "id" : "775f2aed-ec2a-4664-ade4-74a0930e530a",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "body" : "I already spend too much work on this that should have gone elsewhere. So I fixed it quickly, feel free to improve it further. This is already a clear improvement over what we had before.",
        "createdAt" : "2018-11-28T23:29:41Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "7268595c-1eb4-4b5f-9277-90f183130a4b",
        "tags" : [
        ]
      },
      {
        "id" : "ead35f82-e040-4bdc-96e9-d75fbf84a7c6",
        "parentId" : "bf27dcdc-e96d-457a-8c8c-27ed1454a8e9",
        "authorId" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "body" : "Yes, having tests for this is a huge improvement. Thanks for putting this together.\r\n\r\nIt's a common theme putting together new tests. They look simple at first and then the corner cases take up 90% of the time required to finish them.",
        "createdAt" : "2018-11-28T23:50:02Z",
        "updatedAt" : "2018-12-07T14:47:22Z",
        "lastEditedBy" : "380aef6a-3fbb-41ad-819b-bada96e05807",
        "tags" : [
        ]
      }
    ],
    "commit" : "9d9e55d1b09af44f33d033d3539e9c9c593bdfcf",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +7,11 @@    state: present\n  ignore_errors: yes\n  register: smtpd_tls\n\n- name: Install test smtpserver"
  }
]