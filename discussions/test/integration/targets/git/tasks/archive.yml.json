[
  {
    "id" : "202d622d-e2ac-4169-9987-02eebdac9da5",
    "prId" : 66067,
    "prUrl" : "https://github.com/ansible/ansible/pull/66067#pullrequestreview-346002454",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b2a5d14f-682f-481e-bf16-47939e03d27f",
        "parentId" : null,
        "authorId" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "body" : "We need to add another test to verify the content of the archive. This will catch the current bug that adds a prefix of `None` if `archive` is set but not `archive_prefix`.\r\n```suggestion\r\n\r\n- name: ARCHIVE | Inspect archive file\r\n  command:\r\n    cmd: \"{{ git_list_commands[item] }} {{ checkout_dir }}/test_role.{{ item }}\"\r\n    warn: no\r\n  register: archive_content\r\n  with_items: \"{{ git_archive_extensions[ansible_os_family ~ ansible_distribution_major_version | default('default') ] | default(git_archive_extensions.default) }}\"\r\n\r\n- name: ARCHIVE | Ensure archive content is correct\r\n  assert:\r\n    that:\r\n      - item.stdout_lines | sort | first == 'defaults/'\r\n  with_items: \"{{ archive_content.results }}\"\r\n```\r\n\r\nThis is the dict to lookup up the correct list command, which can be added to `vars/main.yml`\r\n```yaml\r\ngit_list_commands:\r\n  tar.gz: tar -tf\r\n  tar: tar -tf\r\n  tgz: tar -tf\r\n  zip: unzip -Z1\r\n```",
        "createdAt" : "2020-01-21T17:44:09Z",
        "updatedAt" : "2020-01-23T20:42:35Z",
        "lastEditedBy" : "2f8132dc-12f8-44dc-8b97-1cf4c1616b68",
        "tags" : [
        ]
      }
    ],
    "commit" : "c43211e2f3042c4a487a01fc44a3a0237bad6c86",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +75,79 @@    - \"ansible_os_family == 'RedHat'\"\n    - ansible_distribution_major_version is version('7', '>=')\n\n- name: ARCHIVE | Inspect archive file\n  command:"
  }
]