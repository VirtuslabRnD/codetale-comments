[
  {
    "id" : "ab47bc96-178d-4255-a60b-e1e02f323a8c",
    "prId" : 8777,
    "prUrl" : "https://github.com/apache/airflow/pull/8777#pullrequestreview-423544030",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "56e338c2-2c2b-4df0-86c8-3c935ea03f81",
        "parentId" : null,
        "authorId" : "e3d344f1-67a1-4532-9f7a-4011394a4c7c",
        "body" : "Is this really the best approach (creating the secret in the chart), as it will cause users to store their DB passwords inside their `values.yaml` in plain text. In the `stable/airflow` chart, we allow users to create a secret which just contains the password, and then combine them as the pods start.",
        "createdAt" : "2020-05-26T01:33:58Z",
        "updatedAt" : "2020-06-17T22:24:57Z",
        "lastEditedBy" : "e3d344f1-67a1-4532-9f7a-4011394a4c7c",
        "tags" : [
        ]
      },
      {
        "id" : "4bb4e674-7d7b-40fb-8b61-6a56cd0b9643",
        "parentId" : "56e338c2-2c2b-4df0-86c8-3c935ea03f81",
        "authorId" : "b28ed531-4583-40c6-81ef-a719b768e1d4",
        "body" : "@thesuperzapper good eye. It's not the best, but it's simple. Instead of this, users can also specify a secret name. On line 4 we have `{{- if (and .Values.data.resultBackendConnection (not .Values.data.resultBackendSecretName)) }}`. So this only is used when the individual components are filled out in the values. If a user specifies `.Values.data.resultBackendSecretName`, that will be used instead - looking for a `connection` field I believe. \r\n\r\nThe goal was to be flexible here, so this pattern is also repeated for the normal metadata secret, and in a few other places.\r\n\r\nThis also has support for falling back to a default local postgres per install, if nothing is specified. ",
        "createdAt" : "2020-06-03T13:20:41Z",
        "updatedAt" : "2020-06-17T22:24:57Z",
        "lastEditedBy" : "b28ed531-4583-40c6-81ef-a719b768e1d4",
        "tags" : [
        ]
      }
    ],
    "commit" : "e9f106e57e03ac11ba65bc55d9349beb038b911b",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +34,38 @@type: Opaque\ndata:\n  connection: {{ (printf \"db+postgresql://%s:%s@%s:%s/%s?sslmode=%s\" .Values.data.resultBackendConnection.user .Values.data.resultBackendConnection.pass (ternary (printf \"%s-%s\" .Release.Name \"pgbouncer\") $host .Values.pgbouncer.enabled) ((ternary .Values.ports.pgbouncer .Values.data.resultBackendConnection.port .Values.pgbouncer.enabled) | toString) (ternary (printf \"%s-%s\" .Release.Name \"result-backend\") .Values.data.resultBackendConnection.db .Values.pgbouncer.enabled) .Values.data.resultBackendConnection.sslmode) | b64enc | quote }}\n{{- end }}"
  },
  {
    "id" : "bff0bb59-a880-4257-8277-1f3d444b39b3",
    "prId" : 15616,
    "prUrl" : "https://github.com/apache/airflow/pull/15616#pullrequestreview-649556391",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "18d9c518-6f2e-44f1-bd4d-f9e346309168",
        "parentId" : null,
        "authorId" : "2b57321e-ffa6-49a5-a626-e83c2595de23",
        "body" : "We were deploying this secret more often than we needed. This limits to only celery based executors.",
        "createdAt" : "2021-04-30T19:30:31Z",
        "updatedAt" : "2021-04-30T19:30:31Z",
        "lastEditedBy" : "2b57321e-ffa6-49a5-a626-e83c2595de23",
        "tags" : [
        ]
      }
    ],
    "commit" : "43fbe5b2e5a20a5177b58df9fb9207a999f9c83f",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +20,24 @@#################################\n{{- if not .Values.data.resultBackendSecretName }}\n{{- if or (eq .Values.executor \"CeleryExecutor\") (eq .Values.executor \"CeleryKubernetesExecutor\") }}\n{{- $host := .Values.data.resultBackendConnection.host | default (printf \"%s-%s\" .Release.Name \"postgresql\") }}\n{{- $extras := ternary (printf \"?sslmode=%s\" .Values.data.resultBackendConnection.sslmode) \"\" (eq .Values.data.resultBackendConnection.protocol \"postgresql\") }}"
  }
]