[
  {
    "id" : "4b84c0bb-f8a6-4364-94bd-bb180317b8ed",
    "prId" : 10949,
    "prUrl" : "https://github.com/apache/kafka/pull/10949#pullrequestreview-696664315",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "77a30c2f-fe97-4a68-8361-775acee1eafb",
        "parentId" : null,
        "authorId" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "body" : "It's a little unclear as to how we are removing things from the cache here. If I understand correctly, we stick an empty Optional in the cache to represent removal. And here by _not_ handling the empty optional case, we exclude the broker from the new image. But if that's the case, why do we need the Optional in the first place? Can we directly remove the broker from \"changedBrokers\" when handling UnregisterBrokerRecord?\r\n\r\nThis question applies to some other Delta classes that are using Optional as well",
        "createdAt" : "2021-06-30T20:48:41Z",
        "updatedAt" : "2021-06-30T21:03:09Z",
        "lastEditedBy" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "tags" : [
        ]
      },
      {
        "id" : "4c8e850f-f529-44f8-ab0f-8b1439c3c159",
        "parentId" : "77a30c2f-fe97-4a68-8361-775acee1eafb",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "`changedBrokers` only contains the brokers that have changed. If a broker is absent from this map, it means that nothing has changed versus the image, not that the broker has been removed.",
        "createdAt" : "2021-06-30T22:19:37Z",
        "updatedAt" : "2021-06-30T22:19:38Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "1ef3da1fee9402bd6533faf6d1f0b284c60c29b1",
    "line" : 116,
    "diffHunk" : "@@ -1,1 +114,118 @@            } else if (change.isPresent()) {\n                newBrokers.put(nodeId, change.get());\n            }\n        }\n        for (Entry<Integer, Optional<BrokerRegistration>> entry : changedBrokers.entrySet()) {"
  },
  {
    "id" : "6c0c3797-ec4d-45a6-aa86-2c03f79fd733",
    "prId" : 10949,
    "prUrl" : "https://github.com/apache/kafka/pull/10949#pullrequestreview-696689857",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a440c4f-27b1-4739-b9dd-3126a0e52d59",
        "parentId" : null,
        "authorId" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "body" : "It would be helpful to understand which validations we are free to skip. For example, `BrokerRegistrationChangeRecord` also indicates an epoch. Do we need to check that?",
        "createdAt" : "2021-06-30T21:46:20Z",
        "updatedAt" : "2021-06-30T22:11:13Z",
        "lastEditedBy" : "5c21df64-97d8-46ab-9722-a7e9ba1d7c49",
        "tags" : [
        ]
      },
      {
        "id" : "8a36faa6-3c2b-4212-bb61-5e88c0ba27e0",
        "parentId" : "0a440c4f-27b1-4739-b9dd-3126a0e52d59",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "Let's validate the epoch for each",
        "createdAt" : "2021-06-30T23:15:51Z",
        "updatedAt" : "2021-06-30T23:15:51Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "1ef3da1fee9402bd6533faf6d1f0b284c60c29b1",
    "line" : 100,
    "diffHunk" : "@@ -1,1 +98,102 @@        BrokerRegistration broker =\n            getBrokerOrThrow(record.brokerId(), record.brokerEpoch(), \"change\");\n        if (record.fenced() < 0) {\n            changedBrokers.put(record.brokerId(), Optional.of(broker.cloneWithFencing(false)));\n        } else if (record.fenced() > 0) {"
  }
]