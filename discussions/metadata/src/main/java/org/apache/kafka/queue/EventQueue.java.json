[
  {
    "id" : "900cef8a-99d6-4a87-b4a3-089cbe07d4e6",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582842536",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ecd6ff58-40c7-450a-8daf-3a98180725a2",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Perhaps we could document the ordering guarantee with the deferred event compared with other types of events?",
        "createdAt" : "2021-02-03T18:44:36Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "ab7896ba-79fc-4fab-a8af-75353b9d97cb",
        "parentId" : "ecd6ff58-40c7-450a-8daf-3a98180725a2",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "I added a comment saying that \"Once the deadline has arrived, the event will be prepended to the queue\"",
        "createdAt" : "2021-02-03T22:01:29Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 167,
    "diffHunk" : "@@ -1,1 +165,169 @@     * @param event                 The event to schedule.\n     */\n    default void scheduleDeferred(String tag,\n                                  Function<OptionalLong, OptionalLong> deadlineNsCalculator,\n                                  Event event) {"
  },
  {
    "id" : "5e91bb3f-ce9e-4728-a918-30c229609119",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582874554",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "10efa9ff-a03a-4857-8d74-4a652467ed6f",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Which future? Did you mean `Event`. I assume that `deadlineNs` is the deadline for scheduling/executing the `run` method. The `run` method can take longer than `deadlineNs`.",
        "createdAt" : "2021-02-03T20:12:48Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "d2136dcd-3574-46ab-ae47-341494f19dfb",
        "parentId" : "10efa9ff-a03a-4857-8d74-4a652467ed6f",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "Good question.  I clarified this comment a bit.",
        "createdAt" : "2021-02-03T22:49:59Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 145,
    "diffHunk" : "@@ -1,1 +143,147 @@     *                          deadline, handleException is called with a\n     *                          @{org.apache.kafka.common.errors.TimeoutException},\n     *                          and the event is cancelled.\n     * @param event             The event to append.\n     */"
  },
  {
    "id" : "49dcdfc7-a657-430e-809c-f0d59b414752",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582879428",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ad05ccee-24f9-4ab9-9f45-a1b04d40f917",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "The headline description says \"Schedule an event to be run at a specific time\" yet this param's description seem to indicate a different behavior.",
        "createdAt" : "2021-02-03T20:15:54Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "b6704f56-50a3-4c95-85e4-31160e5a36b8",
        "parentId" : "ad05ccee-24f9-4ab9-9f45-a1b04d40f917",
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Looking at the implementation, it looks like this Long is an absolute time. Is there a reason why absolute times are used instead of relative times like delay and timeout?",
        "createdAt" : "2021-02-03T21:57:19Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "a35bc376-9c53-4c50-8163-6cb3dfcd0ece",
        "parentId" : "ad05ccee-24f9-4ab9-9f45-a1b04d40f917",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "We need to support absolute times in order to support things like `EarliestDeadlineFunction`, and mixing relative and absolute times is kind of confusing.",
        "createdAt" : "2021-02-03T22:58:17Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 161,
    "diffHunk" : "@@ -1,1 +159,163 @@     *                              deadline for the event with this tag (or empty if the\n     *                              event has no tag, or if there is none such), and\n     *                              produces the deadline to use for this event.\n     *                              Once the deadline has arrived, the event will be\n     *                              run.  Events whose deadlines are only a few nanoseconds"
  },
  {
    "id" : "ccf9ee1e-af3f-4a38-9386-f8b4f6b4a3f8",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582880570",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "838daf93-3760-47b2-bb52-ebf702a7eaf5",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "The headline description says \"Enqueue an event to be run in FIFO order.\" but looking the param description it doesn't looking like it is FIFO order since it support prepend, append and deferred.\r\n\r\nWhat do you mean by DEFEREED? How is the delay specified? I see the param `deadlineNsCalculator` but it looks like this describe the maximum amount of time this event is allowed to stay in the queue before it is cancelled by the queue.",
        "createdAt" : "2021-02-03T20:22:57Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "d0a5ee4b-65de-4f6d-84b6-657b30c8d657",
        "parentId" : "838daf93-3760-47b2-bb52-ebf702a7eaf5",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "I will change the description to reflect the fact that this function supports PREPEND and DEFERRED, so it's not always \"FIFO order\".\r\n\r\nHow to use deferred events is described in more detail in `scheduleDeferred`",
        "createdAt" : "2021-02-03T23:00:18Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 195,
    "diffHunk" : "@@ -1,1 +193,197 @@     *                              to run.  APPEND means insert the event as the last\n     *                              thing to run.  DEFERRED means insert the event to\n     *                              run after a delay.\n     * @param tag                   If this is non-null, the unique tag to use for\n     *                              this event.  If an event with this tag already"
  },
  {
    "id" : "d4485e9e-465c-41a0-ae9c-d14f67a62799",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582894704",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c2764da3-48ff-4a81-9cad-ddfde9577396",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Let's document these two methods. For example, looking at the implementation it looks like `handleException` needs to handle:\r\n1. Exceptions thrown by `Event::run`\r\n2. Exception passed by the `EventQueue` like `EventQueueClosedException`, `TimeoutException`, anything else?\r\n\r\nAny thoughts on why this design instead of not allowing `run` to throw a checked exception? For example:\r\n```java\r\ninterface Event extends Runnable {\r\n    default void cancel(Throwable e) {}\r\n}\r\n```",
        "createdAt" : "2021-02-03T20:51:24Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "10430759-eec1-4669-93b8-33d960a86f76",
        "parentId" : "c2764da3-48ff-4a81-9cad-ddfde9577396",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "> Let's document these two methods\r\n\r\nSure.  I will add some JavaDoc.\r\n\r\n> Any thoughts on why this design instead of not allowing run to throw a checked exception? For example:\r\n\r\nChecked exceptions are sort of a failed idea.  This would just force you to wrap all the checked exceptions that the event could throw, and unwrap them in handleException.  That would not help the clarity of the controller code.\r\n\r\nAlso, implementing Runnable isn't really useful here because Java 8 lambdas can be used on any single-function interface, not just Runnable.",
        "createdAt" : "2021-02-03T23:27:27Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +44,48 @@         */\n        default void handleException(Throwable e) {}\n    }\n\n    abstract class FailureLoggingEvent implements Event {"
  },
  {
    "id" : "afa10c74-eaec-4b7c-91c6-b587ed7542e5",
    "prId" : 10030,
    "prUrl" : "https://github.com/apache/kafka/pull/10030#pullrequestreview-582898992",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9eee550e-7a9f-4967-86bd-e3c76d3e6fe0",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "It would be interesting to explain this design. I get the impression that we are interesting in rescheduling events that haven't triggered.\r\n\r\nOne way to change the deadline is to specified the previous event that is being rescheduled. E.g.\r\n```java\r\nrescheduleDeferred(Event oldEvent, Function<Long, Long> deadlineNsCalculator, Event newEvent);\r\n```\r\n\r\nThis API allows the deadline to either increase or decrease. Are both cases used by the Controller?",
        "createdAt" : "2021-02-03T22:05:53Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      },
      {
        "id" : "6b8f0c9d-1c01-4fbb-a7ae-bd3bba139754",
        "parentId" : "9eee550e-7a9f-4967-86bd-e3c76d3e6fe0",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "> One way to change the deadline is to specified the previous event that is being rescheduled\r\n\r\nHaving to store the previous event object somewhere would be very annoying.  Since the thread triggering deferred events is often not the controller thread itself, it would require complex locking or volatile objects.  Also then you run into issues like should the equals function be used, or object identity.\r\n\r\nIt's a lot easier to just pass a string (which is immutable).  This also has the nice effect of describing the deferred event.\r\n\r\n> This API allows the deadline to either increase or decrease. Are both cases used by the Controller?\r\n\r\nIn the controller we are mainly interested in making the deadline closer to \"now\" (decreasing it) or cancelling the deferred event.",
        "createdAt" : "2021-02-03T23:36:39Z",
        "updatedAt" : "2021-02-04T22:44:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "809725cd0214ebf9cc400db54750ca56177c15a3",
    "line" : 157,
    "diffHunk" : "@@ -1,1 +155,159 @@     * @param tag                   If this is non-null, the unique tag to use for this\n     *                              event.  If an event with this tag already exists, it\n     *                              will be cancelled.\n     * @param deadlineNsCalculator  A function which takes as an argument the existing\n     *                              deadline for the event with this tag (or empty if the"
  }
]