[
  {
    "id" : "f2100457-d0dd-498b-aed1-ae94b2f3a45d",
    "prId" : 10070,
    "prUrl" : "https://github.com/apache/kafka/pull/10070#pullrequestreview-591715825",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ff5c9f3e-68f8-49d1-9b6c-defd44e1b6eb",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "When a broker is unfenced, some of the partitions without leader could have a new leader now. So, it seems that we need to trigger a leader election here.",
        "createdAt" : "2021-02-12T18:00:36Z",
        "updatedAt" : "2021-02-20T00:12:14Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "97cc186b-2944-441b-bd42-494568e6463b",
        "parentId" : "ff5c9f3e-68f8-49d1-9b6c-defd44e1b6eb",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "Good point. The appropriate place to handle this will be in the broker heartbeat handling code, since that is where the active controller unfences brokers.",
        "createdAt" : "2021-02-16T23:36:58Z",
        "updatedAt" : "2021-02-20T00:12:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "7bcdd2ec50b7fbacffcb3c5810a37ae8161a64c3",
    "line" : 295,
    "diffHunk" : "@@ -1,1 +293,297 @@                \"registration with that epoch found\", record.toString()));\n        } else {\n            brokerRegistrations.put(brokerId, registration.cloneWithFencing(false));\n            log.info(\"Unfenced broker: {}\", record);\n        }"
  },
  {
    "id" : "aee52a5e-7db5-498c-8863-1f62290069e8",
    "prId" : 10070,
    "prUrl" : "https://github.com/apache/kafka/pull/10070#pullrequestreview-592597411",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "484d039e-502f-4bdd-843b-e677e1ab2129",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Sometimes, we update the in-memory state after the record is appended to the log. Here, it seems that we do the reverse. Should we make that consistent?",
        "createdAt" : "2021-02-12T21:20:15Z",
        "updatedAt" : "2021-02-20T00:12:14Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      },
      {
        "id" : "72735c9e-3d4d-4605-b06f-40830ee87286",
        "parentId" : "484d039e-502f-4bdd-843b-e677e1ab2129",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "The heartbeat manager is special because it stores soft state which is not in the metadata log (when each broker last heartbeated, for example).",
        "createdAt" : "2021-02-17T20:25:33Z",
        "updatedAt" : "2021-02-20T00:12:14Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "7bcdd2ec50b7fbacffcb3c5810a37ae8161a64c3",
    "line" : 209,
    "diffHunk" : "@@ -1,1 +207,211 @@\n        if (existing == null) {\n            heartbeatManager.touch(brokerId, true, -1);\n        } else {\n            heartbeatManager.touch(brokerId, existing.fenced(), -1);"
  },
  {
    "id" : "a1b0009a-cec9-4077-8318-41f96f99a7d6",
    "prId" : 10070,
    "prUrl" : "https://github.com/apache/kafka/pull/10070#pullrequestreview-593803505",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8ac931ae-6c71-433c-8f23-e94c81d74c3c",
        "parentId" : null,
        "authorId" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "body" : "Could we add some comments to this class?",
        "createdAt" : "2021-02-19T02:10:09Z",
        "updatedAt" : "2021-02-20T00:12:14Z",
        "lastEditedBy" : "442b5138-0781-4001-8ac5-0593f2136d1c",
        "tags" : [
        ]
      }
    ],
    "commit" : "7bcdd2ec50b7fbacffcb3c5810a37ae8161a64c3",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +52,56 @@ * brokers being fenced or unfenced, and broker feature versions.\n */\npublic class ClusterControlManager {\n    class ReadyBrokersFuture {\n        private final CompletableFuture<Void> future;"
  },
  {
    "id" : "b4532ea2-0194-436f-a737-b5021a44d705",
    "prId" : 10867,
    "prUrl" : "https://github.com/apache/kafka/pull/10867#pullrequestreview-684297322",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ec1287a7-707e-4a56-a9e9-ac5d8ad0d428",
        "parentId" : null,
        "authorId" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "body" : "Since we are adding `fenced` to the RegisterBrokerRecord, do we also need to add a `fenced` field to the BrokerRegistrationRequest RPC? Or is it the case that only the controller will set the fenced state of this record",
        "createdAt" : "2021-06-15T17:12:06Z",
        "updatedAt" : "2021-06-15T17:19:11Z",
        "lastEditedBy" : "083f2f03-ca7e-48a1-9781-482564dfdf53",
        "tags" : [
        ]
      },
      {
        "id" : "25f742e6-b72a-4796-8075-b33507991418",
        "parentId" : "ec1287a7-707e-4a56-a9e9-ac5d8ad0d428",
        "authorId" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "body" : "Only the controller decides when brokers can be unfenced.",
        "createdAt" : "2021-06-15T17:26:52Z",
        "updatedAt" : "2021-06-15T17:26:52Z",
        "lastEditedBy" : "514c0afb-8649-4fd9-a6ea-ee9e1b695274",
        "tags" : [
        ]
      }
    ],
    "commit" : "2318cdaf2eb18f8fadf17be7a679e10cd6adc907",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +244,248 @@            record.brokerEpoch(), record.incarnationId(), listeners, features,\n            Optional.ofNullable(record.rack()), record.fenced()));\n        BrokerRegistration prevRegistration = brokerRegistrations.get(brokerId);\n        if (prevRegistration == null) {\n            log.info(\"Registered new broker: {}\", record);"
  },
  {
    "id" : "664bd6d7-c59e-4977-a826-4326dbb82a38",
    "prId" : 11191,
    "prUrl" : "https://github.com/apache/kafka/pull/11191#pullrequestreview-727770661",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ab95f22e-2b75-4dd0-b51c-31e3b9d91c76",
        "parentId" : null,
        "authorId" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "body" : "Looks like this method is only used for tests. How about moving this to `ReplicationControlManagerTest`?",
        "createdAt" : "2021-08-11T17:48:11Z",
        "updatedAt" : "2021-08-12T15:55:20Z",
        "lastEditedBy" : "4a7c311c-0954-4671-a0d2-266cb67437ad",
        "tags" : [
        ]
      }
    ],
    "commit" : "77be415601cbae0c977fe55006aa134b93bb5ee7",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +164,168 @@    }\n\n    Set<Integer> fencedBrokerIds() {\n        return brokerRegistrations.values()\n            .stream()"
  }
]