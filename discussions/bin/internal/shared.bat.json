[
  {
    "id" : "fa61d5c8-f991-4799-9c42-42b63d0248e3",
    "prId" : 64773,
    "prUrl" : "https://github.com/flutter/flutter/pull/64773#pullrequestreview-477928286",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9d2b0207-a68e-4cad-ad33-b1b36805116c",
        "parentId" : null,
        "authorId" : "7ae842f7-1029-4528-8bf6-8472584744ed",
        "body" : "so `exit $LASTEXITCODE` is setting `%ERRORLEVEL%`?",
        "createdAt" : "2020-08-28T17:21:51Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "7ae842f7-1029-4528-8bf6-8472584744ed",
        "tags" : [
        ]
      },
      {
        "id" : "61f68177-0149-4de5-8663-b243987f7716",
        "parentId" : "9d2b0207-a68e-4cad-ad33-b1b36805116c",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Yes, by default when you run powershell with -Command, all non-zero exit codes are translated into `1`.  This LASTEXITCODE trick allows me to set the exit code to the value from the command, which I set to 2 specifically for the case where the version is incorrect.",
        "createdAt" : "2020-08-28T17:24:54Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "df1595a2-72ce-4e80-aec8-86c636f0e1eb",
        "parentId" : "9d2b0207-a68e-4cad-ad33-b1b36805116c",
        "authorId" : "7ae842f7-1029-4528-8bf6-8472584744ed",
        "body" : "Could you add a comment, just because I know I won't remember that? Otherwise, LGTM.",
        "createdAt" : "2020-08-28T17:39:39Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "7ae842f7-1029-4528-8bf6-8472584744ed",
        "tags" : [
        ]
      },
      {
        "id" : "7e615239-8b55-4ed5-9c72-6d7e83958130",
        "parentId" : "9d2b0207-a68e-4cad-ad33-b1b36805116c",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "Added more details and combined the two comments",
        "createdAt" : "2020-08-28T18:04:48Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4208cfb36de6b18e26496a6c6916c4e1c2d081",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +96,100 @@    REM into 1. The exit code 2 is used to detect the case where the major version is incorrect and there should be\n    REM no subsequent retries.\n    %powershell_executable% -ExecutionPolicy Bypass -Command \"Unblock-File -Path '%update_dart_bin%'; & '%update_dart_bin%'; exit $LASTEXITCODE;\"\n    IF \"%ERRORLEVEL%\" EQU \"2\" (\n      EXIT 1"
  },
  {
    "id" : "049498ee-29cc-48d2-a016-3d6967e5a5a6",
    "prId" : 64773,
    "prUrl" : "https://github.com/flutter/flutter/pull/64773#pullrequestreview-478057820",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cf98f178-80f7-4725-96cf-c88b4c5534d8",
        "parentId" : null,
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "I _think_ this only exits you out of the subroutine and then actually not sure what it executes next (would it retry the subroutine again? That wouldn't make much sense since this error is unreoverable.). I would have expected this to set `exit_code` and then jump to `: final_exit`?",
        "createdAt" : "2020-08-28T21:18:12Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "e58d4a87-3f7e-4639-8c68-6580653fa1e9",
        "parentId" : "cf98f178-80f7-4725-96cf-c88b4c5534d8",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "/B is subroutine only - you can test this locally by removing the condition for the pwsh version detection, but it will immediately exit.",
        "createdAt" : "2020-08-28T22:30:09Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "52b3f804-4be8-48fc-9579-377a6d3b33ec",
        "parentId" : "cf98f178-80f7-4725-96cf-c88b4c5534d8",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "I wonder why we do the 'final_exit' dance below then... But if you tried this and it works: LGTM",
        "createdAt" : "2020-08-28T22:34:10Z",
        "updatedAt" : "2020-08-31T16:02:27Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4208cfb36de6b18e26496a6c6916c4e1c2d081",
    "line" : 10,
    "diffHunk" : "@@ -1,1 +98,102 @@    %powershell_executable% -ExecutionPolicy Bypass -Command \"Unblock-File -Path '%update_dart_bin%'; & '%update_dart_bin%'; exit $LASTEXITCODE;\"\n    IF \"%ERRORLEVEL%\" EQU \"2\" (\n      EXIT 1\n    )\n    IF \"%ERRORLEVEL%\" NEQ \"0\" ("
  },
  {
    "id" : "2411094f-f170-4a7e-8210-914178aae1e0",
    "prId" : 65422,
    "prUrl" : "https://github.com/flutter/flutter/pull/65422#pullrequestreview-488003873",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7c85b014-9181-4277-8a63-2544f6ebb789",
        "parentId" : null,
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "This needs to be a full exit",
        "createdAt" : "2020-09-14T17:43:27Z",
        "updatedAt" : "2020-09-14T17:43:27Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "e701db1986bbe390ad9fa4df7878599ab47a0917",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +51,55 @@  ECHO        this path. Try moving the flutter directory to a writable location, 1>&2\n  ECHO        such as within your home directory.                                 1>&2\n  EXIT 1\n)\n"
  },
  {
    "id" : "b106ab23-2f4c-4b48-9ad7-3ab2b56bcf68",
    "prId" : 65422,
    "prUrl" : "https://github.com/flutter/flutter/pull/65422#pullrequestreview-488003974",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b82ac198-39dc-4aa9-9191-6450a0fe2930",
        "parentId" : null,
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "This also needs to be a full exit",
        "createdAt" : "2020-09-14T17:43:34Z",
        "updatedAt" : "2020-09-14T17:43:34Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "e701db1986bbe390ad9fa4df7878599ab47a0917",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +37,41 @@    ECHO Error: PowerShell executable not found.                        1>&2\n    ECHO        Either pwsh.exe or PowerShell.exe must be in your PATH. 1>&2\n    EXIT 1\n)\n"
  },
  {
    "id" : "4ca3ca38-45e0-4c2d-92c5-92195e3b584f",
    "prId" : 65422,
    "prUrl" : "https://github.com/flutter/flutter/pull/65422#pullrequestreview-490085731",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b985b393-25b9-4c3f-b673-e44ac5055091",
        "parentId" : null,
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "If I don't shorten this message, then `:upgrade_succeeded` cannot be located from the `GOTO` on L137 when running the hostonly windoows machines.",
        "createdAt" : "2020-09-14T17:47:14Z",
        "updatedAt" : "2020-09-14T17:47:14Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      },
      {
        "id" : "eea0dfd8-6918-423d-8fed-18c66fb1ff91",
        "parentId" : "b985b393-25b9-4c3f-b673-e44ac5055091",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "Wait, what? Why's that?",
        "createdAt" : "2020-09-14T20:55:35Z",
        "updatedAt" : "2020-09-15T22:41:21Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "f980e8d3-405e-4dc5-9704-66fdb2d259cc",
        "parentId" : "b985b393-25b9-4c3f-b673-e44ac5055091",
        "authorId" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "body" : "good question!\r\n\r\nI've seen some information that GOTO label can behave weird if the label is outside of some certain size block, but from what I read that only applies if unix line endings are used. however, without fail the hostonly windows machines could not locate the `upgrade_succeeded` label with the longer message.",
        "createdAt" : "2020-09-16T23:31:51Z",
        "updatedAt" : "2020-09-16T23:31:51Z",
        "lastEditedBy" : "e73873df-c6ef-4dd5-ad17-dc7a574dcf0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "e701db1986bbe390ad9fa4df7878599ab47a0917",
    "line" : 84,
    "diffHunk" : "@@ -1,1 +143,147 @@      :upgrade_retries_exhausted\n        SET exit_code=%ERRORLEVEL%\n        ECHO Error: 'pub upgrade' still failing after %total_tries% tries. 1>&2\n        GOTO final_exit\n      :upgrade_succeeded"
  },
  {
    "id" : "e994f8de-069f-47bf-b136-8e5e1cc72e2f",
    "prId" : 65422,
    "prUrl" : "https://github.com/flutter/flutter/pull/65422#pullrequestreview-490021738",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a252bc9-091b-4ccf-ae92-4b331995f82e",
        "parentId" : null,
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "Did you double check that this redirects the right thing to the right thing in real life? Line 57/59 does some funny business with the descriptors (see comment in line 58). I almost would have expected a redirect to \"3\" since that supposedly should be stderr now. Unless of course the file descriptor magic doesn't apply inside the subroutine... ",
        "createdAt" : "2020-09-15T22:41:14Z",
        "updatedAt" : "2020-09-15T22:41:20Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      },
      {
        "id" : "ec012d8f-dc24-4c49-b499-b9ea360ecf5f",
        "parentId" : "0a252bc9-091b-4ccf-ae92-4b331995f82e",
        "authorId" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "body" : "Now that I think about this again, the way you have it is correct, I believe. Line 59 redirects stderr \"2\" of this subroutine to \"3\", which is stderr in the call context of the subroutine, but not within the subroutine. ",
        "createdAt" : "2020-09-16T21:07:59Z",
        "updatedAt" : "2020-09-16T21:07:59Z",
        "lastEditedBy" : "d61ab95a-0bf0-4571-9098-19991dd821ca",
        "tags" : [
        ]
      }
    ],
    "commit" : "e701db1986bbe390ad9fa4df7878599ab47a0917",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +89,93 @@\n  :do_sdk_update_and_snapshot\n    ECHO Checking Dart SDK version... 1>&2\n    SET update_dart_bin=%FLUTTER_ROOT%\\bin\\internal\\update_dart_sdk.ps1\n    REM Escape apostrophes from the executable path"
  }
]